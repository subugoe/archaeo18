var arrayIndex=function(c,b){if(Array.indexOf){return c.indexOf(b)}for(var a=0;a<c.length;a++){if(c[a]==b){return a}}return -1};var STIMinifier_urlPrefix;for(var i=0;i<document.getElementsByTagName("script").length;i++){var script=document.getElementsByTagName("script")[i];var index=script.src.indexOf("minify/geotico-complete");if(index!=-1){STIMinifier_urlPrefix=script.src.substring(0,index);break}}if(!document.createElement("canvas").getContext){(function(){var w=Math;var x=w.round;var t=w.sin;var F=w.cos;var o=w.abs;var E=w.sqrt;var a=10;var p=a/2;function h(){return this.context_||(this.context_=new r(this))}var v=Array.prototype.slice;function G(m,H,I){var j=v.call(arguments,2);return function(){return m.apply(H,j.concat(v.call(arguments)))}}var k={init:function(j){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var m=j||document;m.createElement("canvas");m.attachEvent("onreadystatechange",G(this.init_,this,m))}},init_:function(I){if(!I.namespaces.g_vml_){I.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML")}if(!I.namespaces.g_o_){I.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}if(!I.styleSheets.ex_canvas_){var H=I.createStyleSheet();H.owningElement.id="ex_canvas_";H.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}var m=I.getElementsByTagName("canvas");for(var j=0;j<m.length;j++){this.initElement(m[j])}},initElement:function(m){if(!m.getContext){m.getContext=h;m.innerHTML="";m.attachEvent("onpropertychange",D);m.attachEvent("onresize",b);var j=m.attributes;if(j.width&&j.width.specified){m.style.width=j.width.nodeValue+"px"}else{m.width=m.clientWidth}if(j.height&&j.height.specified){m.style.height=j.height.nodeValue+"px"}else{m.height=m.clientHeight}}return m}};function D(m){var j=m.srcElement;switch(m.propertyName){case"width":j.style.width=j.attributes.width.nodeValue+"px";j.getContext().clearRect();break;case"height":j.style.height=j.attributes.height.nodeValue+"px";j.getContext().clearRect();break}}function b(m){var j=m.srcElement;if(j.firstChild){j.firstChild.style.width=j.clientWidth+"px";j.firstChild.style.height=j.clientHeight+"px"}}k.init();var e=[];for(var A=0;A<16;A++){for(var z=0;z<16;z++){e[A*16+z]=A.toString(16)+z.toString(16)}}function s(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(I,H){var m=s();for(var j=0;j<3;j++){for(var L=0;L<3;L++){var J=0;for(var K=0;K<3;K++){J+=I[j][K]*H[K][L]}m[j][L]=J}}return m}function y(m,j){j.fillStyle=m.fillStyle;j.lineCap=m.lineCap;j.lineJoin=m.lineJoin;j.lineWidth=m.lineWidth;j.miterLimit=m.miterLimit;j.shadowBlur=m.shadowBlur;j.shadowColor=m.shadowColor;j.shadowOffsetX=m.shadowOffsetX;j.shadowOffsetY=m.shadowOffsetY;j.strokeStyle=m.strokeStyle;j.globalAlpha=m.globalAlpha;j.arcScaleX_=m.arcScaleX_;j.arcScaleY_=m.arcScaleY_;j.lineScale_=m.lineScale_}function c(m){var J,I=1;m=String(m);if(m.substring(0,3)=="rgb"){var L=m.indexOf("(",3);var j=m.indexOf(")",L+1);var K=m.substring(L+1,j).split(",");J="#";for(var H=0;H<3;H++){J+=e[Number(K[H])]}if(K.length==4&&m.substr(3,1)=="a"){I=K[3]}}else{J=m}return{color:J,alpha:I}}function u(j){switch(j){case"butt":return"flat";case"round":return"round";case"square":default:return"square"}}function r(m){this.m_=s();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle="#000";this.fillStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=a*1;this.globalAlpha=1;this.canvas=m;var j=m.ownerDocument.createElement("div");j.style.width=m.clientWidth+"px";j.style.height=m.clientHeight+"px";j.style.overflow="hidden";j.style.position="absolute";m.appendChild(j);this.element_=j;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1}var l=r.prototype;l.clearRect=function(){this.element_.innerHTML=""};l.beginPath=function(){this.currentPath_=[]};l.moveTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"moveTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};l.lineTo=function(m,j){var H=this.getCoords_(m,j);this.currentPath_.push({type:"lineTo",x:H.x,y:H.y});this.currentX_=H.x;this.currentY_=H.y};l.bezierCurveTo=function(H,m,N,M,L,J){var j=this.getCoords_(L,J);var K=this.getCoords_(H,m);var I=this.getCoords_(N,M);q(this,K,I,j)};function q(j,I,H,m){j.currentPath_.push({type:"bezierCurveTo",cp1x:I.x,cp1y:I.y,cp2x:H.x,cp2y:H.y,x:m.x,y:m.y});j.currentX_=m.x;j.currentY_=m.y}l.quadraticCurveTo=function(L,H,m,j){var K=this.getCoords_(L,H);var J=this.getCoords_(m,j);var M={x:this.currentX_+2/3*(K.x-this.currentX_),y:this.currentY_+2/3*(K.y-this.currentY_)};var I={x:M.x+(J.x-this.currentX_)/3,y:M.y+(J.y-this.currentY_)/3};q(this,M,I,J)};l.arc=function(O,M,N,J,m,H){N*=a;var S=H?"at":"wa";var P=O+F(J)*N-p;var R=M+t(J)*N-p;var j=O+F(m)*N-p;var Q=M+t(m)*N-p;if(P==j&&!H){P+=0.125}var I=this.getCoords_(O,M);var L=this.getCoords_(P,R);var K=this.getCoords_(j,Q);this.currentPath_.push({type:S,x:I.x,y:I.y,radius:N,xStart:L.x,yStart:L.y,xEnd:K.x,yEnd:K.y})};l.rect=function(H,m,j,I){this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath()};l.strokeRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.stroke();this.currentPath_=J};l.fillRect=function(H,m,j,I){var J=this.currentPath_;this.beginPath();this.moveTo(H,m);this.lineTo(H+j,m);this.lineTo(H+j,m+I);this.lineTo(H,m+I);this.closePath();this.fill();this.currentPath_=J};l.createLinearGradient=function(m,I,j,H){var J=new B("gradient");J.x0_=m;J.y0_=I;J.x1_=j;J.y1_=H;return J};l.createRadialGradient=function(I,K,H,m,J,j){var L=new B("gradientradial");L.x0_=I;L.y0_=K;L.r0_=H;L.x1_=m;L.y1_=J;L.r1_=j;return L};l.drawImage=function(V,I){var O,M,Q,ad,T,R,Y,af;var P=V.runtimeStyle.width;var U=V.runtimeStyle.height;V.runtimeStyle.width="auto";V.runtimeStyle.height="auto";var N=V.width;var ab=V.height;V.runtimeStyle.width=P;V.runtimeStyle.height=U;if(arguments.length==3){O=arguments[1];M=arguments[2];T=R=0;Y=Q=N;af=ad=ab}else{if(arguments.length==5){O=arguments[1];M=arguments[2];Q=arguments[3];ad=arguments[4];T=R=0;Y=N;af=ab}else{if(arguments.length==9){T=arguments[1];R=arguments[2];Y=arguments[3];af=arguments[4];O=arguments[5];M=arguments[6];Q=arguments[7];ad=arguments[8]}else{throw Error("Invalid number of arguments")}}}var ae=this.getCoords_(O,M);var J=Y/2;var m=af/2;var ac=[];var j=10;var L=10;ac.push(" <g_vml_:group",' coordsize="',a*j,",",a*L,'"',' coordorigin="0,0"',' style="width:',j,"px;height:",L,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var K=[];K.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",x(ae.x/a),",","Dy=",x(ae.y/a),"");var aa=ae;var Z=this.getCoords_(O+Q,M);var X=this.getCoords_(O,M+ad);var S=this.getCoords_(O+Q,M+ad);aa.x=w.max(aa.x,Z.x,X.x,S.x);aa.y=w.max(aa.y,Z.y,X.y,S.y);ac.push("padding:0 ",x(aa.x/a),"px ",x(aa.y/a),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",K.join(""),", sizingmethod='clip');")}else{ac.push("top:",x(ae.y/a),"px;left:",x(ae.x/a),"px;")}ac.push(' ">','<g_vml_:image src="',V.src,'"',' style="width:',a*Q,"px;"," height:",a*ad,'px;"',' cropleft="',T/N,'"',' croptop="',R/ab,'"',' cropright="',(N-T-Y)/N,'"',' cropbottom="',(ab-R-af)/ab,'"'," />","</g_vml_:group>");this.element_.insertAdjacentHTML("BeforeEnd",ac.join(""))};l.stroke=function(ah){var M=[];var N=false;var at=c(ah?this.fillStyle:this.strokeStyle);var ad=at.color;var an=at.alpha*this.globalAlpha;var J=10;var P=10;M.push("<g_vml_:shape",' filled="',!!ah,'"',' style="position:absolute;width:',J,"px;height:",P,'px;"',' coordorigin="0 0" coordsize="',a*J," ",a*P,'"',' stroked="',!ah,'"',' path="');var O=false;var ar={x:null,y:null};var Z={x:null,y:null};for(var am=0;am<this.currentPath_.length;am++){var al=this.currentPath_[am];var aq;switch(al.type){case"moveTo":aq=al;M.push(" m ",x(al.x),",",x(al.y));break;case"lineTo":M.push(" l ",x(al.x),",",x(al.y));break;case"close":M.push(" x ");al=null;break;case"bezierCurveTo":M.push(" c ",x(al.cp1x),",",x(al.cp1y),",",x(al.cp2x),",",x(al.cp2y),",",x(al.x),",",x(al.y));break;case"at":case"wa":M.push(" ",al.type," ",x(al.x-this.arcScaleX_*al.radius),",",x(al.y-this.arcScaleY_*al.radius)," ",x(al.x+this.arcScaleX_*al.radius),",",x(al.y+this.arcScaleY_*al.radius)," ",x(al.xStart),",",x(al.yStart)," ",x(al.xEnd),",",x(al.yEnd));break}if(al){if(ar.x==null||al.x<ar.x){ar.x=al.x}if(Z.x==null||al.x>Z.x){Z.x=al.x}if(ar.y==null||al.y<ar.y){ar.y=al.y}if(Z.y==null||al.y>Z.y){Z.y=al.y}}}M.push(' ">');if(!ah){var Y=this.lineScale_*this.lineWidth;if(Y<1){an*=Y}M.push("<g_vml_:stroke",' opacity="',an,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',u(this.lineCap),'"',' weight="',Y,'px"',' color="',ad,'" />')}else{if(typeof this.fillStyle=="object"){var Q=this.fillStyle;var V=0;var ak={x:0,y:0};var ae=0;var T=1;if(Q.type_=="gradient"){var S=Q.x0_/this.arcScaleX_;var m=Q.y0_/this.arcScaleY_;var R=Q.x1_/this.arcScaleX_;var au=Q.y1_/this.arcScaleY_;var ap=this.getCoords_(S,m);var ao=this.getCoords_(R,au);var L=ao.x-ap.x;var K=ao.y-ap.y;V=Math.atan2(L,K)*180/Math.PI;if(V<0){V+=360}if(V<0.000001){V=0}}else{var ap=this.getCoords_(Q.x0_,Q.y0_);var j=Z.x-ar.x;var I=Z.y-ar.y;ak={x:(ap.x-ar.x)/j,y:(ap.y-ar.y)/I};j/=this.arcScaleX_*a;I/=this.arcScaleY_*a;var aj=w.max(j,I);ae=2*Q.r0_/aj;T=2*Q.r1_/aj-ae}var ac=Q.colors_;ac.sort(function(W,H){return W.offset-H.offset});var X=ac.length;var ab=ac[0].color;var aa=ac[X-1].color;var ag=ac[0].alpha*this.globalAlpha;var af=ac[X-1].alpha*this.globalAlpha;var ai=[];for(var am=0;am<X;am++){var U=ac[am];ai.push(U.offset*T+ae+" "+U.color)}M.push('<g_vml_:fill type="',Q.type_,'"',' method="none" focus="100%"',' color="',ab,'"',' color2="',aa,'"',' colors="',ai.join(","),'"',' opacity="',af,'"',' g_o_:opacity2="',ag,'"',' angle="',V,'"',' focusposition="',ak.x,",",ak.y,'" />')}else{M.push('<g_vml_:fill color="',ad,'" opacity="',an,'" />')}}M.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",M.join(""))};l.fill=function(){this.stroke(true)};l.closePath=function(){this.currentPath_.push({type:"close"})};l.getCoords_=function(I,H){var j=this.m_;return{x:a*(I*j[0][0]+H*j[1][0]+j[2][0])-p,y:a*(I*j[0][1]+H*j[1][1]+j[2][1])-p}};l.save=function(){var j={};y(this,j);this.aStack_.push(j);this.mStack_.push(this.m_);this.m_=d(s(),this.m_)};l.restore=function(){y(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};function g(H){for(var J=0;J<3;J++){for(var I=0;I<2;I++){if(!isFinite(H[J][I])||isNaN(H[J][I])){return false}}}return true}function C(H,j,I){if(!g(j)){return}H.m_=j;if(I){var J=j[0][0]*j[1][1]-j[0][1]*j[1][0];H.lineScale_=E(o(J))}}l.translate=function(H,m){var j=[[1,0,0],[0,1,0],[H,m,1]];C(this,d(j,this.m_),false)};l.rotate=function(m){var I=F(m);var H=t(m);var j=[[I,H,0],[-H,I,0],[0,0,1]];C(this,d(j,this.m_),false)};l.scale=function(H,m){this.arcScaleX_*=H;this.arcScaleY_*=m;var j=[[H,0,0],[0,m,0],[0,0,1]];C(this,d(j,this.m_),true)};l.transform=function(J,I,L,K,m,j){var H=[[J,I,0],[L,K,0],[m,j,1]];C(this,d(H,this.m_),true)};l.setTransform=function(K,J,M,L,I,H){var j=[[K,J,0],[M,L,0],[I,H,1]];C(this,j,true)};l.clip=function(){};l.arcTo=function(){};l.createPattern=function(){return new f};function B(j){this.type_=j;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[]}B.prototype.addColorStop=function(m,j){j=c(j);this.colors_.push({offset:m,color:j.color,alpha:j.alpha})};function f(){}G_vmlCanvasManager=k;CanvasRenderingContext2D=r;CanvasGradient=B;CanvasPattern=f})()}SimileAjax_urlPrefix=STIMinifier_urlPrefix+"lib/simile/ajax/";if(typeof window.SimileAjax=="undefined"){window.SimileAjax={loadingScriptsCount:0,error:null,params:{bundle:"true"}};SimileAjax.Platform=new Object();SimileAjax.includeCssFile=function(c,a){var b=c.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a);c.getElementsByTagName("head")[0].appendChild(b)};SimileAjax.urlPrefix=SimileAjax_urlPrefix}if(!("jQuery" in window)&&!("$" in window)){(function(){var W=this,ab,F=W.jQuery,S=W.$,T=W.jQuery=W.$=function(b,a){return new T.fn.init(b,a)},M=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,ac=/^.[^:#\[\.,]*$/;T.fn=T.prototype={init:function(e,b){e=e||document;if(e.nodeType){this[0]=e;this.length=1;this.context=e;return this}if(typeof e==="string"){var c=M.exec(e);if(c&&(c[1]||!b)){if(c[1]){e=T.clean([c[1]],b)}else{var a=document.getElementById(c[3]);if(a&&a.id!=c[3]){return T().find(e)}var d=T(a||[]);d.context=document;d.selector=e;return d}}else{return T(b).find(e)}}else{if(T.isFunction(e)){return T(document).ready(e)}}if(e.selector&&e.context){this.selector=e.selector;this.context=e.context}return this.setArray(T.isArray(e)?e:T.makeArray(e))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(a){return a===ab?Array.prototype.slice.call(this):this[a]},pushStack:function(c,a,d){var b=T(c);b.prevObject=this;b.context=this.context;if(a==="find"){b.selector=this.selector+(this.selector?" ":"")+d}else{if(a){b.selector=this.selector+"."+a+"("+d+")"}}return b},setArray:function(a){this.length=0;Array.prototype.push.apply(this,a);return this},each:function(a,b){return T.each(this,a,b)},index:function(a){return T.inArray(a&&a.jquery?a[0]:a,this)},attr:function(c,a,b){var d=c;if(typeof c==="string"){if(a===ab){return this[0]&&T[b||"attr"](this[0],c)}else{d={};d[c]=a}}return this.each(function(e){for(c in d){T.attr(b?this.style:this,c,T.prop(this,d[c],b,e,c))}})},css:function(b,a){if((b=="width"||b=="height")&&parseFloat(a)<0){a=ab}return this.attr(b,a,"curCSS")},text:function(a){if(typeof a!=="object"&&a!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(a))}var b="";T.each(a||this,function(){T.each(this.childNodes,function(){if(this.nodeType!=8){b+=this.nodeType!=1?this.nodeValue:T.fn.text([this])}})});return b},wrapAll:function(b){if(this[0]){var a=T(b,this[0].ownerDocument).clone();if(this[0].parentNode){a.insertBefore(this[0])}a.map(function(){var c=this;while(c.firstChild){c=c.firstChild}return c}).append(this)}return this},wrapInner:function(a){return this.each(function(){T(this).contents().wrapAll(a)})},wrap:function(a){return this.each(function(){T(this).wrapAll(a)})},append:function(){return this.domManip(arguments,true,function(a){if(this.nodeType==1){this.appendChild(a)}})},prepend:function(){return this.domManip(arguments,true,function(a){if(this.nodeType==1){this.insertBefore(a,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(a){this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,false,function(a){this.parentNode.insertBefore(a,this.nextSibling)})},end:function(){return this.prevObject||T([])},push:[].push,sort:[].sort,splice:[].splice,find:function(b){if(this.length===1){var a=this.pushStack([],"find",b);a.length=0;T.find(b,this[0],a);return a}else{return this.pushStack(T.unique(T.map(this,function(c){return T.find(b,c)})),"find",b)}},clone:function(b){var d=this.map(function(){if(!T.support.noCloneEvent&&!T.isXMLDoc(this)){var f=this.outerHTML;if(!f){var e=this.ownerDocument.createElement("div");e.appendChild(this.cloneNode(true));f=e.innerHTML}return T.clean([f.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(b===true){var a=this.find("*").andSelf(),c=0;d.find("*").andSelf().each(function(){if(this.nodeName!==a[c].nodeName){return}var g=T.data(a[c],"events");for(var e in g){for(var f in g[e]){T.event.add(this,e,g[e][f],g[e][f].data)}}c++})}return d},filter:function(a){return this.pushStack(T.isFunction(a)&&T.grep(this,function(b,c){return a.call(b,c)})||T.multiFilter(a,T.grep(this,function(b){return b.nodeType===1})),"filter",a)},closest:function(c){var a=T.expr.match.POS.test(c)?T(c):null,b=0;return this.map(function(){var d=this;while(d&&d.ownerDocument){if(a?a.index(d)>-1:T(d).is(c)){T.data(d,"closest",b);return d}d=d.parentNode;b++}})},not:function(b){if(typeof b==="string"){if(ac.test(b)){return this.pushStack(T.multiFilter(b,this,true),"not",b)}else{b=T.multiFilter(b,this)}}var a=b.length&&b[b.length-1]!==ab&&!b.nodeType;return this.filter(function(){return a?T.inArray(this,b)<0:this!=b})},add:function(a){return this.pushStack(T.unique(T.merge(this.get(),typeof a==="string"?T(a):T.makeArray(a))))},is:function(a){return !!a&&T.multiFilter(a,this).length>0},hasClass:function(a){return !!a&&this.is("."+a)},val:function(c){if(c===ab){var j=this[0];if(j){if(T.nodeName(j,"option")){return(j.attributes.value||{}).specified?j.value:j.text}if(T.nodeName(j,"select")){var e=j.selectedIndex,b=[],a=j.options,f=j.type=="select-one";if(e<0){return null}for(var h=f?e:0,d=f?e+1:a.length;h<d;h++){var g=a[h];if(g.selected){c=T(g).val();if(f){return c}b.push(c)}}return b}return(j.value||"").replace(/\r/g,"")}return ab}if(typeof c==="number"){c+=""}return this.each(function(){if(this.nodeType!=1){return}if(T.isArray(c)&&/radio|checkbox/.test(this.type)){this.checked=(T.inArray(this.value,c)>=0||T.inArray(this.name,c)>=0)}else{if(T.nodeName(this,"select")){var k=T.makeArray(c);T("option",this).each(function(){this.selected=(T.inArray(this.value,k)>=0||T.inArray(this.text,k)>=0)});if(!k.length){this.selectedIndex=-1}}else{this.value=c}}})},html:function(a){return a===ab?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(a)},replaceWith:function(a){return this.after(a).remove()},eq:function(a){return this.slice(a,+a+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(a){return this.pushStack(T.map(this,function(b,c){return a.call(b,c,b)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(d,a,b){if(this[0]){var e=(this[0].ownerDocument||this[0]).createDocumentFragment(),h=T.clean(d,(this[0].ownerDocument||this[0]),e),f=e.firstChild;if(f){for(var g=0,j=this.length;g<j;g++){b.call(c(this[g],f),this.length>1||g>0?e.cloneNode(true):e)}}if(h){T.each(h,E)}}return this;function c(l,k){return a&&T.nodeName(l,"table")&&T.nodeName(k,"tr")?(l.getElementsByTagName("tbody")[0]||l.appendChild(l.ownerDocument.createElement("tbody"))):l}}};T.fn.init.prototype=T.fn;function E(b,a){if(a.src){T.ajax({url:a.src,async:false,dataType:"script"})}else{T.globalEval(a.text||a.textContent||a.innerHTML||"")}if(a.parentNode){a.parentNode.removeChild(a)}}function ad(){return +new Date}T.extend=T.fn.extend=function(){var c=arguments[0]||{},e=1,d=arguments.length,h=false,f;if(typeof c==="boolean"){h=c;c=arguments[1]||{};e=2}if(typeof c!=="object"&&!T.isFunction(c)){c={}}if(d==e){c=this;--e}for(;e<d;e++){if((f=arguments[e])!=null){for(var g in f){var b=c[g],a=f[g];if(c===a){continue}if(h&&a&&typeof a==="object"&&!a.nodeType){c[g]=T.extend(h,b||(a.length!=null?[]:{}),a)}else{if(a!==ab){c[g]=a}}}}}return c};var ag=/z-?index|font-?weight|opacity|zoom|line-?height/i,Q=document.defaultView||{},L=Object.prototype.toString;T.extend({noConflict:function(a){W.$=S;if(a){W.jQuery=F}return T},isFunction:function(a){return L.call(a)==="[object Function]"},isArray:function(a){return L.call(a)==="[object Array]"},isXMLDoc:function(a){return a.nodeType===9&&a.documentElement.nodeName!=="HTML"||!!a.ownerDocument&&T.isXMLDoc(a.ownerDocument)},globalEval:function(a){if(a&&/\S/.test(a)){var b=document.getElementsByTagName("head")[0]||document.documentElement,c=document.createElement("script");c.type="text/javascript";if(T.support.scriptEval){c.appendChild(document.createTextNode(a))}else{c.text=a}b.insertBefore(c,b.firstChild);b.removeChild(c)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()==b.toUpperCase()},each:function(e,a,f){var g,d=0,c=e.length;if(f){if(c===ab){for(g in e){if(a.apply(e[g],f)===false){break}}}else{for(;d<c;){if(a.apply(e[d++],f)===false){break}}}}else{if(c===ab){for(g in e){if(a.call(e[g],g,e[g])===false){break}}}else{for(var b=e[0];d<c&&a.call(b,d,b)!==false;b=e[++d]){}}}return e},prop:function(b,a,c,d,e){if(T.isFunction(a)){a=a.call(b,d)}return typeof a==="number"&&c=="curCSS"&&!ag.test(e)?a+"px":a},className:{add:function(b,a){T.each((a||"").split(/\s+/),function(d,c){if(b.nodeType==1&&!T.className.has(b.className,c)){b.className+=(b.className?" ":"")+c}})},remove:function(b,a){if(b.nodeType==1){b.className=a!==ab?T.grep(b.className.split(/\s+/),function(c){return !T.className.has(a,c)}).join(" "):""}},has:function(a,b){return a&&T.inArray(b,(a.className||a).toString().split(/\s+/))>-1}},swap:function(b,c,a){var e={};for(var d in c){e[d]=b.style[d];b.style[d]=c[d]}a.call(b);for(var d in c){b.style[d]=e[d]}},css:function(e,g,c,h){if(g=="width"||g=="height"){var a,f={position:"absolute",visibility:"hidden",display:"block"},b=g=="width"?["Left","Right"]:["Top","Bottom"];function d(){a=g=="width"?e.offsetWidth:e.offsetHeight;if(h==="border"){return}T.each(b,function(){if(!h){a-=parseFloat(T.curCSS(e,"padding"+this,true))||0}if(h==="margin"){a+=parseFloat(T.curCSS(e,"margin"+this,true))||0}else{a-=parseFloat(T.curCSS(e,"border"+this+"Width",true))||0}})}if(e.offsetWidth!==0){d()}else{T.swap(e,f,d)}return Math.max(0,Math.round(a))}return T.curCSS(e,g,c)},curCSS:function(e,h,g){var b,j=e.style;if(h=="opacity"&&!T.support.opacity){b=T.attr(j,"opacity");return b==""?"1":b}if(h.match(/float/i)){h=H}if(!g&&j&&j[h]){b=j[h]}else{if(Q.getComputedStyle){if(h.match(/float/i)){h="float"}h=h.replace(/([A-Z])/g,"-$1").toLowerCase();var a=Q.getComputedStyle(e,null);if(a){b=a.getPropertyValue(h)}if(h=="opacity"&&b==""){b="1"}}else{if(e.currentStyle){var d=h.replace(/\-(\w)/g,function(l,k){return k.toUpperCase()});b=e.currentStyle[h]||e.currentStyle[d];if(!/^\d+(px)?$/i.test(b)&&/^\d/.test(b)){var f=j.left,c=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left;j.left=b||0;b=j.pixelLeft+"px";j.left=f;e.runtimeStyle.left=c}}}}return b},clean:function(g,b,d){b=b||document;if(typeof b.createElement==="undefined"){b=b.ownerDocument||b[0]&&b[0].ownerDocument||document}if(!d&&g.length===1&&typeof g[0]==="string"){var e=/^<(\w+)\s*\/?>$/.exec(g[0]);if(e){return[b.createElement(e[1])]}}var f=[],h=[],a=b.createElement("div");T.each(g,function(m,j){if(typeof j==="number"){j+=""}if(!j){return}if(typeof j==="string"){j=j.replace(/(<(\w+)[^>]*?)\/>/g,function(s,r,t){return t.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?s:r+"></"+t+">"});var o=j.replace(/^\s+/,"").substring(0,10).toLowerCase();var l=!o.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!o.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||o.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!o.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!o.indexOf("<td")||!o.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!o.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!T.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];a.innerHTML=l[1]+j+l[2];while(l[0]--){a=a.lastChild}if(!T.support.tbody){var k=/<tbody/i.test(j),p=!o.indexOf("<table")&&!k?a.firstChild&&a.firstChild.childNodes:l[1]=="<table>"&&!k?a.childNodes:[];for(var q=p.length-1;q>=0;--q){if(T.nodeName(p[q],"tbody")&&!p[q].childNodes.length){p[q].parentNode.removeChild(p[q])}}}if(!T.support.leadingWhitespace&&/^\s/.test(j)){a.insertBefore(b.createTextNode(j.match(/^\s*/)[0]),a.firstChild)}j=T.makeArray(a.childNodes)}if(j.nodeType){f.push(j)}else{f=T.merge(f,j)}});if(d){for(var c=0;f[c];c++){if(T.nodeName(f[c],"script")&&(!f[c].type||f[c].type.toLowerCase()==="text/javascript")){h.push(f[c].parentNode?f[c].parentNode.removeChild(f[c]):f[c])}else{if(f[c].nodeType===1){f.splice.apply(f,[c+1,0].concat(T.makeArray(f[c].getElementsByTagName("script"))))}d.appendChild(f[c])}}return h}return f},attr:function(c,f,b){if(!c||c.nodeType==3||c.nodeType==8){return ab}var e=!T.isXMLDoc(c),a=b!==ab;f=e&&T.props[f]||f;if(c.tagName){var g=/href|src|style/.test(f);if(f=="selected"&&c.parentNode){c.parentNode.selectedIndex}if(f in c&&e&&!g){if(a){if(f=="type"&&T.nodeName(c,"input")&&c.parentNode){throw"type property can't be changed"}c[f]=b}if(T.nodeName(c,"form")&&c.getAttributeNode(f)){return c.getAttributeNode(f).nodeValue}if(f=="tabIndex"){var d=c.getAttributeNode("tabIndex");return d&&d.specified?d.value:c.nodeName.match(/(button|input|object|select|textarea)/i)?0:c.nodeName.match(/^(a|area)$/i)&&c.href?0:ab}return c[f]}if(!T.support.style&&e&&f=="style"){return T.attr(c.style,"cssText",b)}if(a){c.setAttribute(f,""+b)}var h=!T.support.hrefNormalized&&e&&g?c.getAttribute(f,2):c.getAttribute(f);return h===null?ab:h}if(!T.support.opacity&&f=="opacity"){if(a){c.zoom=1;c.filter=(c.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(b)+""=="NaN"?"":"alpha(opacity="+b*100+")")}return c.filter&&c.filter.indexOf("opacity=")>=0?(parseFloat(c.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}f=f.replace(/-([a-z])/ig,function(k,j){return j.toUpperCase()});if(a){c[f]=b}return c[f]},trim:function(a){return(a||"").replace(/^\s+|\s+$/g,"")},makeArray:function(a){var c=[];if(a!=null){var b=a.length;if(b==null||typeof a==="string"||T.isFunction(a)||a.setInterval){c[0]=a}else{while(b){c[--b]=a[b]}}}return c},inArray:function(b,a){for(var d=0,c=a.length;d<c;d++){if(a[d]===b){return d}}return -1},merge:function(b,e){var d=0,c,a=b.length;if(!T.support.getAll){while((c=e[d++])!=null){if(c.nodeType!=8){b[a++]=c}}}else{while((c=e[d++])!=null){b[a++]=c}}return b},unique:function(a){var f=[],g={};try{for(var e=0,d=a.length;e<d;e++){var b=T.data(a[e]);if(!g[b]){g[b]=true;f.push(a[e])}}}catch(c){f=a}return f},grep:function(e,a,f){var d=[];for(var c=0,b=e.length;c<b;c++){if(!f!=!a(e[c],c)){d.push(e[c])}}return d},map:function(f,a){var e=[];for(var d=0,c=f.length;d<c;d++){var b=a(f[d],d);if(b!=null){e[e.length]=b}}return e.concat.apply([],e)}});var O=navigator.userAgent.toLowerCase();T.browser={version:(O.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(O),opera:/opera/.test(O),msie:/msie/.test(O)&&!/opera/.test(O),mozilla:/mozilla/.test(O)&&!/(compatible|webkit)/.test(O)};T.each({parent:function(a){return a.parentNode},parents:function(a){return T.dir(a,"parentNode")},next:function(a){return T.nth(a,2,"nextSibling")},prev:function(a){return T.nth(a,2,"previousSibling")},nextAll:function(a){return T.dir(a,"nextSibling")},prevAll:function(a){return T.dir(a,"previousSibling")},siblings:function(a){return T.sibling(a.parentNode.firstChild,a)},children:function(a){return T.sibling(a.firstChild)},contents:function(a){return T.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:T.makeArray(a.childNodes)}},function(b,a){T.fn[b]=function(d){var c=T.map(this,a);if(d&&typeof d=="string"){c=T.multiFilter(d,c)}return this.pushStack(T.unique(c),b,d)}});T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,a){T.fn[b]=function(h){var e=[],c=T(h);for(var d=0,g=c.length;d<g;d++){var f=(d>0?this.clone(true):this).get();T.fn[a].apply(T(c[d]),f);e=e.concat(f)}return this.pushStack(e,b,h)}});T.each({removeAttr:function(a){T.attr(this,a,"");if(this.nodeType==1){this.removeAttribute(a)}},addClass:function(a){T.className.add(this,a)},removeClass:function(a){T.className.remove(this,a)},toggleClass:function(a,b){if(typeof b!=="boolean"){b=!T.className.has(this,a)}T.className[b?"add":"remove"](this,a)},remove:function(a){if(!a||T.filter(a,[this]).length){T("*",this).add([this]).each(function(){T.event.remove(this);T.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){T(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(b,a){T.fn[b]=function(){return this.each(a,arguments)}});function Y(b,a){return b[0]&&parseInt(T.curCSS(b[0],a,true),10)||0}var aa="jQuery"+ad(),I=0,R={};T.extend({cache:{},data:function(c,d,b){c=c==W?R:c;var a=c[aa];if(!a){a=c[aa]=++I}if(d&&!T.cache[a]){T.cache[a]={}}if(b!==ab){T.cache[a][d]=b}return d?T.cache[a][d]:a},removeData:function(c,d){c=c==W?R:c;var a=c[aa];if(d){if(T.cache[a]){delete T.cache[a][d];d="";for(d in T.cache[a]){break}if(!d){T.removeData(c)}}}else{try{delete c[aa]}catch(b){if(c.removeAttribute){c.removeAttribute(aa)}}delete T.cache[a]}},queue:function(c,d,a){if(c){d=(d||"fx")+"queue";var b=T.data(c,d);if(!b||T.isArray(a)){b=T.data(c,d,T.makeArray(a))}else{if(a){b.push(a)}}}return b},dequeue:function(a,b){var d=T.queue(a,b),c=d.shift();if(!b||b==="fx"){c=d[0]}if(c!==ab){c.call(a)}}});T.fn.extend({data:function(d,b){var a=d.split(".");a[1]=a[1]?"."+a[1]:"";if(b===ab){var c=this.triggerHandler("getData"+a[1]+"!",[a[0]]);if(c===ab&&this.length){c=T.data(this[0],d)}return c===ab&&a[1]?this.data(a[0]):c}else{return this.trigger("setData"+a[1]+"!",[a[0],b]).each(function(){T.data(this,d,b)})}},removeData:function(a){return this.each(function(){T.removeData(this,a)})},queue:function(b,a){if(typeof b!=="string"){a=b;b="fx"}if(a===ab){return T.queue(this[0],b)}return this.each(function(){var c=T.queue(this,b,a);if(b=="fx"&&c.length==1){c[0].call(this)}})},dequeue:function(a){return this.each(function(){T.dequeue(this,a)})}});(function(){var b=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,h=0,m=Object.prototype.toString;var p=function(t,x,ak,aj){ak=ak||[];x=x||document;if(x.nodeType!==1&&x.nodeType!==9){return[]}if(!t||typeof t!=="string"){return ak}var s=[],v,C,z,y,ai,w,u=true;b.lastIndex=0;while((v=b.exec(t))!==null){s.push(v[1]);if(v[2]){w=RegExp.rightContext;break}}if(s.length>1&&g.exec(t)){if(s.length===2&&l.relative[s[0]]){C=k(s[0]+s[1],x)}else{C=l.relative[s[0]]?[x]:p(s.shift(),x);while(s.length){t=s.shift();if(l.relative[t]){t+=s.shift()}C=k(t,C)}}}else{var D=aj?{expr:s.pop(),set:q(aj)}:p.find(s.pop(),s.length===1&&x.parentNode?x.parentNode:x,c(x));C=p.filter(D.expr,D.set);if(s.length>0){z=q(C)}else{u=false}while(s.length){var A=s.pop(),B=A;if(!l.relative[A]){A=""}else{B=s.pop()}if(B==null){B=x}l.relative[A](z,B,c(x))}}if(!z){z=C}if(!z){throw"Syntax error, unrecognized expression: "+(A||t)}if(m.call(z)==="[object Array]"){if(!u){ak.push.apply(ak,z)}else{if(x.nodeType===1){for(var r=0;z[r]!=null;r++){if(z[r]&&(z[r]===true||z[r].nodeType===1&&j(x,z[r]))){ak.push(C[r])}}}else{for(var r=0;z[r]!=null;r++){if(z[r]&&z[r].nodeType===1){ak.push(C[r])}}}}}else{q(z,ak)}if(w){p(w,x,ak,aj);if(o){hasDuplicate=false;ak.sort(o);if(hasDuplicate){for(var r=1;r<ak.length;r++){if(ak[r]===ak[r-1]){ak.splice(r--,1)}}}}}return ak};p.matches=function(s,r){return p(s,null,null,r)};p.find=function(r,y,z){var s,u;if(!r){return[]}for(var v=0,w=l.order.length;v<w;v++){var t=l.order[v],u;if((u=l.match[t].exec(r))){var x=RegExp.leftContext;if(x.substr(x.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,"");s=l.find[t](u,y,z);if(s!=null){r=r.replace(l.match[t],"");break}}}}if(!s){s=y.getElementsByTagName("*")}return{set:s,expr:r}};p.filter=function(ai,aj,B,v){var w=ai,z=[],r=aj,t,y,s=aj&&aj[0]&&c(aj[0]);while(ai&&aj.length){for(var ak in l.filter){if((t=l.match[ak].exec(ai))!=null){var x=l.filter[ak],A,C;y=false;if(r==z){z=[]}if(l.preFilter[ak]){t=l.preFilter[ak](t,r,B,z,v,s);if(!t){y=A=true}else{if(t===true){continue}}}if(t){for(var u=0;(C=r[u])!=null;u++){if(C){A=x(C,t,u,r);var D=v^!!A;if(B&&A!=null){if(D){y=true}else{r[u]=false}}else{if(D){z.push(C);y=true}}}}}if(A!==ab){if(!B){r=z}ai=ai.replace(l.match[ak],"");if(!y){return[]}break}}}if(ai==w){if(y==null){throw"Syntax error, unrecognized expression: "+ai}else{break}}w=ai}return r};var l=p.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(r){return r.getAttribute("href")}},relative:{"+":function(r,y,s){var u=typeof y==="string",z=u&&!/\W/.test(y),t=u&&!z;if(z&&!s){y=y.toUpperCase()}for(var v=0,w=r.length,x;v<w;v++){if((x=r[v])){while((x=x.previousSibling)&&x.nodeType!==1){}r[v]=t||x&&x.nodeName===y?x||false:x===y}}if(t){p.filter(y,r,true)}},">":function(w,t,v){var y=typeof t==="string";if(y&&!/\W/.test(t)){t=v?t:t.toUpperCase();for(var s=0,u=w.length;s<u;s++){var x=w[s];if(x){var r=x.parentNode;w[s]=r.nodeName===t?r:false}}}else{for(var s=0,u=w.length;s<u;s++){var x=w[s];if(x){w[s]=y?x.parentNode:x.parentNode===t}}if(y){p.filter(t,w,true)}}},"":function(r,t,v){var s=h++,u=a;if(!t.match(/\W/)){var w=t=v?t:t.toUpperCase();u=d}u("parentNode",t,s,r,w,v)},"~":function(r,t,v){var s=h++,u=a;if(typeof t==="string"&&!t.match(/\W/)){var w=t=v?t:t.toUpperCase();u=d}u("previousSibling",t,s,r,w,v)}},find:{ID:function(t,s,r){if(typeof s.getElementById!=="undefined"&&!r){var u=s.getElementById(t[1]);return u?[u]:[]}},NAME:function(s,w,v){if(typeof w.getElementsByName!=="undefined"){var t=[],x=w.getElementsByName(s[1]);for(var r=0,u=x.length;r<u;r++){if(x[r].getAttribute("name")===s[1]){t.push(x[r])}}return t.length===0?null:t}},TAG:function(s,r){return r.getElementsByTagName(s[1])}},preFilter:{CLASS:function(r,t,s,u,w,v){r=" "+r[1].replace(/\\/g,"")+" ";if(v){return r}for(var y=0,x;(x=t[y])!=null;y++){if(x){if(w^(x.className&&(" "+x.className+" ").indexOf(r)>=0)){if(!s){u.push(x)}}else{if(s){t[y]=false}}}}return false},ID:function(r){return r[1].replace(/\\/g,"")},TAG:function(s,t){for(var r=0;t[r]===false;r++){}return t[r]&&c(t[r])?s[1]:s[1].toUpperCase()},CHILD:function(s){if(s[1]=="nth"){var r=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(s[2]=="even"&&"2n"||s[2]=="odd"&&"2n+1"||!/\D/.test(s[2])&&"0n+"+s[2]||s[2]);s[2]=(r[1]+(r[2]||1))-0;s[3]=r[3]-0}s[0]=h++;return s},ATTR:function(x,t,s,u,w,v){var r=x[1].replace(/\\/g,"");if(!v&&l.attrMap[r]){x[1]=l.attrMap[r]}if(x[2]==="~="){x[4]=" "+x[4]+" "}return x},PSEUDO:function(w,t,s,u,v){if(w[1]==="not"){if(w[3].match(b).length>1||/^\w/.test(w[3])){w[3]=p(w[3],null,null,t)}else{var r=p.filter(w[3],t,s,true^v);if(!s){u.push.apply(u,r)}return false}}else{if(l.match.POS.test(w[0])||l.match.CHILD.test(w[0])){return true}}return w},POS:function(r){r.unshift(true);return r}},filters:{enabled:function(r){return r.disabled===false&&r.type!=="hidden"},disabled:function(r){return r.disabled===true},checked:function(r){return r.checked===true},selected:function(r){r.parentNode.selectedIndex;return r.selected===true},parent:function(r){return !!r.firstChild},empty:function(r){return !r.firstChild},has:function(r,s,t){return !!p(t[3],r).length},header:function(r){return/h\d/i.test(r.nodeName)},text:function(r){return"text"===r.type},radio:function(r){return"radio"===r.type},checkbox:function(r){return"checkbox"===r.type},file:function(r){return"file"===r.type},password:function(r){return"password"===r.type},submit:function(r){return"submit"===r.type},image:function(r){return"image"===r.type},reset:function(r){return"reset"===r.type},button:function(r){return"button"===r.type||r.nodeName.toUpperCase()==="BUTTON"},input:function(r){return/input|select|textarea|button/i.test(r.nodeName)}},setFilters:{first:function(r,s){return s===0},last:function(s,t,u,r){return t===r.length-1},even:function(r,s){return s%2===0},odd:function(r,s){return s%2===1},lt:function(r,s,t){return s<t[3]-0},gt:function(r,s,t){return s>t[3]-0},nth:function(r,s,t){return t[3]-0==s},eq:function(r,s,t){return t[3]-0==s}},filter:{PSEUDO:function(w,s,r,v){var t=s[1],y=l.filters[t];if(y){return y(w,r,s,v)}else{if(t==="contains"){return(w.textContent||w.innerText||"").indexOf(s[3])>=0}else{if(t==="not"){var x=s[3];for(var r=0,u=x.length;r<u;r++){if(x[r]===w){return false}}return true}}}},CHILD:function(y,v){var s=v[1],x=y;switch(s){case"only":case"first":while(x=x.previousSibling){if(x.nodeType===1){return false}}if(s=="first"){return true}x=y;case"last":while(x=x.nextSibling){if(x.nodeType===1){return false}}return true;case"nth":var w=v[2],z=v[3];if(w==1&&z==0){return true}var t=v[0],A=y.parentNode;if(A&&(A.sizcache!==t||!y.nodeIndex)){var u=0;for(x=A.firstChild;x;x=x.nextSibling){if(x.nodeType===1){x.nodeIndex=++u}}A.sizcache=t}var r=y.nodeIndex-z;if(w==0){return r==0}else{return(r%w==0&&r/w>=0)}}},ID:function(r,s){return r.nodeType===1&&r.getAttribute("id")===s},TAG:function(r,s){return(s==="*"&&r.nodeType===1)||r.nodeName===s},CLASS:function(r,s){return(" "+(r.className||r.getAttribute("class"))+" ").indexOf(s)>-1},ATTR:function(w,r){var s=r[1],u=l.attrHandle[s]?l.attrHandle[s](w):w[s]!=null?w[s]:w.getAttribute(s),v=u+"",x=r[2],t=r[4];return u==null?x==="!=":x==="="?v===t:x==="*="?v.indexOf(t)>=0:x==="~="?(" "+v+" ").indexOf(t)>=0:!t?v&&u!==false:x==="!="?v!=t:x==="^="?v.indexOf(t)===0:x==="$="?v.substr(v.length-t.length)===t:x==="|="?v===t||v.substr(0,t.length+1)===t+"-":false},POS:function(w,t,s,v){var u=t[2],r=l.setFilters[u];if(r){return r(w,s,t,v)}}}};var g=l.match.POS;for(var e in l.match){l.match[e]=RegExp(l.match[e].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var q=function(r,s){r=Array.prototype.slice.call(r);if(s){s.push.apply(s,r);return s}return r};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(f){q=function(v,r){var t=r||[];if(m.call(v)==="[object Array]"){Array.prototype.push.apply(t,v)}else{if(typeof v.length==="number"){for(var s=0,u=v.length;s<u;s++){t.push(v[s])}}else{for(var s=0;v[s];s++){t.push(v[s])}}}return t}}var o;if(document.documentElement.compareDocumentPosition){o=function(s,t){var r=s.compareDocumentPosition(t)&4?-1:s===t?0:1;if(r===0){hasDuplicate=true}return r}}else{if("sourceIndex" in document.documentElement){o=function(s,t){var r=s.sourceIndex-t.sourceIndex;if(r===0){hasDuplicate=true}return r}}else{if(document.createRange){o=function(r,t){var s=r.ownerDocument.createRange(),u=t.ownerDocument.createRange();s.selectNode(r);s.collapse(true);u.selectNode(t);u.collapse(true);var v=s.compareBoundaryPoints(Range.START_TO_END,u);if(v===0){hasDuplicate=true}return v}}}}(function(){var s=document.createElement("form"),r="script"+(new Date).getTime();s.innerHTML="<input name='"+r+"'/>";var t=document.documentElement;t.insertBefore(s,t.firstChild);if(!!document.getElementById(r)){l.find.ID=function(x,w,v){if(typeof w.getElementById!=="undefined"&&!v){var u=w.getElementById(x[1]);return u?u.id===x[1]||typeof u.getAttributeNode!=="undefined"&&u.getAttributeNode("id").nodeValue===x[1]?[u]:ab:[]}};l.filter.ID=function(v,u){var w=typeof v.getAttributeNode!=="undefined"&&v.getAttributeNode("id");return v.nodeType===1&&w&&w.nodeValue===u}}t.removeChild(s)})();(function(){var r=document.createElement("div");r.appendChild(document.createComment(""));if(r.getElementsByTagName("*").length>0){l.find.TAG=function(u,v){var w=v.getElementsByTagName(u[1]);if(u[1]==="*"){var s=[];for(var t=0;w[t];t++){if(w[t].nodeType===1){s.push(w[t])}}w=s}return w}}r.innerHTML="<a href='#'></a>";if(r.firstChild&&typeof r.firstChild.getAttribute!=="undefined"&&r.firstChild.getAttribute("href")!=="#"){l.attrHandle.href=function(s){return s.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var s=p,r=document.createElement("div");r.innerHTML="<p class='TEST'></p>";if(r.querySelectorAll&&r.querySelectorAll(".TEST").length===0){return}p=function(w,x,u,t){x=x||document;if(!t&&x.nodeType===9&&!c(x)){try{return q(x.querySelectorAll(w),u)}catch(v){}}return s(w,x,u,t)};p.find=s.find;p.filter=s.filter;p.selectors=s.selectors;p.matches=s.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var r=document.createElement("div");r.innerHTML="<div class='test e'></div><div class='test'></div>";if(r.getElementsByClassName("e").length===0){return}r.lastChild.className="e";if(r.getElementsByClassName("e").length===1){return}l.order.splice(1,0,"CLASS");l.find.CLASS=function(u,t,s){if(typeof t.getElementsByClassName!=="undefined"&&!s){return t.getElementsByClassName(u[1])}}})()}function d(x,s,t,z,r,A){var B=x=="previousSibling"&&!A;for(var v=0,w=z.length;v<w;v++){var y=z[v];if(y){if(B&&y.nodeType===1){y.sizcache=t;y.sizset=v}y=y[x];var u=false;while(y){if(y.sizcache===t){u=z[y.sizset];break}if(y.nodeType===1&&!A){y.sizcache=t;y.sizset=v}if(y.nodeName===s){u=y;break}y=y[x]}z[v]=u}}}function a(x,s,t,z,r,A){var B=x=="previousSibling"&&!A;for(var v=0,w=z.length;v<w;v++){var y=z[v];if(y){if(B&&y.nodeType===1){y.sizcache=t;y.sizset=v}y=y[x];var u=false;while(y){if(y.sizcache===t){u=z[y.sizset];break}if(y.nodeType===1){if(!A){y.sizcache=t;y.sizset=v}if(typeof s!=="string"){if(y===s){u=true;break}}else{if(p.filter(s,[y]).length>0){u=y;break}}}y=y[x]}z[v]=u}}}var j=document.compareDocumentPosition?function(r,s){return r.compareDocumentPosition(s)&16}:function(r,s){return r!==s&&(r.contains?r.contains(s):true)};var c=function(r){return r.nodeType===9&&r.documentElement.nodeName!=="HTML"||!!r.ownerDocument&&c(r.ownerDocument)};var k=function(u,w){var r=[],y="",x,s=w.nodeType?[w]:w;while((x=l.match.PSEUDO.exec(u))){y+=x[0];u=u.replace(l.match.PSEUDO,"")}u=l.relative[u]?u+"*":u;for(var v=0,t=s.length;v<t;v++){p(u,s[v],r)}return p.filter(y,r)};T.find=p;T.filter=p.filter;T.expr=p.selectors;T.expr[":"]=T.expr.filters;p.selectors.filters.hidden=function(r){return r.offsetWidth===0||r.offsetHeight===0};p.selectors.filters.visible=function(r){return r.offsetWidth>0||r.offsetHeight>0};p.selectors.filters.animated=function(r){return T.grep(T.timers,function(s){return r===s.elem}).length};T.multiFilter=function(r,t,s){if(s){r=":not("+r+")"}return p.matches(r,t)};T.dir=function(s,t){var u=[],r=s[t];while(r&&r!=document){if(r.nodeType==1){u.push(r)}r=r[t]}return u};T.nth=function(v,u,s,r){u=u||1;var t=0;for(;v;v=v[s]){if(v.nodeType==1&&++t==u){break}}return v};T.sibling=function(r,s){var t=[];for(;r;r=r.nextSibling){if(r.nodeType==1&&r!=s){t.push(r)}}return t};return;W.Sizzle=p})();T.event={add:function(c,f,d,a){if(c.nodeType==3||c.nodeType==8){return}if(c.setInterval&&c!=W){c=W}if(!d.guid){d.guid=this.guid++}if(a!==ab){var e=d;d=this.proxy(e);d.data=a}var g=T.data(c,"events")||T.data(c,"events",{}),b=T.data(c,"handle")||T.data(c,"handle",function(){return typeof T!=="undefined"&&!T.event.triggered?T.event.handle.apply(arguments.callee.elem,arguments):ab});b.elem=c;T.each(f.split(/\s+/),function(l,k){var j=k.split(".");k=j.shift();d.type=j.slice().sort().join(".");var h=g[k];if(T.event.specialAll[k]){T.event.specialAll[k].setup.call(c,a,j)}if(!h){h=g[k]={};if(!T.event.special[k]||T.event.special[k].setup.call(c,a,j)===false){if(c.addEventListener){c.addEventListener(k,b,false)}else{if(c.attachEvent){c.attachEvent("on"+k,b)}}}}h[d.guid]=d;T.event.global[k]=true});c=null},guid:1,global:{},remove:function(b,e,c){if(b.nodeType==3||b.nodeType==8){return}var f=T.data(b,"events"),g,h;if(f){if(e===ab||(typeof e==="string"&&e.charAt(0)==".")){for(var d in f){this.remove(b,d+(e||""))}}else{if(e.type){c=e.handler;e=e.type}T.each(e.split(/\s+/),function(o,l){var j=l.split(".");l=j.shift();var m=RegExp("(^|\\.)"+j.slice().sort().join(".*\\.")+"(\\.|$)");if(f[l]){if(c){delete f[l][c.guid]}else{for(var k in f[l]){if(m.test(f[l][k].type)){delete f[l][k]}}}if(T.event.specialAll[l]){T.event.specialAll[l].teardown.call(b,j)}for(g in f[l]){break}if(!g){if(!T.event.special[l]||T.event.special[l].teardown.call(b,j)===false){if(b.removeEventListener){b.removeEventListener(l,T.data(b,"handle"),false)}else{if(b.detachEvent){b.detachEvent("on"+l,T.data(b,"handle"))}}}g=null;delete f[l]}}})}for(g in f){break}if(!g){var a=T.data(b,"handle");if(a){a.elem=null}T.removeData(b,"events");T.removeData(b,"handle")}}},trigger:function(d,b,e,h){var f=d.type||d;if(!h){d=typeof d==="object"?d[aa]?d:T.extend(T.Event(f),d):T.Event(f);if(f.indexOf("!")>=0){d.type=f=f.slice(0,-1);d.exclusive=true}if(!e){d.stopPropagation();if(this.global[f]){T.each(T.cache,function(){if(this.events&&this.events[f]){T.event.trigger(d,b,this.handle.elem)}})}}if(!e||e.nodeType==3||e.nodeType==8){return ab}d.result=ab;d.target=e;b=T.makeArray(b);b.unshift(d)}d.currentTarget=e;var c=T.data(e,"handle");if(c){c.apply(e,b)}if((!e[f]||(T.nodeName(e,"a")&&f=="click"))&&e["on"+f]&&e["on"+f].apply(e,b)===false){d.result=false}if(!h&&e[f]&&!d.isDefaultPrevented()&&!(T.nodeName(e,"a")&&f=="click")){this.triggered=true;try{e[f]()}catch(a){}}this.triggered=false;if(!d.isPropagationStopped()){var g=e.parentNode||e.ownerDocument;if(g){T.event.trigger(d,b,g,true)}}},handle:function(b){var c,h;b=arguments[0]=T.event.fix(b||W.event);b.currentTarget=this;var a=b.type.split(".");b.type=a.shift();c=!a.length&&!b.exclusive;var d=RegExp("(^|\\.)"+a.slice().sort().join(".*\\.")+"(\\.|$)");h=(T.data(this,"events")||{})[b.type];for(var f in h){var e=h[f];if(c||d.test(e.type)){b.handler=e;b.data=e.data;var g=e.apply(this,arguments);if(g!==ab){b.result=g;if(g===false){b.preventDefault();b.stopPropagation()}}if(b.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(c){if(c[aa]){return c}var e=c;c=T.Event(e);for(var d=this.props.length,a;d;){a=this.props[--d];c[a]=e[a]}if(!c.target){c.target=c.srcElement||document}if(c.target.nodeType==3){c.target=c.target.parentNode}if(!c.relatedTarget&&c.fromElement){c.relatedTarget=c.fromElement==c.target?c.toElement:c.fromElement}if(c.pageX==null&&c.clientX!=null){var b=document.documentElement,f=document.body;c.pageX=c.clientX+(b&&b.scrollLeft||f&&f.scrollLeft||0)-(b.clientLeft||0);c.pageY=c.clientY+(b&&b.scrollTop||f&&f.scrollTop||0)-(b.clientTop||0)}if(!c.which&&((c.charCode||c.charCode===0)?c.charCode:c.keyCode)){c.which=c.charCode||c.keyCode}if(!c.metaKey&&c.ctrlKey){c.metaKey=c.ctrlKey}if(!c.which&&c.button){c.which=(c.button&1?1:(c.button&2?3:(c.button&4?2:0)))}return c},proxy:function(a,b){b=b||function(){return a.apply(this,arguments)};b.guid=a.guid=a.guid||b.guid||this.guid++;return b},special:{ready:{setup:P,teardown:function(){}}},specialAll:{live:{setup:function(b,a){T.event.add(this,a[0],af)},teardown:function(a){if(a.length){var c=0,b=RegExp("(^|\\.)"+a[0]+"(\\.|$)");T.each((T.data(this,"events").live||{}),function(){if(b.test(this.type)){c++}});if(c<1){T.event.remove(this,a[0],af)}}}}}};T.Event=function(a){if(!this.preventDefault){return new T.Event(a)}if(a&&a.type){this.originalEvent=a;this.type=a.type}else{this.type=a}this.timeStamp=ad();this[aa]=true};function X(){return false}function J(){return true}T.Event.prototype={preventDefault:function(){this.isDefaultPrevented=J;var a=this.originalEvent;if(!a){return}if(a.preventDefault){a.preventDefault()}a.returnValue=false},stopPropagation:function(){this.isPropagationStopped=J;var a=this.originalEvent;if(!a){return}if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=J;this.stopPropagation()},isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X};var ah=function(b){var c=b.relatedTarget;while(c&&c!=this){try{c=c.parentNode}catch(a){c=this}}if(c!=this){b.type=b.data;T.event.handle.apply(this,arguments)}};T.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(a,b){T.event.special[b]={setup:function(){T.event.add(this,a,ah,b)},teardown:function(){T.event.remove(this,a,ah)}}});T.fn.extend({bind:function(b,a,c){return b=="unload"?this.one(b,a,c):this.each(function(){T.event.add(this,b,c||a,c&&a)})},one:function(b,a,c){var d=T.event.proxy(c||a,function(e){T(this).unbind(e,d);return(c||a).apply(this,arguments)});return this.each(function(){T.event.add(this,b,d,c&&a)})},unbind:function(a,b){return this.each(function(){T.event.remove(this,a,b)})},trigger:function(b,a){return this.each(function(){T.event.trigger(b,a,this)})},triggerHandler:function(c,a){if(this[0]){var b=T.Event(c);b.preventDefault();b.stopPropagation();T.event.trigger(b,a,this[0]);return b.result}},toggle:function(a){var c=arguments,b=1;while(b<c.length){T.event.proxy(a,c[b++])}return this.click(T.event.proxy(a,function(d){this.lastToggle=(this.lastToggle||0)%b;d.preventDefault();return c[this.lastToggle++].apply(this,arguments)||false}))},hover:function(b,a){return this.mouseenter(b).mouseleave(a)},ready:function(a){P();if(T.isReady){a.call(document,T)}else{T.readyList.push(a)}return this},live:function(a,b){var c=T.event.proxy(b);c.guid+=this.selector+a;T(document).bind(Z(a,this.selector),this.selector,c);return this},die:function(a,b){T(document).unbind(Z(a,this.selector),b?{guid:b.guid+this.selector+a}:null);return this}});function af(a){var d=RegExp("(^|\\.)"+a.type+"(\\.|$)"),b=true,c=[];T.each(T.data(this,"events").live||[],function(g,f){if(d.test(f.type)){var e=T(a.target).closest(f.data)[0];if(e){c.push({elem:e,fn:f})}}});c.sort(function(e,f){return T.data(e.elem,"closest")-T.data(f.elem,"closest")});T.each(c,function(){if(this.fn.call(this.elem,a,this.fn.data)===false){return(b=false)}});return b}function Z(a,b){return["live",a,b.replace(/\./g,"`").replace(/ /g,"|")].join(".")}T.extend({isReady:false,readyList:[],ready:function(){if(!T.isReady){T.isReady=true;if(T.readyList){T.each(T.readyList,function(){this.call(document,T)});T.readyList=null}T(document).triggerHandler("ready")}}});var G=false;function P(){if(G){return}G=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);T.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);T.ready()}});if(document.documentElement.doScroll&&W==W.top){(function(){if(T.isReady){return}try{document.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}T.ready()})()}}}T.event.add(W,"load",T.ready)}T.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(a,b){T.fn[b]=function(c){return c?this.bind(b,c):this.trigger(b)}});T(W).bind("unload",function(){for(var a in T.cache){if(a!=1&&T.cache[a].handle){T.event.remove(T.cache[a].handle.elem)}}});(function(){T.support={};var f=document.documentElement,e=document.createElement("script"),a=document.createElement("div"),b="script"+(new Date).getTime();a.style.display="none";a.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var d=a.getElementsByTagName("*"),g=a.getElementsByTagName("a")[0];if(!d||!d.length||!g){return}T.support={leadingWhitespace:a.firstChild.nodeType==3,tbody:!a.getElementsByTagName("tbody").length,objectAll:!!a.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/red/.test(g.getAttribute("style")),hrefNormalized:g.getAttribute("href")==="/a",opacity:g.style.opacity==="0.5",cssFloat:!!g.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};e.type="text/javascript";try{e.appendChild(document.createTextNode("window."+b+"=1;"))}catch(c){}f.insertBefore(e,f.firstChild);if(W[b]){T.support.scriptEval=true;delete W[b]}f.removeChild(e);if(a.attachEvent&&a.fireEvent){a.attachEvent("onclick",function(){T.support.noCloneEvent=false;a.detachEvent("onclick",arguments.callee)});a.cloneNode(true).fireEvent("onclick")}T(function(){var h=document.createElement("div");h.style.width=h.style.paddingLeft="1px";document.body.appendChild(h);T.boxModel=T.support.boxModel=h.offsetWidth===2;document.body.removeChild(h).style.display="none"})})();var H=T.support.cssFloat?"cssFloat":"styleFloat";T.props={"for":"htmlFor","class":"className","float":H,cssFloat:H,styleFloat:H,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};T.fn.extend({_load:T.fn.load,load:function(e,b,a){if(typeof e!=="string"){return this._load(e)}var c=e.indexOf(" ");if(c>=0){var g=e.slice(c,e.length);e=e.slice(0,c)}var d="GET";if(b){if(T.isFunction(b)){a=b;b=null}else{if(typeof b==="object"){b=T.param(b);d="POST"}}}var f=this;T.ajax({url:e,type:d,dataType:"html",data:b,complete:function(j,h){if(h=="success"||h=="notmodified"){f.html(g?T("<div/>").append(j.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(g):j.responseText)}if(a){f.each(a,[j.responseText,h,j])}}});return this},serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?T.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(c,b){var a=T(this).val();return a==null?null:T.isArray(a)?T.map(a,function(d,e){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});T.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(b,a){T.fn[a]=function(c){return this.bind(a,c)}});var N=ad();T.extend({get:function(d,b,a,c){if(T.isFunction(b)){a=b;b=null}return T.ajax({type:"GET",url:d,data:b,success:a,dataType:c})},getScript:function(b,a){return T.get(b,null,a,"script")},getJSON:function(c,b,a){return T.get(c,b,a,"json")},post:function(d,b,a,c){if(T.isFunction(b)){a=b;b={}}return T.ajax({type:"POST",url:d,data:b,success:a,dataType:c})},ajaxSetup:function(a){T.extend(T.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return W.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(l){l=T.extend(true,l,T.extend(true,{},T.ajaxSettings,l));var a,t=/=\?(&|$)/g,f,b,s=l.type.toUpperCase();if(l.data&&l.processData&&typeof l.data!=="string"){l.data=T.param(l.data)}if(l.dataType=="jsonp"){if(s=="GET"){if(!l.url.match(t)){l.url+=(l.url.match(/\?/)?"&":"?")+(l.jsonp||"callback")+"=?"}}else{if(!l.data||!l.data.match(t)){l.data=(l.data?l.data+"&":"")+(l.jsonp||"callback")+"=?"}}l.dataType="json"}if(l.dataType=="json"&&(l.data&&l.data.match(t)||l.url.match(t))){a="jsonp"+N++;if(l.data){l.data=(l.data+"").replace(t,"="+a+"$1")}l.url=l.url.replace(t,"="+a+"$1");l.dataType="script";W[a]=function(w){b=w;q();m();W[a]=ab;try{delete W[a]}catch(v){}if(r){r.removeChild(d)}}}if(l.dataType=="script"&&l.cache==null){l.cache=false}if(l.cache===false&&s=="GET"){var u=ad();var c=l.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+u+"$2");l.url=c+((c==l.url)?(l.url.match(/\?/)?"&":"?")+"_="+u:"")}if(l.data&&s=="GET"){l.url+=(l.url.match(/\?/)?"&":"?")+l.data;l.data=null}if(l.global&&!T.active++){T.event.trigger("ajaxStart")}var g=/^(\w+:)?\/\/([^\/?#]+)/.exec(l.url);if(l.dataType=="script"&&s=="GET"&&g&&(g[1]&&g[1]!=location.protocol||g[2]!=location.host)){var r=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.src=l.url;if(l.scriptCharset){d.charset=l.scriptCharset}if(!a){var j=false;d.onload=d.onreadystatechange=function(){if(!j&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){j=true;q();m();d.onload=d.onreadystatechange=null;r.removeChild(d)}}}r.appendChild(d);return ab}var o=false;var p=l.xhr();if(l.username){p.open(s,l.url,l.async,l.username,l.password)}else{p.open(s,l.url,l.async)}try{if(l.data){p.setRequestHeader("Content-Type",l.contentType)}if(l.ifModified){p.setRequestHeader("If-Modified-Since",T.lastModified[l.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}p.setRequestHeader("X-Requested-With","XMLHttpRequest");p.setRequestHeader("Accept",l.dataType&&l.accepts[l.dataType]?l.accepts[l.dataType]+", */*":l.accepts._default)}catch(e){}if(l.beforeSend&&l.beforeSend(p,l)===false){if(l.global&&!--T.active){T.event.trigger("ajaxStop")}p.abort();return false}if(l.global){T.event.trigger("ajaxSend",[p,l])}var k=function(x){if(p.readyState==0){if(h){clearInterval(h);h=null;if(l.global&&!--T.active){T.event.trigger("ajaxStop")}}}else{if(!o&&p&&(p.readyState==4||x=="timeout")){o=true;if(h){clearInterval(h);h=null}f=x=="timeout"?"timeout":!T.httpSuccess(p)?"error":l.ifModified&&T.httpNotModified(p,l.url)?"notmodified":"success";if(f=="success"){try{b=T.httpData(p,l.dataType,l)}catch(v){f="parsererror"}}if(f=="success"){var w;try{w=p.getResponseHeader("Last-Modified")}catch(v){}if(l.ifModified&&w){T.lastModified[l.url]=w}if(!a){q()}}else{T.handleError(l,p,f)}m();if(x){p.abort()}if(l.async){p=null}}}};if(l.async){var h=setInterval(k,13);if(l.timeout>0){setTimeout(function(){if(p&&!o){k("timeout")}},l.timeout)}}try{p.send(l.data)}catch(e){T.handleError(l,p,null,e)}if(!l.async){k()}function q(){if(l.success){l.success(b,f)}if(l.global){T.event.trigger("ajaxSuccess",[p,l])}}function m(){if(l.complete){l.complete(p,f)}if(l.global){T.event.trigger("ajaxComplete",[p,l])}if(l.global&&!--T.active){T.event.trigger("ajaxStop")}}return p},handleError:function(c,a,d,b){if(c.error){c.error(a,d,b)}if(c.global){T.event.trigger("ajaxError",[a,c,b])}},active:0,httpSuccess:function(a){try{return !a.status&&location.protocol=="file:"||(a.status>=200&&a.status<300)||a.status==304||a.status==1223}catch(b){}return false},httpNotModified:function(b,d){try{var a=b.getResponseHeader("Last-Modified");return b.status==304||a==T.lastModified[d]}catch(c){}return false},httpData:function(a,c,d){var e=a.getResponseHeader("content-type"),f=c=="xml"||!c&&e&&e.indexOf("xml")>=0,b=f?a.responseXML:a.responseText;if(f&&b.documentElement.tagName=="parsererror"){throw"parsererror"}if(d&&d.dataFilter){b=d.dataFilter(b,c)}if(typeof b==="string"){if(c=="script"){T.globalEval(b)}if(c=="json"){b=W["eval"]("("+b+")")}}return b},param:function(d){var b=[];function a(f,e){b[b.length]=encodeURIComponent(f)+"="+encodeURIComponent(e)}if(T.isArray(d)||d.jquery){T.each(d,function(){a(this.name,this.value)})}else{for(var c in d){if(T.isArray(d[c])){T.each(d[c],function(){a(c,this)})}else{a(c,T.isFunction(d[c])?d[c]():d[c])}}}return b.join("&").replace(/%20/g,"+")}});var V={},U,ae=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function K(b,c){var a={};T.each(ae.concat.apply([],ae.slice(0,c)),function(){a[this]=b});return a}T.fn.extend({show:function(c,a){if(c){return this.animate(K("show",3),c,a)}else{for(var e=0,g=this.length;e<g;e++){var h=T.data(this[e],"olddisplay");this[e].style.display=h||"";if(T.css(this[e],"display")==="none"){var f=this[e].tagName,b;if(V[f]){b=V[f]}else{var d=T("<"+f+" />").appendTo("body");b=d.css("display");if(b==="none"){b="block"}d.remove();V[f]=b}T.data(this[e],"olddisplay",b)}}for(var e=0,g=this.length;e<g;e++){this[e].style.display=T.data(this[e],"olddisplay")||""}return this}},hide:function(b,a){if(b){return this.animate(K("hide",3),b,a)}else{for(var c=0,d=this.length;c<d;c++){var e=T.data(this[c],"olddisplay");if(!e&&e!=="none"){T.data(this[c],"olddisplay",T.css(this[c],"display"))}}for(var c=0,d=this.length;c<d;c++){this[c].style.display="none"}return this}},_toggle:T.fn.toggle,toggle:function(a,b){var c=typeof a==="boolean";return T.isFunction(a)&&T.isFunction(b)?this._toggle.apply(this,arguments):a==null||c?this.each(function(){var d=c?a:T(this).is(":hidden");T(this)[d?"show":"hide"]()}):this.animate(K("toggle",3),a,b)},fadeTo:function(c,a,b){return this.animate({opacity:a},c,b)},animate:function(a,d,b,c){var e=T.speed(d,b,c);return this[e.queue===false?"each":"queue"](function(){var g=T.extend({},e),j,f=this.nodeType==1&&T(this).is(":hidden"),h=this;for(j in a){if(a[j]=="hide"&&f||a[j]=="show"&&!f){return g.complete.call(this)}if((j=="height"||j=="width")&&this.style){g.display=T.css(this,"display");g.overflow=this.style.overflow}}if(g.overflow!=null){this.style.overflow="hidden"}g.curAnim=T.extend({},a);T.each(a,function(q,l){var m=new T.fx(h,g,q);if(/toggle|show|hide/.test(l)){m[l=="toggle"?f?"show":"hide":l](a)}else{var o=l.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),k=m.cur(true)||0;if(o){var r=parseFloat(o[2]),p=o[3]||"px";if(p!="px"){h.style[q]=(r||1)+p;k=((r||1)/m.cur(true))*k;h.style[q]=k+p}if(o[1]){r=((o[1]=="-="?-1:1)*r)+k}m.custom(k,r,p)}else{m.custom(k,l,"")}}});return true})},stop:function(b,c){var a=T.timers;if(b){this.queue([])}this.each(function(){for(var d=a.length-1;d>=0;d--){if(a[d].elem==this){if(c){a[d](true)}a.splice(d,1)}}});if(!c){this.dequeue()}return this}});T.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(b,a){T.fn[b]=function(d,c){return this.animate(a,d,c)}});T.extend({speed:function(b,a,c){var d=typeof b==="object"?b:{complete:c||!c&&a||T.isFunction(b)&&b,duration:b,easing:c&&a||a&&!T.isFunction(a)&&a};d.duration=T.fx.off?0:typeof d.duration==="number"?d.duration:T.fx.speeds[d.duration]||T.fx.speeds._default;d.old=d.complete;d.complete=function(){if(d.queue!==false){T(this).dequeue()}if(T.isFunction(d.old)){d.old.call(this)}};return d},easing:{linear:function(b,a,d,c){return d+c*b},swing:function(b,a,d,c){return((-Math.cos(b*Math.PI)/2)+0.5)*c+d}},timers:[],fx:function(b,c,a){this.options=c;this.elem=b;this.prop=a;if(!c.orig){c.orig={}}}});T.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(T.fx.step[this.prop]||T.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var b=parseFloat(T.css(this.elem,this.prop,a));return b&&b>-10000?b:parseFloat(T.curCSS(this.elem,this.prop))||0},custom:function(a,b,c){this.startTime=ad();this.start=a;this.end=b;this.unit=c||this.unit||"px";this.now=this.start;this.pos=this.state=0;var e=this;function d(f){return e.step(f)}d.elem=this.elem;if(d()&&T.timers.push(d)&&!U){U=setInterval(function(){var f=T.timers;for(var g=0;g<f.length;g++){if(!f[g]()){f.splice(g--,1)}}if(!f.length){clearInterval(U);U=ab}},13)}},show:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());T(this.elem).show()},hide:function(){this.options.orig[this.prop]=T.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(c){var d=ad();if(c||d>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var f=true;for(var e in this.options.curAnim){if(this.options.curAnim[e]!==true){f=false}}if(f){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(T.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){T(this.elem).hide()}if(this.options.hide||this.options.show){for(var b in this.options.curAnim){T.attr(this.elem.style,b,this.options.orig[b])}}this.options.complete.call(this.elem)}return false}else{var a=d-this.startTime;this.state=a/this.options.duration;this.pos=T.easing[this.options.easing||(T.easing.swing?"swing":"linear")](this.state,a,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};T.extend(T.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){T.attr(a.elem.style,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null){a.elem.style[a.prop]=a.now+a.unit}else{a.elem[a.prop]=a.now}}}});if(document.documentElement.getBoundingClientRect){T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}var f=this[0].getBoundingClientRect(),c=this[0].ownerDocument,g=c.body,h=c.documentElement,a=h.clientTop||g.clientTop||0,b=h.clientLeft||g.clientLeft||0,d=f.top+(self.pageYOffset||T.boxModel&&h.scrollTop||g.scrollTop)-a,e=f.left+(self.pageXOffset||T.boxModel&&h.scrollLeft||g.scrollLeft)-b;return{top:d,left:e}}}else{T.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return T.offset.bodyOffset(this[0])}T.offset.initialized||T.offset.initialize();var f=this[0],j=f.offsetParent,k=f,a=f.ownerDocument,c,h=a.documentElement,e=a.body,d=a.defaultView,l=d.getComputedStyle(f,null),b=f.offsetTop,g=f.offsetLeft;while((f=f.parentNode)&&f!==e&&f!==h){c=d.getComputedStyle(f,null);b-=f.scrollTop,g-=f.scrollLeft;if(f===j){b+=f.offsetTop,g+=f.offsetLeft;if(T.offset.doesNotAddBorder&&!(T.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(f.tagName))){b+=parseInt(c.borderTopWidth,10)||0,g+=parseInt(c.borderLeftWidth,10)||0}k=j,j=f.offsetParent}if(T.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"){b+=parseInt(c.borderTopWidth,10)||0,g+=parseInt(c.borderLeftWidth,10)||0}l=c}if(l.position==="relative"||l.position==="static"){b+=e.offsetTop,g+=e.offsetLeft}if(l.position==="fixed"){b+=Math.max(h.scrollTop,e.scrollTop),g+=Math.max(h.scrollLeft,e.scrollLeft)}return{top:b,left:g}}}T.offset={initialize:function(){if(this.initialized){return}var c=document.body,j=document.createElement("div"),g,h,a,f,b,k,e=c.style.marginTop,d='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';b={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(k in b){j.style[k]=b[k]}j.innerHTML=d;c.insertBefore(j,c.firstChild);g=j.firstChild,h=g.firstChild,f=g.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(h.offsetTop!==5);this.doesAddBorderForTableAndCells=(f.offsetTop===5);g.style.overflow="hidden",g.style.position="relative";this.subtractsBorderForOverflowNotVisible=(h.offsetTop===-5);c.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(c.offsetTop===0);c.style.marginTop=e;c.removeChild(j);this.initialized=true},bodyOffset:function(c){T.offset.initialized||T.offset.initialize();var a=c.offsetTop,b=c.offsetLeft;if(T.offset.doesNotIncludeMarginInBodyOffset){a+=parseInt(T.curCSS(c,"marginTop",true),10)||0,b+=parseInt(T.curCSS(c,"marginLeft",true),10)||0}return{top:a,left:b}}};T.fn.extend({position:function(){var b=0,c=0,e;if(this[0]){var d=this.offsetParent(),a=this.offset(),f=/^body|html$/i.test(d[0].tagName)?{top:0,left:0}:d.offset();a.top-=Y(this,"marginTop");a.left-=Y(this,"marginLeft");f.top+=Y(d,"borderTopWidth");f.left+=Y(d,"borderLeftWidth");e={top:a.top-f.top,left:a.left-f.left}}return e},offsetParent:function(){var a=this[0].offsetParent||document.body;while(a&&(!/^body|html$/i.test(a.tagName)&&T.css(a,"position")=="static")){a=a.offsetParent}return T(a)}});T.each(["Left","Top"],function(b,c){var a="scroll"+c;T.fn[a]=function(d){if(!this[0]){return null}return d!==ab?this.each(function(){this==W||this==document?W.scrollTo(!b?d:T(W).scrollLeft(),b?d:T(W).scrollTop()):this[a]=d}):this[0]==W||this[0]==document?self[b?"pageYOffset":"pageXOffset"]||T.boxModel&&document.documentElement[a]||document.body[a]:this[0][a]}});T.each(["Height","Width"],function(b,d){var f=b?"Left":"Top",c=b?"Right":"Bottom",e=d.toLowerCase();T.fn["inner"+d]=function(){return this[0]?T.css(this[0],e,false,"padding"):null};T.fn["outer"+d]=function(g){return this[0]?T.css(this[0],e,false,g?"margin":"border"):null};var a=d.toLowerCase();T.fn[a]=function(g){return this[0]==W?document.compatMode=="CSS1Compat"&&document.documentElement["client"+d]||document.body["client"+d]:this[0]==document?Math.max(document.documentElement["client"+d],document.body["scroll"+d],document.documentElement["scroll"+d],document.body["offset"+d],document.documentElement["offset"+d]):g===ab?(this.length?T.css(this[0],a):null):this.css(a,typeof g==="string"?g:g+"px")}})})()}SimileAjax.version="2.2.1";SimileAjax.jQuery=jQuery.noConflict(true);if(typeof window["$"]=="undefined"){window.$=SimileAjax.jQuery}SimileAjax.Platform.os={isMac:false,isWin:false,isWin32:false,isUnix:false};SimileAjax.Platform.browser={isIE:false,isNetscape:false,isMozilla:false,isFirefox:false,isOpera:false,isSafari:false,majorVersion:0,minorVersion:0};(function(){var c=navigator.appName.toLowerCase();var a=navigator.userAgent.toLowerCase();SimileAjax.Platform.os.isMac=(a.indexOf("mac")!=-1);SimileAjax.Platform.os.isWin=(a.indexOf("win")!=-1);SimileAjax.Platform.os.isWin32=SimileAjax.Platform.isWin&&(a.indexOf("95")!=-1||a.indexOf("98")!=-1||a.indexOf("nt")!=-1||a.indexOf("win32")!=-1||a.indexOf("32bit")!=-1);SimileAjax.Platform.os.isUnix=(a.indexOf("x11")!=-1);SimileAjax.Platform.browser.isIE=(c.indexOf("microsoft")!=-1);SimileAjax.Platform.browser.isNetscape=(c.indexOf("netscape")!=-1);SimileAjax.Platform.browser.isMozilla=(a.indexOf("mozilla")!=-1);SimileAjax.Platform.browser.isFirefox=(a.indexOf("firefox")!=-1);SimileAjax.Platform.browser.isOpera=(c.indexOf("opera")!=-1);SimileAjax.Platform.browser.isSafari=(c.indexOf("safari")!=-1);var e=function(g){var f=g.split(".");SimileAjax.Platform.browser.majorVersion=parseInt(f[0]);SimileAjax.Platform.browser.minorVersion=parseInt(f[1])};var b=function(h,g,j){var f=h.indexOf(g,j);return f>=0?f:h.length};if(SimileAjax.Platform.browser.isMozilla){var d=a.indexOf("mozilla/");if(d>=0){e(a.substring(d+8,b(a," ",d)))}}if(SimileAjax.Platform.browser.isIE){var d=a.indexOf("msie ");if(d>=0){e(a.substring(d+5,b(a,";",d)))}}if(SimileAjax.Platform.browser.isNetscape){var d=a.indexOf("rv:");if(d>=0){e(a.substring(d+3,b(a,")",d)))}}if(SimileAjax.Platform.browser.isFirefox){var d=a.indexOf("firefox/");if(d>=0){e(a.substring(d+8,b(a," ",d)))}}if(!("localeCompare" in String.prototype)){String.prototype.localeCompare=function(f){if(this<f){return -1}else{if(this>f){return 1}else{return 0}}}}})();SimileAjax.Platform.getDefaultLocale=function(){return SimileAjax.Platform.clientLocale};SimileAjax.Debug={silent:false};SimileAjax.Debug.log=function(b){var a;if("console" in window&&"log" in window.console){a=function(c){console.log(c)}}else{a=function(c){if(!SimileAjax.Debug.silent){alert(c)}}}SimileAjax.Debug.log=a;a(b)};SimileAjax.Debug.warn=function(b){var a;if("console" in window&&"warn" in window.console){a=function(c){console.warn(c)}}else{a=function(c){if(!SimileAjax.Debug.silent){alert(c)}}}SimileAjax.Debug.warn=a;a(b)};SimileAjax.Debug.exception=function(b,d){var a,c=SimileAjax.parseURLParameters();if(c.errors=="throw"||SimileAjax.params.errors=="throw"){a=function(f,e){throw (f)}}else{if("console" in window&&"error" in window.console){a=function(f,e){if(e!=null){console.error(e+" %o",f)}else{console.error(f)}throw (f)}}else{a=function(f,e){if(!SimileAjax.Debug.silent){alert("Caught exception: "+e+"\n\nDetails: "+("description" in f?f.description:f))}throw (f)}}}SimileAjax.Debug.exception=a;a(b,d)};SimileAjax.Debug.objectToString=function(a){return SimileAjax.Debug._objectToString(a,"")};SimileAjax.Debug._objectToString=function(d,a){var c=a+" ";if(typeof d=="object"){var b="{";for(e in d){b+=c+e+": "+SimileAjax.Debug._objectToString(d[e],c)+"\n"}b+=a+"}";return b}else{if(typeof d=="array"){var b="[";for(var e=0;e<d.length;e++){b+=SimileAjax.Debug._objectToString(d[e],c)+"\n"}b+=a+"]";return b}else{return d}}};SimileAjax.XmlHttp=new Object();SimileAjax.XmlHttp._onReadyStateChange=function(a,d,b){switch(a.readyState){case 4:try{if(a.status==0||a.status==200){if(b){b(a)}}else{if(d){d(a.statusText,a.status,a)}}}catch(c){SimileAjax.Debug.exception("XmlHttp: Error handling onReadyStateChange",c)}break}};SimileAjax.XmlHttp._createRequest=function(){if(SimileAjax.Platform.browser.isIE){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];for(var b=0;b<a.length;b++){try{var c=a[b];var d=function(){return new ActiveXObject(c)};var h=d();SimileAjax.XmlHttp._createRequest=d;return h}catch(g){}}}try{var d=function(){return new XMLHttpRequest()};var h=d();SimileAjax.XmlHttp._createRequest=d;return h}catch(g){throw new Error("Failed to create an XMLHttpRequest object")}};SimileAjax.XmlHttp.get=function(a,d,c){var b=SimileAjax.XmlHttp._createRequest();b.open("GET",a,true);b.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(b,d,c)};b.send(null)};SimileAjax.XmlHttp.post=function(b,a,e,d){var c=SimileAjax.XmlHttp._createRequest();c.open("POST",b,true);c.onreadystatechange=function(){SimileAjax.XmlHttp._onReadyStateChange(c,e,d)};c.send(a)};SimileAjax.XmlHttp._forceXML=function(a){try{a.overrideMimeType("text/xml")}catch(b){a.setrequestheader("Content-Type","text/xml")}};SimileAjax.JSON=new Object();(function(){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var s={array:function(x){var a=["["],b,f,i,l=x.length,v;for(i=0;i<l;i+=1){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=","}a[a.length]=v;b=true}}}a[a.length]="]";return a.join("")},"boolean":function(x){return String(x)},"null":function(x){return"null"},number:function(x){return isFinite(x)?String(x):"null"},object:function(x){if(x){if(x instanceof Array){return s.array(x)}var a=["{"],b,f,i,v;for(i in x){v=x[i];f=s[typeof v];if(f){v=f(v);if(typeof v=="string"){if(b){a[a.length]=","}a.push(s.string(i),":",v);b=true}}}a[a.length]="}";return a.join("")}return"null"},string:function(x){if(/["\\\x00-\x1f]/.test(x)){x=x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})}return'"'+x+'"'}};SimileAjax.JSON.toJSONString=function(o){if(o instanceof Object){return s.object(o)}else{if(o instanceof Array){return s.array(o)}else{return o.toString()}}};SimileAjax.JSON.parseJSON=function(){try{return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(this.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+this+")")}catch(e){return false}}})();SimileAjax.DOM=new Object();SimileAjax.DOM.registerEventWithObject=function(c,a,d,b){SimileAjax.DOM.registerEvent(c,a,function(f,e,g){return d[b].call(d,f,e,g)})};SimileAjax.DOM.registerEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}};SimileAjax.DOM.getPageCoordinates=function(b){var e=0;var d=0;if(b.nodeType!=1){b=b.parentNode}var c=b;while(c!=null){e+=c.offsetLeft;d+=c.offsetTop;c=c.offsetParent}var a=document.body;while(b!=null&&b!=a){if("scrollLeft" in b){e-=b.scrollLeft;d-=b.scrollTop}b=b.parentNode}return{left:e,top:d}};SimileAjax.DOM.getSize=function(b){var a=this.getStyle(b,"width");var c=this.getStyle(b,"height");if(a.indexOf("px")>-1){a=a.replace("px","")}if(c.indexOf("px")>-1){c=c.replace("px","")}return{w:a,h:c}};SimileAjax.DOM.getStyle=function(b,a){if(b.currentStyle){var c=b.currentStyle[a]}else{if(window.getComputedStyle){var c=document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}else{var c=""}}return c};SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){if(a.type=="mousewheel"){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}else{return{x:a.offsetX,y:a.offsetY}}}else{var c=SimileAjax.DOM.getPageCoordinates(b);if((a.type=="DOMMouseScroll")&&SimileAjax.Platform.browser.isFirefox&&(SimileAjax.Platform.browser.majorVersion==2)){return{x:a.screenX-c.left,y:a.screenY-c.top}}else{return{x:a.pageX-c.left,y:a.pageY-c.top}}}};SimileAjax.DOM.getEventPageCoordinates=function(a){if(SimileAjax.Platform.browser.isIE){return{x:a.clientX+document.body.scrollLeft,y:a.clientY+document.body.scrollTop}}else{return{x:a.pageX,y:a.pageY}}};SimileAjax.DOM.hittest=function(a,c,b){return SimileAjax.DOM._hittest(document.body,a,c,b)};SimileAjax.DOM._hittest=function(c,o,m,h){var p=c.childNodes;outer:for(var g=0;g<p.length;g++){var a=p[g];for(var f=0;f<h.length;f++){if(a==h[f]){continue outer}}if(a.offsetWidth==0&&a.offsetHeight==0){var b=SimileAjax.DOM._hittest(a,o,m,h);if(b!=a){return b}}else{var l=0;var e=0;var d=a;while(d){l+=d.offsetTop;e+=d.offsetLeft;d=d.offsetParent}if(e<=o&&l<=m&&(o-e)<a.offsetWidth&&(m-l)<a.offsetHeight){return SimileAjax.DOM._hittest(a,o,m,h)}else{if(a.nodeType==1&&a.tagName=="TR"){var k=SimileAjax.DOM._hittest(a,o,m,h);if(k!=a){return k}}}}}return c};SimileAjax.DOM.cancelEvent=function(a){a.returnValue=false;a.cancelBubble=true;if("preventDefault" in a){a.preventDefault()}};SimileAjax.DOM.appendClassName=function(c,d){var b=c.className.split(" ");for(var a=0;a<b.length;a++){if(b[a]==d){return}}b.push(d);c.className=b.join(" ")};SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");b.innerHTML="<input type='"+a+"' />";return b.firstChild};SimileAjax.DOM.createDOMFromTemplate=function(b){var a={};a.elmt=SimileAjax.DOM._createDOMFromTemplate(b,a,null);return a};SimileAjax.DOM._createDOMFromTemplate=function(a,j,e){if(a==null){return null}else{if(typeof a!="object"){var d=document.createTextNode(a);if(e!=null){e.appendChild(d)}return d}else{var c=null;if("tag" in a){var k=a.tag;if(e!=null){if(k=="tr"){c=e.insertRow(e.rows.length)}else{if(k=="td"){c=e.insertCell(e.cells.length)}}}if(c==null){c=k=="input"?SimileAjax.DOM.createInputElement(a.type):document.createElement(k);if(e!=null){e.appendChild(c)}}}else{c=a.elmt;if(e!=null){e.appendChild(c)}}for(var b in a){var g=a[b];if(b=="field"){j[g]=c}else{if(b=="className"){c.className=g}else{if(b=="id"){c.id=g}else{if(b=="title"){c.title=g}else{if(b=="type"&&c.tagName=="input"){}else{if(b=="style"){for(n in g){var h=g[n];if(n=="float"){n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"}c.style[n]=h}}else{if(b=="children"){for(var f=0;f<g.length;f++){SimileAjax.DOM._createDOMFromTemplate(g[f],j,c)}}else{if(b!="tag"&&b!="elmt"){c.setAttribute(b,g)}}}}}}}}}return c}}};SimileAjax.DOM._cachedParent=null;SimileAjax.DOM.createElementFromString=function(a){if(SimileAjax.DOM._cachedParent==null){SimileAjax.DOM._cachedParent=document.createElement("div")}SimileAjax.DOM._cachedParent.innerHTML=a;return SimileAjax.DOM._cachedParent.firstChild};SimileAjax.DOM.createDOMFromString=function(a,c,d){var b=typeof a=="string"?document.createElement(a):a;b.innerHTML=c;var e={elmt:b};SimileAjax.DOM._processDOMChildrenConstructedFromString(e,b,d!=null?d:{});return e};SimileAjax.DOM._processDOMConstructedFromString=function(d,a,b){var e=a.id;if(e!=null&&e.length>0){a.removeAttribute("id");if(e in b){var c=a.parentNode;c.insertBefore(b[e],a);c.removeChild(a);d[e]=b[e];return}else{d[e]=a}}if(a.hasChildNodes()){SimileAjax.DOM._processDOMChildrenConstructedFromString(d,a,b)}};SimileAjax.DOM._processDOMChildrenConstructedFromString=function(e,b,d){var c=b.firstChild;while(c!=null){var a=c.nextSibling;if(c.nodeType==1){SimileAjax.DOM._processDOMConstructedFromString(e,c,d)}c=a}};SimileAjax.Graphics=new Object();SimileAjax.Graphics.pngIsTranslucent=(!SimileAjax.Platform.browser.isIE)||(SimileAjax.Platform.browser.majorVersion>6);if(!SimileAjax.Graphics.pngIsTranslucent){SimileAjax.includeCssFile(document,SimileAjax.urlPrefix+"styles/graphics-ie6.css")}SimileAjax.Graphics._createTranslucentImage1=function(a,c){var b=document.createElement("img");b.setAttribute("src",a);if(c!=null){b.style.verticalAlign=c}return b};SimileAjax.Graphics._createTranslucentImage2=function(a,c){var b=document.createElement("img");b.style.width="1px";b.style.height="1px";b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image')";b.style.verticalAlign=(c!=null)?c:"middle";return b};SimileAjax.Graphics.createTranslucentImage=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImage1:SimileAjax.Graphics._createTranslucentImage2;SimileAjax.Graphics._createTranslucentImageHTML1=function(a,b){return'<img src="'+a+'"'+(b!=null?' style="vertical-align: '+b+';"':"")+" />"};SimileAjax.Graphics._createTranslucentImageHTML2=function(a,c){var b="width: 1px; height: 1px; filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a+"', sizingMethod='image');"+(c!=null?" vertical-align: "+c+";":"");return"<img src='"+a+"' style=\""+b+'" />'};SimileAjax.Graphics.createTranslucentImageHTML=SimileAjax.Graphics.pngIsTranslucent?SimileAjax.Graphics._createTranslucentImageHTML1:SimileAjax.Graphics._createTranslucentImageHTML2;SimileAjax.Graphics.setOpacity=function(b,a){if(SimileAjax.Platform.browser.isIE){b.style.filter="progid:DXImageTransform.Microsoft.Alpha(Style=0,Opacity="+a+")"}else{var c=(a/100).toString();b.style.opacity=c;b.style.MozOpacity=c}};SimileAjax.Graphics.bubbleConfig={containerCSSClass:"simileAjax-bubble-container",innerContainerCSSClass:"simileAjax-bubble-innerContainer",contentContainerCSSClass:"simileAjax-bubble-contentContainer",borderGraphicSize:50,borderGraphicCSSClassPrefix:"simileAjax-bubble-border-",arrowGraphicTargetOffset:33,arrowGraphicLength:100,arrowGraphicWidth:49,arrowGraphicCSSClassPrefix:"simileAjax-bubble-arrow-",closeGraphicCSSClass:"simileAjax-bubble-close",extraPadding:20};SimileAjax.Graphics.createBubbleForContentAndPoint=function(f,d,c,a,b,e){if(typeof a!="number"){a=300}if(typeof e!="number"){e=0}f.style.position="absolute";f.style.left="-5000px";f.style.top="0px";f.style.width=a+"px";document.body.appendChild(f);window.setTimeout(function(){var k=f.scrollWidth+10;var g=f.scrollHeight+10;var j=0;if(e>0&&g>e){g=e;j=k-25}var h=SimileAjax.Graphics.createBubbleForPoint(d,c,k,g,b);document.body.removeChild(f);f.style.position="static";f.style.left="";f.style.top="";if(j>0){var l=document.createElement("div");f.style.width="";l.style.width=j+"px";l.appendChild(f);h.content.appendChild(l)}else{f.style.width=k+"px";h.content.appendChild(f)}},200)};SimileAjax.Graphics.createBubbleForPoint=function(b,a,l,o,d){l=parseInt(l,10);o=parseInt(o,10);var e=SimileAjax.Graphics.bubbleConfig;var p=SimileAjax.Graphics.pngIsTranslucent?"pngTranslucent":"pngNotTranslucent";var m=l+2*e.borderGraphicSize;var r=o+2*e.borderGraphicSize;var q=function(u){return u+" "+u+"-"+p};var h=document.createElement("div");h.className=q(e.containerCSSClass);h.style.width=l+"px";h.style.height=o+"px";var f=document.createElement("div");f.className=q(e.innerContainerCSSClass);h.appendChild(f);var j=function(){if(!k._closed){document.body.removeChild(k._div);k._doc=null;k._div=null;k._content=null;k._closed=true}};var k={_closed:false};var t=SimileAjax.WindowManager.pushLayer(j,true,h);k._div=h;k.close=function(){SimileAjax.WindowManager.popLayer(t)};var g=function(v){var u=document.createElement("div");u.className=q(e.borderGraphicCSSClassPrefix+v);f.appendChild(u)};g("top-left");g("top-right");g("bottom-left");g("bottom-right");g("left");g("right");g("top");g("bottom");var c=document.createElement("div");c.className=q(e.contentContainerCSSClass);f.appendChild(c);k.content=c;var s=document.createElement("div");s.className=q(e.closeGraphicCSSClass);f.appendChild(s);SimileAjax.WindowManager.registerEventWithObject(s,"click",k,"close");(function(){var B=SimileAjax.Graphics.getWindowDimensions();var w=B.w;var u=B.h;var x=Math.ceil(e.arrowGraphicWidth/2);var A=function(C){var D=document.createElement("div");D.className=q(e.arrowGraphicCSSClassPrefix+"point-"+C);f.appendChild(D);return D};if(b-x-e.borderGraphicSize-e.extraPadding>0&&b+x+e.borderGraphicSize+e.extraPadding<w){var z=b-Math.round(l/2);z=b<(w/2)?Math.max(z,e.extraPadding+e.borderGraphicSize):Math.min(z,w-e.extraPadding-e.borderGraphicSize-l);if((d&&d=="top")||(!d&&(a-e.arrowGraphicTargetOffset-o-e.borderGraphicSize-e.extraPadding>0))){var v=A("down");v.style.left=(b-x-z)+"px";h.style.left=z+"px";h.style.top=(a-e.arrowGraphicTargetOffset-o)+"px";return}else{if((d&&d=="bottom")||(!d&&(a+e.arrowGraphicTargetOffset+o+e.borderGraphicSize+e.extraPadding<u))){var v=A("up");v.style.left=(b-x-z)+"px";h.style.left=z+"px";h.style.top=(a+e.arrowGraphicTargetOffset)+"px";return}}}var y=a-Math.round(o/2);y=a<(u/2)?Math.max(y,e.extraPadding+e.borderGraphicSize):Math.min(y,u-e.extraPadding-e.borderGraphicSize-o);if((d&&d=="left")||(!d&&(b-e.arrowGraphicTargetOffset-l-e.borderGraphicSize-e.extraPadding>0))){var v=A("right");v.style.top=(a-x-y)+"px";h.style.top=y+"px";h.style.left=(b-e.arrowGraphicTargetOffset-l)+"px"}else{var v=A("left");v.style.top=(a-x-y)+"px";h.style.top=y+"px";h.style.left=(b+e.arrowGraphicTargetOffset)+"px"}})();document.body.appendChild(h);return k};SimileAjax.Graphics.getWindowDimensions=function(){if(typeof window.innerHeight=="number"){return{w:window.innerWidth,h:window.innerHeight}}else{if(document.documentElement&&document.documentElement.clientHeight){return{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight}}else{if(document.body&&document.body.clientHeight){return{w:document.body.clientWidth,h:document.body.clientHeight}}}}};SimileAjax.Graphics.createMessageBubble=function(h){var g=h.createElement("div");if(SimileAjax.Graphics.pngIsTranslucent){var j=h.createElement("div");j.style.height="33px";j.style.background="url("+SimileAjax.urlPrefix+"images/message-top-left.png) top left no-repeat";j.style.paddingLeft="44px";g.appendChild(j);var c=h.createElement("div");c.style.height="33px";c.style.background="url("+SimileAjax.urlPrefix+"images/message-top-right.png) top right no-repeat";j.appendChild(c);var f=h.createElement("div");f.style.background="url("+SimileAjax.urlPrefix+"images/message-left.png) top left repeat-y";f.style.paddingLeft="44px";g.appendChild(f);var a=h.createElement("div");a.style.background="url("+SimileAjax.urlPrefix+"images/message-right.png) top right repeat-y";a.style.paddingRight="44px";f.appendChild(a);var d=h.createElement("div");a.appendChild(d);var b=h.createElement("div");b.style.height="55px";b.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-left.png) bottom left no-repeat";b.style.paddingLeft="44px";g.appendChild(b);var e=h.createElement("div");e.style.height="55px";e.style.background="url("+SimileAjax.urlPrefix+"images/message-bottom-right.png) bottom right no-repeat";b.appendChild(e)}else{g.style.border="2px solid #7777AA";g.style.padding="20px";g.style.background="white";SimileAjax.Graphics.setOpacity(g,90);var d=h.createElement("div");g.appendChild(d)}return{containerDiv:g,contentDiv:d}};SimileAjax.Graphics.createAnimation=function(b,e,d,c,a){return new SimileAjax.Graphics._Animation(b,e,d,c,a)};SimileAjax.Graphics._Animation=function(b,e,d,c,a){this.f=b;this.cont=(typeof a=="function")?a:function(){};this.from=e;this.to=d;this.current=e;this.duration=c;this.start=new Date().getTime();this.timePassed=0};SimileAjax.Graphics._Animation.prototype.run=function(){var b=this;window.setTimeout(function(){b.step()},50)};SimileAjax.Graphics._Animation.prototype.step=function(){this.timePassed+=50;var b=this.timePassed/this.duration;var a=-Math.cos(b*Math.PI)/2+0.5;var d=a*(this.to-this.from)+this.from;try{this.f(d,d-this.current)}catch(c){}this.current=d;if(this.timePassed<this.duration){this.run()}else{this.f(this.to,0);this["cont"]()}};SimileAjax.Graphics.createStructuredDataCopyButton=function(f,d,a,e){var g=document.createElement("div");g.style.position="relative";g.style.display="inline";g.style.width=d+"px";g.style.height=a+"px";g.style.overflow="hidden";g.style.margin="2px";if(SimileAjax.Graphics.pngIsTranslucent){g.style.background="url("+f+") no-repeat"}else{g.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+f+"', sizingMethod='image')"}var c;if(SimileAjax.Platform.browser.isIE){c="filter:alpha(opacity=0)"}else{c="opacity: 0"}g.innerHTML="<textarea rows='1' autocomplete='off' value='none' style='"+c+"' />";var b=g.firstChild;b.style.width=d+"px";b.style.height=a+"px";b.onmousedown=function(h){h=(h)?h:((event)?event:null);if(h.button==2){b.value=e();b.select()}};return g};SimileAjax.Graphics.getWidthHeight=function(c){var a,b;if(c.getBoundingClientRect==null){a=c.offsetWidth;b=c.offsetHeight}else{var d=c.getBoundingClientRect();a=Math.ceil(d.right-d.left);b=Math.ceil(d.bottom-d.top)}return{width:a,height:b}};SimileAjax.Graphics.getFontRenderingContext=function(a,b){return new SimileAjax.Graphics._FontRenderingContext(a,b)};SimileAjax.Graphics._FontRenderingContext=function(a,b){this._elmt=a;this._elmt.style.visibility="hidden";if(typeof b=="string"){this._elmt.style.width=b}else{if(typeof b=="number"){this._elmt.style.width=b+"px"}}};SimileAjax.Graphics._FontRenderingContext.prototype.dispose=function(){this._elmt=null};SimileAjax.Graphics._FontRenderingContext.prototype.update=function(){this._elmt.innerHTML="A";this._lineHeight=this._elmt.offsetHeight};SimileAjax.Graphics._FontRenderingContext.prototype.computeSize=function(d,c){var b=this._elmt;b.innerHTML=d;b.className=c===undefined?"":c;var a=SimileAjax.Graphics.getWidthHeight(b);b.className="";return a};SimileAjax.Graphics._FontRenderingContext.prototype.getLineHeight=function(){return this._lineHeight};SimileAjax.DateTime=new Object();SimileAjax.DateTime.MILLISECOND=0;SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.YEAR=7;SimileAjax.DateTime.DECADE=8;SimileAjax.DateTime.CENTURY=9;SimileAjax.DateTime.MILLENNIUM=10;SimileAjax.DateTime.EPOCH=-1;SimileAjax.DateTime.ERA=-2;SimileAjax.DateTime.gregorianUnitLengths=[];(function(){var c=SimileAjax.DateTime;var b=c.gregorianUnitLengths;b[c.MILLISECOND]=1;b[c.SECOND]=1000;b[c.MINUTE]=b[c.SECOND]*60;b[c.HOUR]=b[c.MINUTE]*60;b[c.DAY]=b[c.HOUR]*24;b[c.WEEK]=b[c.DAY]*7;b[c.MONTH]=b[c.DAY]*31;b[c.YEAR]=b[c.DAY]*365;b[c.DECADE]=b[c.YEAR]*10;b[c.CENTURY]=b[c.YEAR]*100;b[c.MILLENNIUM]=b[c.YEAR]*1000})();SimileAjax.DateTime._dateRegexp=new RegExp("^(-?)([0-9]{4})("+["(-?([0-9]{2})(-?([0-9]{2}))?)","(-?([0-9]{3}))","(-?W([0-9]{2})(-?([1-7]))?)"].join("|")+")?$");SimileAjax.DateTime._timezoneRegexp=new RegExp("Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$");SimileAjax.DateTime._timeRegexp=new RegExp("^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$");SimileAjax.DateTime.setIso8601Date=function(j,g){var k=g.match(SimileAjax.DateTime._dateRegexp);if(!k){throw new Error("Invalid date string: "+g)}var b=(k[1]=="-")?-1:1;var l=b*k[2];var h=k[5];var c=k[7];var f=k[9];var a=k[11];var p=(k[13])?k[13]:1;j.setUTCFullYear(l);if(f){j.setUTCMonth(0);j.setUTCDate(Number(f))}else{if(a){j.setUTCMonth(0);j.setUTCDate(1);var o=j.getUTCDay();var m=(o)?o:7;var e=Number(p)+(7*Number(a));if(m<=4){j.setUTCDate(e+1-m)}else{j.setUTCDate(e+8-m)}}else{if(h){j.setUTCDate(1);j.setUTCMonth(h-1)}if(c){j.setUTCDate(c)}}}return j};SimileAjax.DateTime.setIso8601Time=function(g,c){var h=c.match(SimileAjax.DateTime._timeRegexp);if(!h){SimileAjax.Debug.warn("Invalid time string: "+c);return false}var a=h[1];var f=Number((h[3])?h[3]:0);var e=(h[5])?h[5]:0;var b=h[7]?(Number("0."+h[7])*1000):0;g.setUTCHours(a);g.setUTCMinutes(f);g.setUTCSeconds(e);g.setUTCMilliseconds(b);return g};SimileAjax.DateTime.timezoneOffset=new Date().getTimezoneOffset();SimileAjax.DateTime.setIso8601=function(b,a){var e=null;var f=(a.indexOf("T")==-1)?a.split(" "):a.split("T");SimileAjax.DateTime.setIso8601Date(b,f[0]);if(f.length==2){var c=f[1].match(SimileAjax.DateTime._timezoneRegexp);if(c){if(c[0]=="Z"){e=0}else{e=(Number(c[3])*60)+Number(c[5]);e*=((c[2]=="-")?1:-1)}f[1]=f[1].substr(0,f[1].length-c[0].length)}SimileAjax.DateTime.setIso8601Time(b,f[1])}if(e==null){e=b.getTimezoneOffset()}b.setTime(b.getTime()+e*60000);return b};SimileAjax.DateTime.parseIso8601DateTime=function(a){try{return SimileAjax.DateTime.setIso8601(new Date(0),a)}catch(b){return null}};SimileAjax.DateTime.parseGregorianDateTime=function(j){if(j==null){return null}else{if(j instanceof Date){return j}}var b=j.toString();if(b.length>0&&b.length<8){var c=b.indexOf(" ");if(c>0){var a=parseInt(b.substr(0,c));var g=b.substr(c+1);if(g.toLowerCase()=="bc"){a=1-a}}else{var a=parseInt(b)}var h=new Date(0);h.setUTCFullYear(a);return h}try{return new Date(Date.parse(b))}catch(f){return null}};SimileAjax.DateTime.roundDownToInterval=function(b,h,l,m,a){var e=l*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var k=new Date(b.getTime()+e);var f=function(o){o.setUTCMilliseconds(0);o.setUTCSeconds(0);o.setUTCMinutes(0);o.setUTCHours(0)};var c=function(o){f(o);o.setUTCDate(1);o.setUTCMonth(0)};switch(h){case SimileAjax.DateTime.MILLISECOND:var j=k.getUTCMilliseconds();k.setUTCMilliseconds(j-(j%m));break;case SimileAjax.DateTime.SECOND:k.setUTCMilliseconds(0);var j=k.getUTCSeconds();k.setUTCSeconds(j-(j%m));break;case SimileAjax.DateTime.MINUTE:k.setUTCMilliseconds(0);k.setUTCSeconds(0);var j=k.getUTCMinutes();k.setTime(k.getTime()-(j%m)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:k.setUTCMilliseconds(0);k.setUTCSeconds(0);k.setUTCMinutes(0);var j=k.getUTCHours();k.setUTCHours(j-(j%m));break;case SimileAjax.DateTime.DAY:f(k);break;case SimileAjax.DateTime.WEEK:f(k);var g=(k.getUTCDay()+7-a)%7;k.setTime(k.getTime()-g*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY]);break;case SimileAjax.DateTime.MONTH:f(k);k.setUTCDate(1);var j=k.getUTCMonth();k.setUTCMonth(j-(j%m));break;case SimileAjax.DateTime.YEAR:c(k);var j=k.getUTCFullYear();k.setUTCFullYear(j-(j%m));break;case SimileAjax.DateTime.DECADE:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/10)*10);break;case SimileAjax.DateTime.CENTURY:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/100)*100);break;case SimileAjax.DateTime.MILLENNIUM:c(k);k.setUTCFullYear(Math.floor(k.getUTCFullYear()/1000)*1000);break}b.setTime(k.getTime()-e)};SimileAjax.DateTime.roundUpToInterval=function(d,f,c,a,b){var e=d.getTime();SimileAjax.DateTime.roundDownToInterval(d,f,c,a,b);if(d.getTime()<e){d.setTime(d.getTime()+SimileAjax.DateTime.gregorianUnitLengths[f]*a)}};SimileAjax.DateTime.incrementByInterval=function(b,e,a){a=(typeof a=="undefined")?0:a;var d=a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var c=new Date(b.getTime()+d);switch(e){case SimileAjax.DateTime.MILLISECOND:c.setTime(c.getTime()+1);break;case SimileAjax.DateTime.SECOND:c.setTime(c.getTime()+1000);break;case SimileAjax.DateTime.MINUTE:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:c.setUTCDate(c.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:c.setUTCDate(c.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:c.setUTCMonth(c.getUTCMonth()+1);break;case SimileAjax.DateTime.YEAR:c.setUTCFullYear(c.getUTCFullYear()+1);break;case SimileAjax.DateTime.DECADE:c.setUTCFullYear(c.getUTCFullYear()+10);break;case SimileAjax.DateTime.CENTURY:c.setUTCFullYear(c.getUTCFullYear()+100);break;case SimileAjax.DateTime.MILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+1000);break}b.setTime(c.getTime()-d)};SimileAjax.DateTime.removeTimeZoneOffset=function(b,a){return new Date(b.getTime()+a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR])};SimileAjax.DateTime.getTimezone=function(){var a=new Date().getTimezoneOffset();return a/-60};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.startsWith=function(a){return this.length>=a.length&&this.substr(0,a.length)==a};String.prototype.endsWith=function(a){return this.length>=a.length&&this.substr(this.length-a.length)==a};String.substitute=function(b,d){var a="";var f=0;while(f<b.length-1){var c=b.indexOf("%",f);if(c<0||c==b.length-1){break}else{if(c>f&&b.charAt(c-1)=="\\"){a+=b.substring(f,c-1)+"%";f=c+1}else{var e=parseInt(b.charAt(c+1));if(isNaN(e)||e>=d.length){a+=b.substring(f,c+2)}else{a+=b.substring(f,c)+d[e].toString()}f=c+2}}}if(f<b.length){a+=b.substring(f)}return a};SimileAjax.HTML=new Object();SimileAjax.HTML._e2uHash={};(function(){var a=SimileAjax.HTML._e2uHash;a.nbsp="\u00A0[space]";a.iexcl="\u00A1";a.cent="\u00A2";a.pound="\u00A3";a.curren="\u00A4";a.yen="\u00A5";a.brvbar="\u00A6";a.sect="\u00A7";a.uml="\u00A8";a.copy="\u00A9";a.ordf="\u00AA";a.laquo="\u00AB";a.not="\u00AC";a.shy="\u00AD";a.reg="\u00AE";a.macr="\u00AF";a.deg="\u00B0";a.plusmn="\u00B1";a.sup2="\u00B2";a.sup3="\u00B3";a.acute="\u00B4";a.micro="\u00B5";a.para="\u00B6";a.middot="\u00B7";a.cedil="\u00B8";a.sup1="\u00B9";a.ordm="\u00BA";a.raquo="\u00BB";a.frac14="\u00BC";a.frac12="\u00BD";a.frac34="\u00BE";a.iquest="\u00BF";a.Agrave="\u00C0";a.Aacute="\u00C1";a.Acirc="\u00C2";a.Atilde="\u00C3";a.Auml="\u00C4";a.Aring="\u00C5";a.AElig="\u00C6";a.Ccedil="\u00C7";a.Egrave="\u00C8";a.Eacute="\u00C9";a.Ecirc="\u00CA";a.Euml="\u00CB";a.Igrave="\u00CC";a.Iacute="\u00CD";a.Icirc="\u00CE";a.Iuml="\u00CF";a.ETH="\u00D0";a.Ntilde="\u00D1";a.Ograve="\u00D2";a.Oacute="\u00D3";a.Ocirc="\u00D4";a.Otilde="\u00D5";a.Ouml="\u00D6";a.times="\u00D7";a.Oslash="\u00D8";a.Ugrave="\u00D9";a.Uacute="\u00DA";a.Ucirc="\u00DB";a.Uuml="\u00DC";a.Yacute="\u00DD";a.THORN="\u00DE";a.szlig="\u00DF";a.agrave="\u00E0";a.aacute="\u00E1";a.acirc="\u00E2";a.atilde="\u00E3";a.auml="\u00E4";a.aring="\u00E5";a.aelig="\u00E6";a.ccedil="\u00E7";a.egrave="\u00E8";a.eacute="\u00E9";a.ecirc="\u00EA";a.euml="\u00EB";a.igrave="\u00EC";a.iacute="\u00ED";a.icirc="\u00EE";a.iuml="\u00EF";a.eth="\u00F0";a.ntilde="\u00F1";a.ograve="\u00F2";a.oacute="\u00F3";a.ocirc="\u00F4";a.otilde="\u00F5";a.ouml="\u00F6";a.divide="\u00F7";a.oslash="\u00F8";a.ugrave="\u00F9";a.uacute="\u00FA";a.ucirc="\u00FB";a.uuml="\u00FC";a.yacute="\u00FD";a.thorn="\u00FE";a.yuml="\u00FF";a.quot="\u0022";a.amp="\u0026";a.lt="\u003C";a.gt="\u003E";a.OElig="";a.oelig="\u0153";a.Scaron="\u0160";a.scaron="\u0161";a.Yuml="\u0178";a.circ="\u02C6";a.tilde="\u02DC";a.ensp="\u2002";a.emsp="\u2003";a.thinsp="\u2009";a.zwnj="\u200C";a.zwj="\u200D";a.lrm="\u200E";a.rlm="\u200F";a.ndash="\u2013";a.mdash="\u2014";a.lsquo="\u2018";a.rsquo="\u2019";a.sbquo="\u201A";a.ldquo="\u201C";a.rdquo="\u201D";a.bdquo="\u201E";a.dagger="\u2020";a.Dagger="\u2021";a.permil="\u2030";a.lsaquo="\u2039";a.rsaquo="\u203A";a.euro="\u20AC";a.fnof="\u0192";a.Alpha="\u0391";a.Beta="\u0392";a.Gamma="\u0393";a.Delta="\u0394";a.Epsilon="\u0395";a.Zeta="\u0396";a.Eta="\u0397";a.Theta="\u0398";a.Iota="\u0399";a.Kappa="\u039A";a.Lambda="\u039B";a.Mu="\u039C";a.Nu="\u039D";a.Xi="\u039E";a.Omicron="\u039F";a.Pi="\u03A0";a.Rho="\u03A1";a.Sigma="\u03A3";a.Tau="\u03A4";a.Upsilon="\u03A5";a.Phi="\u03A6";a.Chi="\u03A7";a.Psi="\u03A8";a.Omega="\u03A9";a.alpha="\u03B1";a.beta="\u03B2";a.gamma="\u03B3";a.delta="\u03B4";a.epsilon="\u03B5";a.zeta="\u03B6";a.eta="\u03B7";a.theta="\u03B8";a.iota="\u03B9";a.kappa="\u03BA";a.lambda="\u03BB";a.mu="\u03BC";a.nu="\u03BD";a.xi="\u03BE";a.omicron="\u03BF";a.pi="\u03C0";a.rho="\u03C1";a.sigmaf="\u03C2";a.sigma="\u03C3";a.tau="\u03C4";a.upsilon="\u03C5";a.phi="\u03C6";a.chi="\u03C7";a.psi="\u03C8";a.omega="\u03C9";a.thetasym="\u03D1";a.upsih="\u03D2";a.piv="\u03D6";a.bull="\u2022";a.hellip="\u2026";a.prime="\u2032";a.Prime="\u2033";a.oline="\u203E";a.frasl="\u2044";a.weierp="\u2118";a.image="\u2111";a.real="\u211C";a.trade="\u2122";a.alefsym="\u2135";a.larr="\u2190";a.uarr="\u2191";a.rarr="\u2192";a.darr="\u2193";a.harr="\u2194";a.crarr="\u21B5";a.lArr="\u21D0";a.uArr="\u21D1";a.rArr="\u21D2";a.dArr="\u21D3";a.hArr="\u21D4";a.forall="\u2200";a.part="\u2202";a.exist="\u2203";a.empty="\u2205";a.nabla="\u2207";a.isin="\u2208";a.notin="\u2209";a.ni="\u220B";a.prod="\u220F";a.sum="\u2211";a.minus="\u2212";a.lowast="\u2217";a.radic="\u221A";a.prop="\u221D";a.infin="\u221E";a.ang="\u2220";a.and="\u2227";a.or="\u2228";a.cap="\u2229";a.cup="\u222A";a["int"]="\u222B";a.there4="\u2234";a.sim="\u223C";a.cong="\u2245";a.asymp="\u2248";a.ne="\u2260";a.equiv="\u2261";a.le="\u2264";a.ge="\u2265";a.sub="\u2282";a.sup="\u2283";a.nsub="\u2284";a.sube="\u2286";a.supe="\u2287";a.oplus="\u2295";a.otimes="\u2297";a.perp="\u22A5";a.sdot="\u22C5";a.lceil="\u2308";a.rceil="\u2309";a.lfloor="\u230A";a.rfloor="\u230B";a.lang="\u2329";a.rang="\u232A";a.loz="\u25CA";a.spades="\u2660";a.clubs="\u2663";a.hearts="\u2665";a.diams="\u2666"})();SimileAjax.HTML.deEntify=function(c){var d=SimileAjax.HTML._e2uHash;var b=/&(\w+?);/;while(b.test(c)){var a=c.match(b);c=c.replace(b,d[a[1]])}return c};SimileAjax.Set=function(b){this._hash={};this._count=0;if(b instanceof Array){for(var c=0;c<b.length;c++){this.add(b[c])}}else{if(b instanceof SimileAjax.Set){this.addSet(b)}}};SimileAjax.Set.prototype.add=function(a){if(!(a in this._hash)){this._hash[a]=true;this._count++;return true}return false};SimileAjax.Set.prototype.addSet=function(b){for(var a in b._hash){this.add(a)}};SimileAjax.Set.prototype.remove=function(a){if(a in this._hash){delete this._hash[a];this._count--;return true}return false};SimileAjax.Set.prototype.removeSet=function(b){for(var a in b._hash){this.remove(a)}};SimileAjax.Set.prototype.retainSet=function(b){for(var a in this._hash){if(!b.contains(a)){delete this._hash[a];this._count--}}};SimileAjax.Set.prototype.contains=function(a){return(a in this._hash)};SimileAjax.Set.prototype.size=function(){return this._count};SimileAjax.Set.prototype.toArray=function(){var b=[];for(var c in this._hash){b.push(c)}return b};SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash){if(a(b)==true){break}}};SimileAjax.SortedArray=function(b,a){this._a=(a instanceof Array)?a:[];this._compare=b};SimileAjax.SortedArray.prototype.add=function(c){var a=this;var b=this.find(function(d){return a._compare(d,c)});if(b<this._a.length){this._a.splice(b,0,c)}else{this._a.push(c)}};SimileAjax.SortedArray.prototype.remove=function(c){var a=this;var b=this.find(function(d){return a._compare(d,c)});while(b<this._a.length&&this._compare(this._a[b],c)==0){if(this._a[b]==c){this._a.splice(b,1);return true}else{b++}}return false};SimileAjax.SortedArray.prototype.removeAll=function(){this._a=[]};SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]};SimileAjax.SortedArray.prototype.length=function(){return this._a.length};SimileAjax.SortedArray.prototype.find=function(g){var e=0;var d=this._a.length;while(e<d){var f=Math.floor((e+d)/2);var h=g(this._a[f]);if(f==e){return h<0?e+1:e}else{if(h<0){e=f}else{d=f}}}return e};SimileAjax.SortedArray.prototype.getFirst=function(){return(this._a.length>0)?this._a[0]:null};SimileAjax.SortedArray.prototype.getLast=function(){return(this._a.length>0)?this._a[this._a.length-1]:null};SimileAjax.EventIndex=function(b){var a=this;this._unit=(b!=null)?b:SimileAjax.NativeDateUnit;this._events=new SimileAjax.SortedArray(function(d,c){return a._unit.compare(d.getStart(),c.getStart())});this._idToEvent={};this._indexed=true};SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit};SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]};SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a);this._idToEvent[a.getID()]=a;this._indexed=false};SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll();this._idToEvent={};this._indexed=false};SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()};SimileAjax.EventIndex.prototype.getIterator=function(a,b){if(!this._indexed){this._index()}return new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){if(!this._indexed){this._index()}return new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)};SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return(a==null)?null:a.getStart()};SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(a==null){return null}if(!this._indexed){this._index()}var c=a._earliestOverlapIndex;var b=this._events.elementAt(c).getEnd();for(var d=c+1;d<this._events.length();d++){b=this._unit.later(b,this._events.elementAt(d).getEnd())}return b};SimileAjax.EventIndex.prototype._index=function(){var d=this._events.length();for(var e=0;e<d;e++){var c=this._events.elementAt(e);c._earliestOverlapIndex=e}var g=1;for(var e=0;e<d;e++){var c=this._events.elementAt(e);var b=c.getEnd();g=Math.max(g,e+1);while(g<d){var a=this._events.elementAt(g);var f=a.getStart();if(this._unit.compare(f,b)<0){a._earliestOverlapIndex=e;g++}else{break}}}this._indexed=true};SimileAjax.EventIndex._Iterator=function(b,a,d,c){this._events=b;this._startDate=a;this._endDate=d;this._unit=c;this._currentIndex=b.find(function(e){return c.compare(e.getStart(),a)});if(this._currentIndex-1>=0){this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex}this._currentIndex--;this._maxIndex=b.find(function(e){return c.compare(e.getStart(),d)});this._hasNext=false;this._next=null;this._findNext()};SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else{return null}},_findNext:function(){var b=this._unit;while((++this._currentIndex)<this._maxIndex){var a=this._events.elementAt(this._currentIndex);if(b.compare(a.getStart(),this._endDate)<0&&b.compare(a.getEnd(),this._startDate)>0){this._next=a;this._hasNext=true;return}}this._next=null;this._hasNext=false}};SimileAjax.EventIndex._ReverseIterator=function(b,a,d,c){this._events=b;this._startDate=a;this._endDate=d;this._unit=c;this._minIndex=b.find(function(e){return c.compare(e.getStart(),a)});if(this._minIndex-1>=0){this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex}this._maxIndex=b.find(function(e){return c.compare(e.getStart(),d)});this._currentIndex=this._maxIndex;this._hasNext=false;this._next=null;this._findNext()};SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else{return null}},_findNext:function(){var b=this._unit;while((--this._currentIndex)>=this._minIndex){var a=this._events.elementAt(this._currentIndex);if(b.compare(a.getStart(),this._endDate)<0&&b.compare(a.getEnd(),this._startDate)>0){this._next=a;this._hasNext=true;return}}this._next=null;this._hasNext=false}};SimileAjax.EventIndex._AllIterator=function(a){this._events=a;this._index=0};SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}};SimileAjax.NativeDateUnit=new Object();SimileAjax.NativeDateUnit.makeDefaultValue=function(){return new Date()};SimileAjax.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};SimileAjax.NativeDateUnit.getParser=function(a){if(typeof a=="string"){a=a.toLowerCase()}return(a=="iso8601"||a=="iso 8601")?SimileAjax.DateTime.parseIso8601DateTime:SimileAjax.DateTime.parseGregorianDateTime};SimileAjax.NativeDateUnit.parseFromObject=function(a){return SimileAjax.DateTime.parseGregorianDateTime(a)};SimileAjax.NativeDateUnit.toNumber=function(a){return a.getTime()};SimileAjax.NativeDateUnit.fromNumber=function(a){return new Date(a)};SimileAjax.NativeDateUnit.compare=function(d,c){var b,a;if(typeof d=="object"){b=d.getTime()}else{b=Number(d)}if(typeof c=="object"){a=c.getTime()}else{a=Number(c)}return b-a};SimileAjax.NativeDateUnit.earlier=function(b,a){return SimileAjax.NativeDateUnit.compare(b,a)<0?b:a};SimileAjax.NativeDateUnit.later=function(b,a){return SimileAjax.NativeDateUnit.compare(b,a)>0?b:a};SimileAjax.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};SimileAjax.ListenerQueue=function(a){this._listeners=[];this._wildcardHandlerName=a};SimileAjax.ListenerQueue.prototype.add=function(a){this._listeners.push(a)};SimileAjax.ListenerQueue.prototype.remove=function(c){var b=this._listeners;for(var a=0;a<b.length;a++){if(b[a]==c){b.splice(a,1);break}}};SimileAjax.ListenerQueue.prototype.fire=function(b,a){var d=[].concat(this._listeners);for(var c=0;c<d.length;c++){var f=d[c];if(b in f){try{f[b].apply(f,a)}catch(g){SimileAjax.Debug.exception("Error firing event of name "+b,g)}}else{if(this._wildcardHandlerName!=null&&this._wildcardHandlerName in f){try{f[this._wildcardHandlerName].apply(f,[b])}catch(g){SimileAjax.Debug.exception("Error firing event of name "+b+" to wildcard handler",g)}}}}};SimileAjax.History={maxHistoryLength:10,historyFile:"__history__.html",enabled:true,_initialized:false,_listeners:new SimileAjax.ListenerQueue(),_actions:[],_baseIndex:0,_currentIndex:0,_plainDocumentTitle:document.title};SimileAjax.History.formatHistoryEntryTitle=function(a){return SimileAjax.History._plainDocumentTitle+" {"+a+"}"};SimileAjax.History.initialize=function(){if(SimileAjax.History._initialized){return}if(SimileAjax.History.enabled){var a=document.createElement("iframe");a.id="simile-ajax-history";a.style.position="absolute";a.style.width="10px";a.style.height="10px";a.style.top="0px";a.style.left="0px";a.style.visibility="hidden";a.src=SimileAjax.History.historyFile+"?0";document.body.appendChild(a);SimileAjax.DOM.registerEvent(a,"load",SimileAjax.History._handleIFrameOnLoad);SimileAjax.History._iframe=a}SimileAjax.History._initialized=true};SimileAjax.History.addListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.add(a)};SimileAjax.History.removeListener=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.remove(a)};SimileAjax.History.addAction=function(a){SimileAjax.History.initialize();SimileAjax.History._listeners.fire("onBeforePerform",[a]);window.setTimeout(function(){try{a.perform();SimileAjax.History._listeners.fire("onAfterPerform",[a]);if(SimileAjax.History.enabled){SimileAjax.History._actions=SimileAjax.History._actions.slice(0,SimileAjax.History._currentIndex-SimileAjax.History._baseIndex);SimileAjax.History._actions.push(a);SimileAjax.History._currentIndex++;var c=SimileAjax.History._actions.length-SimileAjax.History.maxHistoryLength;if(c>0){SimileAjax.History._actions=SimileAjax.History._actions.slice(c);SimileAjax.History._baseIndex+=c}try{SimileAjax.History._iframe.contentWindow.location.search="?"+SimileAjax.History._currentIndex}catch(b){var d=SimileAjax.History.formatHistoryEntryTitle(a.label);document.title=d}}}catch(b){SimileAjax.Debug.exception(b,"Error adding action {"+a.label+"} to history")}},0)};SimileAjax.History.addLengthyAction=function(c,a,b){SimileAjax.History.addAction({perform:c,undo:a,label:b,uiLayer:SimileAjax.WindowManager.getBaseLayer(),lengthy:true})};SimileAjax.History._handleIFrameOnLoad=function(){try{var b=SimileAjax.History._iframe.contentWindow.location.search;var h=(b.length==0)?0:Math.max(0,parseInt(b.substr(1)));var g=function(){var c=h-SimileAjax.History._currentIndex;SimileAjax.History._currentIndex+=c;SimileAjax.History._baseIndex+=c;SimileAjax.History._iframe.contentWindow.location.search="?"+h};if(h<SimileAjax.History._currentIndex){SimileAjax.History._listeners.fire("onBeforeUndoSeveral",[]);window.setTimeout(function(){while(SimileAjax.History._currentIndex>h&&SimileAjax.History._currentIndex>SimileAjax.History._baseIndex){SimileAjax.History._currentIndex--;var c=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{c.undo()}catch(j){SimileAjax.Debug.exception(j,"History: Failed to undo action {"+c.label+"}")}}SimileAjax.History._listeners.fire("onAfterUndoSeveral",[]);g()},0)}else{if(h>SimileAjax.History._currentIndex){SimileAjax.History._listeners.fire("onBeforeRedoSeveral",[]);window.setTimeout(function(){while(SimileAjax.History._currentIndex<h&&SimileAjax.History._currentIndex-SimileAjax.History._baseIndex<SimileAjax.History._actions.length){var c=SimileAjax.History._actions[SimileAjax.History._currentIndex-SimileAjax.History._baseIndex];try{c.perform()}catch(j){SimileAjax.Debug.exception(j,"History: Failed to redo action {"+c.label+"}")}SimileAjax.History._currentIndex++}SimileAjax.History._listeners.fire("onAfterRedoSeveral",[]);g()},0)}else{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1;var f=(a>=0&&a<SimileAjax.History._actions.length)?SimileAjax.History.formatHistoryEntryTitle(SimileAjax.History._actions[a].label):SimileAjax.History._plainDocumentTitle;SimileAjax.History._iframe.contentWindow.document.title=f;document.title=f}}}catch(d){}};SimileAjax.History.getNextUndoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex-1;return SimileAjax.History._actions[a]}catch(b){return null}};SimileAjax.History.getNextRedoAction=function(){try{var a=SimileAjax.History._currentIndex-SimileAjax.History._baseIndex;return SimileAjax.History._actions[a]}catch(b){return null}};SimileAjax.WindowManager={_initialized:false,_listeners:[],_draggedElement:null,_draggedElementCallback:null,_dropTargetHighlightElement:null,_lastCoords:null,_ghostCoords:null,_draggingMode:"",_dragging:false,_layers:[]};SimileAjax.WindowManager.initialize=function(){if(SimileAjax.WindowManager._initialized){return}SimileAjax.DOM.registerEvent(document.body,"mousedown",SimileAjax.WindowManager._onBodyMouseDown);SimileAjax.DOM.registerEvent(document.body,"mousemove",SimileAjax.WindowManager._onBodyMouseMove);SimileAjax.DOM.registerEvent(document.body,"mouseup",SimileAjax.WindowManager._onBodyMouseUp);SimileAjax.DOM.registerEvent(document,"keydown",SimileAjax.WindowManager._onBodyKeyDown);SimileAjax.DOM.registerEvent(document,"keyup",SimileAjax.WindowManager._onBodyKeyUp);SimileAjax.WindowManager._layers.push({index:0});SimileAjax.WindowManager._historyListener={onBeforeUndoSeveral:function(){},onAfterUndoSeveral:function(){},onBeforeUndo:function(){},onAfterUndo:function(){},onBeforeRedoSeveral:function(){},onAfterRedoSeveral:function(){},onBeforeRedo:function(){},onAfterRedo:function(){}};SimileAjax.History.addListener(SimileAjax.WindowManager._historyListener);SimileAjax.WindowManager._initialized=true};SimileAjax.WindowManager.getBaseLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[0]};SimileAjax.WindowManager.getHighestLayer=function(){SimileAjax.WindowManager.initialize();return SimileAjax.WindowManager._layers[SimileAjax.WindowManager._layers.length-1]};SimileAjax.WindowManager.registerEventWithObject=function(d,a,e,b,c){SimileAjax.WindowManager.registerEvent(d,a,function(g,f,h){return e[b].call(e,g,f,h)},c)};SimileAjax.WindowManager.registerEvent=function(d,b,e,c){if(c==null){c=SimileAjax.WindowManager.getHighestLayer()}var a=function(g,f,j){if(SimileAjax.WindowManager._canProcessEventAtLayer(c)){SimileAjax.WindowManager._popToLayer(c.index);try{e(g,f,j)}catch(h){SimileAjax.Debug.exception(h)}}SimileAjax.DOM.cancelEvent(f);return false};SimileAjax.DOM.registerEvent(d,b,a)};SimileAjax.WindowManager.pushLayer=function(c,d,b){var a={onPop:c,index:SimileAjax.WindowManager._layers.length,ephemeral:(d),elmt:b};SimileAjax.WindowManager._layers.push(a);return a};SimileAjax.WindowManager.popLayer=function(b){for(var a=1;a<SimileAjax.WindowManager._layers.length;a++){if(SimileAjax.WindowManager._layers[a]==b){SimileAjax.WindowManager._popToLayer(a-1);break}}};SimileAjax.WindowManager.popAllLayers=function(){SimileAjax.WindowManager._popToLayer(0)};SimileAjax.WindowManager.registerForDragging=function(b,c,a){SimileAjax.WindowManager.registerEvent(b,"mousedown",function(e,d,f){SimileAjax.WindowManager._handleMouseDown(e,d,c)},a)};SimileAjax.WindowManager._popToLayer=function(c){while(c+1<SimileAjax.WindowManager._layers.length){try{var a=SimileAjax.WindowManager._layers.pop();if(a.onPop!=null){a.onPop()}}catch(b){}}};SimileAjax.WindowManager._canProcessEventAtLayer=function(b){if(b.index==(SimileAjax.WindowManager._layers.length-1)){return true}for(var a=b.index+1;a<SimileAjax.WindowManager._layers.length;a++){if(!SimileAjax.WindowManager._layers[a].ephemeral){return false}}return true};SimileAjax.WindowManager.cancelPopups=function(a){var f=(a)?SimileAjax.DOM.getEventPageCoordinates(a):{x:-1,y:-1};var e=SimileAjax.WindowManager._layers.length-1;while(e>0&&SimileAjax.WindowManager._layers[e].ephemeral){var d=SimileAjax.WindowManager._layers[e];if(d.elmt!=null){var c=d.elmt;var b=SimileAjax.DOM.getPageCoordinates(c);if(f.x>=b.left&&f.x<(b.left+c.offsetWidth)&&f.y>=b.top&&f.y<(b.top+c.offsetHeight)){break}}e--}SimileAjax.WindowManager._popToLayer(e)};SimileAjax.WindowManager._onBodyMouseDown=function(b,a,c){if(!("eventPhase" in a)||a.eventPhase==a.BUBBLING_PHASE){SimileAjax.WindowManager.cancelPopups(a)}};SimileAjax.WindowManager._handleMouseDown=function(b,a,c){SimileAjax.WindowManager._draggedElement=b;SimileAjax.WindowManager._draggedElementCallback=c;SimileAjax.WindowManager._lastCoords={x:a.clientX,y:a.clientY};SimileAjax.DOM.cancelEvent(a);return false};SimileAjax.WindowManager._onBodyKeyDown=function(c,a,d){if(SimileAjax.WindowManager._dragging){if(a.keyCode==27){SimileAjax.WindowManager._cancelDragging()}else{if((a.keyCode==17||a.keyCode==16)&&SimileAjax.WindowManager._draggingMode!="copy"){SimileAjax.WindowManager._draggingMode="copy";var b=SimileAjax.Graphics.createTranslucentImage(SimileAjax.urlPrefix+"images/copy.png");b.style.position="absolute";b.style.left=(SimileAjax.WindowManager._ghostCoords.left-16)+"px";b.style.top=(SimileAjax.WindowManager._ghostCoords.top)+"px";document.body.appendChild(b);SimileAjax.WindowManager._draggingModeIndicatorElmt=b}}}};SimileAjax.WindowManager._onBodyKeyUp=function(b,a,c){if(SimileAjax.WindowManager._dragging){if(a.keyCode==17||a.keyCode==16){SimileAjax.WindowManager._draggingMode="";if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt);SimileAjax.WindowManager._draggingModeIndicatorElmt=null}}}};SimileAjax.WindowManager._onBodyMouseMove=function(a,q,j){if(SimileAjax.WindowManager._draggedElement!=null){var s=SimileAjax.WindowManager._draggedElementCallback;var f=SimileAjax.WindowManager._lastCoords;var p=q.clientX-f.x;var l=q.clientY-f.y;if(!SimileAjax.WindowManager._dragging){if(Math.abs(p)>5||Math.abs(l)>5){try{if("onDragStart" in s){s.onDragStart()}if("ghost" in s&&s.ghost){var m=SimileAjax.WindowManager._draggedElement;SimileAjax.WindowManager._ghostCoords=SimileAjax.DOM.getPageCoordinates(m);SimileAjax.WindowManager._ghostCoords.left+=p;SimileAjax.WindowManager._ghostCoords.top+=l;var r=m.cloneNode(true);r.style.position="absolute";r.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";r.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";r.style.zIndex=1000;SimileAjax.Graphics.setOpacity(r,50);document.body.appendChild(r);s._ghostElmt=r}SimileAjax.WindowManager._dragging=true;SimileAjax.WindowManager._lastCoords={x:q.clientX,y:q.clientY};document.body.focus()}catch(h){SimileAjax.Debug.exception("WindowManager: Error handling mouse down",h);SimileAjax.WindowManager._cancelDragging()}}}else{try{SimileAjax.WindowManager._lastCoords={x:q.clientX,y:q.clientY};if("onDragBy" in s){s.onDragBy(p,l)}if("_ghostElmt" in s){var r=s._ghostElmt;SimileAjax.WindowManager._ghostCoords.left+=p;SimileAjax.WindowManager._ghostCoords.top+=l;r.style.left=SimileAjax.WindowManager._ghostCoords.left+"px";r.style.top=SimileAjax.WindowManager._ghostCoords.top+"px";if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){var k=SimileAjax.WindowManager._draggingModeIndicatorElmt;k.style.left=(SimileAjax.WindowManager._ghostCoords.left-16)+"px";k.style.top=SimileAjax.WindowManager._ghostCoords.top+"px"}if("droppable" in s&&s.droppable){var o=SimileAjax.DOM.getEventPageCoordinates(q);var j=SimileAjax.DOM.hittest(o.x,o.y,[SimileAjax.WindowManager._ghostElmt,SimileAjax.WindowManager._dropTargetHighlightElement]);j=SimileAjax.WindowManager._findDropTarget(j);if(j!=SimileAjax.WindowManager._potentialDropTarget){if(SimileAjax.WindowManager._dropTargetHighlightElement!=null){document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement);SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._potentialDropTarget=null}var g=false;if(j!=null){if((!("canDropOn" in s)||s.canDropOn(j))&&(!("canDrop" in j)||j.canDrop(SimileAjax.WindowManager._draggedElement))){g=true}}if(g){var c=4;var d=SimileAjax.DOM.getPageCoordinates(j);var b=document.createElement("div");b.style.border=c+"px solid yellow";b.style.backgroundColor="yellow";b.style.position="absolute";b.style.left=d.left+"px";b.style.top=d.top+"px";b.style.width=(j.offsetWidth-c*2)+"px";b.style.height=(j.offsetHeight-c*2)+"px";SimileAjax.Graphics.setOpacity(b,30);document.body.appendChild(b);SimileAjax.WindowManager._potentialDropTarget=j;SimileAjax.WindowManager._dropTargetHighlightElement=b}}}}}catch(h){SimileAjax.Debug.exception("WindowManager: Error handling mouse move",h);SimileAjax.WindowManager._cancelDragging()}}SimileAjax.DOM.cancelEvent(q);return false}};SimileAjax.WindowManager._onBodyMouseUp=function(b,a,c){if(SimileAjax.WindowManager._draggedElement!=null){try{if(SimileAjax.WindowManager._dragging){var e=SimileAjax.WindowManager._draggedElementCallback;if("onDragEnd" in e){e.onDragEnd()}if("droppable" in e&&e.droppable){var d=false;var c=SimileAjax.WindowManager._potentialDropTarget;if(c!=null){if((!("canDropOn" in e)||e.canDropOn(c))&&(!("canDrop" in c)||c.canDrop(SimileAjax.WindowManager._draggedElement))){if("onDropOn" in e){e.onDropOn(c)}c.ondrop(SimileAjax.WindowManager._draggedElement,SimileAjax.WindowManager._draggingMode);d=true}}if(!d){}}}}finally{SimileAjax.WindowManager._cancelDragging()}SimileAjax.DOM.cancelEvent(a);return false}};SimileAjax.WindowManager._cancelDragging=function(){var b=SimileAjax.WindowManager._draggedElementCallback;if("_ghostElmt" in b){var a=b._ghostElmt;document.body.removeChild(a);delete b._ghostElmt}if(SimileAjax.WindowManager._dropTargetHighlightElement!=null){document.body.removeChild(SimileAjax.WindowManager._dropTargetHighlightElement);SimileAjax.WindowManager._dropTargetHighlightElement=null}if(SimileAjax.WindowManager._draggingModeIndicatorElmt!=null){document.body.removeChild(SimileAjax.WindowManager._draggingModeIndicatorElmt);SimileAjax.WindowManager._draggingModeIndicatorElmt=null}SimileAjax.WindowManager._draggedElement=null;SimileAjax.WindowManager._draggedElementCallback=null;SimileAjax.WindowManager._potentialDropTarget=null;SimileAjax.WindowManager._dropTargetHighlightElement=null;SimileAjax.WindowManager._lastCoords=null;SimileAjax.WindowManager._ghostCoords=null;SimileAjax.WindowManager._draggingMode="";SimileAjax.WindowManager._dragging=false};SimileAjax.WindowManager._findDropTarget=function(a){while(a!=null){if("ondrop" in a&&(typeof a.ondrop)=="function"){break}a=a.parentNode}return a};Timeline_urlPrefix=STIMinifier_urlPrefix+"lib/simile/timeline/";SimileAjax.History.enabled=false;if(typeof window.Timeline=="undefined"){window.Timeline=new Object();Timeline.urlPrefix=Timeline_urlPrefix;window.Timeline.DateTime=window.SimileAjax.DateTime}(function(){var h=false;if(document.location.search.length>0){var g=document.location.search.substr(1).split("&");for(var c=0;c<g.length;c++){if(g[c]=="timeline-use-local-resources"){h=true}}}var f=function(){if("Timeline" in window){return}if(window.SimileAjax.DateTime==undefined){window.SimileAjax.DateTime=new Object()}window.Timeline=new Object();window.Timeline.DateTime=window.SimileAjax.DateTime;window.Timeline.loaded={core:{},localized:{}};if(!window.console){window.console={log:{},error:{},info:{}}}var z=false;var v=["timeline.js","band.js","themes.js","ethers.js","ether-painters.js","event-utils.js","labellers.js","sources.js","original-painter.js","detailed-painter.js","overview-painter.js","compact-painter.js","decorators.js","units.js"];var q=["timeline.css","ethers.css","events.css"];var t=["timeline.js","labellers.js"];var B=[];var y=["cs","de","en","es","fr","it","nl","ru","se","tr","vi","zh"];try{var m=["en"],k="en",G=null;var o=function(e){var I=e.split("&");for(var l=0;l<I.length;l++){var H=I[l].split("=");if(H[0]=="locales"){m=m.concat(H[1].split(","))}else{if(H[0]=="defaultLocale"){k=H[1]}else{if(H[0]=="forceLocale"){G=H[1];m=m.concat(H[1].split(","))}else{if(H[0]=="bundle"){z=H[1]!="false"}}}}}};(function(){if(typeof Timeline_urlPrefix=="string"){Timeline.urlPrefix=Timeline_urlPrefix;if(typeof Timeline_parameters=="string"){o(Timeline_parameters)}}else{var K=document.documentElement.getElementsByTagName("head");for(var J=0;J<K.length;J++){var e=K[J].getElementsByTagName("script");for(var I=0;I<e.length;I++){var l=e[I].src;var H=l.indexOf("timeline-api.js");if(H>=0){Timeline.urlPrefix=l.substr(0,H);var L=l.indexOf("?");if(L>0){o(l.substr(L+1))}return}}}throw new Error("Failed to derive URL prefix for Timeline API code files")}})();var j=function(e,l){SimileAjax.includeJavascriptFiles(document,e,l)};var F=function(e,l){SimileAjax.includeCssFiles(document,e,l)};var x=(z)?["timeline-bundle.js"]:v;window.SimileAjax_onLoad=function(){Timeline.loaded.core.files=x;Timeline.loaded.core.loaded=true};if(z){j(Timeline.urlPrefix,["timeline-bundle.js"]);F(Timeline.urlPrefix,["timeline-bundle.css"])}else{j(Timeline.urlPrefix+"scripts/",v);F(Timeline.urlPrefix+"styles/",q)}var u=[];var r=function(e){for(var H=0;H<y.length;H++){if(e==y[H]){u[e]=true;return true}}console.error("Timeline locale ["+e+"] is not yet supported");return false};var A=function(e){var l=e.indexOf("-");if(l>0&&r(e.substr(0,l))){return e.substr(0,l)}else{if(r(e)){return e}}return null};if(!r(k)){k="en"}u[k]=true;for(var C=0;C<m.length;C++){A(m[C])}var p=k;var w=("language" in navigator?navigator.language:navigator.browserLanguage).split(";");for(var C=0;C<w.length;C++){var D=A(w[C]);if(D!=null){p=D;break}}(function s(){var J=50;if(!this.iteration){this.iteration=0}this.iteration+=1;if(!Timeline.loaded.core.loaded){if(this.iteration>=J){console.info("could not load Timeline core assets");return}setTimeout(function(){s()},10);return}var I=[];for(var H=0;H<y.length;H++){var e=y[H];if(u[e]){I.push(e);j(Timeline.urlPrefix+"scripts/l10n/"+e+"/",t);F(Timeline.urlPrefix+"styles/l10n/"+e+"/",B)}}SimileAjax_onLoad=function(){Timeline.loaded.localized.loaded=true;Timeline.loaded.localized.locales=I;console.info("Timeline core loaded");console.info("Timeline locales loaded: "+Timeline.loaded.localized.locales)};if(G==null){Timeline.serverLocale=k;Timeline.clientLocale=p}else{if(!r(G)){G="en"}Timeline.serverLocale=G;Timeline.clientLocale=G}}())}catch(E){alert(E)}};if(typeof SimileAjax=="undefined"){window.SimileAjax_onLoad=f;var b=h?"http://127.0.0.1:9999/ajax/api/simile-ajax-api.js?bundle=false":"http://api.simile-widgets.org/ajax/2.2.1/simile-ajax-api.js";if(typeof Timeline_ajax_url=="string"){b=Timeline_ajax_url}var a=function(){var e=document.createElement("script");e.type="text/javascript";e.language="JavaScript";e.src=b;document.getElementsByTagName("head")[0].appendChild(e)};if(document.body==null){try{document.write("<script src='"+b+"' type='text/javascript'><\/script>")}catch(d){a()}}else{a()}}else{f()}})();Timeline.version="2.3.1";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};Timeline.create=function(d,c,b,f){if(Timeline.timelines==null){Timeline.timelines=[]}var a=Timeline.timelines.length;Timeline.timelines[a]=null;var e=new Timeline._Impl(d,c,b,f,a);Timeline.timelines[a]=e;return e};Timeline.createBandInfo=function(d){var e=("theme" in d)?d.theme:Timeline.getDefaultTheme();var b=("eventSource" in d)?d.eventSource:null;var f=new Timeline.LinearEther({centersOn:("date" in d)?d.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[d.intervalUnit],pixelsPerInterval:d.intervalPixels,theme:e});var g=new Timeline.GregorianEtherPainter({unit:d.intervalUnit,multiple:("multiple" in d)?d.multiple:1,theme:e,align:("align" in d)?d.align:undefined});var j={showText:("showEventText" in d)?d.showEventText:true,theme:e};if("eventPainterParams" in d){for(var a in d.eventPainterParams){j[a]=d.eventPainterParams[a]}}if("trackHeight" in d){j.trackHeight=d.trackHeight}if("trackGap" in d){j.trackGap=d.trackGap}var h=("overview" in d&&d.overview)?"overview":("layout" in d?d.layout:"original");var c;if("eventPainter" in d){c=new d.eventPainter(j)}else{switch(h){case"overview":c=new Timeline.OverviewEventPainter(j);break;case"detailed":c=new Timeline.DetailedEventPainter(j);break;default:c=new Timeline.OriginalEventPainter(j)}}return{width:d.width,eventSource:b,timeZone:("timeZone" in d)?d.timeZone:0,ether:f,etherPainter:g,eventPainter:c,theme:e,zoomIndex:("zoomIndex" in d)?d.zoomIndex:0,zoomSteps:("zoomSteps" in d)?d.zoomSteps:null}};Timeline.createHotZoneBandInfo=function(d){var e=("theme" in d)?d.theme:Timeline.getDefaultTheme();var b=("eventSource" in d)?d.eventSource:null;var f=new Timeline.HotZoneEther({centersOn:("date" in d)?d.date:new Date(),interval:SimileAjax.DateTime.gregorianUnitLengths[d.intervalUnit],pixelsPerInterval:d.intervalPixels,zones:d.zones,theme:e});var g=new Timeline.HotZoneGregorianEtherPainter({unit:d.intervalUnit,zones:d.zones,theme:e,align:("align" in d)?d.align:undefined});var j={showText:("showEventText" in d)?d.showEventText:true,theme:e};if("eventPainterParams" in d){for(var a in d.eventPainterParams){j[a]=d.eventPainterParams[a]}}if("trackHeight" in d){j.trackHeight=d.trackHeight}if("trackGap" in d){j.trackGap=d.trackGap}var h=("overview" in d&&d.overview)?"overview":("layout" in d?d.layout:"original");var c;if("eventPainter" in d){c=new d.eventPainter(j)}else{switch(h){case"overview":c=new Timeline.OverviewEventPainter(j);break;case"detailed":c=new Timeline.DetailedEventPainter(j);break;default:c=new Timeline.OriginalEventPainter(j)}}return{width:d.width,eventSource:b,timeZone:("timeZone" in d)?d.timeZone:0,ether:f,etherPainter:g,eventPainter:c,theme:e,zoomIndex:("zoomIndex" in d)?d.zoomIndex:0,zoomSteps:("zoomSteps" in d)?d.zoomSteps:null}};Timeline.getDefaultTheme=function(){if(Timeline._defaultTheme==null){Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale())}return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};Timeline.loadXML=function(a,c){var d=function(g,e,f){alert("Failed to load data xml from "+a+"\n"+g)};var b=function(f){var e=f.responseXML;if(!e.documentElement&&f.responseStream){e.load(f.responseStream)}c(e,a)};SimileAjax.XmlHttp.get(a,d,b)};Timeline.loadJSON=function(url,f){var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText)};var fDone=function(xmlhttp){f(eval("("+xmlhttp.responseText+")"),url)};SimileAjax.XmlHttp.get(url,fError,fDone)};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};Timeline._Impl=function(d,c,b,e,a){SimileAjax.WindowManager.initialize();this._containerDiv=d;this._bandInfos=c;this._orientation=b==null?Timeline.HORIZONTAL:b;this._unit=(e!=null)?e:SimileAjax.NativeDateUnit;this._starting=true;this._autoResizing=false;this.autoWidth=c&&c[0]&&c[0].theme&&c[0].theme.autoWidth;this.autoWidthAnimationTime=c&&c[0]&&c[0].theme&&c[0].theme.autoWidthAnimationTime;this.timelineID=a;this.timeline_start=c&&c[0]&&c[0].theme&&c[0].theme.timeline_start;this.timeline_stop=c&&c[0]&&c[0].theme&&c[0].theme.timeline_stop;this.timeline_at_start=false;this.timeline_at_stop=false;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++){this._bands[a].dispose()}this._bands=null;this._bandInfos=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(true);this._starting=false};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(true);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++){this._bands[a].paint()}};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};Timeline._Impl.prototype.loadXML=function(b,d){var a=this;var e=function(h,f,g){alert("Failed to load data xml from "+b+"\n"+h);a.hideLoadingMessage()};var c=function(g){try{var f=g.responseXML;if(!f.documentElement&&g.responseStream){f.load(g.responseStream)}d(f,b)}finally{a.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(b,e,c)},0)};Timeline._Impl.prototype.loadJSON=function(url,f){var tl=this;var fError=function(statusText,status,xmlhttp){alert("Failed to load json data from "+url+"\n"+statusText);tl.hideLoadingMessage()};var fDone=function(xmlhttp){try{f(eval("("+xmlhttp.responseText+")"),url)}finally{tl.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(url,fError,fDone)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(false)};Timeline._Impl.prototype._autoWidthCheck=function(c){var e=this;var b=e._starting;var d=0;function a(){var h=e.getWidthStyle();if(b){e._containerDiv.style[h]=d+"px"}else{e._autoResizing=true;var g={};g[h]=d+"px";SimileAjax.jQuery(e._containerDiv).animate(g,e.autoWidthAnimationTime,"linear",function(){e._autoResizing=false})}}function f(){var j=0;var g=e.getPixelWidth();if(e._autoResizing){return}for(var h=0;h<e._bands.length;h++){e._bands[h].checkAutoWidth();j+=e._bandInfos[h].width}if(j>g||c){d=j;a();e._distributeWidths()}}if(!e.autoWidth){return}f()};Timeline._Impl.prototype._initialize=function(){var h=this._containerDiv;var e=h.ownerDocument;h.className=h.className.split(" ").concat("timeline-container").join(" ");var b=(this.isHorizontal())?"horizontal":"vertical";h.className+=" timeline-"+b;while(h.firstChild){h.removeChild(h.firstChild)}var a=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));a.className="timeline-copyright";a.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";SimileAjax.DOM.registerEvent(a,"click",function(){window.location="http://code.google.com/p/simile-widgets/"});h.appendChild(a);this._bands=[];for(var c=0;c<this._bandInfos.length;c++){var g=new Timeline._Band(this,this._bandInfos[c],c);this._bands.push(g)}this._distributeWidths();for(var c=0;c<this._bandInfos.length;c++){var f=this._bandInfos[c];if("syncWith" in f){this._bands[c].setSyncWithBand(this._bands[f.syncWith],("highlight" in f)?f.highlight:false)}}if(this.autoWidth){for(var c=0;c<this._bands.length;c++){this._bands[c].addOnScrollListener(this._autoWidthScrollListener)}}var d=SimileAjax.Graphics.createMessageBubble(e);d.containerDiv.className="timeline-message-container";h.appendChild(d.containerDiv);d.contentDiv.className="timeline-message";d.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){d.containerDiv.style.display="block"};this.hideLoadingMessage=function(){d.containerDiv.style.display="none"}};Timeline._Impl.prototype._distributeWidths=function(){var b=this.getPixelLength();var a=this.getPixelWidth();var c=0;for(var e=0;e<this._bands.length;e++){var j=this._bands[e];var k=this._bandInfos[e];var f=k.width;var d;if(typeof f=="string"){var h=f.indexOf("%");if(h>0){var g=parseInt(f.substr(0,h));d=Math.round(g*a/100)}else{d=parseInt(f)}}else{d=f}j.setBandShiftAndWidth(c,d);j.setViewLength(b);c+=d}};Timeline._Impl.prototype.shiftOK=function(d,b){var c=b>0,a=b<0;if((c&&this.timeline_start==null)||(a&&this.timeline_stop==null)||(b==0)){return(true)}var g=false;for(var f=0;f<this._bands.length&&!g;f++){g=this._bands[f].busy()}if(g){return(true)}if((c&&this.timeline_at_start)||(a&&this.timeline_at_stop)){return(false)}var e=false;for(var f=0;f<this._bands.length&&!e;f++){var h=this._bands[f];if(c){e=(f==d?h.getMinVisibleDateAfterDelta(b):h.getMinVisibleDate())>=this.timeline_start}else{e=(f==d?h.getMaxVisibleDateAfterDelta(b):h.getMaxVisibleDate())<=this.timeline_stop}}if(c){this.timeline_at_start=!e;this.timeline_at_stop=false}else{this.timeline_at_stop=!e;this.timeline_at_start=false}return(e)};Timeline._Impl.prototype.zoom=function(g,b,f,d){var c=new RegExp("^timeline-band-([0-9]+)$");var e=null;var a=c.exec(d.id);if(a){e=parseInt(a[1])}if(e!=null){this._bands[e].zoom(g,b,f,d)}this.paint()};Timeline._Band=function(g,h,c){if(g.autoWidth&&typeof h.width=="string"){h.width=h.width.indexOf("%")>-1?0:parseInt(h.width)}this._timeline=g;this._bandInfo=h;this._index=c;this._locale=("locale" in h)?h.locale:Timeline.getDefaultLocale();this._timeZone=("timeZone" in h)?h.timeZone:0;this._labeller=("labeller" in h)?h.labeller:(("createLabeller" in g.getUnit())?g.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone));this._theme=h.theme;this._zoomIndex=("zoomIndex" in h)?h.zoomIndex:0;this._zoomSteps=("zoomSteps" in h)?h.zoomSteps:null;this._dragging=false;this._changing=false;this._originalScrollSpeed=5;this._scrollSpeed=this._originalScrollSpeed;this._onScrollListeners=[];var a=this;this._syncWithBand=null;this._syncWithBandHandler=function(b){a._onHighlightBandScroll()};this._selectorListener=function(b){a._onHighlightBandScroll()};var e=this._timeline.getDocument().createElement("div");e.className="timeline-band-input";this._timeline.addDiv(e);this._keyboardInput=document.createElement("input");this._keyboardInput.type="text";e.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className="timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(this._div,"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut");SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");var f=this._theme!=null?this._theme.mouseWheel:"scroll";if(f==="zoom"||f==="scroll"||this._zoomSteps){if(SimileAjax.Platform.browser.isFirefox){SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll")}else{SimileAjax.DOM.registerEventWithObject(this._div,"mousewheel",this,"_onMouseScroll")}}this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=h.ether;h.ether.initialize(this,g);this._etherPainter=h.etherPainter;h.etherPainter.initialize(this,g);this._eventSource=h.eventSource;if(this._eventSource){this._eventListener={onAddMany:function(){a._onAddMany()},onClear:function(){a._onClear()}};this._eventSource.addListener(this._eventListener)}this._eventPainter=h.eventPainter;this._eventTracksNeeded=0;this._eventTrackIncrement=0;h.eventPainter.initialize(this,g);this._decorators=("decorators" in h)?h.decorators:[];for(var d=0;d<this._decorators.length;d++){this._decorators[d].initialize(this,g)}};Timeline._Band.SCROLL_MULTIPLES=5;Timeline._Band.prototype.dispose=function(){this.closeBubble();if(this._eventSource){this._eventSource.removeListener(this._eventListener);this._eventListener=null;this._eventSource=null}this._timeline=null;this._bandInfo=null;this._labeller=null;this._ether=null;this._etherPainter=null;this._eventPainter=null;this._decorators=null;this._onScrollListeners=null;this._syncWithBandHandler=null;this._selectorListener=null;this._div=null;this._innerDiv=null;this._keyboardInput=null};Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)};Timeline._Band.prototype.removeOnScrollListener=function(b){for(var a=0;a<this._onScrollListeners.length;a++){if(this._onScrollListeners[a]==b){this._onScrollListeners.splice(a,1);break}}};Timeline._Band.prototype.setSyncWithBand=function(b,a){if(this._syncWithBand){this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler)}this._syncWithBand=b;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._highlight=a;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(b,a){this._eventTrackIncrement=a;if(b>this._eventTracksNeeded){this._eventTracksNeeded=b}};Timeline._Band.prototype.checkAutoWidth=function(){if(!this._timeline.autoWidth){return}var a=this._eventPainter.getType()=="overview";var c=a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin;var b=Math.ceil((this._eventTracksNeeded+c)*this._eventTrackIncrement);b+=a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;var d=this._bandInfo;if(b!=d.width){d.width=b}};Timeline._Band.prototype.layout=function(){this.paint()};Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};Timeline._Band.prototype.setBandShiftAndWidth=function(a,d){var c=this._keyboardInput.parentNode;var b=a+Math.floor(d/2);if(this._timeline.isHorizontal()){this._div.style.top=a+"px";this._div.style.height=d+"px";c.style.top=b+"px";c.style.left="-1em"}else{this._div.style.left=a+"px";this._div.style.width=d+"px";c.style.left=b+"px";c.style.top="-1em"}};Timeline._Band.prototype.getViewWidth=function(){if(this._timeline.isHorizontal()){return this._div.offsetHeight}else{return this._div.offsetWidth}};Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.setMaxVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.setCenterVisibleDate=function(a){if(!this._changing){this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))}};Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)};Timeline._Band.prototype.createLayerDiv=function(d,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+(typeof b=="string"?(" "+b):"");c.style.zIndex=d;this._innerDiv.appendChild(c);var a=this._timeline.getDocument().createElement("div");a.className="timeline-band-layer-inner";if(SimileAjax.Platform.browser.isIE){a.style.cursor="move"}else{a.style.cursor="-moz-grab"}c.appendChild(a);return a};Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)};Timeline._Band.prototype.scrollToCenter=function(b,c){var a=this._ether.dateToPixelOffset(b);if(a<-this._viewLength/2){this.setCenterVisibleDate(this.pixelOffsetToDate(a+this._viewLength))}else{if(a>3*this._viewLength/2){this.setCenterVisibleDate(this.pixelOffsetToDate(a-this._viewLength))}}this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(b)),c)};Timeline._Band.prototype.showBubbleForEvent=function(c){var a=this.getEventSource().getEvent(c);if(a){var b=this;this.scrollToCenter(a.getStart(),function(){b._eventPainter.showBubble(a)})}};Timeline._Band.prototype.zoom=function(f,a,e,c){if(!this._zoomSteps){return}a+=this._viewOffset;var d=this._ether.pixelOffsetToDate(a);var b=this._ether.zoom(f);this._etherPainter.zoom(b);this._moveEther(Math.round(-this._ether.dateToPixelOffset(d)));this._moveEther(a)};Timeline._Band.prototype._onMouseDown=function(b,a,c){this.closeBubble();this._dragging=true;this._dragX=a.clientX;this._dragY=a.clientY};Timeline._Band.prototype._onMouseMove=function(d,a,e){if(this._dragging){var c=a.clientX-this._dragX;var b=a.clientY-this._dragY;this._dragX=a.clientX;this._dragY=a.clientY;this._moveEther(this._timeline.isHorizontal()?c:b);this._positionHighlight()}};Timeline._Band.prototype._onMouseUp=function(b,a,c){this._dragging=false;this._keyboardInput.focus()};Timeline._Band.prototype._onMouseOut=function(b,a,d){var c=SimileAjax.DOM.getEventRelativeCoordinates(a,b);c.x+=this._viewOffset;if(c.x<0||c.x>b.offsetWidth||c.y<0||c.y>b.offsetHeight){this._dragging=false}};Timeline._Band.prototype._onMouseScroll=function(g,j,e){var a=new Date();a=a.getTime();if(!this._lastScrollTime||((a-this._lastScrollTime)>50)){this._lastScrollTime=a;var h=0;if(j.wheelDelta){h=j.wheelDelta/120}else{if(j.detail){h=-j.detail/3}}var f=this._theme.mouseWheel;if(this._zoomSteps||f==="zoom"){var d=SimileAjax.DOM.getEventRelativeCoordinates(j,g);if(h!=0){var c;if(h>0){c=true}if(h<0){c=false}this._timeline.zoom(c,d.x,d.y,g)}}else{if(f==="scroll"){var b=50*(h<0?-1:1);this._moveEther(b)}}}if(j.stopPropagation){j.stopPropagation()}j.cancelBubble=true;if(j.preventDefault){j.preventDefault()}j.returnValue=false};Timeline._Band.prototype._onDblClick=function(b,a,d){var c=SimileAjax.DOM.getEventRelativeCoordinates(a,b);var e=c.x-(this._viewLength/2-this._viewOffset);this._autoScroll(-e)};Timeline._Band.prototype._onKeyDown=function(b,a,c){if(!this._dragging){switch(a.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;default:return true}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return false}return true};Timeline._Band.prototype._onKeyUp=function(b,a,c){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(a.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return true}this.closeBubble();SimileAjax.DOM.cancelEvent(a);return false}return true};Timeline._Band.prototype._autoScroll=function(g,e){var c=this;var d=SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,g,1000,e);d.run()};Timeline._Band.prototype._moveEther=function(a){this.closeBubble();if(!this._timeline.shiftOK(this._index,a)){return}this._viewOffset+=a;this._ether.shiftPixels(-a);if(this._timeline.isHorizontal()){this._div.style.left=this._viewOffset+"px"}else{this._div.style.top=this._viewOffset+"px"}if(this._viewOffset>-this._viewLength*0.5||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)){this._recenterDiv()}else{this.softLayout()}this._onChanging()};Timeline._Band.prototype._onChanging=function(){this._changing=true;this._fireOnScroll();this._setSyncWithBandDate();this._changing=false};Timeline._Band.prototype.busy=function(){return(this._changing)};Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++){this._onScrollListeners[a](this)}};Timeline._Band.prototype._setSyncWithBandDate=function(){if(this._syncWithBand){var a=this._ether.pixelOffsetToDate(this.getViewLength()/2);this._syncWithBand.setCenterVisibleDate(a)}};Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._syncWithBand.getCenterVisibleDate();var b=this._ether.dateToPixelOffset(a);this._moveEther(Math.round(this._viewLength/2-b));if(this._highlight){this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}}};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate();var b=this._syncWithBand.getMaxVisibleDate();if(this._highlight){this._etherPainter.setHighlight(a,b)}}};Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;if(this._timeline.isHorizontal()){this._div.style.left=this._viewOffset+"px";this._div.style.width=(Timeline._Band.SCROLL_MULTIPLES*this._viewLength)+"px"}else{this._div.style.top=this._viewOffset+"px";this._div.style.height=(Timeline._Band.SCROLL_MULTIPLES*this._viewLength)+"px"}this.layout()};Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()};Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++){this._decorators[a].paint()}};Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++){this._decorators[a].softPaint()}};Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};Timeline.ClassicTheme=new Object();Timeline.ClassicTheme.implementations=[];Timeline.ClassicTheme.create=function(a){if(a==null){a=Timeline.getDefaultLocale()}var b=Timeline.ClassicTheme.implementations[a];if(b==null){b=Timeline.ClassicTheme._Impl}return new b()};Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=false;this.autoWidthAnimationTime=500;this.timeline_start=null;this.timeline_stop=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:true,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:false,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};Timeline.LinearEther.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._unit=a.getUnit();if("startsOn" in this._params){this._start=this._unit.parseFromObject(this._params.startsOn)}else{if("endsOn" in this._params){this._start=this._unit.parseFromObject(this._params.endsOn);this.shiftPixels(-this._timeline.getPixelLength())}else{if("centersOn" in this._params){this._start=this._unit.parseFromObject(this._params.centersOn);this.shiftPixels(-this._timeline.getPixelLength()/2)}else{this._start=this._unit.makeDefaultValue();this.shiftPixels(-this._timeline.getPixelLength()/2)}}}};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(b){var a=this._interval*b/this._pixelsPerInterval;this._start=this._unit.change(this._start,a)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){var b=this._unit.compare(a,this._start);return this._pixelsPerInterval*b/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(b){var a=b*this._interval/this._pixelsPerInterval;return this._unit.change(this._start,a)};Timeline.LinearEther.prototype.zoom=function(d){var b=0;var a=this._band._zoomIndex;var c=a;if(d&&(a>0)){c=a-1}if(!d&&(a<(this._band._zoomSteps.length-1))){c=a+1}this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;b=this._band._zoomSteps[c].unit-this._band._zoomSteps[a].unit;return b};Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};Timeline.HotZoneEther.prototype.initialize=function(h,k){this._band=h;this._timeline=k;this._unit=k.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];var b=this._params;for(var d=0;d<b.zones.length;d++){var g=b.zones[d];var e=this._unit.parseFromObject(g.start);var f=this._unit.parseFromObject(g.end);for(var c=0;c<this._zones.length&&this._unit.compare(f,e)>0;c++){var a=this._zones[c];if(this._unit.compare(e,a.endTime)<0){if(this._unit.compare(e,a.startTime)>0){this._zones.splice(c,0,{startTime:a.startTime,endTime:e,magnify:a.magnify});c++;a.startTime=e}if(this._unit.compare(f,a.endTime)<0){this._zones.splice(c,0,{startTime:e,endTime:f,magnify:g.magnify*a.magnify});c++;a.startTime=f;e=f}else{a.magnify*=g.magnify;e=a.endTime}}}}if("startsOn" in this._params){this._start=this._unit.parseFromObject(this._params.startsOn)}else{if("endsOn" in this._params){this._start=this._unit.parseFromObject(this._params.endsOn);this.shiftPixels(-this._timeline.getPixelLength())}else{if("centersOn" in this._params){this._start=this._unit.parseFromObject(this._params.centersOn);this.shiftPixels(-this._timeline.getPixelLength()/2)}else{this._start=this._unit.makeDefaultValue();this.shiftPixels(-this._timeline.getPixelLength()/2)}}}};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(d){var b=0;var a=this._band._zoomIndex;var c=a;if(d&&(a>0)){c=a-1}if(!d&&(a<(this._band._zoomSteps.length-1))){c=a+1}this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;b=this._band._zoomSteps[c].unit-this._band._zoomSteps[a].unit;return b};Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(j,d){var b=this._getScale();var h=j;var c=d;var a=0;if(this._unit.compare(h,c)<0){var g=0;while(g<this._zones.length){if(this._unit.compare(h,this._zones[g].endTime)<0){break}g++}while(this._unit.compare(h,c)<0){var e=this._zones[g];var f=this._unit.earlier(c,e.endTime);a+=(this._unit.compare(f,h)/(b/e.magnify));h=f;g++}}else{var g=this._zones.length-1;while(g>=0){if(this._unit.compare(h,this._zones[g].startTime)>0){break}g--}while(this._unit.compare(h,c)>0){var e=this._zones[g];var f=this._unit.later(c,e.startTime);a+=(this._unit.compare(f,h)/(b/e.magnify));h=f;g--}}return a};Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(h,c){var g=this._getScale();var e=c;if(h>0){var f=0;while(f<this._zones.length){if(this._unit.compare(e,this._zones[f].endTime)<0){break}f++}while(h>0){var a=this._zones[f];var d=g/a.magnify;if(a.endTime==Number.POSITIVE_INFINITY){e=this._unit.change(e,h*d);h=0}else{var b=this._unit.compare(a.endTime,e)/d;if(b>h){e=this._unit.change(e,h*d);h=0}else{e=a.endTime;h-=b}}f++}}else{var f=this._zones.length-1;while(f>=0){if(this._unit.compare(e,this._zones[f].startTime)>0){break}f--}h=-h;while(h>0){var a=this._zones[f];var d=g/a.magnify;if(a.startTime==Number.NEGATIVE_INFINITY){e=this._unit.change(e,-h*d);h=0}else{var b=this._unit.compare(e,a.startTime)/d;if(b>h){e=this._unit.change(e,-h*d);h=0}else{e=a.startTime;h-=b}}f--}}return e};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple=("multiple" in a)?a.multiple:1};Timeline.GregorianEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params&&this._params.align!=undefined)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.GregorianEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var c=this._band.getMinDate();var f=this._band.getMaxDate();var b=this._band.getTimeZone();var e=this._band.getLabeller();SimileAjax.DateTime.roundDownToInterval(c,this._unit,b,this._multiple,this._theme.firstDayOfWeek);var d=this;var a=function(g){for(var h=0;h<d._multiple;h++){SimileAjax.DateTime.incrementByInterval(g,d._unit)}};while(c.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(c,e,this._unit,this._markerLayer,this._lineLayer);a(c)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){if(a!=0){this._unit+=a}};Timeline.HotZoneGregorianEtherPainter=function(g){this._params=g;this._theme=g.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:g.unit,multiple:1}];for(var e=0;e<g.zones.length;e++){var b=g.zones[e];var d=SimileAjax.DateTime.parseGregorianDateTime(b.start).getTime();var f=SimileAjax.DateTime.parseGregorianDateTime(b.end).getTime();for(var c=0;c<this._zones.length&&f>d;c++){var a=this._zones[c];if(d<a.endTime){if(d>a.startTime){this._zones.splice(c,0,{startTime:a.startTime,endTime:d,unit:a.unit,multiple:a.multiple});c++;a.startTime=d}if(f<a.endTime){this._zones.splice(c,0,{startTime:d,endTime:f,unit:b.unit,multiple:(b.multiple)?b.multiple:1});c++;a.startTime=f;d=f}else{a.multiple=b.multiple;a.unit=b.unit;d=a.endTime}}}}};Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params&&this._params.align!=undefined)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var d=this._band.getMinDate();var a=this._band.getMaxDate();var l=this._band.getTimeZone();var j=this._band.getLabeller();var b=this;var m=function(p,o){for(var q=0;q<o.multiple;q++){SimileAjax.DateTime.incrementByInterval(p,o.unit)}};var c=0;while(c<this._zones.length){if(d.getTime()<this._zones[c].endTime){break}c++}var e=this._zones.length-1;while(e>=0){if(a.getTime()>this._zones[e].startTime){break}e--}for(var h=c;h<=e;h++){var g=this._zones[h];var k=new Date(Math.max(d.getTime(),g.startTime));var f=new Date(Math.min(a.getTime(),g.endTime));SimileAjax.DateTime.roundDownToInterval(k,g.unit,l,g.multiple,this._theme.firstDayOfWeek);SimileAjax.DateTime.roundUpToInterval(f,g.unit,l,g.multiple,this._theme.firstDayOfWeek);while(k.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(k,j,g.unit,this._markerLayer,this._lineLayer);m(k,g)}}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(b){if(b!=0){for(var a=0;a<this._zones.length;++a){if(this._zones[a]){this._zones[a].unit+=b}}}};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple=("multiple" in a)?a.multiple:1};Timeline.YearCountEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.YearCountEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var b=new Date(this._startDate.getTime());var f=this._band.getMaxDate();var e=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();b.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-e%this._multiple);var c=this;var a=function(g){for(var h=0;h<c._multiple;h++){SimileAjax.DateTime.incrementByInterval(g,SimileAjax.DateTime.YEAR)}};var d={labelInterval:function(g,j){var h=g.getUTCFullYear()-c._startDate.getUTCFullYear();return{text:h,emphasized:h==0}}};while(b.getTime()<f.getTime()){this._intervalMarkerLayout.createIntervalMarker(b,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer);a(b)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};Timeline.QuarterlyEtherPainter.prototype.initialize=function(c,b){this._band=c;this._timeline=b;this._backgroundLayer=c.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._markerLayer=null;this._lineLayer=null;var d=("align" in this._params)?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];var a=("showLine" in this._params)?this._params.showLine:this._theme.ether.interval.line.show;this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,this._theme,d,a);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};Timeline.QuarterlyEtherPainter.prototype.paint=function(){if(this._markerLayer){this._band.removeLayerDiv(this._markerLayer)}this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";if(this._lineLayer){this._band.removeLayerDiv(this._lineLayer)}this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var b=new Date(0);var e=this._band.getMaxDate();b.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));b.setUTCMonth(this._startDate.getUTCMonth());var c=this;var a=function(f){f.setUTCMonth(f.getUTCMonth()+3)};var d={labelInterval:function(f,h){var g=(4+(f.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;if(g!=0){return{text:"Q"+(g+1),emphasized:false}}else{return{text:"Y"+(f.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:true}}}};while(b.getTime()<e.getTime()){this._intervalMarkerLayout.createIntervalMarker(b,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer);a(b)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};Timeline.EtherIntervalMarkerLayout=function(o,m,c,e,h){var a=o.isHorizontal();if(a){if(e=="Top"){this.positionDiv=function(q,p){q.style.left=p+"px";q.style.top="0px"}}else{this.positionDiv=function(q,p){q.style.left=p+"px";q.style.bottom="0px"}}}else{if(e=="Left"){this.positionDiv=function(q,p){q.style.top=p+"px";q.style.left="0px"}}else{this.positionDiv=function(q,p){q.style.top=p+"px";q.style.right="0px"}}}var d=c.ether.interval.marker;var j=c.ether.interval.line;var b=c.ether.interval.weekend;var l=(a?"h":"v")+e;var g=d[l+"Styler"];var k=d[l+"EmphasizedStyler"];var f=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(v,C,D,E,s){var w=Math.round(m.dateToPixelOffset(v));if(h&&D!=SimileAjax.DateTime.WEEK){var x=o.getDocument().createElement("div");x.className="timeline-ether-lines";if(j.opacity<100){SimileAjax.Graphics.setOpacity(x,j.opacity)}if(a){x.style.left=w+"px"}else{x.style.top=w+"px"}s.appendChild(x)}if(D==SimileAjax.DateTime.WEEK){var p=c.firstDayOfWeek;var y=new Date(v.getTime()+(6-p-7)*f);var B=new Date(y.getTime()+2*f);var z=Math.round(m.dateToPixelOffset(y));var u=Math.round(m.dateToPixelOffset(B));var t=Math.max(1,u-z);var r=o.getDocument().createElement("div");r.className="timeline-ether-weekends";if(b.opacity<100){SimileAjax.Graphics.setOpacity(r,b.opacity)}if(a){r.style.left=z+"px";r.style.width=t+"px"}else{r.style.top=z+"px";r.style.height=t+"px"}s.appendChild(r)}var A=C.labelInterval(v,D);var q=o.getDocument().createElement("div");q.innerHTML=A.text;q.className="timeline-date-label";if(A.emphasized){q.className+=" timeline-date-label-em"}this.positionDiv(q,w);E.appendChild(q);return q}};Timeline.EtherHighlight=function(c,e,d,b){var a=c.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(this._highlightDiv==null){this._highlightDiv=c.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var f=d.ether.highlightOpacity;if(f<100){SimileAjax.Graphics.setOpacity(this._highlightDiv,f)}b.appendChild(this._highlightDiv)}};this.position=function(f,j){this._createHighlightDiv();var k=Math.round(e.dateToPixelOffset(f));var h=Math.round(e.dateToPixelOffset(j));var g=Math.max(h-k,3);if(a){this._highlightDiv.style.left=k+"px";this._highlightDiv.style.width=g+"px";this._highlightDiv.style.height=(e.getViewWidth()-4)+"px"}else{this._highlightDiv.style.top=k+"px";this._highlightDiv.style.height=g+"px";this._highlightDiv.style.width=(e.getViewWidth()-4)+"px"}}};Timeline.EventUtils={};Timeline.EventUtils.getNewEventID=function(){if(this._lastEventID==null){this._lastEventID=0}this._lastEventID+=1;return"e"+this._lastEventID};Timeline.EventUtils.decodeEventElID=function(b){var d=b.split("-");if(d[1]!="tl"){alert("Internal Timeline problem 101, please consult support");return{band:null,evt:null}}var c=Timeline.getTimelineFromID(d[2]);var e=c.getBand(d[3]);var a=e.getEventSource.getEvent(d[4]);return{band:e,evt:a}};Timeline.EventUtils.encodeEventElID=function(c,d,b,a){return b+"-tl-"+c.timelineID+"-"+d.getIndex()+"-"+a.getID()};Timeline.GregorianDateLabeller=function(a,b){this._locale=a;this._timeZone=b};Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.getMonthName=function(b,a){return Timeline.GregorianDateLabeller.monthNames[a][b]};Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,c){var b=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];if(b==null){b=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval}return b.call(this,a,c)};Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(b,f){var c;var e=false;b=SimileAjax.DateTime.removeTimeZoneOffset(b,this._timeZone);switch(f){case SimileAjax.DateTime.MILLISECOND:c=b.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:c=b.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:var a=b.getUTCMinutes();if(a==0){c=b.getUTCHours()+":00";e=true}else{c=a}break;case SimileAjax.DateTime.HOUR:c=b.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:c=Timeline.GregorianDateLabeller.getMonthName(b.getUTCMonth(),this._locale)+" "+b.getUTCDate();break;case SimileAjax.DateTime.WEEK:c=Timeline.GregorianDateLabeller.getMonthName(b.getUTCMonth(),this._locale)+" "+b.getUTCDate();break;case SimileAjax.DateTime.MONTH:var a=b.getUTCMonth();if(a!=0){c=Timeline.GregorianDateLabeller.getMonthName(a,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:var d=b.getUTCFullYear();if(d>0){c=b.getUTCFullYear()}else{c=(1-d)+"BC"}e=(f==SimileAjax.DateTime.MONTH)||(f==SimileAjax.DateTime.DECADE&&d%100==0)||(f==SimileAjax.DateTime.CENTURY&&d%1000==0);break;default:c=b.toUTCString()}return{text:c,emphasized:e}};Timeline.DefaultEventSource=function(a){this._events=(a instanceof Object)?a:new SimileAjax.EventIndex();this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};Timeline.DefaultEventSource.prototype.removeListener=function(b){for(var a=0;a<this._listeners.length;a++){if(this._listeners[a]==b){this._listeners.splice(a,1);break}}};Timeline.DefaultEventSource.prototype.loadXML=function(g,a){var c=this._getBaseURL(a);var h=g.documentElement.getAttribute("wiki-url");var m=g.documentElement.getAttribute("wiki-section");var e=g.documentElement.getAttribute("date-time-format");var f=this._events.getUnit().getParser(e);var d=g.documentElement.firstChild;var j=false;while(d!=null){if(d.nodeType==1){var l="";if(d.firstChild!=null&&d.firstChild.nodeType==3){l=d.firstChild.nodeValue}var b=(d.getAttribute("isDuration")===null&&d.getAttribute("durationEvent")===null)||d.getAttribute("isDuration")=="false"||d.getAttribute("durationEvent")=="false";var k=new Timeline.DefaultEventSource.Event({id:d.getAttribute("id"),start:f(d.getAttribute("start")),end:f(d.getAttribute("end")),latestStart:f(d.getAttribute("latestStart")),earliestEnd:f(d.getAttribute("earliestEnd")),instant:b,text:d.getAttribute("title"),description:l,image:this._resolveRelativeURL(d.getAttribute("image"),c),link:this._resolveRelativeURL(d.getAttribute("link"),c),icon:this._resolveRelativeURL(d.getAttribute("icon"),c),color:d.getAttribute("color"),textColor:d.getAttribute("textColor"),hoverText:d.getAttribute("hoverText"),classname:d.getAttribute("classname"),tapeImage:d.getAttribute("tapeImage"),tapeRepeat:d.getAttribute("tapeRepeat"),caption:d.getAttribute("caption"),eventID:d.getAttribute("eventID"),trackNum:d.getAttribute("trackNum")});k._node=d;k.getProperty=function(o){return this._node.getAttribute(o)};k.setWikiInfo(h,m);this._events.add(k);j=true}d=d.nextSibling}if(j){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.loadJSON=function(g,b){var d=this._getBaseURL(b);var k=false;if(g&&g.events){var j=("wikiURL" in g)?g.wikiURL:null;var m=("wikiSection" in g)?g.wikiSection:null;var e=("dateTimeFormat" in g)?g.dateTimeFormat:null;var h=this._events.getUnit().getParser(e);for(var f=0;f<g.events.length;f++){var a=g.events[f];var c=a.isDuration||(a.durationEvent!=null&&!a.durationEvent);var l=new Timeline.DefaultEventSource.Event({id:("id" in a)?a.id:undefined,start:h(a.start),end:h(a.end),latestStart:h(a.latestStart),earliestEnd:h(a.earliestEnd),instant:c,text:a.title,description:a.description,image:this._resolveRelativeURL(a.image,d),link:this._resolveRelativeURL(a.link,d),icon:this._resolveRelativeURL(a.icon,d),color:a.color,textColor:a.textColor,hoverText:a.hoverText,classname:a.classname,tapeImage:a.tapeImage,tapeRepeat:a.tapeRepeat,caption:a.caption,eventID:a.eventID,trackNum:a.trackNum});l._obj=a;l.getProperty=function(o){return this._obj[o]};l.setWikiInfo(j,m);this._events.add(l);k=true}}if(k){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.loadSPARQL=function(h,a){var d=this._getBaseURL(a);var f="iso8601";var g=this._events.getUnit().getParser(f);if(h==null){return}var e=h.documentElement.firstChild;while(e!=null&&(e.nodeType!=1||e.nodeName!="results")){e=e.nextSibling}var k=null;var o=null;if(e!=null){k=e.getAttribute("wiki-url");o=e.getAttribute("wiki-section");e=e.firstChild}var l=false;while(e!=null){if(e.nodeType==1){var c={};var j=e.firstChild;while(j!=null){if(j.nodeType==1&&j.firstChild!=null&&j.firstChild.nodeType==1&&j.firstChild.firstChild!=null&&j.firstChild.firstChild.nodeType==3){c[j.getAttribute("name")]=j.firstChild.firstChild.nodeValue}j=j.nextSibling}if(c.start==null&&c.date!=null){c.start=c.date}var b=(c.isDuration===null&&c.durationEvent===null)||c.isDuration=="false"||c.durationEvent=="false";var m=new Timeline.DefaultEventSource.Event({id:c.id,start:g(c.start),end:g(c.end),latestStart:g(c.latestStart),earliestEnd:g(c.earliestEnd),instant:b,text:c.title,description:c.description,image:this._resolveRelativeURL(c.image,d),link:this._resolveRelativeURL(c.link,d),icon:this._resolveRelativeURL(c.icon,d),color:c.color,textColor:c.textColor,hoverText:c.hoverText,caption:c.caption,classname:c.classname,tapeImage:c.tapeImage,tapeRepeat:c.tapeRepeat,eventID:c.eventID,trackNum:c.trackNum});m._bindings=c;m.getProperty=function(p){return this._bindings[p]};m.setWikiInfo(k,o);this._events.add(m);l=true}e=e.nextSibling}if(l){this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};Timeline.DefaultEventSource.prototype.addMany=function(b){for(var a=0;a<b.length;a++){this._events.add(b[a])}this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};Timeline.DefaultEventSource.prototype._fire=function(b,a){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(b in d){try{d[b].apply(d,a)}catch(f){SimileAjax.Debug.exception(f)}}}};Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(a.indexOf("://")<0){var c=this._getBaseURL(document.location.href);if(a.substr(0,1)=="/"){a=c.substr(0,c.indexOf("/",c.indexOf("://")+3))+a}else{a=c+a}}var b=a.lastIndexOf("/");if(b<0){return""}else{return a.substr(0,b+1)}};Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){if(a==null||a==""){return a}else{if(a.indexOf("://")>0){return a}else{if(a.substr(0,1)=="/"){return b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a}else{return b+a}}}};Timeline.DefaultEventSource.Event=function(a){function d(e){return(a[e]!=null&&a[e]!="")?a[e]:null}var c=a.id?a.id.trim():"";this._id=c.length>0?c:Timeline.EventUtils.getNewEventID();this._instant=a.instant||(a.end==null);this._start=a.start;this._end=(a.end!=null)?a.end:a.start;this._latestStart=(a.latestStart!=null)?a.latestStart:(a.instant?this._end:this._start);this._earliestEnd=(a.earliestEnd!=null)?a.earliestEnd:this._end;var b=[];if(this._start>this._latestStart){this._latestStart=this._start;b.push("start is > latestStart")}if(this._start>this._earliestEnd){this._earliestEnd=this._latestStart;b.push("start is > earliestEnd")}if(this._start>this._end){this._end=this._earliestEnd;b.push("start is > end")}if(this._latestStart>this._earliestEnd){this._earliestEnd=this._latestStart;b.push("latestStart is > earliestEnd")}if(this._latestStart>this._end){this._end=this._earliestEnd;b.push("latestStart is > end")}if(this._earliestEnd>this._end){this._end=this._earliestEnd;b.push("earliestEnd is > end")}this._eventID=d("eventID");this._text=(a.text!=null)?SimileAjax.HTML.deEntify(a.text):"";if(b.length>0){this._text+=" PROBLEM: "+b.join(", ")}this._description=SimileAjax.HTML.deEntify(a.description);this._image=d("image");this._link=d("link");this._title=d("hoverText");this._title=d("caption");this._icon=d("icon");this._color=d("color");this._textColor=d("textColor");this._classname=d("classname");this._tapeImage=d("tapeImage");this._tapeRepeat=d("tapeRepeat");this._trackNum=d("trackNum");if(this._trackNum!=null){this._trackNum=parseInt(this._trackNum)}this._wikiURL=null;this._wikiSection=null};Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(a){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},setWikiInfo:function(b,a){this._wikiURL=b;this._wikiSection=a},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(e){e.style.display="none";if(this._wikiURL==null||this._wikiSection==null){return}var d=this.getProperty("wikiID");if(d==null||d.length==0){d=this.getText()}if(d==null||d.length==0){return}e.style.display="inline";d=d.replace(/\s/g,"_");var c=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+d;var b=document.createElement("a");b.href=c;b.target="new";b.innerHTML=Timeline.strings[Timeline.clientLocale].wikiLinkLabel;e.appendChild(document.createTextNode("["));e.appendChild(b);e.appendChild(document.createTextNode("]"))},fillTime:function(a,b){if(this._instant){if(this.isImprecise()){a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))}else{a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)))}}else{if(this.isImprecise()){a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))}else{a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)));a.appendChild(a.ownerDocument.createElement("br"));a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))}}},fillInfoBubble:function(b,e,m){var o=b.ownerDocument;var l=this.getText();var j=this.getLink();var d=this.getImage();if(d!=null){var f=o.createElement("img");f.src=d;e.event.bubble.imageStyler(f);b.appendChild(f)}var p=o.createElement("div");var c=o.createTextNode(l);if(j!=null){var k=o.createElement("a");k.href=j;k.appendChild(c);p.appendChild(k)}else{p.appendChild(c)}e.event.bubble.titleStyler(p);b.appendChild(p);var q=o.createElement("div");this.fillDescription(q);e.event.bubble.bodyStyler(q);b.appendChild(q);var h=o.createElement("div");this.fillTime(h,m);e.event.bubble.timeStyler(h);b.appendChild(h);var g=o.createElement("div");this.fillWikiInfo(g);e.event.bubble.wikiStyler(g);b.appendChild(g)}};Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.OriginalEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(b){for(var a=0;a<this._eventPaintListeners.length;a++){if(this._eventPaintListeners[a]==b){this._eventPaintListeners.splice(a,1);break}}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.OriginalEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();var j=this._params.theme.event;var g=Math.max(j.track.height,j.tape.height+this._frc.getLineHeight());var f={trackOffset:j.track.offset,trackHeight:g,trackGap:j.track.gap,trackIncrement:g+j.track.gap,icon:j.instant.icon,iconWidth:j.instant.iconWidth,iconHeight:j.instant.iconHeight,labelWidth:j.label.width,maxLabelChar:j.label.maxLabelChar,impreciseIconMargin:j.instant.impreciseIconMargin};var c=this._band.getMinDate();var a=this._band.getMaxDate();var k=(this._filterMatcher!=null)?this._filterMatcher:function(l){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(l){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var h=d.next();if(k(h)){this.paintEvent(h,f,this._params.theme,e(h))}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,f.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null)};Timeline.OriginalEventPainter.prototype.softPaint=function(){};Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._tracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.OriginalEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(o,s,u,t){var x=this._timeline.getDocument();var m=o.getText();var e=o.getStart();var c=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(c+s.iconWidth/2);var l=Math.round(c-s.iconWidth/2);var h=this._getLabelDivClassName(o);var j=this._frc.computeSize(m,h);var y=a+u.event.label.offsetFromLine;var d=y+j.width;var w=d;var q=this._findFreeTrack(o,w);var v=Math.round(s.trackOffset+q*s.trackIncrement+s.trackHeight/2-j.height/2);var b=this._paintEventIcon(o,q,l,s,u,0);var r=this._paintEventLabel(o,m,y,v,j.width,j.height,u,h,t);var f=[b.elmt,r.elmt];var p=this;var k=function(z,A,B){return p._onClickInstantEvent(b.elmt,A,o)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(r.elmt,"mousedown",k);var g=this._createHighlightDiv(t,b,u,o);if(g!=null){f.push(g)}this._fireEventPaintListeners("paintedEvent",o,f);this._eventIdToElmt[o.getID()]=b.elmt;this._tracks[q]=l};Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(r,v,A,x){var C=this._timeline.getDocument();var p=r.getText();var g=r.getStart();var y=r.getEnd();var d=Math.round(this._band.dateToPixelOffset(g));var b=Math.round(this._band.dateToPixelOffset(y));var a=Math.round(d+v.iconWidth/2);var o=Math.round(d-v.iconWidth/2);var k=this._getLabelDivClassName(r);var l=this._frc.computeSize(p,k);var D=a+A.event.label.offsetFromLine;var e=D+l.width;var B=Math.max(e,b);var t=this._findFreeTrack(r,B);var q=A.event.tape.height;var z=Math.round(v.trackOffset+t*v.trackIncrement+q);var c=this._paintEventIcon(r,t,o,v,A,q);var u=this._paintEventLabel(r,p,D,z,l.width,l.height,A,k,x);var w=r.getColor();w=w!=null?w:A.event.instant.impreciseColor;var f=this._paintEventTape(r,t,d,b,w,A.event.instant.impreciseOpacity,v,A,0);var h=[c.elmt,u.elmt,f.elmt];var s=this;var m=function(E,F,G){return s._onClickInstantEvent(c.elmt,F,r)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(u.elmt,"mousedown",m);var j=this._createHighlightDiv(x,c,A,r);if(j!=null){h.push(j)}this._fireEventPaintListeners("paintedEvent",r,h);this._eventIdToElmt[r.getID()]=c.elmt;this._tracks[t]=o};Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(m,r,v,t){var y=this._timeline.getDocument();var l=m.getText();var e=m.getStart();var u=m.getEnd();var b=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(this._band.dateToPixelOffset(u));var h=this._getLabelDivClassName(m);var j=this._frc.computeSize(l,h);var z=b;var c=z+j.width;var x=Math.max(c,a);var p=this._findFreeTrack(m,x);var w=Math.round(r.trackOffset+p*r.trackIncrement+v.event.tape.height);var s=m.getColor();s=s!=null?s:v.event.duration.color;var d=this._paintEventTape(m,p,b,a,s,100,r,v,0);var q=this._paintEventLabel(m,l,z,w,j.width,j.height,v,h,t);var f=[d.elmt,q.elmt];var o=this;var k=function(A,B,C){return o._onClickDurationEvent(d.elmt,B,m)};SimileAjax.DOM.registerEvent(d.elmt,"mousedown",k);SimileAjax.DOM.registerEvent(q.elmt,"mousedown",k);var g=this._createHighlightDiv(t,d,v,m);if(g!=null){f.push(g)}this._fireEventPaintListeners("paintedEvent",m,f);this._eventIdToElmt[m.getID()]=d.elmt;this._tracks[p]=b};Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(p,u,A,x){var D=this._timeline.getDocument();var o=p.getText();var e=p.getStart();var v=p.getLatestStart();var y=p.getEnd();var C=p.getEarliestEnd();var c=Math.round(this._band.dateToPixelOffset(e));var g=Math.round(this._band.dateToPixelOffset(v));var a=Math.round(this._band.dateToPixelOffset(y));var h=Math.round(this._band.dateToPixelOffset(C));var k=this._getLabelDivClassName(p);var l=this._frc.computeSize(o,k);var E=g;var b=E+l.width;var B=Math.max(b,a);var r=this._findFreeTrack(p,B);var z=Math.round(u.trackOffset+r*u.trackIncrement+A.event.tape.height);var w=p.getColor();w=w!=null?w:A.event.duration.color;var t=this._paintEventTape(p,r,c,a,A.event.duration.impreciseColor,A.event.duration.impreciseOpacity,u,A,0);var d=this._paintEventTape(p,r,g,h,w,100,u,A,1);var s=this._paintEventLabel(p,o,E,z,l.width,l.height,A,k,x);var f=[t.elmt,d.elmt,s.elmt];var q=this;var m=function(F,G,H){return q._onClickDurationEvent(d.elmt,G,p)};SimileAjax.DOM.registerEvent(d.elmt,"mousedown",m);SimileAjax.DOM.registerEvent(s.elmt,"mousedown",m);var j=this._createHighlightDiv(x,d,A,p);if(j!=null){f.push(j)}this._fireEventPaintListeners("paintedEvent",p,f);this._eventIdToElmt[p.getID()]=d.elmt;this._tracks[r]=c};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(b,a){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,b,a)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(e,a){var d=e.getTrackNum();if(d!=null){return d}for(var c=0;c<this._tracks.length;c++){var b=this._tracks[c];if(b>a){break}}return c};Timeline.OriginalEventPainter.prototype._paintEventIcon=function(k,f,b,g,e,c){var j=k.getIcon();j=j!=null?j:g.icon;var h;if(c>0){h=g.trackOffset+f*g.trackIncrement+c+g.impreciseIconMargin}else{var l=g.trackOffset+f*g.trackIncrement+g.trackHeight/2;h=Math.round(l-g.iconHeight/2)}var d=SimileAjax.Graphics.createTranslucentImage(j);var a=this._timeline.getDocument().createElement("div");a.className=this._getElClassName("timeline-event-icon",k,"icon");a.id=this._encodeEventElID("icon",k);a.style.left=b+"px";a.style.top=h+"px";a.appendChild(d);if(k._title!=null){a.title=k._title}this._eventLayer.appendChild(a);return{left:b,top:h,width:g.iconWidth,height:g.iconHeight,elmt:a}};Timeline.OriginalEventPainter.prototype._paintEventLabel=function(k,l,c,h,a,m,e,f,b){var j=this._timeline.getDocument();var g=j.createElement("div");g.className=f;g.id=this._encodeEventElID("label",k);g.style.left=c+"px";g.style.width=a+"px";g.style.top=h+"px";g.innerHTML=l;if(k._title!=null){g.title=k._title}var d=k.getTextColor();if(d==null){d=k.getColor()}if(d!=null){g.style.color=d}if(e.event.highlightLabelBackground&&b>=0){g.style.background=this._getHighlightColor(b,e)}this._eventLayer.appendChild(g);return{left:c,top:h,width:a,height:m,elmt:g}};Timeline.OriginalEventPainter.prototype._paintEventTape=function(p,j,f,a,c,h,k,g,q){var b=a-f;var e=g.event.tape.height;var l=k.trackOffset+j*k.trackIncrement;var o=this._timeline.getDocument().createElement("div");o.className=this._getElClassName("timeline-event-tape",p,"tape");o.id=this._encodeEventElID("tape"+q,p);o.style.left=f+"px";o.style.width=b+"px";o.style.height=e+"px";o.style.top=l+"px";if(p._title!=null){o.title=p._title}if(c!=null){o.style.backgroundColor=c}var m=p.getTapeImage();var d=p.getTapeRepeat();d=d!=null?d:"repeat";if(m!=null){o.style.backgroundImage="url("+m+")";o.style.backgroundRepeat=d}SimileAjax.Graphics.setOpacity(o,h);this._eventLayer.appendChild(o);return{left:f,top:l,width:b,height:e,elmt:o}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(b,a,d){var e=a.getClassName(),c=[];if(e){if(d){c.push(d+"-"+e+" ")}c.push(e+" ")}c.push(b);return(c.join(""))};Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,c){var b=c.event.highlightColors;return b[Math.min(a,b.length-1)]};Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,d,f,b){var g=null;if(a>=0){var e=this._timeline.getDocument();var c=this._getHighlightColor(a,f);g=e.createElement("div");g.className=this._getElClassName("timeline-event-highlight",b,"highlight");g.id=this._encodeEventElID("highlight0",b);g.style.position="absolute";g.style.overflow="hidden";g.style.left=(d.left-2)+"px";g.style.width=(d.width+4)+"px";g.style.top=(d.top-2)+"px";g.style.height=(d.height+4)+"px";g.style.background=c;this._highlightLayer.appendChild(g)}return g};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),a);this._fireOnSelect(a.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,b);this._fireOnSelect(b.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,a)}};Timeline.OriginalEventPainter.prototype._showBubble=function(a,e,b){var d=document.createElement("div");var c=this._params.theme.event.bubble;b.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,e,c.width,null,c.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(d,a,c){for(var b=0;b<this._eventPaintListeners.length;b++){this._eventPaintListeners[b](this._band,d,a,c)}};Timeline.DetailedEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.DetailedEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.DetailedEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._eventIdToElmt={};this._prepareForPainting();var j=this._params.theme.event;var g=Math.max(j.track.height,this._frc.getLineHeight());var f={trackOffset:Math.round(this._band.getViewWidth()/2-g/2),trackHeight:g,trackGap:j.track.gap,trackIncrement:g+j.track.gap,icon:j.instant.icon,iconWidth:j.instant.iconWidth,iconHeight:j.instant.iconHeight,labelWidth:j.label.width};var c=this._band.getMinDate();var a=this._band.getMaxDate();var k=(this._filterMatcher!=null)?this._filterMatcher:function(l){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(l){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var h=d.next();if(k(h)){this.paintEvent(h,f,this._params.theme,e(h))}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,f.trackIncrement)};Timeline.DetailedEventPainter.prototype.softPaint=function(){};Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.DetailedEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(l,p,s,q){var u=this._timeline.getDocument();var k=l.getText();var e=l.getStart();var c=Math.round(this._band.dateToPixelOffset(e));var a=Math.round(c+p.iconWidth/2);var j=Math.round(c-p.iconWidth/2);var g=this._frc.computeSize(k);var d=this._findFreeTrackForSolid(a,c);var b=this._paintEventIcon(l,d,j,p,s);var v=a+s.event.label.offsetFromLine;var r=d;var f=this._getTrackData(d);if(Math.min(f.solid,f.text)>=v+g.width){f.solid=j;f.text=v}else{f.solid=j;v=c+s.event.label.offsetFromLine;r=this._findFreeTrackForText(d,v+g.width,function(w){w.line=c-2});this._getTrackData(r).text=j;this._paintEventLine(l,c,d,r,p,s)}var t=Math.round(p.trackOffset+r*p.trackIncrement+p.trackHeight/2-g.height/2);var o=this._paintEventLabel(l,k,v,t,g.width,g.height,s);var m=this;var h=function(w,x,y){return m._onClickInstantEvent(b.elmt,x,l)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(o.elmt,"mousedown",h);this._createHighlightDiv(q,b,s);this._eventIdToElmt[l.getID()]=b.elmt};Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(p,s,x,t){var z=this._timeline.getDocument();var o=p.getText();var h=p.getStart();var u=p.getEnd();var e=Math.round(this._band.dateToPixelOffset(h));var b=Math.round(this._band.dateToPixelOffset(u));var a=Math.round(e+s.iconWidth/2);var m=Math.round(e-s.iconWidth/2);var k=this._frc.computeSize(o);var f=this._findFreeTrackForSolid(b,e);var g=this._paintEventTape(p,f,e,b,x.event.instant.impreciseColor,x.event.instant.impreciseOpacity,s,x);var c=this._paintEventIcon(p,f,m,s,x);var j=this._getTrackData(f);j.solid=m;var y=a+x.event.label.offsetFromLine;var d=y+k.width;var v;if(d<b){v=f}else{y=e+x.event.label.offsetFromLine;d=y+k.width;v=this._findFreeTrackForText(f,d,function(A){A.line=e-2});this._getTrackData(v).text=m;this._paintEventLine(p,e,f,v,s,x)}var w=Math.round(s.trackOffset+v*s.trackIncrement+s.trackHeight/2-k.height/2);var r=this._paintEventLabel(p,o,y,w,k.width,k.height,x);var q=this;var l=function(A,B,C){return q._onClickInstantEvent(c.elmt,B,p)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",l);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",l);SimileAjax.DOM.registerEvent(r.elmt,"mousedown",l);this._createHighlightDiv(t,c,x);this._eventIdToElmt[p.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(k,o,u,q){var v=this._timeline.getDocument();var j=k.getText();var d=k.getStart();var r=k.getEnd();var b=Math.round(this._band.dateToPixelOffset(d));var a=Math.round(this._band.dateToPixelOffset(r));var f=this._frc.computeSize(j);var e=this._findFreeTrackForSolid(a);var p=k.getColor();p=p!=null?p:u.event.duration.color;var c=this._paintEventTape(k,e,b,a,p,100,o,u);var h=this._getTrackData(e);h.solid=b;var w=b+u.event.label.offsetFromLine;var s=this._findFreeTrackForText(e,w+f.width,function(x){x.line=b-2});this._getTrackData(s).text=b-2;this._paintEventLine(k,b,e,s,o,u);var t=Math.round(o.trackOffset+s*o.trackIncrement+o.trackHeight/2-f.height/2);var m=this._paintEventLabel(k,j,w,t,f.width,f.height,u);var l=this;var g=function(x,y,z){return l._onClickDurationEvent(c.elmt,y,k)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",g);SimileAjax.DOM.registerEvent(m.elmt,"mousedown",g);this._createHighlightDiv(q,c,u);this._eventIdToElmt[k.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(m,r,y,u){var B=this._timeline.getDocument();var l=m.getText();var d=m.getStart();var s=m.getLatestStart();var v=m.getEnd();var z=m.getEarliestEnd();var b=Math.round(this._band.dateToPixelOffset(d));var f=Math.round(this._band.dateToPixelOffset(s));var a=Math.round(this._band.dateToPixelOffset(v));var g=Math.round(this._band.dateToPixelOffset(z));var h=this._frc.computeSize(l);var e=this._findFreeTrackForSolid(a);var t=m.getColor();t=t!=null?t:y.event.duration.color;var q=this._paintEventTape(m,e,b,a,y.event.duration.impreciseColor,y.event.duration.impreciseOpacity,r,y);var c=this._paintEventTape(m,e,f,g,t,100,r,y);var k=this._getTrackData(e);k.solid=b;var A=f+y.event.label.offsetFromLine;var w=this._findFreeTrackForText(e,A+h.width,function(C){C.line=f-2});this._getTrackData(w).text=f-2;this._paintEventLine(m,f,e,w,r,y);var x=Math.round(r.trackOffset+w*r.trackIncrement+r.trackHeight/2-h.height/2);var p=this._paintEventLabel(m,l,A,x,h.width,h.height,y);var o=this;var j=function(C,D,E){return o._onClickDurationEvent(c.elmt,D,m)};SimileAjax.DOM.registerEvent(c.elmt,"mousedown",j);SimileAjax.DOM.registerEvent(p.elmt,"mousedown",j);this._createHighlightDiv(u,c,y);this._eventIdToElmt[m.getID()]=c.elmt};Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(b,a){for(var d=0;true;d++){if(d<this._lowerTracks.length){var c=this._lowerTracks[d];if(Math.min(c.solid,c.text)>b&&(!(a)||c.line>a)){return d}}else{this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});return d}if(d<this._upperTracks.length){var c=this._upperTracks[d];if(Math.min(c.solid,c.text)>b&&(!(a)||c.line>a)){return -1-d}}else{this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});return -1-d}}};Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(d,c,h){var f;var g;var b;var k;if(d<0){f=true;b=-d;g=this._findFreeUpperTrackForText(b,c);k=-1-g}else{if(d>0){f=false;b=d+1;g=this._findFreeLowerTrackForText(b,c);k=g}else{var a=this._findFreeUpperTrackForText(0,c);var j=this._findFreeLowerTrackForText(1,c);if(j-1<=a){f=false;b=1;g=j;k=g}else{f=true;b=0;g=a;k=-1-g}}}if(f){if(g==this._upperTracks.length){this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY})}for(var e=b;e<g;e++){h(this._upperTracks[e])}}else{if(g==this._lowerTracks.length){this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY})}for(var e=b;e<g;e++){h(this._lowerTracks[e])}}return k};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,c){for(;a<this._lowerTracks.length;a++){var b=this._lowerTracks[a];if(Math.min(b.solid,b.text)>=c){break}}return a};Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,c){for(;a<this._upperTracks.length;a++){var b=this._upperTracks[a];if(Math.min(b.solid,b.text)>=c){break}}return a};Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return(a<0)?this._upperTracks[-a-1]:this._lowerTracks[a]};Timeline.DetailedEventPainter.prototype._paintEventLine=function(j,c,f,a,g,d){var h=Math.round(g.trackOffset+f*g.trackIncrement+g.trackHeight/2);var k=Math.round(Math.abs(a-f)*g.trackIncrement);var e="1px solid "+d.event.label.lineColor;var b=this._timeline.getDocument().createElement("div");b.style.position="absolute";b.style.left=c+"px";b.style.width=d.event.label.offsetFromLine+"px";b.style.height=k+"px";if(f>a){b.style.top=(h-k)+"px";b.style.borderTop=e}else{b.style.top=h+"px";b.style.borderBottom=e}b.style.borderLeft=e;this._lineLayer.appendChild(b)};Timeline.DetailedEventPainter.prototype._paintEventIcon=function(j,e,b,f,d){var h=j.getIcon();h=h!=null?h:f.icon;var k=f.trackOffset+e*f.trackIncrement+f.trackHeight/2;var g=Math.round(k-f.iconHeight/2);var c=SimileAjax.Graphics.createTranslucentImage(h);var a=this._timeline.getDocument().createElement("div");a.style.position="absolute";a.style.left=b+"px";a.style.top=g+"px";a.appendChild(c);a.style.cursor="pointer";if(j._title!=null){a.title=j._title}this._eventLayer.appendChild(a);return{left:b,top:g,width:f.iconWidth,height:f.iconHeight,elmt:a}};Timeline.DetailedEventPainter.prototype._paintEventLabel=function(h,j,b,f,a,k,d){var g=this._timeline.getDocument();var l=g.createElement("div");l.style.position="absolute";l.style.left=b+"px";l.style.width=a+"px";l.style.top=f+"px";l.style.height=k+"px";l.style.backgroundColor=d.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(l,d.event.label.backgroundOpacity);this._eventLayer.appendChild(l);var e=g.createElement("div");e.style.position="absolute";e.style.left=b+"px";e.style.width=a+"px";e.style.top=f+"px";e.innerHTML=j;e.style.cursor="pointer";if(h._title!=null){e.title=h._title}var c=h.getTextColor();if(c==null){c=h.getColor()}if(c!=null){e.style.color=c}this._eventLayer.appendChild(e);return{left:b,top:f,width:a,height:k,elmt:e}};Timeline.DetailedEventPainter.prototype._paintEventTape=function(m,h,e,a,c,g,j,f){var b=a-e;var d=f.event.tape.height;var o=j.trackOffset+h*j.trackIncrement+j.trackHeight/2;var k=Math.round(o-d/2);var l=this._timeline.getDocument().createElement("div");l.style.position="absolute";l.style.left=e+"px";l.style.width=b+"px";l.style.top=k+"px";l.style.height=d+"px";l.style.backgroundColor=c;l.style.overflow="hidden";l.style.cursor="pointer";if(m._title!=null){l.title=m._title}SimileAjax.Graphics.setOpacity(l,g);this._eventLayer.appendChild(l);return{left:e,top:k,width:b,height:d,elmt:l}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-2)+"px";f.style.width=(c.width+4)+"px";f.style.top=(c.top-2)+"px";f.style.height=(c.height+4)+"px";f.style.background=b;this._highlightLayer.appendChild(f)}};Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),a);this._fireOnSelect(a.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,b);this._fireOnSelect(b.getID());d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,a)}};Timeline.DetailedEventPainter.prototype._showBubble=function(a,e,b){var d=document.createElement("div");var c=this._params.theme.event.bubble;b.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,e,c.width,null,c.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._eventLayer=null;this._highlightLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.OverviewEventPainter.prototype.paint=function(){var b=this._band.getEventSource();if(b==null){return}this._prepareForPainting();var h=this._params.theme.event;var f={trackOffset:h.overviewTrack.offset,trackHeight:h.overviewTrack.height,trackGap:h.overviewTrack.gap,trackIncrement:h.overviewTrack.height+h.overviewTrack.gap};var c=this._band.getMinDate();var a=this._band.getMaxDate();var j=(this._filterMatcher!=null)?this._filterMatcher:function(k){return true};var e=(this._highlightMatcher!=null)?this._highlightMatcher:function(k){return -1};var d=b.getEventReverseIterator(c,a);while(d.hasNext()){var g=d.next();if(j(g)){this.paintEvent(g,f,this._params.theme,e(g))}}this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,f.trackIncrement)};Timeline.OverviewEventPainter.prototype.softPaint=function(){};Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];if(this._highlightLayer!=null){a.removeLayerDiv(this._highlightLayer)}this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._eventLayer!=null){a.removeLayerDiv(this._eventLayer)}this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.OverviewEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(j,h,f,a){var b=j.getStart();var e=Math.round(this._band.dateToPixelOffset(b));var d=j.getColor(),c=j.getClassName();if(c){d=null}else{d=d!=null?d:f.event.duration.color}var g=this._paintEventTick(j,e,d,100,h,f);this._createHighlightDiv(a,g,f)};Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(m,l,k,d){var a=m.getLatestStart();var c=m.getEarliestEnd();var b=Math.round(this._band.dateToPixelOffset(a));var e=Math.round(this._band.dateToPixelOffset(c));var j=0;for(;j<this._tracks.length;j++){if(e<this._tracks[j]){break}}this._tracks[j]=e;var h=m.getColor(),g=m.getClassName();if(g){h=null}else{h=h!=null?h:k.event.duration.color}var f=this._paintEventTape(m,j,b,e,h,100,l,k,g);this._createHighlightDiv(d,f,k)};Timeline.OverviewEventPainter.prototype._paintEventTape=function(m,b,c,l,e,g,h,f,d){var j=h.trackOffset+b*h.trackIncrement;var a=l-c;var o=h.trackHeight;var k=this._timeline.getDocument().createElement("div");k.className="timeline-small-event-tape";if(d){k.className+=" small-"+d}k.style.left=c+"px";k.style.width=a+"px";k.style.top=j+"px";k.style.height=o+"px";if(e){k.style.backgroundColor=e}if(g<100){SimileAjax.Graphics.setOpacity(k,g)}this._eventLayer.appendChild(k);return{left:c,top:j,width:a,height:o,elmt:k}};Timeline.OverviewEventPainter.prototype._paintEventTick=function(k,b,d,f,g,e){var l=e.event.overviewTrack.tickHeight;var h=g.trackOffset-l;var a=1;var j=this._timeline.getDocument().createElement("div");j.className="timeline-small-event-icon";j.style.left=b+"px";j.style.top=h+"px";var c=k.getClassName();if(c){j.className+=" small-"+c}if(f<100){SimileAjax.Graphics.setOpacity(j,f)}this._eventLayer.appendChild(j);return{left:b,top:h,width:a,height:l,elmt:j}};Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-1)+"px";f.style.width=(c.width+2)+"px";f.style.top=(c.top-1)+"px";f.style.height=(c.height+2)+"px";f.style.background=b;this._highlightLayer.appendChild(f)}};Timeline.OverviewEventPainter.prototype.showBubble=function(a){};Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._filterMatcher=null;this._highlightMatcher=null;this._frc=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._backLayer=null;this._eventLayer=null;this._lineLayer=null;this._highlightLayer=null;this._eventIdToElmt=null};Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(b){for(var a=0;a<this._onSelectListeners.length;a++){if(this._onSelectListeners[a]==b){this._onSelectListeners.splice(a,1);break}}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};Timeline.CompactEventPainter.prototype.paint=function(){var s=this._band.getEventSource();if(s==null){return}this._eventIdToElmt={};this._prepareForPainting();var t=this._params.theme;var q=t.event;var k={trackOffset:"trackOffset" in this._params?this._params.trackOffset:10,trackHeight:"trackHeight" in this._params?this._params.trackHeight:10,tapeHeight:t.event.tape.height,tapeBottomMargin:"tapeBottomMargin" in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin" in this._params?this._params.labelBottomMargin:5,labelRightMargin:"labelRightMargin" in this._params?this._params.labelRightMargin:5,defaultIcon:q.instant.icon,defaultIconWidth:q.instant.iconWidth,defaultIconHeight:q.instant.iconHeight,customIconWidth:"iconWidth" in this._params?this._params.iconWidth:q.instant.iconWidth,customIconHeight:"iconHeight" in this._params?this._params.iconHeight:q.instant.iconHeight,iconLabelGap:"iconLabelGap" in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin" in this._params?this._params.iconBottomMargin:2};if("compositeIcon" in this._params){k.compositeIcon=this._params.compositeIcon;k.compositeIconWidth=this._params.compositeIconWidth||k.customIconWidth;k.compositeIconHeight=this._params.compositeIconHeight||k.customIconHeight}else{k.compositeIcon=k.defaultIcon;k.compositeIconWidth=k.defaultIconWidth;k.compositeIconHeight=k.defaultIconHeight}k.defaultStackIcon="icon" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:k.defaultIcon;k.defaultStackIconWidth="iconWidth" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:k.defaultIconWidth;k.defaultStackIconHeight="iconHeight" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:k.defaultIconHeight;var b=this._band.getMinDate();var d=this._band.getMaxDate();var u=(this._filterMatcher!=null)?this._filterMatcher:function(j){return true};var f=(this._highlightMatcher!=null)?this._highlightMatcher:function(j){return -1};var h=s.getEventIterator(b,d);var l="stackConcurrentPreciseInstantEvents" in this._params&&typeof this._params.stackConcurrentPreciseInstantEvents=="object";var g="collapseConcurrentPreciseInstantEvents" in this._params&&this._params.collapseConcurrentPreciseInstantEvents;if(g||l){var p=[];var a=null;while(h.hasNext()){var e=h.next();if(u(e)){if(!e.isInstant()||e.isImprecise()){this.paintEvent(e,k,this._params.theme,f(e))}else{if(a!=null&&a.getStart().getTime()==e.getStart().getTime()){p[p.length-1].push(e)}else{p.push([e]);a=e}}}}for(var o=0;o<p.length;o++){var r=p[o];if(r.length==1){this.paintEvent(r[0],k,this._params.theme,f(e))}else{var c=-1;for(var m=0;c<0&&m<r.length;m++){c=f(r[m])}if(l){this.paintStackedPreciseInstantEvents(r,k,this._params.theme,c)}else{this.paintCompositePreciseInstantEvents(r,k,this._params.theme,c)}}}}else{while(h.hasNext()){var e=h.next();if(u(e)){this.paintEvent(e,k,this._params.theme,f(e))}}}this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block"};Timeline.CompactEventPainter.prototype.softPaint=function(){};Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var b=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var a=document.createElement("span");a.className="timeline-event-label";this._backLayer.appendChild(a);this._frc=SimileAjax.Graphics.getFontRenderingContext(a)}this._frc.update();this._tracks=[];if(this._highlightLayer!=null){b.removeLayerDiv(this._highlightLayer)}this._highlightLayer=b.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";if(this._lineLayer!=null){b.removeLayerDiv(this._lineLayer)}this._lineLayer=b.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";if(this._eventLayer!=null){b.removeLayerDiv(this._eventLayer)}this._eventLayer=b.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};Timeline.CompactEventPainter.prototype.paintEvent=function(b,c,d,a){if(b.isInstant()){this.paintInstantEvent(b,c,d,a)}else{this.paintDurationEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseInstantEvent(b,c,d,a)}else{this.paintPreciseInstantEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(b,c,d,a){if(b.isImprecise()){this.paintImpreciseDurationEvent(b,c,d,a)}else{this.paintPreciseDurationEvent(b,c,d,a)}};Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(h,f,c,b){var d={tooltip:h.getProperty("tooltip")||h.getText()};var a={url:h.getIcon()};if(a.url==null){a.url=f.defaultIcon;a.width=f.defaultIconWidth;a.height=f.defaultIconHeight;a.className="timeline-event-icon-default"}else{a.width=h.getProperty("iconWidth")||f.customIconWidth;a.height=h.getProperty("iconHeight")||f.customIconHeight}var g={text:h.getText(),color:h.getTextColor()||h.getColor(),className:h.getClassName()};var k=this.paintTapeIconLabel(h.getStart(),d,null,a,g,f,c,b);var j=this;var e=function(l,m,o){return j._onClickInstantEvent(k.iconElmtData.elmt,m,h)};SimileAjax.DOM.registerEvent(k.iconElmtData.elmt,"mousedown",e);SimileAjax.DOM.registerEvent(k.labelElmtData.elmt,"mousedown",e);this._eventIdToElmt[h.getID()]=k.iconElmtData.elmt};Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(m,h,c,b){var k=m[0];var g=[];for(var d=0;d<m.length;d++){g.push(m[d].getProperty("tooltip")||m[d].getText())}var e={tooltip:g.join("; ")};var a={url:h.compositeIcon,width:h.compositeIconWidth,height:h.compositeIconHeight,className:"timeline-event-icon-composite"};var j={text:String.substitute(this._params.compositeEventLabelTemplate,[m.length])};var o=this.paintTapeIconLabel(k.getStart(),e,null,a,j,h,c,b);var l=this;var f=function(p,q,r){return l._onClickMultiplePreciseInstantEvent(o.iconElmtData.elmt,q,m)};SimileAjax.DOM.registerEvent(o.iconElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(o.labelElmtData.elmt,"mousedown",f);for(var d=0;d<m.length;d++){this._eventIdToElmt[m[d].getID()]=o.iconElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(z,L,D,e){var u="limit" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10;var j="moreMessageTemplate" in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events";var r=u<=z.length-2;var c=this._band;var G=function(S){return Math.round(c.dateToPixelOffset(S))};var p=function(S){var T={url:S.getIcon()};if(T.url==null){T.url=L.defaultStackIcon;T.width=L.defaultStackIconWidth;T.height=L.defaultStackIconHeight;T.className="timeline-event-icon-stack timeline-event-icon-default"}else{T.width=S.getProperty("iconWidth")||L.customIconWidth;T.height=S.getProperty("iconHeight")||L.customIconHeight;T.className="timeline-event-icon-stack"}return T};var g=p(z[0]);var x=5;var f=0;var l=0;var R=0;var y=0;var N=[];for(var Q=0;Q<z.length&&(!r||Q<u);Q++){var C=z[Q];var B=C.getText();var w=p(C);var v=this._frc.computeSize(B);var I={text:B,iconData:w,labelSize:v,iconLeft:g.width+Q*x-w.width};I.labelLeft=g.width+Q*x+L.iconLabelGap;I.top=R;N.push(I);f=Math.min(f,I.iconLeft);R+=v.height;l=Math.max(l,I.labelLeft+v.width);y=Math.max(y,I.top+w.height)}if(r){var m=String.substitute(j,[z.length-u]);var M=this._frc.computeSize(m);var J=g.width+(u-1)*x+L.iconLabelGap;var P=R;R+=M.height;l=Math.max(l,J+M.width)}l+=L.labelRightMargin;R+=L.labelBottomMargin;y+=L.iconBottomMargin;var O=G(z[0].getStart());var t=[];var o=Math.ceil(Math.max(y,R)/L.trackHeight);var F=g.width+(z.length-1)*x;for(var Q=0;Q<o;Q++){t.push({start:f,end:F})}var H=Math.ceil(R/L.trackHeight);for(var Q=0;Q<H;Q++){var q=t[Q];q.end=Math.max(q.end,l)}var h=this._fitTracks(O,t);var A=h*L.trackHeight+L.trackOffset;var a=this._timeline.getDocument().createElement("div");a.className="timeline-event-icon-stack";a.style.position="absolute";a.style.overflow="visible";a.style.left=O+"px";a.style.top=A+"px";a.style.width=F+"px";a.style.height=y+"px";a.innerHTML="<div style='position: relative'></div>";this._eventLayer.appendChild(a);var k=this;var s=function(T){try{var X=parseInt(this.getAttribute("index"));var V=a.firstChild.childNodes;for(var S=0;S<V.length;S++){var W=V[S];if(S==X){W.style.zIndex=V.length}else{W.style.zIndex=V.length-S}}}catch(U){}};var E=function(X){var T=N[X];var S=z[X];var Y=S.getProperty("tooltip")||S.getText();var W=k._paintEventLabel({tooltip:Y},{text:T.text},O+T.labelLeft,A+T.top,T.labelSize.width,T.labelSize.height,D);W.elmt.setAttribute("index",X);W.elmt.onmouseover=s;var V=SimileAjax.Graphics.createTranslucentImage(T.iconData.url);var U=k._timeline.getDocument().createElement("div");U.className="timeline-event-icon"+("className" in T.iconData?(" "+T.iconData.className):"");U.style.left=T.iconLeft+"px";U.style.top=T.top+"px";U.style.zIndex=(N.length-X);U.appendChild(V);U.setAttribute("index",X);U.onmouseover=s;a.firstChild.appendChild(U);var Z=function(aa,ab,ac){return k._onClickInstantEvent(W.elmt,ab,S)};SimileAjax.DOM.registerEvent(U,"mousedown",Z);SimileAjax.DOM.registerEvent(W.elmt,"mousedown",Z);k._eventIdToElmt[S.getID()]=U};for(var Q=0;Q<N.length;Q++){E(Q)}if(r){var d=z.slice(u);var b=this._paintEventLabel({tooltip:m},{text:m},O+J,A+P,M.width,M.height,D);var K=function(S,T,U){return k._onClickMultiplePreciseInstantEvent(b.elmt,T,d)};SimileAjax.DOM.registerEvent(b.elmt,"mousedown",K);for(var Q=0;Q<d.length;Q++){this._eventIdToElmt[d[Q].getID()]=b.elmt}}};Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),latestStart:j.getLatestStart(),earliestEnd:j.getEarliestEnd(),isInstant:true};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.impreciseTapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),isInstant:false};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getLatestStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.tapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(j,g,d,c){var e={tooltip:j.getProperty("tooltip")||j.getText()};var a={start:j.getStart(),end:j.getEnd(),latestStart:j.getLatestStart(),earliestEnd:j.getEarliestEnd(),isInstant:false};var b={url:j.getIcon()};if(b.url==null){b=null}else{b.width=j.getProperty("iconWidth")||g.customIconWidth;b.height=j.getProperty("iconHeight")||g.customIconHeight}var h={text:j.getText(),color:j.getTextColor()||j.getColor(),className:j.getClassName()};var l=this.paintTapeIconLabel(j.getLatestStart(),e,a,b,h,g,d,c);var k=this;var f=b!=null?function(m,o,p){return k._onClickInstantEvent(l.iconElmtData.elmt,o,j)}:function(m,o,p){return k._onClickInstantEvent(l.labelElmtData.elmt,o,j)};SimileAjax.DOM.registerEvent(l.labelElmtData.elmt,"mousedown",f);SimileAjax.DOM.registerEvent(l.tapeElmtData.elmt,"mousedown",f);if(b!=null){SimileAjax.DOM.registerEvent(l.iconElmtData.elmt,"mousedown",f);this._eventIdToElmt[j.getID()]=l.iconElmtData.elmt}else{this._eventIdToElmt[j.getID()]=l.labelElmtData.elmt}};Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(D,o,G,e,A,y,F,B){var u=this._band;var l=function(t){return Math.round(u.dateToPixelOffset(t))};var v=l(D);var E=[];var C=0;var q=0;var p=0;if(G!=null){C=y.tapeHeight+y.tapeBottomMargin;q=Math.ceil(y.tapeHeight/y.trackHeight);var a=l(G.end)-v;var d=l(G.start)-v;for(var s=0;s<q;s++){E.push({start:d,end:a})}p=y.trackHeight-(C%y.tapeHeight)}var b=0;var x=0;if(e!=null){if("iconAlign" in e&&e.iconAlign=="center"){b=-Math.floor(e.width/2)}x=b+e.width+y.iconLabelGap;if(q>0){E[q-1].end=Math.max(E[q-1].end,x)}var k=e.height+y.iconBottomMargin+p;while(k>0){E.push({start:b,end:x});k-=y.trackHeight}}var r=A.text;var g=this._frc.computeSize(r);var c=g.height+y.labelBottomMargin+p;var f=x+g.width+y.labelRightMargin;if(q>0){E[q-1].end=Math.max(E[q-1].end,f)}for(var z=0;c>0;z++){if(q+z<E.length){var w=E[q+z];w.end=f}else{E.push({start:0,end:f})}c-=y.trackHeight}var j=this._fitTracks(v,E);var h=j*y.trackHeight+y.trackOffset;var m={};m.labelElmtData=this._paintEventLabel(o,A,v+x,h+C,g.width,g.height,F);if(G!=null){if("latestStart" in G||"earliestEnd" in G){m.impreciseTapeElmtData=this._paintEventTape(o,G,y.tapeHeight,h,l(G.start),l(G.end),F.event.duration.impreciseColor,F.event.duration.impreciseOpacity,y,F)}if(!G.isInstant&&"start" in G&&"end" in G){m.tapeElmtData=this._paintEventTape(o,G,y.tapeHeight,h,v,l("earliestEnd" in G?G.earliestEnd:G.end),G.color,100,y,F)}}if(e!=null){m.iconElmtData=this._paintEventIcon(o,e,h+C,v+b,y,F)}return m};Timeline.CompactEventPainter.prototype._fitTracks=function(a,f){var h;for(h=0;h<this._tracks.length;h++){var e=true;for(var c=0;c<f.length&&(h+c)<this._tracks.length;c++){var g=this._tracks[h+c];var b=f[c];if(a+b.start<g){e=false;break}}if(e){break}}for(var d=0;d<f.length;d++){this._tracks[h+d]=a+f[d].end}return h};Timeline.CompactEventPainter.prototype._paintEventIcon=function(c,d,h,g,e,f){var b=SimileAjax.Graphics.createTranslucentImage(d.url);var a=this._timeline.getDocument().createElement("div");a.className="timeline-event-icon"+("className" in d?(" "+d.className):"");a.style.left=g+"px";a.style.top=h+"px";a.appendChild(b);if("tooltip" in c&&typeof c.tooltip=="string"){a.title=c.tooltip}this._eventLayer.appendChild(a);return{left:g,top:h,width:e.iconWidth,height:e.iconHeight,elmt:a}};Timeline.CompactEventPainter.prototype._paintEventLabel=function(d,g,b,f,a,j,c){var h=this._timeline.getDocument();var e=h.createElement("div");e.className="timeline-event-label";e.style.left=b+"px";e.style.width=(a+1)+"px";e.style.top=f+"px";e.innerHTML=g.text;if("tooltip" in d&&typeof d.tooltip=="string"){e.title=d.tooltip}if("color" in g&&typeof g.color=="string"){e.style.color=g.color}if("className" in g&&typeof g.className=="string"){e.className+=" "+g.className}this._eventLayer.appendChild(e);return{left:b,top:f,width:a,height:j,elmt:e}};Timeline.CompactEventPainter.prototype._paintEventTape=function(g,b,m,k,f,a,d,h,j,e){var c=a-f;var l=this._timeline.getDocument().createElement("div");l.className="timeline-event-tape";l.style.left=f+"px";l.style.top=k+"px";l.style.width=c+"px";l.style.height=m+"px";if("tooltip" in g&&typeof g.tooltip=="string"){l.title=g.tooltip}if(d!=null&&typeof b.color=="string"){l.style.backgroundColor=d}if("backgroundImage" in b&&typeof b.backgroundImage=="string"){l.style.backgroundImage="url("+backgroundImage+")";l.style.backgroundRepeat=("backgroundRepeat" in b&&typeof b.backgroundRepeat=="string")?b.backgroundRepeat:"repeat"}SimileAjax.Graphics.setOpacity(l,h);if("className" in b&&typeof b.className=="string"){l.className+=" "+b.className}this._eventLayer.appendChild(l);return{left:f,top:k,width:c,height:m,elmt:l}};Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,c,e){if(a>=0){var d=this._timeline.getDocument();var g=e.event;var b=g.highlightColors[Math.min(a,g.highlightColors.length-1)];var f=d.createElement("div");f.style.position="absolute";f.style.overflow="hidden";f.style.left=(c.left-2)+"px";f.style.width=(c.width+4)+"px";f.style.top=(c.top-2)+"px";f.style.height=(c.height+4)+"px";this._highlightLayer.appendChild(f)}};Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(e,f,b){var g=SimileAjax.DOM.getPageCoordinates(e);this._showBubble(g.left+Math.ceil(e.offsetWidth/2),g.top+Math.ceil(e.offsetHeight/2),b);var d=[];for(var a=0;a<b.length;a++){d.push(b[a].getID())}this._fireOnSelect(d);f.cancelBubble=true;SimileAjax.DOM.cancelEvent(f);return false};Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(b,d,a){var e=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(e.left+Math.ceil(b.offsetWidth/2),e.top+Math.ceil(b.offsetHeight/2),[a]);this._fireOnSelect([a.getID()]);d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(e,d,b){if("pageX" in d){var a=d.pageX;var g=d.pageY}else{var f=SimileAjax.DOM.getPageCoordinates(e);var a=d.offsetX+f.left;var g=d.offsetY+f.top}this._showBubble(a,g,[b]);this._fireOnSelect([b.getID()]);d.cancelBubble=true;SimileAjax.DOM.cancelEvent(d);return false};Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var d=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(d.left+b.offsetWidth/2,d.top+b.offsetHeight/2,[a])}};Timeline.CompactEventPainter.prototype._showBubble=function(a,f,b){var e=document.createElement("div");b=("fillInfoBubble" in b)?[b]:b;for(var d=0;d<b.length;d++){var c=document.createElement("div");e.appendChild(c);b[d].fillInfoBubble(c,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(e,a,f,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(b){for(var a=0;a<this._onSelectListeners.length;a++){this._onSelectListeners[a](b)}};Timeline.SpanHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._startDate=(typeof a.startDate=="string")?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate=(typeof a.endDate=="string")?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=a.startLabel!=null?a.startLabel:"";this._endLabel=a.endLabel!=null?a.endLabel:"";this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:null;this._opacity=a.opacity!=null?a.opacity:100;this._zIndex=(a.inFront!=null&&a.inFront)?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._layerDiv=null};Timeline.SpanHighlightDecorator.prototype.paint=function(){if(this._layerDiv!=null){this._band.removeLayerDiv(this._layerDiv)}this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var f=this._band.getMinDate();var c=this._band.getMaxDate();if(this._unit.compare(this._startDate,c)<0&&this._unit.compare(this._endDate,f)>0){f=this._unit.later(f,this._startDate);c=this._unit.earlier(c,this._endDate);var d=this._band.dateToPixelOffset(f);var l=this._band.dateToPixelOffset(c);var j=this._timeline.getDocument();var h=function(){var m=j.createElement("table");m.insertRow(0).insertCell(0);return m};var b=j.createElement("div");b.className="timeline-highlight-decorator";if(this._cssClass){b.className+=" "+this._cssClass}if(this._color!=null){b.style.backgroundColor=this._color}if(this._opacity<100){SimileAjax.Graphics.setOpacity(b,this._opacity)}this._layerDiv.appendChild(b);var k=h();k.className="timeline-highlight-label timeline-highlight-label-start";var g=k.rows[0].cells[0];g.innerHTML=this._startLabel;if(this._cssClass){g.className="label_"+this._cssClass}this._layerDiv.appendChild(k);var a=h();a.className="timeline-highlight-label timeline-highlight-label-end";var e=a.rows[0].cells[0];e.innerHTML=this._endLabel;if(this._cssClass){e.className="label_"+this._cssClass}this._layerDiv.appendChild(a);if(this._timeline.isHorizontal()){b.style.left=d+"px";b.style.width=(l-d)+"px";k.style.right=(this._band.getTotalViewLength()-d)+"px";k.style.width=(this._startLabel.length)+"em";a.style.left=l+"px";a.style.width=(this._endLabel.length)+"em"}else{b.style.top=d+"px";b.style.height=(l-d)+"px";k.style.bottom=d+"px";k.style.height="1.5px";a.style.top=l+"px";a.style.height="1.5px"}}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};Timeline.PointHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._date=(typeof a.date=="string")?this._unit.parseFromObject(a.date):a.date;this._width=a.width!=null?a.width:10;this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:"";this._opacity=a.opacity!=null?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(b,a){this._band=b;this._timeline=a;this._layerDiv=null};Timeline.PointHighlightDecorator.prototype.paint=function(){if(this._layerDiv!=null){this._band.removeLayerDiv(this._layerDiv)}this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var c=this._band.getMinDate();var e=this._band.getMaxDate();if(this._unit.compare(this._date,e)<0&&this._unit.compare(this._date,c)>0){var b=this._band.dateToPixelOffset(this._date);var a=b-Math.round(this._width/2);var d=this._timeline.getDocument();var f=d.createElement("div");f.className="timeline-highlight-point-decorator";f.className+=" "+this._cssClass;if(this._color!=null){f.style.backgroundColor=this._color}if(this._opacity<100){SimileAjax.Graphics.setOpacity(f,this._opacity)}this._layerDiv.appendChild(f);if(this._timeline.isHorizontal()){f.style.left=a+"px";f.style.width=this._width}else{f.style.top=a+"px";f.style.height=this._width}}this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};Timeline.NativeDateUnit=new Object();Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)};Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date()};Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};Timeline.NativeDateUnit.getParser=function(a){if(typeof a=="string"){a=a.toLowerCase()}return(a=="iso8601"||a=="iso 8601")?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime};Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)};Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()};Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)};Timeline.NativeDateUnit.compare=function(d,c){var b,a;if(typeof d=="object"){b=d.getTime()}else{b=Number(d)}if(typeof c=="object"){a=c.getTime()}else{a=Number(c)}return b-a};Timeline.NativeDateUnit.earlier=function(b,a){return Timeline.NativeDateUnit.compare(b,a)<0?b:a};Timeline.NativeDateUnit.later=function(b,a){return Timeline.NativeDateUnit.compare(b,a)>0?b:a};Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};Timeline.strings.en={wikiLinkLabel:"Discuss"};Timeline.GregorianDateLabeller.monthNames.en=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Timeline.GregorianDateLabeller.dayNames.en=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(typeof window.Timeplot=="undefined"){window.Timeplot={params:{bundle:true,autoCreate:true},namespace:"http://simile.mit.edu/2007/06/timeplot#",importers:{}};Timeplot.urlPrefix=STIMinifier_urlPrefix+"lib/simile/timeplot/"}(function(){var local=false;if(document.location.search.length>0){var params=document.location.search.substr(1).split("&");for(var i=0;i<params.length;i++){if(params[i]=="local"){local=true}}}if(!local){var heads=document.documentElement.getElementsByTagName("head");for(var h=0;h<heads.length;h++){var node=heads[h].firstChild;while(node!=null){if(node.nodeType==1&&node.tagName.toLowerCase()=="script"){var url=node.src;if(url.indexOf("timeplot-api")>=0){local=(url.indexOf("local")>=0)}}node=node.nextSibling}}}var loadTimeplot=function(){if(typeof window.Timeplot!="undefined"){return}window.Timeplot={loaded:false,params:{bundle:true,autoCreate:true},namespace:"http://simile.mit.edu/2007/06/timeplot#",importers:{}};var javascriptFiles=["timeplot.js","plot.js","sources.js","geometry.js","color.js","math.js","processor.js"];var cssFiles=["timeplot.css"];var locales=["en"];var defaultClientLocales=("language" in navigator?navigator.language:navigator.browserLanguage).split(";");for(var l=0;l<defaultClientLocales.length;l++){var locale=defaultClientLocales[l];if(locale!="en"){var segments=locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(locale)}}var paramTypes={bundle:Boolean,js:Array,css:Array,autoCreate:Boolean};if(typeof Timeplot_urlPrefix=="string"){Timeplot.urlPrefix=Timeplot_urlPrefix;if("Timeplot_parameters" in window){SimileAjax.parseURLParameters(Timeplot_parameters,Timeplot.params,paramTypes)}}else{var url=SimileAjax.findScript(document,"/timeplot-api.js");if(url==null){Timeplot.error=new Error("Failed to derive URL prefix for Simile Timeplot API code files");return}Timeplot.urlPrefix=url.substr(0,url.indexOf("timeplot-api.js"));SimileAjax.parseURLParameters(url,Timeplot.params,paramTypes)}if(Timeplot.params.locale){if(Timeplot.params.locale!="en"){var segments=Timeplot.params.locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(Timeplot.params.locale)}}var timeplotURLPrefix=Timeplot.urlPrefix;if(local&&!("console" in window)){var firebug=[timeplotURLPrefix+"lib/firebug/firebug.js"];SimileAjax.includeJavascriptFiles(document,"",firebug)}var canvas=document.createElement("canvas");if(!canvas.getContext){var excanvas=[timeplotURLPrefix+"lib/excanvas.js"];SimileAjax.includeJavascriptFiles(document,"",excanvas)}var scriptURLs=Timeplot.params.js||[];var cssURLs=Timeplot.params.css||[];if(Timeplot.params.bundle&&!local){scriptURLs.push(timeplotURLPrefix+"timeplot-bundle.js");cssURLs.push(timeplotURLPrefix+"timeplot-bundle.css")}else{SimileAjax.prefixURLs(scriptURLs,timeplotURLPrefix+"scripts/",javascriptFiles);SimileAjax.prefixURLs(cssURLs,timeplotURLPrefix+"styles/",cssFiles)}window.SimileAjax_onLoad=function(){if(local&&window.console.open){window.console.open()}if(Timeplot.params.callback){eval(Timeplot.params.callback+"()")}};SimileAjax.includeJavascriptFiles(document,"",scriptURLs);SimileAjax.includeCssFiles(document,"",cssURLs);Timeplot.loaded=true};var loadTimeline=function(){if(typeof Timeline!="undefined"){loadTimeplot()}else{var timelineURL="http://api.simile-widgets.org/timeline/2.3.1/timeline-api.js?bundle=true";window.SimileAjax_onLoad=loadTimeplot;SimileAjax.includeJavascriptFile(document,timelineURL)}};if(typeof SimileAjax=="undefined"){window.SimileAjax_onLoad=loadTimeline;var url="http://api.simile-widgets.org/ajax/2.2.1/simile-ajax-api.js?bundle=true";var createScriptElement=function(){var script=document.createElement("script");script.type="text/javascript";script.language="JavaScript";script.src=url;document.getElementsByTagName("head")[0].appendChild(script)};if(document.body==null){try{document.write("<script src='"+url+"' type='text/javascript'><\/script>")}catch(e){createScriptElement()}}else{createScriptElement()}}else{loadTimeline()}})();Timeline.Debug=SimileAjax.Debug;var log=SimileAjax.Debug.log;Object.extend=function(a,c){for(var b in c){a[b]=c[b]}return a};Timeplot.create=function(a,b){return new Timeplot._Impl(a,b)};Timeplot.createPlotInfo=function(a){return{id:("id" in a)?a.id:"p"+Math.round(Math.random()*1000000),dataSource:("dataSource" in a)?a.dataSource:null,eventSource:("eventSource" in a)?a.eventSource:null,timeGeometry:("timeGeometry" in a)?a.timeGeometry:new Timeplot.DefaultTimeGeometry(),valueGeometry:("valueGeometry" in a)?a.valueGeometry:new Timeplot.DefaultValueGeometry(),timeZone:("timeZone" in a)?a.timeZone:0,fillColor:("fillColor" in a)?((a.fillColor=="string")?new Timeplot.Color(a.fillColor):a.fillColor):null,fillGradient:("fillGradient" in a)?a.fillGradient:true,fillFrom:("fillFrom" in a)?a.fillFrom:Number.NEGATIVE_INFINITY,lineColor:("lineColor" in a)?((a.lineColor=="string")?new Timeplot.Color(a.lineColor):a.lineColor):new Timeplot.Color("#606060"),lineWidth:("lineWidth" in a)?a.lineWidth:1,dotRadius:("dotRadius" in a)?a.dotRadius:2,dotColor:("dotColor" in a)?a.dotColor:null,eventLineWidth:("eventLineWidth" in a)?a.eventLineWidth:1,showValues:("showValues" in a)?a.showValues:false,roundValues:("roundValues" in a)?a.roundValues:true,valuesOpacity:("valuesOpacity" in a)?a.valuesOpacity:75,bubbleWidth:("bubbleWidth" in a)?a.bubbleWidth:300,bubbleHeight:("bubbleHeight" in a)?a.bubbleHeight:200}};Timeplot._Impl=function(a,b){this._id="t"+Math.round(Math.random()*1000000);this._containerDiv=a;this._plotInfos=b;this._painters={background:[],foreground:[]};this._painter=null;this._active=false;this._upright=false;this._initialize()};Timeplot._Impl.prototype={dispose:function(){for(var a=0;a<this._plots.length;a++){this._plots[a].dispose()}this._plots=null;this._plotsInfos=null;this._containerDiv.innerHTML=""},getElement:function(){return this._containerDiv},getDocument:function(){return this._containerDiv.ownerDocument},add:function(a){this._containerDiv.appendChild(a)},remove:function(a){this._containerDiv.removeChild(a)},addPainter:function(b,a){var d=this._painters[b];if(d){for(var c=0;c<d.length;c++){if(d[c].context._id==a.context._id){return}}d.push(a)}},removePainter:function(b,a){var d=this._painters[b];if(d){for(var c=0;c<d.length;c++){if(d[c].context._id==a.context._id){d.splice(c,1);break}}}},getWidth:function(){return this._containerDiv.clientWidth},getHeight:function(){return this._containerDiv.clientHeight},getCanvas:function(){return this._canvas},loadText:function(a,g,d,c,f){if(this._active){var h=this;var e=function(l,j,k){alert("Failed to load data xml from "+a+"\n"+l);h.hideLoadingMessage()};var b=function(j){try{d.loadText(j.responseText,g,a,c,f)}catch(k){SimileAjax.Debug.exception(k)}finally{h.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,e,b)},0)}},loadXML:function(b,d){if(this._active){var a=this;var e=function(h,f,g){alert("Failed to load data xml from "+b+"\n"+h);a.hideLoadingMessage()};var c=function(g){try{var f=g.responseXML;if(!f.documentElement&&g.responseStream){f.load(g.responseStream)}d.loadXML(f,b)}finally{a.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(b,e,c)},0)}},putText:function(e,c,a,b){var d=this.putDiv(e,"timeplot-div "+a,b);d.innerHTML=c;return d},putDiv:function(f,b,c){var d=this._id+"-"+f;var e=document.getElementById(d);if(!e){var a=this._containerDiv.firstChild;e=document.createElement("div");e.setAttribute("id",d);a.appendChild(e)}e.setAttribute("class","timeplot-div "+b);e.setAttribute("className","timeplot-div "+b);this.placeDiv(e,c);return e},placeDiv:function(b,a){if(a){for(style in a){if(style=="left"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="right"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="top"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="bottom"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="width"){if(a[style]<0){a[style]=0}a[style]+="px"}else{if(style=="height"){if(a[style]<0){a[style]=0}a[style]+="px"}}}}}}b.style[style]=a[style]}}},locate:function(a){return{x:a.offsetLeft-this._paddingX,y:a.offsetTop-this._paddingY}},update:function(){if(this._active){for(var b=0;b<this._plots.length;b++){var c=this._plots[b];var d=c.getDataSource();if(d){var a=d.getRange();if(a){c._valueGeometry.setRange(a);c._timeGeometry.setRange(a)}}c.hideValues()}this.paint()}},repaint:function(){if(this._active){this._prepareCanvas();for(var a=0;a<this._plots.length;a++){var b=this._plots[a];if(b._timeGeometry){b._timeGeometry.reset()}if(b._valueGeometry){b._valueGeometry.reset()}}this.paint()}},paint:function(){if(this._active&&this._painter==null){var a=this;this._painter=window.setTimeout(function(){a._clearCanvas();var e=function(g,f){try{if(f.setTimeplot){f.setTimeplot(a)}g.apply(f,[])}catch(h){SimileAjax.Debug.exception(h)}};var c=a._painters.background;for(var b=0;b<c.length;b++){e(c[b].action,c[b].context)}var d=a._painters.foreground;for(var b=0;b<d.length;b++){e(d[b].action,d[b].context)}a._painter=null},20)}},_clearCanvas:function(){var b=this.getCanvas();var a=b.getContext("2d");a.clearRect(0,0,b.width,b.height)},_clearLabels:function(){var a=this._containerDiv.firstChild;if(a){this._containerDiv.removeChild(a)}a=document.createElement("div");this._containerDiv.appendChild(a)},_prepareCanvas:function(){var c=this.getCanvas();var b=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(b.css("paddingLeft"))+parseInt(b.css("paddingRight")))/2;this._paddingY=(parseInt(b.css("paddingTop"))+parseInt(b.css("paddingBottom")))/2;c.width=this.getWidth()-(this._paddingX*2);c.height=this.getHeight()-(this._paddingY*2);var a=c.getContext("2d");this._setUpright(a,c);a.globalCompositeOperation="source-over"},_setUpright:function(a,b){if(!SimileAjax.Platform.browser.isIE){this._upright=false}if(!this._upright){this._upright=true;a.translate(0,b.height);a.scale(1,-1)}},_isBrowserSupported:function(b){var a=SimileAjax.Platform.browser;if((b.getContext&&window.getComputedStyle)||(a.isIE&&a.majorVersion>=6)){return true}else{return false}},_initialize:function(){SimileAjax.WindowManager.initialize();var g=this._containerDiv;var j=g.ownerDocument;g.className="timeplot-container "+g.className;while(g.firstChild){g.removeChild(g.firstChild)}var b=j.createElement("canvas");if(this._isBrowserSupported(b)){this._clearLabels();this._canvas=b;b.className="timeplot-canvas";g.appendChild(b);if(!b.getContext&&G_vmlCanvasManager){b=G_vmlCanvasManager.initElement(this._canvas);this._canvas=b}this._prepareCanvas();var c=SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/copyright.png");c.className="timeplot-copyright";c.title="Timeplot (c) SIMILE - http://simile.mit.edu/timeplot/";SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://simile.mit.edu/timeplot/"});g.appendChild(c);var e=this;var h={onAddMany:function(){e.update()},onClear:function(){e.update()}};this._plots=[];if(this._plotInfos){for(var d=0;d<this._plotInfos.length;d++){var f=new Timeplot.Plot(this,this._plotInfos[d]);var a=f.getDataSource();if(a){a.addListener(h)}this.addPainter("background",{context:f.getTimeGeometry(),action:f.getTimeGeometry().paint});this.addPainter("background",{context:f.getValueGeometry(),action:f.getValueGeometry().paint});this.addPainter("foreground",{context:f,action:f.paint});this._plots.push(f);f.initialize()}}var k=SimileAjax.Graphics.createMessageBubble(j);k.containerDiv.className="timeplot-message-container";g.appendChild(k.containerDiv);k.contentDiv.className="timeplot-message";k.contentDiv.innerHTML="<img src='"+Timeplot.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){k.containerDiv.style.display="block"};this.hideLoadingMessage=function(){k.containerDiv.style.display="none"};this._active=true}else{this._message=SimileAjax.Graphics.createMessageBubble(j);this._message.containerDiv.className="timeplot-message-container";this._message.containerDiv.style.top="15%";this._message.containerDiv.style.left="20%";this._message.containerDiv.style.right="20%";this._message.containerDiv.style.minWidth="20em";this._message.contentDiv.className="timeplot-message";this._message.contentDiv.innerHTML="We're terribly sorry, but your browser is not currently supported by <a href='http://simile.mit.edu/timeplot/'>Timeplot</a>.<br><br> We are working on supporting it in the near future but, for now, see the <a href='http://simile.mit.edu/wiki/Timeplot_Limitations'>list of currently supported browsers</a>.";this._message.containerDiv.style.display="block";g.appendChild(this._message.containerDiv)}}};Timeplot.Plot=function(a,b){this._timeplot=a;this._canvas=a.getCanvas();this._plotInfo=b;this._id=b.id;this._timeGeometry=b.timeGeometry;this._valueGeometry=b.valueGeometry;this._theme=new Timeline.getDefaultTheme();this._dataSource=b.dataSource;this._eventSource=b.eventSource;this._bubble=null};Timeplot.Plot.prototype={initialize:function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");if(!this._valueFlagLineLeft.firstChild){this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_left.png"));this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png"))}this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var d=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,d);SimileAjax.Graphics.setOpacity(this._valueFlag,d);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,d);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,d);SimileAjax.Graphics.setOpacity(this._valueFlagPole,d);var f=this;var g=function(j,h,k){if(f._plotInfo.showValues){f._valueFlag.style.display="block";a(j,h,k)}};var b=24*60*60*1000;var e=30*b;var a=function(k,D,s){if(typeof SimileAjax!="undefined"&&f._plotInfo.showValues){var w=f._canvas;var B=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(D,f._canvas).x);if(B>w.width){B=w.width}if(isNaN(B)||B<0){B=0}var E=f._timeGeometry.fromScreen(B);if(E==0){f._valueFlag.style.display="none";return}var m=f._dataSource.getClosestValidTime(E);B=f._timeGeometry.toScreen(m);var C=f._dataSource.getValue(m);if(f._plotInfo.roundValues){C=Math.round(C)}f._valueFlag.innerHTML=new String(C);var u=new Date(m);var j=f._timeGeometry.getPeriod();if(j<b){f._timeFlag.innerHTML=u.toLocaleTimeString()}else{if(j>e){f._timeFlag.innerHTML=u.toLocaleDateString()}else{f._timeFlag.innerHTML=u.toLocaleString()}}var r=f._timeFlag.clientWidth;var h=f._timeFlag.clientHeight;var l=Math.round(r/2);var A=f._valueFlag.clientWidth;var q=f._valueFlag.clientHeight;var z=f._valueGeometry.toScreen(C);if(B+l>w.width){var o=w.width-l}else{if(B-l<0){var o=l}else{var o=B}}if(f._timeGeometry._timeValuePosition=="top"){f._timeplot.placeDiv(f._valueFlagPole,{left:B,top:h-5,height:w.height-z-h+6,display:"block"});f._timeplot.placeDiv(f._timeFlag,{left:o-l,top:-6,display:"block"})}else{f._timeplot.placeDiv(f._valueFlagPole,{left:B,bottom:h-5,height:z-h+6,display:"block"});f._timeplot.placeDiv(f._timeFlag,{left:o-l,bottom:-6,display:"block"})}if(B+A+14>w.width&&z+q+4>w.height){f._valueFlagLineLeft.style.display="none";f._timeplot.placeDiv(f._valueFlagLineRight,{left:B-14,bottom:z-14,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B-A-13,bottom:z-q-13,display:"block"})}else{if(B+A+14>w.width&&z+q+4<w.height){f._valueFlagLineRight.style.display="none";f._timeplot.placeDiv(f._valueFlagLineLeft,{left:B-14,bottom:z,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B-A-13,bottom:z+13,display:"block"})}else{if(B+A+14<w.width&&z+q+4>w.height){f._valueFlagLineRight.style.display="none";f._timeplot.placeDiv(f._valueFlagLineLeft,{left:B,bottom:z-13,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B+13,bottom:z-13,display:"block"})}else{f._valueFlagLineLeft.style.display="none";f._timeplot.placeDiv(f._valueFlagLineRight,{left:B,bottom:z,display:"block"});f._timeplot.placeDiv(f._valueFlag,{left:B+13,bottom:z+13,display:"block"})}}}}};var c=this._timeplot.getElement();SimileAjax.DOM.registerEvent(c,"mouseover",g);SimileAjax.DOM.registerEvent(c,"mousemove",a)}},dispose:function(){if(this._dataSource){this._dataSource.removeListener(this._paintingListener);this._paintingListener=null;this._dataSource.dispose();this._dataSource=null}},hideValues:function(){if(this._valueFlag){this._valueFlag.style.display="none"}if(this._timeFlag){this._timeFlag.style.display="none"}if(this._valueFlagLineLeft){this._valueFlagLineLeft.style.display="none"}if(this._valueFlagLineRight){this._valueFlagLineRight.style.display="none"}if(this._valueFlagPole){this._valueFlagPole.style.display="none"}},getDataSource:function(){return(this._dataSource)?this._dataSource:this._eventSource},getTimeGeometry:function(){return this._timeGeometry},getValueGeometry:function(){return this._valueGeometry},paint:function(){var p=this._canvas.getContext("2d");p.lineWidth=this._plotInfo.lineWidth;p.lineJoin="miter";if(this._dataSource){if(this._plotInfo.fillColor){if(this._plotInfo.fillGradient){var a=p.createLinearGradient(0,this._canvas.height,0,0);a.addColorStop(0,this._plotInfo.fillColor.toString());a.addColorStop(0.5,this._plotInfo.fillColor.toString());a.addColorStop(1,"rgba(255,255,255,0)");p.fillStyle=a}else{p.fillStyle=this._plotInfo.fillColor.toString()}p.beginPath();p.moveTo(0,0);this._plot(function(c,r){p.lineTo(c,r)});if(this._plotInfo.fillFrom==Number.NEGATIVE_INFINITY){p.lineTo(this._canvas.width,0)}else{if(this._plotInfo.fillFrom==Number.POSITIVE_INFINITY){p.lineTo(this._canvas.width,this._canvas.height);p.lineTo(0,this._canvas.height)}else{p.lineTo(this._canvas.width,this._valueGeometry.toScreen(this._plotInfo.fillFrom));p.lineTo(0,this._valueGeometry.toScreen(this._plotInfo.fillFrom))}}p.fill()}if(this._plotInfo.lineColor){p.strokeStyle=this._plotInfo.lineColor.toString();p.beginPath();var g=true;this._plot(function(c,r){if(g){g=false;p.moveTo(c,r)}p.lineTo(c,r)});p.stroke()}if(this._plotInfo.dotColor){p.fillStyle=this._plotInfo.dotColor.toString();var m=this._plotInfo.dotRadius;this._plot(function(c,r){p.beginPath();p.arc(c,r,m,0,2*Math.PI,true);p.fill()})}}if(this._eventSource){var a=p.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(1,"rgba(255,255,255,0)");p.strokeStyle=a;p.fillStyle=a;p.lineWidth=this._plotInfo.eventLineWidth;p.lineJoin="miter";var u=this._eventSource.getAllEventIterator();while(u.hasNext()){var t=u.next();var q=t.getColor();q=(q)?new Timeplot.Color(q):this._plotInfo.lineColor;var b=t.getStart().getTime();var v=t.getEnd().getTime();if(b==v){var y=q.toString();a.addColorStop(0,y);var f=this._timeGeometry.toScreen(b);f=Math.floor(f)+0.5;var d=f;p.beginPath();p.moveTo(f,0);p.lineTo(f,this._canvas.height);p.stroke();var h=f-4;var k=7}else{var y=q.toString(0.5);a.addColorStop(0,y);var f=this._timeGeometry.toScreen(b);f=Math.floor(f)+0.5;var d=this._timeGeometry.toScreen(v);d=Math.floor(d)+0.5;p.fillRect(f,0,d-f,this._canvas.height);var h=f;var k=d-f-1}var l=this._timeplot.putDiv(t.getID(),"timeplot-event-box",{left:Math.round(h),width:Math.round(k),top:0,height:this._canvas.height-1});var s=this;var j=function(c){return function(x,r,B){var A=s._timeplot.getDocument();s._closeBubble();var z=SimileAjax.DOM.getEventPageCoordinates(r);var w=SimileAjax.DOM.getPageCoordinates(x);s._bubble=SimileAjax.Graphics.createBubbleForPoint(z.x,w.top+s._canvas.height,s._plotInfo.bubbleWidth,s._plotInfo.bubbleHeight,"bottom");c.fillInfoBubble(s._bubble.content,s._theme,s._timeGeometry.getLabeler())}};var e=function(r,c,w){r.oldClass=r.className;r.className=r.className+" timeplot-event-box-highlight"};var o=function(r,c,w){r.className=r.oldClass;r.oldClass=null};if(!l.instrumented){SimileAjax.DOM.registerEvent(l,"click",j(t));SimileAjax.DOM.registerEvent(l,"mouseover",e);SimileAjax.DOM.registerEvent(l,"mouseout",o);l.instrumented=true}}}},_plot:function(g){var e=this._dataSource.getData();if(e){var h=e.times;var b=e.values;var c=h.length;for(var d=0;d<c;d++){var a=this._timeGeometry.toScreen(h[d]);var j=this._valueGeometry.toScreen(b[d]);g(a,j)}}},_closeBubble:function(){if(this._bubble!=null){this._bubble.close();this._bubble=null}}};Timeplot.DefaultEventSource=function(a){Timeline.DefaultEventSource.apply(this,arguments)};Object.extend(Timeplot.DefaultEventSource.prototype,Timeline.DefaultEventSource.prototype);Timeplot.DefaultEventSource.prototype.loadText=function(o,j,a,c,l){if(o==null){return}this._events.maxValues=new Array();var b=this._getBaseURL(a);if(!l){l="iso8601"}var h=this._events.getUnit().getParser(l);var g=this._parseText(o,j);var k=false;if(c){g=c(g)}if(g){for(var f=0;f<g.length;f++){var p=g[f];if(p.length>1){var e=SimileAjax.jQuery.trim(p[0]);var d=h(e);if(d){var m=new Timeplot.DefaultEventSource.NumericEvent(d,p.slice(1));this._events.add(m);k=true}}}}if(k){this._fire("onAddMany",[])}};Timeplot.DefaultEventSource.prototype._parseText=function(h,c){h=h.replace(/\r\n?/g,"\n");var f=0;var e=h.length;var j=[];while(f<e){var k=[];if(h.charAt(f)!="#"){while(f<e){if(h.charAt(f)=='"'){var a=h.indexOf('"',f+1);while(a<e&&a>-1){if(h.charAt(a+1)!='"'){break}a=h.indexOf('"',a+2)}if(a<0){}else{if(h.charAt(a+1)==c){var b=h.substr(f+1,a-f-1);b=b.replace(/""/g,'"');k[k.length]=b;f=a+2;continue}else{if(h.charAt(a+1)=="\n"||e==a+1){var b=h.substr(f+1,a-f-1);b=b.replace(/""/g,'"');k[k.length]=b;f=a+2;break}else{}}}}var g=h.indexOf(c,f);var d=h.indexOf("\n",f);if(d<0){d=e}if(g>-1&&g<d){k[k.length]=h.substr(f,g-f);f=g+1}else{k[k.length]=h.substr(f,d-f);f=d+1;break}}}else{var d=h.indexOf("\n",f);f=(d>-1)?d+1:cur}if(k.length>0){j[j.length]=k}}if(j.length<0){return}return j};Timeplot.DefaultEventSource.prototype.getRange=function(){var a=this.getEarliestDate();var b=this.getLatestDate();return{earliestDate:(a)?a:null,latestDate:(b)?b:null,min:0,max:0}};Timeplot.DefaultEventSource.NumericEvent=function(b,a){this._id="e"+Math.round(Math.random()*1000000);this._time=b;this._values=a};Timeplot.DefaultEventSource.NumericEvent.prototype={getID:function(){return this._id},getTime:function(){return this._time},getValues:function(){return this._values},getStart:function(){return this._time},getEnd:function(){return this._time}};Timeplot.DataSource=function(b){this._eventSource=b;var a=this;this._processingListener={onAddMany:function(){a._process()},onClear:function(){a._clear()}};this.addListener(this._processingListener);this._listeners=[];this._data=null;this._range=null};Timeplot.DataSource.prototype={_clear:function(){this._data=null;this._range=null},_process:function(){this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0}},getRange:function(){return this._range},getData:function(){return this._data},getValue:function(c){if(this._data){for(var b=0;b<this._data.times.length;b++){var a=this._data.times[b];if(a>=c){return this._data.values[b]}}}return 0},getClosestValidTime:function(b){if(this._data){for(var a=0;a<this._data.times.length;a++){var c=this._data.times[a];if(c>=b){if(a<=0){return c}else{var d=this._data.times[a-1];if(b-d<c-b){return d}else{return c}}}}}return 0},addListener:function(a){this._eventSource.addListener(a)},removeListener:function(a){this._eventSource.removeListener(a)},replaceListener:function(a,b){this.removeListener(a);this.addListener(b)}};Timeplot.ColumnSource=function(b,a){Timeplot.DataSource.apply(this,arguments);this._column=a-1};Object.extend(Timeplot.ColumnSource.prototype,Timeplot.DataSource.prototype);Timeplot.ColumnSource.prototype.dispose=function(){this.removeListener(this._processingListener);this._clear()};Timeplot.ColumnSource.prototype._process=function(){var g=this._eventSource.getCount();var a=new Array(g);var k=new Array(g);var d=Number.MAX_VALUE;var h=Number.MIN_VALUE;var e=0;var f=this._eventSource.getAllEventIterator();while(f.hasNext()){var b=f.next();var c=b.getTime();a[e]=c;var j=this._getValue(b);if(!isNaN(j)){if(j<d){d=j}if(j>h){h=j}k[e]=j}e++}this._data={times:a,values:k};if(h==Number.MIN_VALUE){h=1}this._range={earliestDate:this._eventSource.getEarliestDate(),latestDate:this._eventSource.getLatestDate(),min:d,max:h}};Timeplot.ColumnSource.prototype._getValue=function(a){return parseFloat(a.getValues()[this._column])};Timeplot.ColumnDiffSource=function(c,b,a){Timeplot.ColumnSource.apply(this,arguments);this._column2=a-1};Object.extend(Timeplot.ColumnDiffSource.prototype,Timeplot.ColumnSource.prototype);Timeplot.ColumnDiffSource.prototype._getValue=function(e){var d=parseFloat(e.getValues()[this._column]);var c=parseFloat(e.getValues()[this._column2]);return d-c};Timeplot.DefaultValueGeometry=function(a){if(!a){a={}}this._id=("id" in a)?a.id:"g"+Math.round(Math.random()*1000000);this._axisColor=("axisColor" in a)?((typeof a.axisColor=="string")?new Timeplot.Color(a.axisColor):a.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in a)?((typeof a.gridColor=="string")?new Timeplot.Color(a.gridColor):a.gridColor):null,this._gridLineWidth=("gridLineWidth" in a)?a.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in a)?a.axisLabelsPlacement:"right";this._gridSpacing=("gridSpacing" in a)?a.gridStep:50;this._gridType=("gridType" in a)?a.gridType:"short";this._gridShortSize=("gridShortSize" in a)?a.gridShortSize:10;this._minValue=("min" in a)?a.min:null;this._maxValue=("max" in a)?a.max:null;this._linMap={direct:function(b){return b},inverse:function(b){return b}};this._map=this._linMap;this._labels=[];this._grid=[]};Timeplot.DefaultValueGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if((this._minValue==null)||((this._minValue!=null)&&(a.min<this._minValue))){this._minValue=a.min}if((this._maxValue==null)||((this._maxValue!=null)&&(a.max*1.05>this._maxValue))){this._maxValue=a.max*1.05}this._updateMappedValues();if(!(this._minValue==0&&this._maxValue==0)){this._grid=this._calculateGrid()}},reset:function(){this._clearLabels();this._updateMappedValues();this._grid=this._calculateGrid()},toScreen:function(b){if(this._canvas&&this._maxValue){var a=b-this._minValue;return this._canvas.height*(this._map.direct(a))/this._mappedRange}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedRange*a/this._canvas.height)+this._minValue}else{return 0}},paint:function(){if(this._timeplot){var b=this._canvas.getContext("2d");b.lineJoin="miter";if(this._gridColor){var e=b.createLinearGradient(0,0,0,this._canvas.height);e.addColorStop(0,this._gridColor.toHexString());e.addColorStop(0.3,this._gridColor.toHexString());e.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=this._gridLineWidth;b.strokeStyle=e;for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var g=Math.floor(c.y)+0.5;if(typeof c.label!="undefined"){if(this._axisLabelsPlacement=="left"){var f=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:4,bottom:g+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(f)}else{if(this._axisLabelsPlacement=="right"){var f=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{right:4,bottom:g+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(f)}}if(g+f.clientHeight<this._canvas.height+10){f.style.visibility="visible"}}b.beginPath();if(this._gridType=="long"||c.label==0){b.moveTo(0,g);b.lineTo(this._canvas.width,g)}else{if(this._gridType=="short"){if(this._axisLabelsPlacement=="left"){b.moveTo(0,g);b.lineTo(this._gridShortSize,g)}else{if(this._axisLabelsPlacement=="right"){b.moveTo(this._canvas.width,g);b.lineTo(this._canvas.width-this._gridShortSize,g)}}}}b.stroke()}}var a=b.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(0,this._axisColor.toString());a.addColorStop(0.5,this._axisColor.toString());a.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=1;b.strokeStyle=a;b.beginPath();b.moveTo(0,this._canvas.height);b.lineTo(0,0);b.stroke();b.beginPath();b.moveTo(this._canvas.width,0);b.lineTo(this._canvas.width,this._canvas.height);b.stroke()}},_clearLabels:function(){for(var b=0;b<this._labels.length;b++){var a=this._labels[b];var c=a.parentNode;if(c){c.removeChild(a)}}},_calculateGrid:function(){var c=[];if(!this._canvas||this._valueRange==0){return c}var d=0;if(this._valueRange>1){while(Math.pow(10,d)<this._valueRange){d++}d--}else{while(Math.pow(10,d)>this._valueRange){d--}}var e=Math.pow(10,d);var f=e;while(true){var a=this.toScreen(this._minValue+f);while(a<this._gridSpacing){f+=e;a=this.toScreen(this._minValue+f)}if(a>2*this._gridSpacing){e/=10;f=e}else{break}}var b=0;var g=this.toScreen(b);if(this._minValue>=0){while(g<this._canvas.height){if(g>0){c.push({y:g,label:b})}b+=f;g=this.toScreen(b)}}else{if(this._maxValue<=0){while(g>0){if(g<this._canvas.height){c.push({y:g,label:b})}b-=f;g=this.toScreen(b)}}else{while(g<this._canvas.height){if(g>0){c.push({y:g,label:b})}b+=f;g=this.toScreen(b)}b=-f;g=this.toScreen(b);while(g>0){if(g<this._canvas.height){c.push({y:g,label:b})}b-=f;g=this.toScreen(b)}}}return c},_updateMappedValues:function(){this._valueRange=Math.abs(this._maxValue-this._minValue);this._mappedRange=this._map.direct(this._valueRange)}};Timeplot.LogarithmicValueGeometry=function(a){Timeplot.DefaultValueGeometry.apply(this,arguments);this._logMap={direct:function(b){return Math.log(b+1)/Math.log(10)},inverse:function(b){return Math.exp(Math.log(10)*b)-1}};this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid};Timeplot.LogarithmicValueGeometry.prototype._linearCalculateGrid=Timeplot.DefaultValueGeometry.prototype._calculateGrid;Object.extend(Timeplot.LogarithmicValueGeometry.prototype,Timeplot.DefaultValueGeometry.prototype);Timeplot.LogarithmicValueGeometry.prototype._logarithmicCalculateGrid=function(){var b=[];if(!this._canvas||this._valueRange==0){return b}var a=1;var c=this.toScreen(a);while(c<this._canvas.height||isNaN(c)){if(c>0){b.push({y:c,label:a})}a*=10;c=this.toScreen(a)}return b};Timeplot.LogarithmicValueGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this._calculateGrid=this._linearCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.actLogarithmic=function(){this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.toggle=function(){if(this._mode=="log"){this.actLinear()}else{this.actLogarithmic()}};Timeplot.DefaultTimeGeometry=function(b){if(!b){b={}}this._id=("id" in b)?b.id:"g"+Math.round(Math.random()*1000000);this._locale=("locale" in b)?b.locale:"en";this._timeZone=("timeZone" in b)?b.timeZone:SimileAjax.DateTime.getTimezone();this._labeler=("labeller" in b)?b.labeller:null;this._axisColor=("axisColor" in b)?((b.axisColor=="string")?new Timeplot.Color(b.axisColor):b.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in b)?((b.gridColor=="string")?new Timeplot.Color(b.gridColor):b.gridColor):null,this._gridLineWidth=("gridLineWidth" in b)?b.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in b)?b.axisLabelsPlacement:"bottom";this._gridStep=("gridStep" in b)?b.gridStep:100;this._gridStepRange=("gridStepRange" in b)?b.gridStepRange:20;this._min=("min" in b)?b.min:null;this._max=("max" in b)?b.max:null;this._timeValuePosition=("timeValuePosition" in b)?b.timeValuePosition:"bottom";this._unit=("unit" in b)?b.unit:Timeline.NativeDateUnit;this._linMap={direct:function(c){return c},inverse:function(c){return c}};this._map=this._linMap;if(!this._labeler){this._labeler=this._unit.createLabeller(this._locale,this._timeZone)}var a=this._unit.getParser("iso8601");if(this._min&&!this._min.getTime){this._min=a(this._min)}if(this._max&&!this._max.getTime){this._max=a(this._max)}this._labels=[];this._grid=[]};Timeplot.DefaultTimeGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if(this._min){this._earliestDate=this._min}else{if(a.earliestDate&&((this._earliestDate==null)||((this._earliestDate!=null)&&(a.earliestDate.getTime()<this._earliestDate.getTime())))){this._earliestDate=a.earliestDate}}if(this._max){this._latestDate=this._max}else{if(a.latestDate&&((this._latestDate==null)||((this._latestDate!=null)&&(a.latestDate.getTime()>this._latestDate.getTime())))){this._latestDate=a.latestDate}}if(!this._earliestDate&&!this._latestDate){this._grid=[]}else{this.reset()}},reset:function(){this._updateMappedValues();if(this._canvas){this._grid=this._calculateGrid()}},toScreen:function(c){if(this._canvas&&this._latestDate){var a=c-this._earliestDate.getTime();var b=(this._mappedPeriod>0)?this._map.direct(a)/this._mappedPeriod:0;return this._canvas.width*b}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedPeriod*a/this._canvas.width)+this._earliestDate.getTime()}else{return 0}},getPeriod:function(){return this._period},getLabeler:function(){return this._labeler},getUnit:function(){return this._unit},paint:function(){if(this._canvas){var e=this._unit;var b=this._canvas.getContext("2d");var f=b.createLinearGradient(0,0,0,this._canvas.height);b.strokeStyle=f;b.lineWidth=this._gridLineWidth;b.lineJoin="miter";if(this._gridColor){f.addColorStop(0,this._gridColor.toString());f.addColorStop(1,"rgba(255,255,255,0.9)");for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var a=Math.floor(c.x)+0.5;if(this._axisLabelsPlacement=="top"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,top:2,visibility:"hidden"});this._labels.push(g)}else{if(this._axisLabelsPlacement=="bottom"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,bottom:2,visibility:"hidden"});this._labels.push(g)}}if(a+g.clientWidth<this._canvas.width+10){g.style.visibility="visible"}b.beginPath();b.moveTo(a,0);b.lineTo(a,this._canvas.height);b.stroke()}}f.addColorStop(0,this._axisColor.toString());f.addColorStop(1,"rgba(255,255,255,0.5)");b.lineWidth=1;f.addColorStop(0,this._axisColor.toString());b.beginPath();b.moveTo(0,0);b.lineTo(this._canvas.width,0);b.stroke()}},_calculateGrid:function(){var a=[];var d=SimileAjax.DateTime;var h=this._unit;var b=this._period;if(b==0){return a}if(b>d.gregorianUnitLengths[d.MILLENNIUM]){g=d.MILLENNIUM}else{for(var g=d.MILLENNIUM;g>0;g--){if(d.gregorianUnitLengths[g-1]<=b&&b<d.gregorianUnitLengths[g]){g--;break}}}var j=h.cloneValue(this._earliestDate);do{d.roundDownToInterval(j,g,this._timeZone,1,0);var f=this.toScreen(h.toNumber(j));switch(g){case d.SECOND:var e=j.toLocaleTimeString();break;case d.MINUTE:var c=j.getMinutes();var e=j.getHours()+":"+((c<10)?"0":"")+c;break;case d.HOUR:var e=j.getHours()+":00";break;case d.DAY:case d.WEEK:case d.MONTH:var e=j.toLocaleDateString();break;case d.YEAR:case d.DECADE:case d.CENTURY:case d.MILLENNIUM:var e=j.getUTCFullYear();break}if(f>0){a.push({x:f,label:e})}d.incrementByInterval(j,g,this._timeZone)}while(j.getTime()<this._latestDate.getTime());return a},_clearLabels:function(){for(var b=0;b<this._labels.length;b++){var a=this._labels[b];var c=a.parentNode;if(c){c.removeChild(a)}}},_updateMappedValues:function(){if(this._latestDate&&this._earliestDate){this._period=this._latestDate.getTime()-this._earliestDate.getTime();this._mappedPeriod=this._map.direct(this._period)}else{this._period=0;this._mappedPeriod=0}}};Timeplot.MagnifyingTimeGeometry=function(b){Timeplot.DefaultTimeGeometry.apply(this,arguments);var a=this;this._MagnifyingMap={direct:function(d){if(d<a._leftTimeMargin){var c=d*a._leftRate}else{if(a._leftTimeMargin<d&&d<a._rightTimeMargin){var c=d*a._expandedRate+a._expandedTimeTranslation}else{var c=d*a._rightRate+a._rightTimeTranslation}}return c},inverse:function(c){if(c<a._leftScreenMargin){var d=c/a._leftRate}else{if(a._leftScreenMargin<c&&c<a._rightScreenMargin){var d=c/a._expandedRate+a._expandedScreenTranslation}else{var d=c/a._rightRate+a._rightScreenTranslation}}return d}};this._mode="lin";this._map=this._linMap};Object.extend(Timeplot.MagnifyingTimeGeometry.prototype,Timeplot.DefaultTimeGeometry.prototype);Timeplot.MagnifyingTimeGeometry.prototype.initialize=function(f){Timeplot.DefaultTimeGeometry.prototype.initialize.apply(this,arguments);if(!this._lens){this._lens=this._timeplot.putDiv("lens","timeplot-lens")}var g=1000*60*60*24*30;var h=this;var b=function(l){var o=l.clientWidth;var m=h._timeplot.locate(l);h.setMagnifyingParams(m.x+o/2,o,g);h.actMagnifying();h._timeplot.paint()};var k=function(m,l,o){h._canvas.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,m);h._canvas.pressed=true};var j=function(m,l,p){h._canvas.pressed=false;var o=SimileAjax.DOM.getEventRelativeCoordinates(l,m);if(Timeplot.Math.isClose(o,h._canvas.startCoords,5)){h._lens.style.display="none";h.actLinear();h._timeplot.paint()}else{h._lens.style.cursor="move";b(h._lens)}};var d=function(m,l,p){if(h._canvas.pressed){var o=SimileAjax.DOM.getEventRelativeCoordinates(l,m);if(o.x<0){o.x=0}if(o.x>h._canvas.width){o.x=h._canvas.width}h._timeplot.placeDiv(h._lens,{left:h._canvas.startCoords.x,width:o.x-h._canvas.startCoords.x,bottom:0,height:h._canvas.height,display:"block"})}};var a=function(m,l,o){h._lens.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,m);h._lens.pressed=true};var c=function(m,l,o){h._lens.pressed=false};var e=function(o,l,r){if(h._lens.pressed){var p=SimileAjax.DOM.getEventRelativeCoordinates(l,o);var m=h._lens;var q=m.offsetLeft+p.x-m.startCoords.x;if(q<h._timeplot._paddingX){q=h._timeplot._paddingX}if(q+m.clientWidth>h._canvas.width-h._timeplot._paddingX){q=h._canvas.width-m.clientWidth+h._timeplot._paddingX}m.style.left=q;b(m)}};if(!this._canvas.instrumented){SimileAjax.DOM.registerEvent(this._canvas,"mousedown",k);SimileAjax.DOM.registerEvent(this._canvas,"mousemove",d);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",j);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",c);this._canvas.instrumented=true}if(!this._lens.instrumented){SimileAjax.DOM.registerEvent(this._lens,"mousedown",a);SimileAjax.DOM.registerEvent(this._lens,"mousemove",e);SimileAjax.DOM.registerEvent(this._lens,"mouseup",c);SimileAjax.DOM.registerEvent(this._lens,"mouseup",j);this._lens.instrumented=true}};Timeplot.MagnifyingTimeGeometry.prototype.setMagnifyingParams=function(k,g,e){g=g/2;e=e/2;var f=this._canvas.width;var j=this._period;if(k<0){k=0}if(k>f){k=f}if(k-g<0){g=k}if(k+g>f){g=f-k}var h=this.fromScreen(k)-this._earliestDate.getTime();if(h-e<0){e=h}if(h+e>j){e=j-h}this._centerX=k;this._centerTime=h;this._aperture=g;this._aperturePeriod=e;this._leftScreenMargin=this._centerX-this._aperture;this._rightScreenMargin=this._centerX+this._aperture;this._leftTimeMargin=this._centerTime-this._aperturePeriod;this._rightTimeMargin=this._centerTime+this._aperturePeriod;this._leftRate=(k-g)/(h-e);this._expandedRate=g/e;this._rightRate=(f-k-g)/(j-h-e);this._expandedTimeTranslation=this._centerX-this._centerTime*this._expandedRate;this._expandedScreenTranslation=this._centerTime-this._centerX/this._expandedRate;this._rightTimeTranslation=(k+g)-(h+e)*this._rightRate;this._rightScreenTranslation=(h+e)-(k+g)/this._rightRate;this._updateMappedValues()};Timeplot.MagnifyingTimeGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.actMagnifying=function(){this._mode="Magnifying";this._map=this._MagnifyingMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.toggle=function(){if(this._mode=="Magnifying"){this.actLinear()}else{this.actMagnifying()}};Timeplot.Color=function(a){this._fromHex(a)};Timeplot.Color.prototype={set:function(f,e,c,d){this.r=f;this.g=e;this.b=c;this.a=(d)?d:1;return this.check()},transparency:function(b){this.a=b;return this.check()},lighten:function(b){var a=new Timeplot.Color();return a.set(this.r+=parseInt(b,10),this.g+=parseInt(b,10),this.b+=parseInt(b,10))},darken:function(b){var a=new Timeplot.Color();return a.set(this.r-=parseInt(b,10),this.g-=parseInt(b,10),this.b-=parseInt(b,10))},check:function(){if(this.r>255){this.r=255}else{if(this.r<0){this.r=0}}if(this.g>255){this.g=255}else{if(this.g<0){this.g=0}}if(this.b>255){this.b=255}else{if(this.b<0){this.b=0}}if(this.a>1){this.a=1}else{if(this.a<0){this.a=0}}return this},toString:function(c){var b=(c)?c:((this.a)?this.a:1);return"rgba("+this.r+","+this.g+","+this.b+","+b+")"},toHexString:function(){return"#"+this._toHex(this.r)+this._toHex(this.g)+this._toHex(this.b)},_fromHex:function(a){if(/^#?([\da-f]{3}|[\da-f]{6})$/i.test(a)){a=a.replace(/^#/,"").replace(/^([\da-f])([\da-f])([\da-f])$/i,"$1$1$2$2$3$3");this.r=parseInt(a.substr(0,2),16);this.g=parseInt(a.substr(2,2),16);this.b=parseInt(a.substr(4,2),16)}else{if(/^rgb *\( *\d{0,3} *, *\d{0,3} *, *\d{0,3} *\)$/i.test(a)){a=a.match(/^rgb *\( *(\d{0,3}) *, *(\d{0,3}) *, *(\d{0,3}) *\)$/i);this.r=parseInt(a[1],10);this.g=parseInt(a[2],10);this.b=parseInt(a[3],10)}}this.a=1;return this.check()},_toHex:function(d){var c="0123456789ABCDEF";if(d<0){return"00"}if(d>255){return"FF"}var b=Math.floor(d/16);var a=d%16;return c.charAt(b)+c.charAt(a)}};Timeplot.Math={range:function(g){var d=g.length;var c=Number.MAX_VALUE;var a=Number.MIN_VALUE;for(var b=0;b<d;b++){var e=g[b];if(e<c){c=e}if(e>a){a=e}}return{min:c,max:a}},movingAverage:function(j,c){var e=j.length;var d=new Array(e);for(var k=0;k<e;k++){var h=0;for(var a=k-c;a<k+c;a++){if(a<0){var b=j[0]}else{if(a>=e){var b=d[k-1]}else{var b=j[a]}}h+=b}d[k]=h/(2*c)}return d},integral:function(e){var d=e.length;var c=new Array(d);var b=0;for(var a=0;a<d;a++){b+=e[a];c[a]=b}return c},normalize:function(d){var c=d.length;var b=0;for(var a=0;a<c;a++){b+=d[a]}for(var a=0;a<c;a++){d[a]/=b}return d},convolution:function(l,k){var t=l.length;var s=k.length;var o=new Array(t);for(var h=0;h<t;h++){var d=0;var j=(h+s<t)?h+s:t;for(var e=h;e<j;e++){var q=l[e-s];var p=k[e-h];d+=q*p}o[h]=d}return o},heavyside:function(b){var d=new Array(b);var c=1/b;for(var a=0;a<b;a++){d[a]=c}return d},gaussian:function(size,threshold){with(Math){var radius=size/2;var variance=radius*radius/log(threshold);var g=new Array(size);for(var t=0;t<size;t++){var l=t-radius;g[t]=exp(-variance*l*l)}}return this.normalize(g)},round:function(x,n){with(Math){if(abs(x)>1){var l=floor(log(x)/log(10));var d=round(exp((l-n+1)*log(10)));var y=round(round(x/d)*d);return y}else{log("FIXME(SM): still to implement for 0 < abs(x) < 1");return x}}},tanh:function(a){if(a>5){return 1}else{if(a<5){return -1}else{var b=Math.exp(2*a);return(b-1)/(b+1)}}},isClose:function(d,c,e){return(d&&c&&Math.abs(d.x-c.x)<e&&Math.abs(d.y-c.y)<e)}};Timeplot.Operator={sum:function(a,b){return Timeplot.Math.integral(a.values)},average:function(c,d){var b=("size" in d)?d.size:30;var a=Timeplot.Math.movingAverage(c.values,b);return a}};Timeplot.Processor=function(d,a,c){this._dataSource=d;this._operator=a;this._params=c;this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0};var b=this;this._processingListener={onAddMany:function(){b._process()},onClear:function(){b._clear()}};this.addListener(this._processingListener)};Timeplot.Processor.prototype={_clear:function(){this.removeListener(this._processingListener);this._dataSource._clear()},_process:function(){var d=this._dataSource.getData();var a=this._dataSource.getRange();var b=this._operator(d,this._params);var c=Timeplot.Math.range(b);this._data={times:d.times,values:b};this._range={earliestDate:a.earliestDate,latestDate:a.latestDate,min:c.min,max:c.max}},getRange:function(){return this._range},getData:function(){return this._data},getValue:Timeplot.DataSource.prototype.getValue,getClosestValidTime:Timeplot.DataSource.prototype.getClosestValidTime,addListener:function(a){this._dataSource.addListener(a)},removeListener:function(a){this._dataSource.removeListener(a)}};function Range(){this._value=0;this._minimum=0;this._maximum=100;this._extent=0;this._isChanging=false}Range.prototype.setValue=function(a){a=Math.round(parseFloat(a));if(isNaN(a)){return}if(this._value!=a){if(a+this._extent>this._maximum){this._value=this._maximum-this._extent}else{if(a<this._minimum){this._value=this._minimum}else{this._value=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getValue=function(){return this._value};Range.prototype.setExtent=function(a){if(this._extent!=a){if(a<0){this._extent=0}else{if(this._value+a>this._maximum){this._extent=this._maximum-this._value}else{this._extent=a}}if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getExtent=function(){return this._extent};Range.prototype.setMinimum=function(a){if(this._minimum!=a){var b=this._isChanging;this._isChanging=true;this._minimum=a;if(a>this._value){this.setValue(a)}if(a>this._maximum){this._extent=0;this.setMaximum(a);this.setValue(a)}if(a+this._extent>this._maximum){this._extent=this._maximum-this._minimum}this._isChanging=b;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMinimum=function(){return this._minimum};Range.prototype.setMaximum=function(b){if(this._maximum!=b){var a=this._isChanging;this._isChanging=true;this._maximum=b;if(b<this._value){this.setValue(b-this._extent)}if(b<this._minimum){this._extent=0;this.setMinimum(b);this.setValue(this._maximum)}if(b<this._minimum+this._extent){this._extent=this._maximum-this._minimum}if(b<this._value+this._extent){this._extent=this._maximum-this._value}this._isChanging=a;if(!this._isChanging&&typeof this.onchange=="function"){this.onchange()}}};Range.prototype.getMaximum=function(){return this._maximum};Slider.isSupported=typeof document.createElement!="undefined"&&typeof document.documentElement!="undefined"&&typeof document.documentElement.offsetWidth=="number";function Slider(b,d,c){if(!b){return}this._orientation=c||"horizontal";this._range=new Range();this._range.setExtent(0);this._blockIncrement=10;this._unitIncrement=1;this._timer=new Timer(100);if(Slider.isSupported&&b){this.document=b.ownerDocument||b.document;this.element=b;this.element.slider=this;this.element.unselectable="on";this.element.className=this._orientation+" "+this.classNameTag+" "+this.element.className;this.line=this.document.createElement("DIV");this.line.className="line";this.line.unselectable="on";this.line.appendChild(this.document.createElement("DIV"));this.element.appendChild(this.line);this.handle=this.document.createElement("DIV");this.handle.className="handle";this.handle.unselectable="on";this.handle.appendChild(this.document.createElement("DIV"));this.handle.firstChild.appendChild(this.document.createTextNode(String.fromCharCode(160)));this.element.appendChild(this.handle)}this.input=d;var a=this;this._range.onchange=function(){a.recalculate();if(typeof a.onchange=="function"){a.onchange()}};if(Slider.isSupported&&b){this.element.onfocus=Slider.eventHandlers.onfocus;this.element.onblur=Slider.eventHandlers.onblur;this.element.onmousedown=Slider.eventHandlers.onmousedown;this.element.onmouseover=Slider.eventHandlers.onmouseover;this.element.onmouseout=Slider.eventHandlers.onmouseout;this.element.onkeydown=Slider.eventHandlers.onkeydown;this.element.onkeypress=Slider.eventHandlers.onkeypress;this.element.onmousewheel=Slider.eventHandlers.onmousewheel;this.handle.onselectstart=this.element.onselectstart=function(){return false};this._timer.ontimer=function(){a.ontimer()};window.setTimeout(function(){a.recalculate()},1)}else{this.input.onchange=function(f){a.setValue(a.input.value)}}}Slider.eventHandlers={getEvent:function(b,a){if(!b){if(a){b=a.document.parentWindow.event}else{b=window.event}}if(!b.srcElement){var a=b.target;while(a!=null&&a.nodeType!=1){a=a.parentNode}b.srcElement=a}if(typeof b.offsetX=="undefined"){b.offsetX=b.layerX;b.offsetY=b.layerY}return b},getDocument:function(a){if(a.target){return a.target.ownerDocument}return a.srcElement.document},getSlider:function(b){var a=b.target||b.srcElement;while(a!=null&&a.slider==null){a=a.parentNode}if(a){return a.slider}return null},getLine:function(b){var a=b.target||b.srcElement;while(a!=null&&a.className!="line"){a=a.parentNode}return a},getHandle:function(c){var b=c.target||c.srcElement;var a=/handle/;while(b!=null&&!a.test(b.className)){b=b.parentNode}return b},onfocus:function(b){var a=this.slider;a._focused=true;a.handle.className="handle hover"},onblur:function(b){var a=this.slider;a._focused=false;a.handle.className="handle"},onmouseover:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle){a.handle.className="handle hover"}},onmouseout:function(b){b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(b.srcElement==a.handle&&!a._focused){a.handle.className="handle"}},onmousedown:function(d){d=Slider.eventHandlers.getEvent(d,this);var a=this.slider;if(a.element.focus){a.element.focus()}Slider._currentInstance=a;var c=a.document;if(c.addEventListener){c.addEventListener("mousemove",Slider.eventHandlers.onmousemove,true);c.addEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(c.attachEvent){c.attachEvent("onmousemove",Slider.eventHandlers.onmousemove);c.attachEvent("onmouseup",Slider.eventHandlers.onmouseup);c.attachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.setCapture()}}if(Slider.eventHandlers.getHandle(d)){Slider._sliderDragData={screenX:d.screenX,screenY:d.screenY,dx:d.screenX-a.handle.offsetLeft,dy:d.screenY-a.handle.offsetTop,startValue:a.getValue(),slider:a}}else{return;var b=Slider.eventHandlers.getLine(d);a._mouseX=d.offsetX+(b?a.line.offsetLeft:0);a._mouseY=d.offsetY+(b?a.line.offsetTop:0);a._increasing=null;a.ontimer()}},onmousemove:function(g){g=Slider.eventHandlers.getEvent(g,this);if(Slider._sliderDragData){var c=Slider._sliderDragData.slider;var a=c.getMaximum()-c.getMinimum();var b,h,f;if(c._orientation=="horizontal"){b=c.element.offsetWidth-c.handle.offsetWidth;h=g.screenX-Slider._sliderDragData.dx;f=Math.abs(g.screenY-Slider._sliderDragData.screenY)>100}else{b=c.element.offsetHeight-c.handle.offsetHeight;h=c.element.offsetHeight-c.handle.offsetHeight-(g.screenY-Slider._sliderDragData.dy);f=Math.abs(g.screenX-Slider._sliderDragData.screenX)>100}c.setValue(f?Slider._sliderDragData.startValue:c.getMinimum()+a*h/b);return false}else{return;var c=Slider._currentInstance;if(c!=null){var d=Slider.eventHandlers.getLine(g);c._mouseX=g.offsetX+(d?c.line.offsetLeft:0);c._mouseY=g.offsetY+(d?c.line.offsetTop:0)}}},onmouseup:function(c){c=Slider.eventHandlers.getEvent(c,this);var a=Slider._currentInstance;var b=a.document;if(b.removeEventListener){b.removeEventListener("mousemove",Slider.eventHandlers.onmousemove,true);b.removeEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else{if(b.detachEvent){b.detachEvent("onmousemove",Slider.eventHandlers.onmousemove);b.detachEvent("onmouseup",Slider.eventHandlers.onmouseup);b.detachEvent("onlosecapture",Slider.eventHandlers.onmouseup);a.element.releaseCapture()}}if(Slider._sliderDragData){Slider._sliderDragData=null}else{return;a._timer.stop();a._increasing=null}Slider._currentInstance=null},onkeydown:function(c){return;c=Slider.eventHandlers.getEvent(c,this);var b=this.slider;var a=c.keyCode;switch(a){case 33:b.setValue(b.getValue()+b.getBlockIncrement());break;case 34:b.setValue(b.getValue()-b.getBlockIncrement());break;case 35:b.setValue(b.getOrientation()=="horizontal"?b.getMaximum():b.getMinimum());break;case 36:b.setValue(b.getOrientation()=="horizontal"?b.getMinimum():b.getMaximum());break;case 38:case 39:b.setValue(b.getValue()+b.getUnitIncrement());break;case 37:case 40:b.setValue(b.getValue()-b.getUnitIncrement());break}if(a>=33&&a<=40){return false}},onkeypress:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=b.keyCode;if(a>=33&&a<=40){return false}},onmousewheel:function(b){return;b=Slider.eventHandlers.getEvent(b,this);var a=this.slider;if(a._focused){a.setValue(a.getValue()+b.wheelDelta/120*a.getUnitIncrement());return false}}};Slider.prototype.classNameTag="dynamic-slider-control",Slider.prototype.setValue=function(a){this._range.setValue(a);this.input.value=this.getValue()};Slider.prototype.getValue=function(){return this._range.getValue()};Slider.prototype.setMinimum=function(a){this._range.setMinimum(a);this.input.value=this.getValue()};Slider.prototype.getMinimum=function(){return this._range.getMinimum()};Slider.prototype.setMaximum=function(a){this._range.setMaximum(a);this.input.value=this.getValue()};Slider.prototype.getMaximum=function(){return this._range.getMaximum()};Slider.prototype.setUnitIncrement=function(a){this._unitIncrement=a};Slider.prototype.getUnitIncrement=function(){return this._unitIncrement};Slider.prototype.setBlockIncrement=function(a){this._blockIncrement=a};Slider.prototype.getBlockIncrement=function(){return this._blockIncrement};Slider.prototype.getOrientation=function(){return this._orientation};Slider.prototype.setOrientation=function(a){if(a!=this._orientation){if(Slider.isSupported&&this.element){this.element.className=this.element.className.replace(this._orientation,a)}this._orientation=a;this.recalculate()}};Slider.prototype.recalculate=function(){if(!Slider.isSupported||!this.element){return}var c=this.element.offsetWidth;var e=this.element.offsetHeight;var a=this.handle.offsetWidth;var d=this.handle.offsetHeight;var f=this.line.offsetWidth;var b=this.line.offsetHeight;if(this._orientation=="horizontal"){this.handle.style.left=(c-a)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.handle.style.top=(e-d)/2+"px";this.line.style.top=(e-b)/2+"px";this.line.style.left=a/2+"px";this.line.style.width=Math.max(0,c-a-2)+"px";this.line.firstChild.style.width=Math.max(0,c-a-4)+"px"}else{this.handle.style.left=(c-a)/2+"px";this.handle.style.top=e-d-(e-d)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.line.style.left=(c-f)/2+"px";this.line.style.top=d/2+"px";this.line.style.height=Math.max(0,e-d-2)+"px";this.line.firstChild.style.height=Math.max(0,e-d-4)+"px"}};Slider.prototype.ontimer=function(){var b=this.handle.offsetWidth;var d=this.handle.offsetHeight;var a=this.handle.offsetLeft;var c=this.handle.offsetTop;if(this._orientation=="horizontal"){if(this._mouseX>a+b&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}else{if(this._mouseX<a&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}}}else{if(this._mouseY>c+d&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}else{if(this._mouseY<c&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}}}this._timer.start()};function Timer(a){this._pauseTime=typeof a=="undefined"?1000:a;this._timer=null;this._isStarted=false}Timer.prototype.start=function(){if(this.isStarted()){this.stop()}var a=this;this._timer=window.setTimeout(function(){if(typeof a.ontimer=="function"){a.ontimer()}},this._pauseTime);this._isStarted=false};Timer.prototype.stop=function(){if(this._timer!=null){window.clearTimeout(this._timer)}this._isStarted=false};Timer.prototype.isStarted=function(){return this._isStarted};Timer.prototype.getPauseTime=function(){return this._pauseTime};Timer.prototype.setPauseTime=function(a){this._pauseTime=a};Timeplot.DefaultEventSource.prototype.loadData=function(b){this._events.maxValues=new Array();this._events.removeAll();for(var a=0;a<b.length;a++){var c=b[a];var d=new Timeplot.DefaultEventSource.NumericEvent(c.date,c.value);this._events.add(d)}this._fire("onAddMany",[])};Timeplot._Impl.prototype.resetPlots=function(e){this._plotInfos=e;this._painters={background:[],foreground:[]};this._painter=null;var b=this;var a={onAddMany:function(){b.update()},onClear:function(){b.update()}};for(i=this._plots.length;i>0;i--){this._plots[i-1].opacityPlot.removeChild(this._plots[i-1]._opacityCanvas);this._plots[i-1].dispose();if(document.addEventListener){this._containerDiv.removeEventListener("mousemove",this._plots[i-1].mousemove,false);this._containerDiv.removeEventListener("mouseover",this._plots[i-1].mouseover,false)}else{if(document.attachEvent){this._containerDiv.detachEvent("onmousemove",this._plots[i-1].mousemove);this._containerDiv.detachEvent("onmouseover",this._plots[i-1].mouseover)}}delete this._plots[i-1]}this._plots=[];for(i=0;i<this._plotInfos.length;i++){var c=new Timeplot.Plot(this,this._plotInfos[i]);var d=c.getDataSource();if(d){d.addListener(a)}this.addPainter("background",{context:c.getTimeGeometry(),action:c.getTimeGeometry().paint});this.addPainter("background",{context:c.getValueGeometry(),action:c.getValueGeometry().paint});this.addPainter("foreground",{context:c,action:c.paint});this._plots.push(c);c.initialize()}};Timeplot.DefaultTimeGeometry.prototype._calculateGrid=function(){var a=[];var c=SimileAjax.DateTime;var h=this._unit;var b=this._period;if(b==0){return a}var g=-1;do{g++}while(c.gregorianUnitLengths[g]<b);g--;var f;if(g<c.DAY){f=c.HOUR}else{if(g<c.WEEK){f=c.DAY}else{if(g<c.QUARTER){f=c.WEEK}else{if(g<c.YEAR){f=c.MONTH}else{if(g<c.DECADE){f=c.YEAR}else{if(g<c.CENTURY){f=c.DECADE}else{f=c.CENTURY}}}}}}if(f<this._granularity){f=this._granularity}var k=h.cloneValue(this._earliestDate);var j;do{c.roundDownToInterval(k,f,j,1,0);var e=this.toScreen(h.toNumber(k));var d=SimileAjax.DateTime.getTimeLabel(f,k);if(e>0){a.push({x:e,label:d})}c.incrementByInterval(k,f,j)}while(k.getTime()<this._latestDate.getTime());return a};Timeplot.DefaultValueGeometry.prototype.paint=function(){if(this._timeplot){var a=this._canvas.getContext("2d");a.lineJoin="miter";if(this._gridColor){var d=a.createLinearGradient(0,0,0,this._canvas.height);d.addColorStop(0,this._gridColor.toHexString());d.addColorStop(0.3,this._gridColor.toHexString());d.addColorStop(1,"rgba(255,255,255,0.5)");a.lineWidth=this._gridLineWidth;a.strokeStyle=d;for(var c=0;c<this._grid.length;c++){var b=this._grid[c];var f=Math.floor(b.y)+0.5;if(typeof b.label!="undefined"){if(this._axisLabelsPlacement=="left"){var e=this._timeplot.putText(this._id+"-"+c,b.label,"timeplot-grid-label",{left:4,bottom:f+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(e)}else{if(this._axisLabelsPlacement=="right"){var e=this._timeplot.putText(this._id+"-"+c,b.label,"timeplot-grid-label",{right:4,bottom:f+2,color:this._gridColor.toHexString(),visibility:"hidden"});this._labels.push(e)}}if(f+e.clientHeight<this._canvas.height+10){e.style.visibility="visible"}}a.beginPath();if(this._gridType=="long"||b.label==0){a.moveTo(0,f);a.lineTo(this._canvas.width,f)}else{if(this._gridType=="short"){if(this._axisLabelsPlacement=="left"){a.moveTo(0,f);a.lineTo(this._gridShortSize,f)}else{if(this._axisLabelsPlacement=="right"){a.moveTo(this._canvas.width,f);a.lineTo(this._canvas.width-this._gridShortSize,f)}}}}a.stroke()}}}};Timeplot.DefaultTimeGeometry.prototype.paint=function(){if(this._canvas){var e=this._unit;var b=this._canvas.getContext("2d");var f=b.createLinearGradient(0,0,0,this._canvas.height);b.strokeStyle=f;b.lineWidth=this._gridLineWidth;b.lineJoin="miter";if(this._gridColor){f.addColorStop(0,this._gridColor.toString());f.addColorStop(1,"rgba(255,255,255,0.9)");for(var d=0;d<this._grid.length;d++){var c=this._grid[d];var a=Math.floor(c.x)+0.5;if(this._axisLabelsPlacement=="top"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,top:2,visibility:"hidden"});this._labels.push(g)}else{if(this._axisLabelsPlacement=="bottom"){var g=this._timeplot.putText(this._id+"-"+d,c.label,"timeplot-grid-label",{left:a+4,bottom:2,visibility:"hidden"});this._labels.push(g)}}if(!this._hideLabels&&a+g.clientWidth<this._canvas.width+10){g.style.visibility="visible"}b.beginPath();b.moveTo(a,0);b.lineTo(a,this._canvas.height);b.stroke()}}}};Timeplot.Plot.prototype.getSliceNumber=function(){return this._dataSource.getData().times.length};Timeplot.Plot.prototype.getSliceId=function(c){var b=this._dataSource.getData();for(var a=0;a<b.times.length;a++){if(b.times[a].getTime()==c.getTime()){return a}}return null};Timeplot.Plot.prototype.getSliceTime=function(a){var b=this._dataSource.getData();if(0<=a&&a<b.times.length){return b.times[a]}return null};Timeplot.Plot.prototype.initialize=function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._pinValueFlag=this._timeplot.putDiv(this._id+"pinvalueflag","timeplot-valueflag");var a=document.getElementById(this._timeplot._id+"-"+this._id+"pinvalueflag");if(SimileAjax.Platform.browser.isIE&&SimileAjax.Platform.browser.majorVersion<9){var c="border: 1px solid "+this._plotInfo.lineColor.toString()+"; background-color: "+this._plotInfo.fillColor.toString()+";";c=c.replace(/rgba\((\s*\d{1,3}),(\s*\d{1,3}),(\s*\d{1,3}),(\s*\d{1}|\s*\d{1}\.\d+)\)/g,"rgb($1,$2,$3)");a.style.setAttribute("cssText",c)}else{a.style.border="1px solid "+this._plotInfo.lineColor.toString();a.style.backgroundColor=this._plotInfo.fillColor.toString()}this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");this._pinValueFlagLineLeft=this._timeplot.putDiv(this._id+"pinValueflagLineLeft","timeplot-valueflag-line");this._pinValueFlagLineRight=this._timeplot.putDiv(this._id+"pinValueflagLineRight","timeplot-valueflag-line");if(!this._valueFlagLineLeft.firstChild){this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_left.png"));this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png"))}if(!this._pinValueFlagLineLeft.firstChild){this._pinValueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(STIStatic.path+"plot-line_left.png"));this._pinValueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(STIStatic.path+"plot-line_right.png"))}this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var f=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,f);SimileAjax.Graphics.setOpacity(this._valueFlag,f);SimileAjax.Graphics.setOpacity(this._pinValueFlag,f);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,f);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,f);SimileAjax.Graphics.setOpacity(this._pinValueFlagLineLeft,f);SimileAjax.Graphics.setOpacity(this._pinValueFlagLineRight,f);SimileAjax.Graphics.setOpacity(this._valueFlagPole,f);var g=this;var d=function(m,l,o){g._timeFlag.style.visibility="visible";g._valueFlag.style.visibility="visible";g._pinValueFlag.style.visibility="visible";g._valueFlagLineLeft.style.visibility="visible";g._valueFlagLineRight.style.visibility="visible";g._pinValueFlagLineLeft.style.visibility="visible";g._pinValueFlagLineRight.style.visibility="visible";g._valueFlagPole.style.visibility="visible";if(g._plotInfo.showValues){g._valueFlag.style.display="block";e(m,l,o)}};var k=function(m,l,o){g._timeFlag.style.visibility="hidden";g._valueFlag.style.visibility="hidden";g._pinValueFlag.style.visibility="hidden";g._valueFlagLineLeft.style.visibility="hidden";g._valueFlagLineRight.style.visibility="hidden";g._pinValueFlagLineLeft.style.visibility="hidden";g._pinValueFlagLineRight.style.visibility="hidden";g._valueFlagPole.style.visibility="hidden"};var j=24*60*60*1000;var h=30*j;var e=function(z,F,X){if(typeof SimileAjax!="undefined"&&g._plotInfo.showValues){var R=g._canvas;var A=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(F,g._canvas).x);if(A>R.width){A=R.width}if(isNaN(A)||A<0){A=0}var D=g._timeGeometry.fromScreen(A);if(D==0){g._valueFlag.style.display="none";return}var C,P;if(g.style=="bars"){var Q=g._dataSource.getClosestValidTime(D);var N=g._timeGeometry.toScreen(Q);var o=g.getSliceId(Q);var O;if(A<N&&o>0||A>=N&&o==g.getSliceNumber()-1){O=g.getSliceTime(o-1)}else{O=g.getSliceTime(o+1)}var M=g._timeGeometry.toScreen(O);var B=new Date(Q);var w=new Date(O);var E=g._timeGeometry.extendedDataSource.unit;var K;if(N<M){K=SimileAjax.DateTime.getTimeLabel(E,B)+"-"+SimileAjax.DateTime.getTimeLabel(E,w);P=Q}else{K=SimileAjax.DateTime.getTimeLabel(E,w)+"-"+SimileAjax.DateTime.getTimeLabel(E,B);P=O}C=g._dataSource.getValue(P);if(g._plotInfo.roundValues){C=Math.round(C)}g._valueFlag.innerHTML=C;g._timeFlag.innerHTML=K;A=(N+M)/2}else{if(g.style=="graph"){P=g._dataSource.getClosestValidTime(D);A=g._timeGeometry.toScreen(P);C=g._dataSource.getValue(P);if(g._plotInfo.roundValues){C=Math.round(C)}g._valueFlag.innerHTML=C;var D=new Date(P);var E=g._timeGeometry.extendedDataSource.unit;var K=SimileAjax.DateTime.getTimeLabel(E,D);g._timeFlag.innerHTML=K}}var W=g._timeFlag.clientWidth;var r=g._timeFlag.clientHeight;var J=Math.round(W/2);var H=g._valueFlag.clientWidth;var V=g._valueFlag.clientHeight;var u=g._valueGeometry.toScreen(C);if(A+J>R.width){var U=R.width-J}else{if(A-J<0){var U=J}else{var U=A}}g._timeplot.placeDiv(g._valueFlagPole,{left:A,top:0,height:R.height,display:"block"});g._timeplot.placeDiv(g._timeFlag,{left:U-J,top:0,display:"block"});var T=g.getSliceId(P);var G,S=0,s;if(g.pins[T].count>0){g._pinValueFlag.innerHTML=g.pins[T].count;G=g._pinValueFlag.clientWidth;S=g._pinValueFlag.clientHeight;s=g.pins[T].height}var I=A+H+14>R.width;var L=false;if(g.pins[T].count>0){if(A-G-14<0){L=true}}var m,q;if(g.pins[T].count>0){var p=u-s<V/2+S/2;if((L||I)&&p){m=0;q=S}else{m=V/2;q=S/2}}else{m=V/2}if(A+H+14>R.width&&u+V/2+4>R.height){g._valueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._valueFlagLineRight,{left:A-14,bottom:u-14,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A-H-13,bottom:u-13-m,display:"block"})}else{if(A+H+14>R.width&&u+V/2+4<R.height){g._valueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._valueFlagLineLeft,{left:A-14,bottom:u,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A-H-13,bottom:u+13-m,display:"block"})}else{if(A+H+14<R.width&&u+V/2+4>R.height){g._valueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._valueFlagLineLeft,{left:A,bottom:u-13,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A+13,bottom:u-13-m,display:"block"})}else{g._valueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._valueFlagLineRight,{left:A,bottom:u,display:"block"});g._timeplot.placeDiv(g._valueFlag,{left:A+13,bottom:u+13-m,display:"block"})}}}if(g.pins[T].count>0){if(A-G-14<0&&s+S+4>R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A+13,bottom:s-13-q,display:"block"})}else{if(A-G-14<0&&s+S+4<R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A+13,bottom:s+13-q,display:"block"})}else{if(A-G-14>=0&&s+S+4>R.height){g._pinValueFlagLineLeft.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineRight,{left:A-13,bottom:s-13,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A-15-G,bottom:s-13-q,display:"block"})}else{g._pinValueFlagLineRight.style.display="none";g._timeplot.placeDiv(g._pinValueFlagLineLeft,{left:A-14,bottom:s,display:"block"});g._timeplot.placeDiv(g._pinValueFlag,{left:A-G-15,bottom:s+13-q,display:"block"})}}}}else{g._pinValueFlagLineLeft.style.display="none";g._pinValueFlagLineRight.style.display="none";g._pinValueFlag.style.display="none"}}};var b=this._timeplot.getElement();this.mouseover=SimileAjax.DOM.registerPlotEvent(b,"mouseover",d);this.mouseout=SimileAjax.DOM.registerPlotEvent(b,"mouseout",k);this.mousemove=SimileAjax.DOM.registerPlotEvent(b,"mousemove",e);this.opacityPlot=this._timeplot.putDiv("opacityPlot"+this._timeplot._plots.length,"opacityPlot");SimileAjax.Graphics.setOpacity(this.opacityPlot,50);this._timeplot.placeDiv(this.opacityPlot,{left:0,bottom:0,width:this._canvas.width,height:this._canvas.height});this._opacityCanvas=document.createElement("canvas");this.opacityPlot.appendChild(this._opacityCanvas);if(!this._opacityCanvas.getContext&&G_vmlCanvasManager){this._opacityCanvas=G_vmlCanvasManager.initElement(this._opacityCanvas)}this._opacityCanvas.width=this._canvas.width;this._opacityCanvas.height=this._canvas.height;this.opacityPlot.style.visibility="hidden"}};SimileAjax.DOM.registerPlotEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{c.addEventListener(b,a,false)}return a};SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}else{var c=SimileAjax.DOM.getPageCoordinates(b);if((a.type=="DOMMouseScroll")&&SimileAjax.Platform.browser.isFirefox&&(SimileAjax.Platform.browser.majorVersion==2)){return{x:a.screenX-c.left,y:a.screenY-c.top}}else{return{x:a.pageX-c.left,y:a.pageY-c.top}}}};SimileAjax.Graphics.setOpacity=function(b,a){if(SimileAjax.Platform.browser.isIE){b.style.filter="alpha(opacity = "+a+")"}else{var c=(a/100).toString();b.style.opacity=c;b.style.MozOpacity=c}};Timeplot.Plot.prototype.fullOpacityPlot=function(d,v,l,o,A,k,e,w){var s=this._opacityCanvas.getContext("2d");s.clearRect(0,0,this._canvas.width,this._canvas.height);s.lineWidth=this._plotInfo.lineWidth;s.lineJoin="miter";var u=this._canvas.height;s.fillStyle=this._plotInfo.lineColor.toString();var z=this._dataSource.getData();var q=z.times;var b=z.values;var j;if(A!=null&&A.getTime()!=d.getTime()){var a=s.createLinearGradient(l-e,0,l,0);a.addColorStop(0,"rgba("+w.r1+","+w.g1+","+w.b1+",0)");a.addColorStop(1,"rgba("+w.r1+","+w.g1+","+w.b1+",1)");j=true;s.beginPath();for(var r=0;r<q.length;r++){var p=this._timeGeometry.toScreen(q[r]);var m=this._valueGeometry.toScreen(b[r]);if(q[r].getTime()==d.getTime()){s.lineTo(p,u-m);s.lineTo(p,u);s.fillStyle=a;s.fill();break}else{if(q[r].getTime()>=A.getTime()){if(j){s.moveTo(p,u);j=false}s.lineTo(p,u-m)}}}}if(k!=null&&k.getTime()!=v.getTime()){var a=s.createLinearGradient(o,0,o+e,0);a.addColorStop(0,"rgba("+w.r1+","+w.g1+","+w.b1+",1)");a.addColorStop(1,"rgba("+w.r1+","+w.g1+","+w.b1+",0)");j=true;s.beginPath();for(var r=0;r<q.length;r++){var p=this._timeGeometry.toScreen(q[r]);var m=this._valueGeometry.toScreen(b[r]);if(q[r].getTime()==k.getTime()){s.lineTo(p,u-m);s.lineTo(p,u);s.fillStyle=a;s.fill();break}else{if(q[r].getTime()>=v.getTime()){if(j){s.moveTo(p,u);j=false}s.lineTo(p,u-m)}}}}j=true;s.beginPath();s.fillStyle=this._plotInfo.lineColor.toString();var g=0,f=0;for(var r=0;r<q.length;r++){if(!(q[r].getTime()<d.getTime()||q[r].getTime()>v.getTime())){var p=this._timeGeometry.toScreen(q[r]);var m=this._valueGeometry.toScreen(b[r]);if(j){s.moveTo(p,u);j=false}if(this.style=="bars"){s.lineTo(p,u-f)}s.lineTo(p,u-m);if(q[r].getTime()==v.getTime()||r==q.length-1){s.lineTo(p,u)}g=p;f=m}}s.fill()};Timeplot._Impl.prototype.regularGrid=function(){var e=this.getCanvas();var d=e.getContext("2d");var g=d.createLinearGradient(0,0,0,e.height);g.addColorStop(0,"rgb(0,0,0)");g.addColorStop(1,"rgba(255,255,255,0.9)");d.strokeStyle=g;d.lineWidth=0.5;d.lineJoin="miter";var b=e.width/9;var c=[];for(var f=1;f<9;f++){var a=f*b;d.beginPath();d.moveTo(a,0);d.lineTo(a,e.height);d.stroke();c.push({label:"",x:a})}return c};Timeplot.Plot.prototype._plot=function(){var k=this._canvas.getContext("2d");var e=this._dataSource.getData();if(e){var a=e.times;var h=e.values;var d=a.length;k.moveTo(0,0);var c=0,b=0;for(var j=0;j<d;j++){var g=this._timeGeometry.toScreen(a[j]);var f=this._valueGeometry.toScreen(h[j]);if(j>0&&(h[j-1]>0||h[j]>0)){if(this.style=="graph"){k.lineTo(g,f)}if(this.style=="bars"){if(h[j-1]>0){k.lineTo(g,b)}else{k.moveTo(g,b)}k.lineTo(g,f)}}else{k.moveTo(g,f)}c=g;b=f}}};SimileAjax.DOM.registerEvent=function(c,b,d){var a=function(e){e=(e)?e:((event)?event:null);if(e){var f=(e.target)?e.target:((e.srcElement)?e.srcElement:null);if(f){f=(f.nodeType==1||f.nodeType==9)?f:f.parentNode}return d(c,e,f)}return true};if(SimileAjax.Platform.browser.isIE){c.attachEvent("on"+b,a)}else{if(b=="mousewheel"){b="DOMMouseScroll"}c.addEventListener(b,a,false)}};Timeplot._Impl.prototype._setUpright=function(a,b){if(!SimileAjax.Platform.browser.isIE){this._upright=false}else{if(SimileAjax.Platform.browser.majorVersion>8){this._upright=false}}if(!this._upright){this._upright=true;a.translate(0,b.height);a.scale(1,-1)}};Timeplot._Impl.prototype._resizeCanvas=function(){var b=this.getCanvas();if(b.firstChild){b.firstChild.style.width=b.clientWidth+"px";b.firstChild.style.height=b.clientHeight+"px"}for(var c=0;c<this._plots.length;c++){var a=this._plots[c]._opacityCanvas;if(a.firstChild){a.firstChild.style.width=a.clientWidth+"px";a.firstChild.style.height=a.clientHeight+"px"}}};Timeplot._Impl.prototype.getWidth=function(){var a=this.getCanvas();if(typeof a.width!="undefined"&&this._containerDiv.clientWidth==0){return a.width}return this._containerDiv.clientWidth};Timeplot._Impl.prototype.getHeight=function(){var a=this.getCanvas();if(typeof a.height!="undefined"&&this._containerDiv.clientHeight==0){return a.height}return this._containerDiv.clientHeight};Timeplot._Impl.prototype._prepareCanvas=function(){var c=this.getCanvas();var b=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(b.css("paddingLeft"))+parseInt(b.css("paddingRight")))/2;this._paddingY=(parseInt(b.css("paddingTop"))+parseInt(b.css("paddingBottom")))/2;if(isNaN(this._paddingX)){this._paddingX=0}if(isNaN(this._paddingY)){this._paddingY=0}c.width=this.getWidth()-(this._paddingX*2);c.height=this.getHeight()-(this._paddingY*2);var a=c.getContext("2d");this._setUpright(a,c);a.globalCompositeOperation="source-over"};SimileAjax.DateTime.MILLISECOND=0;SimileAjax.DateTime.SECOND=1;SimileAjax.DateTime.MINUTE=2;SimileAjax.DateTime.HOUR=3;SimileAjax.DateTime.DAY=4;SimileAjax.DateTime.WEEK=5;SimileAjax.DateTime.MONTH=6;SimileAjax.DateTime.QUARTER=7;SimileAjax.DateTime.SEMESTER=8;SimileAjax.DateTime.YEAR=9;SimileAjax.DateTime.LUSTRUM=10;SimileAjax.DateTime.DECADE=11;SimileAjax.DateTime.HALFCENTURY=12;SimileAjax.DateTime.CENTURY=13;SimileAjax.DateTime.HALFMILLENNIUM=14;SimileAjax.DateTime.MILLENNIUM=15;SimileAjax.DateTime.Strings={en:["milliseconds","seconds","minutes","hours","days","weeks","months","quarters","semester","years","5 years","decades","50 years","centuries","500 years","millenniums"],de:["Millisekunden","Sekunden","Minuten","Stunden","Tage","Wochen","Monate","Quartale","Semester","Jahre","5 Jahre","Dekaden","50 Jahre","Jahrhunderte","500 Jahre","Jahrtausende"]};SimileAjax.DateTime.gregorianUnitLengths=[];(function(){var c=SimileAjax.DateTime;var b=c.gregorianUnitLengths;b[c.MILLISECOND]=1;b[c.SECOND]=1000;b[c.MINUTE]=b[c.SECOND]*60;b[c.HOUR]=b[c.MINUTE]*60;b[c.DAY]=b[c.HOUR]*24;b[c.WEEK]=b[c.DAY]*7;b[c.MONTH]=b[c.DAY]*31;b[c.QUARTER]=b[c.DAY]*91;b[c.SEMESTER]=b[c.DAY]*182;b[c.YEAR]=b[c.DAY]*365;b[c.LUSTRUM]=b[c.YEAR]*5;b[c.DECADE]=b[c.YEAR]*10;b[c.HALFCENTURY]=b[c.YEAR]*50;b[c.CENTURY]=b[c.YEAR]*100;b[c.HALFMILLENNIUM]=b[c.YEAR]*500;b[c.MILLENNIUM]=b[c.YEAR]*1000})();SimileAjax.DateTime.roundDownToInterval=function(b,f,j,l,a){j=(typeof j=="undefined")?0:j;var d=j*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var h=new Date(b.getTime()+d);var e=function(m){m.setUTCMilliseconds(0);m.setUTCSeconds(0);m.setUTCMinutes(0);m.setUTCHours(0)};var k=function(p){e(p);var m=p.getDay();var o=p.getTime();o-=m*1000*60*60*24;p.setTime(o)};var c=function(m){e(m);m.setUTCDate(1);m.setUTCMonth(0)};switch(f){case SimileAjax.DateTime.MILLISECOND:var g=h.getUTCMilliseconds();h.setUTCMilliseconds(g-(g%l));break;case SimileAjax.DateTime.SECOND:h.setUTCMilliseconds(0);var g=h.getUTCSeconds();h.setUTCSeconds(g-(g%l));break;case SimileAjax.DateTime.MINUTE:h.setUTCMilliseconds(0);h.setUTCSeconds(0);var g=h.getUTCMinutes();h.setTime(h.getTime()-(g%l)*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:h.setUTCMilliseconds(0);h.setUTCSeconds(0);h.setUTCMinutes(0);var g=h.getUTCHours();h.setUTCHours(g-(g%l));break;case SimileAjax.DateTime.DAY:e(h);break;case SimileAjax.DateTime.WEEK:k(h);break;case SimileAjax.DateTime.MONTH:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%l));break;case SimileAjax.DateTime.QUARTER:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%3));break;case SimileAjax.DateTime.SEMESTER:e(h);h.setUTCDate(1);var g=h.getUTCMonth();h.setUTCMonth(g-(g%6));break;case SimileAjax.DateTime.YEAR:c(h);var g=h.getUTCFullYear();h.setUTCFullYear(g-(g%l));break;case SimileAjax.DateTime.LUSTRUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/5)*5);break;case SimileAjax.DateTime.DECADE:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/10)*10);break;case SimileAjax.DateTime.HALFCENTURY:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/50)*50);break;case SimileAjax.DateTime.CENTURY:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/100)*100);break;case SimileAjax.DateTime.HALFMILLENNIUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/500)*500);break;case SimileAjax.DateTime.MILLENNIUM:c(h);h.setUTCFullYear(Math.floor(h.getUTCFullYear()/1000)*1000);break}b.setTime(h.getTime()-d)};SimileAjax.DateTime.incrementByInterval=function(b,e,a){a=(typeof a=="undefined")?0:a;var d=a*SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR];var c=new Date(b.getTime()+d);switch(e){case SimileAjax.DateTime.MILLISECOND:c.setTime(c.getTime()+1);break;case SimileAjax.DateTime.SECOND:c.setTime(c.getTime()+1000);break;case SimileAjax.DateTime.MINUTE:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.MINUTE]);break;case SimileAjax.DateTime.HOUR:c.setTime(c.getTime()+SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.HOUR]);break;case SimileAjax.DateTime.DAY:c.setUTCDate(c.getUTCDate()+1);break;case SimileAjax.DateTime.WEEK:c.setUTCDate(c.getUTCDate()+7);break;case SimileAjax.DateTime.MONTH:c.setUTCMonth(c.getUTCMonth()+1);break;case SimileAjax.DateTime.QUARTER:c.setUTCMonth(c.getUTCMonth()+3);break;case SimileAjax.DateTime.SEMESTER:c.setUTCMonth(c.getUTCMonth()+6);break;case SimileAjax.DateTime.YEAR:c.setUTCFullYear(c.getUTCFullYear()+1);break;case SimileAjax.DateTime.LUSTRUM:c.setUTCFullYear(c.getUTCFullYear()+5);break;case SimileAjax.DateTime.DECADE:c.setUTCFullYear(c.getUTCFullYear()+10);break;case SimileAjax.DateTime.HALFCENTURY:c.setUTCFullYear(c.getUTCFullYear()+50);break;case SimileAjax.DateTime.CENTURY:c.setUTCFullYear(c.getUTCFullYear()+100);break;case SimileAjax.DateTime.HALFMILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+500);break;case SimileAjax.DateTime.MILLENNIUM:c.setUTCFullYear(c.getUTCFullYear()+1000);break}b.setTime(c.getTime()-d)};SimileAjax.DateTime.getTimeLabel=function(h,j){var b=SimileAjax.DateTime;var a=j.getUTCSeconds();var c=j.getUTCMinutes();var d=j.getUTCHours();var g=j.getUTCDate();var e=j.getUTCMonth()+1;var f=j.getUTCFullYear();switch(h){case b.SECOND:return d+":"+((c<10)?"0":"")+c+":"+((a<10)?"0":"")+a;case b.MINUTE:return d+":"+((c<10)?"0":"")+c;case b.HOUR:return d+":00";case b.DAY:case b.WEEK:case b.MONTH:case b.QUARTER:case b.SEMESTER:return f+"-"+((e<10)?"0":"")+e+"-"+((g<10)?"0":"")+g;case b.YEAR:case b.LUSTRUM:case b.DECADE:case b.HALFCENTURY:case b.CENTURY:case b.HALFMILLENNIUM:case b.MILLENNIUM:return f}};SimileAjax.DateTime.getTimeString=function(g,c){var j=SimileAjax.DateTime;switch(g){case j.MILLISECOND:case j.SECOND:case j.MINUTE:case j.HOUR:var a=c.getUTCMonth()+1;var k=c.getUTCDate();var f=c.getUTCHours();var b=c.getUTCMinutes();var e=c.getUTCSeconds();return c.getUTCFullYear()+"-"+((a<10)?"0":"")+a+"-"+((k<10)?"0":"")+k+" "+((f<10)?"0":"")+f+":"+((b<10)?"0":"")+b+":"+((e<10)?"0":"")+e;case j.DAY:case j.WEEK:case j.MONTH:case j.QUARTER:case j.SEMESTER:var a=c.getUTCMonth()+1;var k=c.getUTCDate();return c.getUTCFullYear()+"-"+((a<10)?"0":"")+a+"-"+((k<10)?"0":"")+k;case j.YEAR:case j.LUSTRUM:case j.DECADE:case j.HALFCENTURY:case j.CENTURY:case j.HALFMILLENNIUM:case j.MILLENNIUM:return c.getUTCFullYear()}};var OpenLayers={singleFile:true};(function(){var j=(typeof OpenLayers=="object"&&OpenLayers.singleFile);var a;window.OpenLayers={_scriptName:(!j)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){if(a!=undefined){return a}a="";var s=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var o=document.getElementsByTagName("script");for(var q=0,h=o.length;q<h;q++){var r=o[q].getAttribute("src");if(r){var p=r.match(s);if(p){a=p[1];break}}}return a}};if(!j){var k=new Array("OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Class.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/XML.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js");var c=navigator.userAgent;var e=(c.match("MSIE")||c.match("Safari"));if(e){var b=new Array(k.length)}var l=OpenLayers._getScriptLocation()+"lib/";for(var d=0,g=k.length;d<g;d++){if(e){b[d]="<script src='"+l+k[d]+"'><\/script>"}else{var m=document.createElement("script");m.src=l+k[d];var f=document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body;f.appendChild(m)}}if(e){document.write(b.join(""))}}})();OpenLayers.VERSION_NUMBER="OpenLayers 2.10 -- $Revision: 10721 $";OpenLayers.String={startsWith:function(b,a){return(b.indexOf(a)==0)},contains:function(b,a){return(b.indexOf(a)!=-1)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(f){var d=f.split("-");var b=d[0];for(var c=1,a=d.length;c<a;c++){var e=d[c];b+=e.charAt(0).toUpperCase()+e.substring(1)}return b},format:function(d,c,a){if(!c){c=window}var b=function(j,e){var h;var g=e.split(/\.+/);for(var f=0;f<g.length;f++){if(f==0){h=c}h=h[g[f]]}if(typeof h=="function"){h=a?h.apply(null,a):h()}if(typeof h=="undefined"){return"undefined"}else{return h}};return d.replace(OpenLayers.String.tokenRegEx,b)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a}};if(!String.prototype.startsWith){String.prototype.startsWith=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,a)}}if(!String.prototype.contains){String.prototype.contains=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,a)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,c){var b=0;if(c>0){b=parseFloat(a.toPrecision(c))}return b},format:function(c,a,g,j){a=(typeof a!="undefined")?a:0;g=(typeof g!="undefined")?g:OpenLayers.Number.thousandsSeparator;j=(typeof j!="undefined")?j:OpenLayers.Number.decimalSeparator;if(a!=null){c=parseFloat(c.toFixed(a))}var b=c.toString().split(".");if(b.length==1&&a==null){a=0}var d=b[0];if(g){var e=/(-?[0-9]+)([0-9]{3})/;while(e.test(d)){d=d.replace(e,"$1"+g+"$2")}}var f;if(a==0){f=d}else{var h=b.length>1?b[1]:"0";if(a!=null){h=h+new Array(a-h.length+1).join("0")}f=d+j+h}return f}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,a)}}OpenLayers.Function={bind:function(c,b){var a=Array.prototype.slice.apply(arguments,[2]);return function(){var d=a.concat(Array.prototype.slice.apply(arguments,[0]));return c.apply(b,d)}},bindAsEventListener:function(b,a){return function(c){return b.call(a,c||window.event)}},False:function(){return false},True:function(){return true}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,a)}}OpenLayers.Array={filter:function(g,f,b){var d=[];if(Array.prototype.filter){d=g.filter(f,b)}else{var a=g.length;if(typeof f!="function"){throw new TypeError()}for(var c=0;c<a;c++){if(c in g){var e=g[c];if(f.call(b,e,c,g)){d.push(e)}}}}return d}};OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(b){return b.toISOString()}}else{function a(c,b){var d=c+"";while(d.length<b){d="0"+d}return d}return function(b){var c;if(isNaN(b.getTime())){c="Invalid Date"}else{c=b.getUTCFullYear()+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)+"T"+a(b.getUTCHours(),2)+":"+a(b.getUTCMinutes(),2)+":"+a(b.getUTCSeconds(),2)+"."+a(b.getUTCMilliseconds(),3)+"Z"}return c}}})(),parse:function(k){var b;var r=Date.parse(k);if(!isNaN(r)){b=new Date(r)}else{var h=k.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))?$/);var b;if(h&&(h[1]||h[7])){var l=parseInt(h[1],10)||0;var j=(parseInt(h[2],10)-1)||0;var o=parseInt(h[3],10)||1;b=new Date(Date.UTC(l,j,o));var m=h[7];if(m){var p=parseInt(h[4],10);var d=parseInt(h[5],10);var a=parseFloat(h[6]);var q=a|0;var c=Math.round(1000*(a-q));b.setUTCHours(p,d,q,c);if(m!=="Z"){var g=parseInt(m,10);var f=parseInt(h[8])||0;var e=-1000*(60*(g*60)+f*60);b=new Date(b.getTime()+e)}}}else{b=new Date("invalid")}}return b}};OpenLayers.Class=function(){var e=function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}};var c={};var g,b,d;for(var f=0,a=arguments.length;f<a;++f){d=arguments[f];if(typeof d=="function"){if(f==0&&a>1){b=d.prototype.initialize;d.prototype.initialize=function(){};c=new d();if(b===undefined){delete d.prototype.initialize}else{d.prototype.initialize=b}}g=d.prototype}else{g=d}OpenLayers.Util.extend(c,g)}e.prototype=c;return e};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(){var d=arguments[0];var e=new d(OpenLayers.Class.isPrototype);for(var c=1,a=arguments.length;c<a;c++){if(typeof arguments[c]=="function"){var b=arguments[c];arguments[c]=new b(OpenLayers.Class.isPrototype)}OpenLayers.Util.extend(e,arguments[c])}return e};OpenLayers.Util={};OpenLayers.Util.getElement=function(){var d=[];for(var c=0,a=arguments.length;c<a;c++){var b=arguments[c];if(typeof b=="string"){b=document.getElementById(b)}if(arguments.length==1){return b}d.push(b)}return d};OpenLayers.Util.isElement=function(a){return !!(a&&a.nodeType===1)};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement}OpenLayers.Util.extend=function(a,e){a=a||{};if(e){for(var d in e){var c=e[d];if(c!==undefined){a[d]=c}}var b=typeof window.Event=="function"&&e instanceof window.Event;if(!b&&e.hasOwnProperty&&e.hasOwnProperty("toString")){a.toString=e.toString}}return a};OpenLayers.Util.removeItem=function(c,b){for(var a=c.length-1;a>=0;a--){if(c[a]==b){c.splice(a,1)}}return c};OpenLayers.Util.clearArray=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));a.length=0};OpenLayers.Util.indexOf=function(d,c){if(typeof d.indexOf=="function"){return d.indexOf(c)}else{for(var b=0,a=d.length;b<a;b++){if(d[b]==c){return b}}return -1}};OpenLayers.Util.modifyDOMElement=function(e,h,d,f,a,c,g,b){if(h){e.id=h}if(d){e.style.left=d.x+"px";e.style.top=d.y+"px"}if(f){e.style.width=f.w+"px";e.style.height=f.h+"px"}if(a){e.style.position=a}if(c){e.style.border=c}if(g){e.style.overflow=g}if(parseFloat(b)>=0&&parseFloat(b)<1){e.style.filter="alpha(opacity="+(b*100)+")";e.style.opacity=b}else{if(parseFloat(b)==1){e.style.filter="";e.style.opacity=""}}};OpenLayers.Util.createDiv=function(a,j,h,f,e,c,b,g){var d=document.createElement("div");if(f){d.style.backgroundImage="url("+f+")"}if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!e){e="absolute"}OpenLayers.Util.modifyDOMElement(d,a,j,h,e,c,b,g);return d};OpenLayers.Util.createImage=function(a,h,g,e,d,c,f,j){var b=document.createElement("img");if(!a){a=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!d){d="relative"}OpenLayers.Util.modifyDOMElement(b,a,h,g,d,c,null,f);if(j){b.style.display="none";OpenLayers.Event.observe(b,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,b));OpenLayers.Event.observe(b,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,b))}b.style.alt=a;b.galleryImg="no";if(e){b.src=e}return b};OpenLayers.Util.setOpacity=function(b,a){OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display=""}OpenLayers.Element.removeClass(this,"olImageLoadError")};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var d=this.urls;if(d&&d instanceof Array&&d.length>1){var e=this.src.toString();var c,a;for(a=0;c=d[a];a++){if(e.indexOf(c)!=-1){break}}var f=Math.floor(d.length*Math.random());var b=d[f];a=0;while(b==c&&a++<4){f=Math.floor(d.length*Math.random());b=d[f]}this.src=e.replace(c,b)}else{this.src=this.src}}else{OpenLayers.Element.addClass(this,"olImageLoadError")}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var d=navigator.appVersion.split("MSIE");var a=parseFloat(d[1]);var b=false;try{b=!!(document.body.filters)}catch(c){}OpenLayers.Util.alphaHackNeeded=(b&&(a>=5.5)&&(a<7))}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(a,b,k,j,g,f,c,d,h){OpenLayers.Util.modifyDOMElement(a,b,k,j,f,null,null,h);var e=a.childNodes[0];if(g){e.src=g}OpenLayers.Util.modifyDOMElement(e,a.id+"_innerImage",null,j,"relative",c);if(OpenLayers.Util.alphaHack()){if(a.style.display!="none"){a.style.display="inline-block"}if(d==null){d="scale"}a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='"+d+"')";if(parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1){a.style.filter+=" alpha(opacity="+a.style.opacity*100+")"}e.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(b,k,j,g,f,c,d,h,l){var a=OpenLayers.Util.createDiv();var e=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);a.appendChild(e);if(l){e.style.display="none";OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,a));OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,a))}OpenLayers.Util.modifyAlphaImageDiv(a,b,k,j,g,f,c,d,h);return a};OpenLayers.Util.upperCaseObject=function(b){var a={};for(var c in b){a[c.toUpperCase()]=b[c]}return a};OpenLayers.Util.applyDefaults=function(d,c){d=d||{};var b=typeof window.Event=="function"&&c instanceof window.Event;for(var a in c){if(d[a]===undefined||(!b&&c.hasOwnProperty&&c.hasOwnProperty(a)&&!d.hasOwnProperty(a))){d[a]=c[a]}}if(!b&&c&&c.hasOwnProperty&&c.hasOwnProperty("toString")&&!d.hasOwnProperty("toString")){d.toString=c.toString}return d};OpenLayers.Util.getParameterString=function(c){var b=[];for(var h in c){var g=c[h];if((g!=null)&&(typeof g!="function")){var d;if(typeof g=="object"&&g.constructor==Array){var e=[];var j;for(var a=0,f=g.length;a<f;a++){j=g[a];e.push(encodeURIComponent((j===null||j===undefined)?"":j))}d=e.join(",")}else{d=encodeURIComponent(g)}b.push(encodeURIComponent(h)+"="+d)}}return b.join("&")};OpenLayers.Util.urlAppend=function(a,b){var d=a;if(b){var c=(a+" ").split(/[?&]/);d+=(c.pop()===" "?b:c.length?"&"+b:"?"+b)}return d};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")};OpenLayers.Util.Try=function(){var d=null;for(var c=0,a=arguments.length;c<a;c++){var b=arguments[c];try{d=b();break}catch(f){}}return d};OpenLayers.Util.getNodes=function(c,b){var a=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(c.documentElement.childNodes,b)},function(){return OpenLayers.Util._getNodes(c.childNodes,b)});return a};OpenLayers.Util._getNodes=function(c,e){var b=[];for(var d=0,a=c.length;d<a;d++){if(c[d].nodeName==e){b.push(c[d])}}return b};OpenLayers.Util.getTagText=function(c,d,b){var a=OpenLayers.Util.getNodes(c,d);if(a&&(a.length>0)){if(!b){b=0}if(a[b].childNodes.length>1){return a.childNodes[1].nodeValue}else{if(a[b].childNodes.length==1){return a[b].firstChild.nodeValue}}}else{return""}};OpenLayers.Util.getXmlNodeValue=function(a){var b=null;OpenLayers.Util.Try(function(){b=a.text;if(!b){b=a.textContent}if(!b){b=a.firstChild.nodeValue}},function(){b=a.textContent});return b};OpenLayers.Util.mouseLeft=function(a,c){var b=(a.relatedTarget)?a.relatedTarget:a.toElement;while(b!=c&&b!=null){b=b.parentNode}return(b!=c)};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(b,a){if(a==null){a=OpenLayers.Util.DEFAULT_PRECISION}var b;if(a==0){b=parseFloat(b)}else{b=parseFloat(parseFloat(b).toPrecision(a))}return b};OpenLayers.Util.rad=function(a){return a*Math.PI/180};OpenLayers.Util.deg=function(a){return a*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(g,e){var l=OpenLayers.Util.VincentyConstants;var O=l.a,N=l.b,I=l.f;var p=OpenLayers.Util.rad(e.lon-g.lon);var M=Math.atan((1-I)*Math.tan(OpenLayers.Util.rad(g.lat)));var K=Math.atan((1-I)*Math.tan(OpenLayers.Util.rad(e.lat)));var o=Math.sin(M),j=Math.cos(M);var m=Math.sin(K),h=Math.cos(K);var u=p,q=2*Math.PI;var t=20;while(Math.abs(u-q)>1e-12&&--t>0){var E=Math.sin(u),c=Math.cos(u);var P=Math.sqrt((h*E)*(h*E)+(j*m-o*h*c)*(j*m-o*h*c));if(P==0){return 0}var G=o*m+j*h*c;var D=Math.atan2(P,G);var k=Math.asin(j*h*E/P);var H=Math.cos(k)*Math.cos(k);var r=G-2*o*m/H;var x=I/16*H*(4+I*(4-3*H));q=u;u=p+(1-x)*I*Math.sin(k)*(D+x*P*(r+x*G*(-1+2*r*r)))}if(t==0){return NaN}var w=H*(O*O-N*N)/(N*N);var z=1+w/16384*(4096+w*(-768+w*(320-175*w)));var y=w/1024*(256+w*(-128+w*(74-47*w)));var F=y*P*(r+y/4*(G*(-1+2*r*r)-y/6*r*(-3+4*P*P)*(-3+4*r*r)));var v=N*z*(D-F);var J=v.toFixed(3)/1000;return J};OpenLayers.Util.destinationVincenty=function(m,R,G){var q=OpenLayers.Util;var j=q.VincentyConstants;var S=j.a,Q=j.b,M=j.f;var P=m.lon;var g=m.lat;var t=G;var F=q.rad(R);var I=Math.sin(F);var h=Math.cos(F);var H=(1-M)*Math.tan(q.rad(g));var c=1/Math.sqrt((1+H*H)),k=H*c;var r=Math.atan2(H,h);var D=c*I;var K=1-D*D;var w=K*(S*S-Q*Q)/(Q*Q);var z=1+w/16384*(4096+w*(-768+w*(320-175*w)));var x=w/1024*(256+w*(-128+w*(74-47*w)));var y=t/(Q*z),N=2*Math.PI;while(Math.abs(y-N)>1e-12){var o=Math.cos(2*r+y);var T=Math.sin(y);var J=Math.cos(y);var E=x*T*(o+x/4*(J*(-1+2*o*o)-x/6*o*(-3+4*T*T)*(-3+4*o*o)));N=y;y=t/(Q*z)+E}var O=k*T-c*J*h;var d=Math.atan2(k*J+c*T*h,(1-M)*Math.sqrt(D*D+O*O));var p=Math.atan2(T*I,c*J-k*T*h);var v=M/16*K*(4+M*(4-3*K));var l=p-(1-v)*M*D*(y+v*T*(o+v*J*(-1+2*o*o)));var e=Math.atan2(D,-O);return new OpenLayers.LonLat(P+q.deg(l),q.deg(d))};OpenLayers.Util.getParameters=function(b){b=b||window.location.href;var a="";if(OpenLayers.String.contains(b,"?")){var c=b.indexOf("?")+1;var e=OpenLayers.String.contains(b,"#")?b.indexOf("#"):b.length;a=b.substring(c,e)}var l={};var d=a.split(/[&;]/);for(var g=0,h=d.length;g<h;++g){var f=d[g].split("=");if(f[0]){var k=decodeURIComponent(f[0]);var j=f[1]||"";j=decodeURIComponent(j.replace(/\+/g," ")).split(",");if(j.length==1){j=j[0]}l[k]=j}}return l};OpenLayers.Util.getArgs=function(a){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(a)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(a){if(a==null){a="id_"}OpenLayers.Util.lastSeqID+=1;return a+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(b){var a=(b>1)?(1/b):b;return a};OpenLayers.Util.getResolutionFromScale=function(d,a){var b;if(d){if(a==null){a="degrees"}var c=OpenLayers.Util.normalizeScale(d);b=1/(c*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH)}return b};OpenLayers.Util.getScaleFromResolution=function(b,a){if(a==null){a="degrees"}var c=b*OpenLayers.INCHES_PER_UNIT[a]*OpenLayers.DOTS_PER_INCH;return c};OpenLayers.Util.safeStopPropagation=function(a){OpenLayers.Event.stop(a,true)};OpenLayers.Util.pagePosition=function(f){var a=0,d=0;var b=f;var g=f;while(b){if(b==document.body){if(OpenLayers.Element.getStyle(g,"position")=="absolute"){break}}a+=b.offsetTop||0;d+=b.offsetLeft||0;g=b;try{b=b.offsetParent}catch(c){OpenLayers.Console.error(OpenLayers.i18n("pagePositionFailed",{elemId:b.id}));break}}b=f;while(b){a-=b.scrollTop||0;d-=b.scrollLeft||0;b=b.parentNode}return[d,a]};OpenLayers.Util.isEquivalentUrl=function(f,e,c){c=c||{};OpenLayers.Util.applyDefaults(c,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var b=OpenLayers.Util.createUrlObject(f,c);var a=OpenLayers.Util.createUrlObject(e,c);for(var d in b){if(d!=="args"){if(b[d]!=a[d]){return false}}}for(var d in b.args){if(b.args[d]!=a.args[d]){return false}delete a.args[d]}for(var d in a.args){return false}return true};OpenLayers.Util.createUrlObject=function(c,l){l=l||{};if(!(/^\w+:\/\//).test(c)){var g=window.location;var e=g.port?":"+g.port:"";var h=g.protocol+"//"+g.host.split(":").shift()+e;if(c.indexOf("/")===0){c=h+c}else{var f=g.pathname.split("/");f.pop();c=h+f.join("/")+"/"+c}}if(l.ignoreCase){c=c.toLowerCase()}var j=document.createElement("a");j.href=c;var d={};d.host=j.host.split(":").shift();d.protocol=j.protocol;if(l.ignorePort80){d.port=(j.port=="80"||j.port=="0")?"":j.port}else{d.port=(j.port==""||j.port=="0")?"80":j.port}d.hash=(l.ignoreHash||j.hash==="#")?"":j.hash;var b=j.search;if(!b){var k=c.indexOf("?");b=(k!=-1)?c.substr(k):""}d.args=OpenLayers.Util.getParameters(b);d.pathname=(j.pathname.charAt(0)=="/")?j.pathname:"/"+j.pathname;return d};OpenLayers.Util.removeTail=function(b){var c=null;var a=b.indexOf("?");var d=b.indexOf("#");if(a==-1){c=(d!=-1)?b.substr(0,d):b}else{c=(d!=-1)?b.substr(0,Math.min(a,d)):b.substr(0,a)}return c};OpenLayers.Util.getBrowserName=function(){var b="";var a=navigator.userAgent.toLowerCase();if(a.indexOf("opera")!=-1){b="opera"}else{if(a.indexOf("msie")!=-1){b="msie"}else{if(a.indexOf("safari")!=-1){b="safari"}else{if(a.indexOf("mozilla")!=-1){if(a.indexOf("firefox")!=-1){b="firefox"}else{b="mozilla"}}}}}return b};OpenLayers.Util.getRenderedDimensions=function(b,p,q){var k,e;var a=document.createElement("div");a.style.visibility="hidden";var o=(q&&q.containerElement)?q.containerElement:document.body;if(p){if(p.w){k=p.w;a.style.width=k+"px"}else{if(p.h){e=p.h;a.style.height=e+"px"}}}if(q&&q.displayClass){a.className=q.displayClass}var f=document.createElement("div");f.innerHTML=b;f.style.overflow="visible";if(f.childNodes){for(var d=0,c=f.childNodes.length;d<c;d++){if(!f.childNodes[d].style){continue}f.childNodes[d].style.overflow="visible"}}a.appendChild(f);o.appendChild(a);var m=false;var j=a.parentNode;while(j&&j.tagName.toLowerCase()!="body"){var g=OpenLayers.Element.getStyle(j,"position");if(g=="absolute"){m=true;break}else{if(g&&g!="static"){break}}j=j.parentNode}if(!m){a.style.position="absolute"}if(!k){k=parseInt(f.scrollWidth);a.style.width=k+"px"}if(!e){e=parseInt(f.scrollHeight)}a.removeChild(f);o.removeChild(a);return new OpenLayers.Size(k,e)};OpenLayers.Util.getScrollbarWidth=function(){var c=OpenLayers.Util._scrollbarWidth;if(c==null){var e=null;var d=null;var a=0;var b=0;e=document.createElement("div");e.style.position="absolute";e.style.top="-1000px";e.style.left="-1000px";e.style.width="100px";e.style.height="50px";e.style.overflow="hidden";d=document.createElement("div");d.style.width="100%";d.style.height="200px";e.appendChild(d);document.body.appendChild(e);a=d.offsetWidth;e.style.overflow="scroll";b=d.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(a-b);c=OpenLayers.Util._scrollbarWidth}return c};OpenLayers.Util.getFormattedLonLat=function(h,b,e){if(!e){e="dms"}var d=Math.abs(h);var j=Math.floor(d);var a=(d-j)/(1/60);var c=a;a=Math.floor(a);var g=(c-a)/(1/60);g=Math.round(g*10);g/=10;if(j<10){j="0"+j}var f=j+"\u00B0";if(e.indexOf("dm")>=0){if(a<10){a="0"+a}f+=a+"'";if(e.indexOf("dms")>=0){if(g<10){g="0"+g}f+=g+'"'}}if(b=="lon"){f+=h<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")}else{f+=h<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")}return f};OpenLayers.Rico=new Object();OpenLayers.Rico.Corner={round:function(d,b){d=OpenLayers.Util.getElement(d);this._setOptions(b);var a=this.options.color;if(this.options.color=="fromElement"){a=this._background(d)}var c=this.options.bgColor;if(this.options.bgColor=="fromParent"){c=this._background(d.offsetParent)}this._roundCornersImpl(d,a,c)},changeColor:function(c,b){c.style.backgroundColor=b;var a=c.parentNode.getElementsByTagName("span");for(var d=0;d<a.length;d++){a[d].style.backgroundColor=b}},changeOpacity:function(c,f){var d=f;var a="alpha(opacity="+f*100+")";c.style.opacity=d;c.style.filter=a;var b=c.parentNode.getElementsByTagName("span");for(var e=0;e<b.length;e++){b[e].style.opacity=d;b[e].style.filter=a}},reRound:function(d,c){var b=d.parentNode.childNodes[0];var a=d.parentNode.childNodes[2];d.parentNode.removeChild(b);d.parentNode.removeChild(a);this.round(d.parentNode,c)},_roundCornersImpl:function(c,a,b){if(this.options.border){this._renderBorder(c,b)}if(this._isTopRounded()){this._roundTopCorners(c,a,b)}if(this._isBottomRounded()){this._roundBottomCorners(c,a,b)}},_renderBorder:function(d,e){var b="1px solid "+this._borderColor(e);var a="border-left: "+b;var f="border-right: "+b;var c="style='"+a+";"+f+"'";d.innerHTML="<div "+c+">"+d.innerHTML+"</div>"},_roundTopCorners:function(c,a,e){var d=this._createCorner(e);for(var b=0;b<this.options.numSlices;b++){d.appendChild(this._createCornerSlice(a,e,b,"top"))}c.style.paddingTop=0;c.insertBefore(d,c.firstChild)},_roundBottomCorners:function(c,a,e){var d=this._createCorner(e);for(var b=(this.options.numSlices-1);b>=0;b--){d.appendChild(this._createCornerSlice(a,e,b,"bottom"))}c.style.paddingBottom=0;c.appendChild(d)},_createCorner:function(b){var a=document.createElement("div");a.style.backgroundColor=(this._isTransparent()?"transparent":b);return a},_createCornerSlice:function(c,d,g,a){var e=document.createElement("span");var b=e.style;b.backgroundColor=c;b.display="block";b.height="1px";b.overflow="hidden";b.fontSize="1px";var f=this._borderColor(c,d);if(this.options.border&&g==0){b.borderTopStyle="solid";b.borderTopWidth="1px";b.borderLeftWidth="0px";b.borderRightWidth="0px";b.borderBottomWidth="0px";b.height="0px";b.borderColor=f}else{if(f){b.borderColor=f;b.borderStyle="solid";b.borderWidth="0px 1px"}}if(!this.options.compact&&(g==(this.options.numSlices-1))){b.height="2px"}this._setMargin(e,g,a);this._setBorder(e,g,a);return e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};OpenLayers.Util.extend(this.options,a||{});this.options.numSlices=this.options.compact?2:4;if(this._isTransparent()){this.options.blend=false}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""}if(this.options.corners.indexOf("tl")>=0){return"left"}else{if(this.options.corners.indexOf("tr")>=0){return"right"}}return""},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""}if(this.options.corners.indexOf("bl")>=0){return"left"}else{if(this.options.corners.indexOf("br")>=0){return"right"}}return""},_borderColor:function(a,b){if(a=="transparent"){return b}else{if(this.options.border){return this.options.border}else{if(this.options.blend){return this._blend(b,a)}else{return""}}}},_setMargin:function(d,e,b){var c=this._marginSize(e);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){d.style.marginLeft=c+"px";d.style.marginRight="0px"}else{if(a=="right"){d.style.marginRight=c+"px";d.style.marginLeft="0px"}else{d.style.marginLeft=c+"px";d.style.marginRight=c+"px"}}},_setBorder:function(d,e,b){var c=this._borderSize(e);var a=b=="top"?this._whichSideTop():this._whichSideBottom();if(a=="left"){d.style.borderLeftWidth=c+"px";d.style.borderRightWidth="0px"}else{if(a=="right"){d.style.borderRightWidth=c+"px";d.style.borderLeftWidth="0px"}else{d.style.borderLeftWidth=c+"px";d.style.borderRightWidth=c+"px"}}if(this.options.border!=false){d.style.borderLeftWidth=c+"px";d.style.borderRightWidth=c+"px"}},_marginSize:function(e){if(this._isTransparent()){return 0}var d=[5,3,2,1];var a=[3,2,1,0];var c=[2,1];var b=[1,0];if(this.options.compact&&this.options.blend){return b[e]}else{if(this.options.compact){return c[e]}else{if(this.options.blend){return a[e]}else{return d[e]}}}},_borderSize:function(e){var d=[5,3,2,1];var b=[2,1,1,1];var a=[1,0];var c=[0,2,0,0];if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1}else{if(this.options.compact){return a[e]}else{if(this.options.blend){return b[e]}else{if(this.options.border){return c[e]}else{if(this._isTransparent()){return d[e]}}}}}return 0},_hasString:function(b){for(var a=1;a<arguments.length;a++){if(b.indexOf(arguments[a])>=0){return true}}return false},_blend:function(c,a){var b=OpenLayers.Rico.Color.createFromHex(c);b.blend(OpenLayers.Rico.Color.createFromHex(a));return b},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return this.options.color=="transparent"},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return a.childNodes.length==1&&a.childNodes[0].nodeType==3}};(function(){if(window.google&&google.gears){return}var a=null;if(typeof GearsFactory!="undefined"){a=new GearsFactory()}else{try{a=new ActiveXObject("Gears.Factory");if(a.getBuildInfo().indexOf("ie_mobile")!=-1){a.privateSetGlobalObject(this)}}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=document.createElement("object");a.style.display="none";a.width=0;a.height=0;a.type="application/x-googlegears";document.documentElement.appendChild(a)}}}if(!a){return}if(!window.google){google={}}if(!google.gears){google.gears={factory:a}}})();OpenLayers.Element={visible:function(a){return OpenLayers.Util.getElement(a).style.display!="none"},toggle:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);var d=OpenLayers.Element.visible(b)?"hide":"show";OpenLayers.Element[d](b)}},hide:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);if(b){b.style.display="none"}}},show:function(){for(var c=0,a=arguments.length;c<a;c++){var b=OpenLayers.Util.getElement(arguments[c]);if(b){b.style.display=""}}},remove:function(a){a=OpenLayers.Util.getElement(a);a.parentNode.removeChild(a)},getHeight:function(a){a=OpenLayers.Util.getElement(a);return a.offsetHeight},getDimensions:function(c){c=OpenLayers.Util.getElement(c);if(OpenLayers.Element.getStyle(c,"display")!="none"){return{width:c.offsetWidth,height:c.offsetHeight}}var b=c.style;var f=b.visibility;var d=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="";var g=c.clientWidth;var e=c.clientHeight;b.display=a;b.position=d;b.visibility=f;return{width:g,height:e}},hasClass:function(b,a){var c=b.className;return(!!c&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(c))},addClass:function(b,a){if(!OpenLayers.Element.hasClass(b,a)){b.className+=(b.className?" ":"")+a}return b},removeClass:function(b,a){var c=b.className;if(c){b.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+a+"(\\s+|$)")," "))}return b},toggleClass:function(b,a){if(OpenLayers.Element.hasClass(b,a)){OpenLayers.Element.removeClass(b,a)}else{OpenLayers.Element.addClass(b,a)}return b},getStyle:function(c,d){c=OpenLayers.Util.getElement(c);var e=null;if(c&&c.style){e=c.style[OpenLayers.String.camelize(d)];if(!e){if(document.defaultView&&document.defaultView.getComputedStyle){var b=document.defaultView.getComputedStyle(c,null);e=b?b.getPropertyValue(d):null}else{if(c.currentStyle){e=c.currentStyle[OpenLayers.String.camelize(d)]}}}var a=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(a,d)!=-1)&&(OpenLayers.Element.getStyle(c,"position")=="static")){e="auto"}}return e=="auto"?null:e}};OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a);this.h=parseFloat(b)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(b){var a=false;if(b!=null){a=((this.w==b.w&&this.h==b.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(b.w)&&isNaN(b.h)))}return a},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var b=document.getElementsByTagName("script");for(var c=0,a=b.length;c<a;++c){if(b[c].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,d,c){this.url=a;this.size=(b)?b:new OpenLayers.Size(20,20);this.offset=d?d:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=c;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){if(a!=null){this.size=a}this.draw()},setUrl:function(a){if(a!=null){this.url=a}this.draw()},draw:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(a);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)}},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){if(a!=null){this.px=a}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var b=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,b)}}},display:function(a){this.imageDiv.style.display=(a)?"":"none"},isDrawn:function(){var a=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return a},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(g,c,f,b,e,d){if(g==null){g=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=g;this.lonlat=c;this.contentSize=(f!=null)?f:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(b!=null){this.contentHTML=b}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var a=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(a,null,null,null,"relative",null,"hidden");var g=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(g,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(e){this.addCloseBox(d)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(a){if(a==null){if((this.lonlat!=null)&&(this.map!=null)){a=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&OpenLayers.Util.getBrowserName()=="firefox"){this.map.events.register("movestart",this,function(){var b=document.defaultView.getComputedStyle(this.contentDiv,null);var c=b.getPropertyValue("overflow");if(c!="hidden"){this.contentDiv._oldOverflow=c;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var b=this.contentDiv._oldOverflow;if(b){this.contentDiv.style.overflow=b;this.contentDiv._oldOverflow=null}})}this.moveTo(a);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);if(a){this.moveTo(a)}}},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){OpenLayers.Element.show(this.div);if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){OpenLayers.Element.hide(this.div)},setSize:function(c){this.size=c.clone();var b=this.getContentDivPadding();var a=b.left+b.right;var e=b.top+b.bottom;this.fixPadding();a+=this.padding.left+this.padding.right;e+=this.padding.top+this.padding.bottom;if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);a+=d+b.right}this.size.w+=a;this.size.h+=e;if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=b.left+b.right;this.contentSize.h+=b.bottom+b.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=c.w+"px";this.contentDiv.style.height=c.h+"px"}},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var h=(this.map)?this.map.layerContainerDiv:document.body;var j=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:h});var g=this.getSafeContentSize(j);var f=null;if(g.equals(j)){f=j}else{var b=new OpenLayers.Size();b.w=(g.w<j.w)?g.w:null;b.h=(g.h<j.h)?g.h:null;if(b.w&&b.h){f=g}else{var d=OpenLayers.Util.getRenderedDimensions(e,b,{displayClass:this.contentDisplayClass,containerElement:h});var c=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((c!="hidden")&&(d.equals(g))){var a=OpenLayers.Util.getScrollbarWidth();if(b.w){d.h+=a}else{d.w+=a}}f=this.getSafeContentSize(d)}}this.setSize(f)},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(a){if(a!=undefined){this.opacity=a}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(a){if(a!=undefined){this.border=a}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(a){if(a!=null){this.contentHTML=a}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var f=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var b=this.contentDiv.getElementsByTagName("img");for(var e=0,a=b.length;e<a;e++){var c=b[e];if(c.width==0||c.height==0){var d={popup:this,img:c};c._onImgLoad=OpenLayers.Function.bind(f,d);OpenLayers.Event.observe(c,"load",c._onImgLoad)}}},getSafeContentSize:function(l){var d=l.clone();var j=this.getContentDivPadding();var k=j.left+j.right;var g=j.top+j.bottom;this.fixPadding();k+=this.padding.left+this.padding.right;g+=this.padding.top+this.padding.bottom;if(this.closeDiv){var c=parseInt(this.closeDiv.style.width);k+=c+j.right}if(this.minSize){d.w=Math.max(d.w,(this.minSize.w-k));d.h=Math.max(d.h,(this.minSize.h-g))}if(this.maxSize){d.w=Math.min(d.w,(this.maxSize.w-k));d.h=Math.min(d.h,(this.maxSize.h-g))}if(this.map&&this.map.size){var f=0,e=0;if(this.keepInMap&&!this.panMapIfOutOfView){var h=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":f=h.x;e=this.map.size.h-h.y;break;case"tl":f=this.map.size.w-h.x;e=this.map.size.h-h.y;break;case"bl":f=this.map.size.w-h.x;e=h.y;break;case"br":f=h.x;e=h.y;break;default:f=h.x;e=this.map.size.h-h.y;break}}var a=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-g-e;var b=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-k-f;d.w=Math.min(d.w,b);d.h=Math.min(d.h,a)}return d},getContentDivPadding:function(){var a=this._contentDivPadding;if(!a){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=a;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return a},addCloseBox:function(c){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px";this.closeDiv.style.top=b.top+"px";this.groupDiv.appendChild(this.closeDiv);var a=c||function(d){this.hide();OpenLayers.Event.stop(d)};OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var e=this.map.getSize();var d=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var c=d.clone();if(d.x<this.map.paddingForPopups.left){c.x=this.map.paddingForPopups.left}else{if((d.x+this.size.w)>(e.w-this.map.paddingForPopups.right)){c.x=e.w-this.map.paddingForPopups.right-this.size.w}}if(d.y<this.map.paddingForPopups.top){c.y=this.map.paddingForPopups.top}else{if((d.y+this.size.h)>(e.h-this.map.paddingForPopups.bottom)){c.y=e.h-this.map.paddingForPopups.bottom-this.size.h}}var b=d.x-c.x;var a=d.y-c.y;this.map.pan(b,a)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,scope:this})},onmousedown:function(a){this.mousedown=true;OpenLayers.Event.stop(a,true)},onmousemove:function(a){if(this.mousedown){OpenLayers.Event.stop(a,true)}},onmouseup:function(a){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(a,true)}},onclick:function(a){OpenLayers.Event.stop(a,true)},onmouseout:function(a){this.mousedown=false},ondblclick:function(a){OpenLayers.Event.stop(a,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(a){a=a||{};OpenLayers.Util.extend(this,a);this.options=a},mergeWithDefaultFilter:function(b){var a;if(b&&this.defaultFilter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,b]})}else{a=b||this.defaultFilter||undefined}return a},destroy:function(){this.options=null;this.format=null},read:function(a){a=a||{};a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(a){},createCallback:function(c,a,b){return OpenLayers.Function.bind(function(){c.apply(this,[a,b])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(a,b){this.extent=a.clone();if(b){this.resolution=null}},setSize:function(a){this.size=a.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(c,d){if(d==null){d=c.style}if(c.geometry){var e=c.geometry.getBounds();if(e){if(!e.intersectsBounds(this.extent)){d={display:"none"}}var f=this.drawGeometry(c.geometry,d,c.id);if(d.display!="none"&&d.label&&f!==false){var a=c.geometry.getCentroid();if(d.labelXOffset||d.labelYOffset){xOffset=isNaN(d.labelXOffset)?0:d.labelXOffset;yOffset=isNaN(d.labelYOffset)?0:d.labelYOffset;var b=this.getResolution();a.move(xOffset*b,yOffset*b)}this.drawText(c.id,d,a)}else{this.removeText(c.id)}return f}}},drawGeometry:function(c,a,b){},drawText:function(c,b,a){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(d){if(!(d instanceof Array)){d=[d]}for(var c=0,a=d.length;c<a;++c){var b=d[c];this.eraseGeometry(b.geometry,b.id);this.removeText(b.id)}},eraseGeometry:function(b,a){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(b){var a=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(b.stroke===false){delete a.strokeWidth;delete a.strokeColor}if(b.fill===false){delete a.fillColor}OpenLayers.Util.extend(a,b);return a},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(a){this.layer=a},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"});OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(c,b,a){this.rgb={r:c,g:b,b:a}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(b){var a=this.asHSB();a.h=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setSaturation:function(b){var a=this.asHSB();a.s=b;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,a.b)},setBrightness:function(a){var c=this.asHSB();c.b=a;this.rgb=OpenLayers.Rico.Color.HSBtoRGB(c.h,c.s,c.b)},darken:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.max(a.b-b,0))},brighten:function(b){var a=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(a.h,a.s,Math.min(a.b+b,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2);this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2);this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){var a=this.asHSB();return this.asHSB().b>0.5},isDark:function(){return !this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}});OpenLayers.Rico.Color.createFromHex=function(d){if(d.length==4){var b=d;var d="#";for(var c=1;c<4;c++){d+=(b.charAt(c)+b.charAt(c))}}if(d.indexOf("#")==0){d=d.substring(1)}var f=d.substring(0,2);var e=d.substring(2,4);var a=d.substring(4,6);return new OpenLayers.Rico.Color(parseInt(f,16),parseInt(e,16),parseInt(a,16))};OpenLayers.Rico.Color.createColorFromBackground=function(d){var b=RicoUtil.getElementsComputedStyle(OpenLayers.Util.getElement(d),"backgroundColor","background-color");if(b=="transparent"&&d.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(d.parentNode)}if(b==null){return new OpenLayers.Rico.Color(255,255,255)}if(b.indexOf("rgb(")==0){var a=b.substring(4,b.length-1);var c=a.split(",");return new OpenLayers.Rico.Color(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))}else{if(b.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(b)}else{return new OpenLayers.Rico.Color(255,255,255)}}};OpenLayers.Rico.Color.HSBtoRGB=function(j,e,l){var c=0;var d=0;var m=0;if(e==0){c=parseInt(l*255+0.5);d=c;m=c}else{var g=(j-Math.floor(j))*6;var k=g-Math.floor(g);var b=l*(1-e);var a=l*(1-e*k);var o=l*(1-(e*(1-k)));switch(parseInt(g)){case 0:c=(l*255+0.5);d=(o*255+0.5);m=(b*255+0.5);break;case 1:c=(a*255+0.5);d=(l*255+0.5);m=(b*255+0.5);break;case 2:c=(b*255+0.5);d=(l*255+0.5);m=(o*255+0.5);break;case 3:c=(b*255+0.5);d=(a*255+0.5);m=(l*255+0.5);break;case 4:c=(o*255+0.5);d=(b*255+0.5);m=(l*255+0.5);break;case 5:c=(l*255+0.5);d=(b*255+0.5);m=(a*255+0.5);break}}return{r:parseInt(c),g:parseInt(d),b:parseInt(m)}};OpenLayers.Rico.Color.RGBtoHSB=function(a,f,m){var h;var e;var l;var o=(a>f)?a:f;if(m>o){o=m}var j=(a<f)?a:f;if(m<j){j=m}l=o/255;if(o!=0){e=(o-j)/o}else{e=0}if(e==0){h=0}else{var c=(o-a)/(o-j);var k=(o-f)/(o-j);var d=(o-m)/(o-j);if(a==o){h=d-k}else{if(f==o){h=2+c-d}else{h=4+k-c}}h=h/6;if(h<0){h=h+1}}return{h:h,s:e,b:l}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(d,a,b,c){if(d!=null){this.left=OpenLayers.Util.toFloat(d)}if(a!=null){this.bottom=OpenLayers.Util.toFloat(a)}if(b!=null){this.right=OpenLayers.Util.toFloat(b)}if(c!=null){this.top=OpenLayers.Util.toFloat(c)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(b){var a=false;if(b!=null){a=((this.left==b.left)&&(this.right==b.right)&&(this.top==b.top)&&(this.bottom==b.bottom))}return a},toString:function(){return("left-bottom=("+this.left+","+this.bottom+") right-top=("+this.right+","+this.top+")")},toArray:function(a){if(a===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(b,e){if(b==null){b=6}var g=Math.pow(10,b);var f=Math.round(this.left*g)/g;var d=Math.round(this.bottom*g)/g;var c=Math.round(this.right*g)/g;var a=Math.round(this.top*g)/g;if(e===true){return d+","+f+","+a+","+c}else{return f+","+d+","+c+","+a}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(e,c){if(c==null){c=this.getCenterLonLat()}var a,h;if(c.CLASS_NAME=="OpenLayers.LonLat"){a=c.lon;h=c.lat}else{a=c.x;h=c.y}var g=(this.left-a)*e+a;var b=(this.bottom-h)*e+h;var d=(this.right-a)*e+a;var f=(this.top-h)*e+h;return new OpenLayers.Bounds(g,b,d,f)},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Bounds(this.left+a,this.bottom+c,this.right+a,this.top+c)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a;break}if(b){this.centerLonLat=null;if((this.left==null)||(b.left<this.left)){this.left=b.left}if((this.bottom==null)||(b.bottom<this.bottom)){this.bottom=b.bottom}if((this.right==null)||(b.right>this.right)){this.right=b.right}if((this.top==null)||(b.top>this.top)){this.top=b.top}}}},containsLonLat:function(b,a){return this.contains(b.lon,b.lat,a)},containsPixel:function(b,a){return this.contains(b.x,b.y,a)},contains:function(b,d,a){if(a==null){a=true}if(b==null||d==null){return false}b=OpenLayers.Util.toFloat(b);d=OpenLayers.Util.toFloat(d);var c=false;if(a){c=((b>=this.left)&&(b<=this.right)&&(d>=this.bottom)&&(d<=this.top))}else{c=((b>this.left)&&(b<this.right)&&(d>this.bottom)&&(d<this.top))}return c},intersectsBounds:function(e,b){if(b==null){b=true}var d=false;var h=(this.left==e.right||this.right==e.left||this.top==e.bottom||this.bottom==e.top);if(b||!h){var g=(((e.bottom>=this.bottom)&&(e.bottom<=this.top))||((this.bottom>=e.bottom)&&(this.bottom<=e.top)));var f=(((e.top>=this.bottom)&&(e.top<=this.top))||((this.top>e.bottom)&&(this.top<e.top)));var c=(((e.left>=this.left)&&(e.left<=this.right))||((this.left>=e.left)&&(this.left<=e.right)));var a=(((e.right>=this.left)&&(e.right<=this.right))||((this.right>=e.left)&&(this.right<=e.right)));d=((g||f)&&(c||a))}return d},containsBounds:function(g,b,a){if(b==null){b=false}if(a==null){a=true}var c=this.contains(g.left,g.bottom,a);var d=this.contains(g.right,g.bottom,a);var f=this.contains(g.left,g.top,a);var e=this.contains(g.right,g.top,a);return(b)?(c||d||f||e):(c&&d&&f&&e)},determineQuadrant:function(c){var b="";var a=this.getCenterLonLat();b+=(c.lat<a.lat)?"b":"t";b+=(c.lon<a.lon)?"l":"r";return b},transform:function(d,b){this.centerLonLat=null;var e=OpenLayers.Projection.transform({x:this.left,y:this.bottom},d,b);var a=OpenLayers.Projection.transform({x:this.right,y:this.bottom},d,b);var c=OpenLayers.Projection.transform({x:this.left,y:this.top},d,b);var f=OpenLayers.Projection.transform({x:this.right,y:this.top},d,b);this.left=Math.min(e.x,c.x);this.bottom=Math.min(e.y,a.y);this.right=Math.max(a.x,f.x);this.top=Math.max(c.y,f.y);return this},wrapDateLine:function(a,c){c=c||{};var d=c.leftTolerance||0;var b=c.rightTolerance||0;var e=this.clone();if(a){while(e.left<a.left&&(e.right-b)<=a.left){e=e.add(a.getWidth(),0)}while((e.left+d)>=a.right&&e.right>a.right){e=e.add(-a.getWidth(),0)}}return e},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(b){var a=b.split(",");return OpenLayers.Bounds.fromArray(a)};OpenLayers.Bounds.fromArray=function(a){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))};OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";b+=(a.charAt(0)=="t")?"b":"t";b+=(a.charAt(1)=="l")?"r":"l";return b};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(b,a){this.lon=OpenLayers.Util.toFloat(b);this.lat=OpenLayers.Util.toFloat(a)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(c,a){if((c==null)||(a==null)){var b=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(c),this.lat+OpenLayers.Util.toFloat(a))},equals:function(b){var a=false;if(b!=null){a=((this.lon==b.lon&&this.lat==b.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(b.lon)&&isNaN(b.lat)))}return a},transform:function(c,b){var a=OpenLayers.Projection.transform({x:this.lon,y:this.lat},c,b);this.lon=a.x;this.lat=a.y;return this},wrapDateLine:function(a){var b=this.clone();if(a){while(b.lon<a.left){b.lon+=a.getWidth()}while(b.lon>a.right){b.lon-=a.getWidth()}}return b},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(b){var a=b.split(",");return new OpenLayers.LonLat(a[0],a[1])};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a);this.y=parseFloat(b)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},add:function(a,c){if((a==null)||(c==null)){var b=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(b);return null}return new OpenLayers.Pixel(this.x+a,this.y+c)},offset:function(a){var b=this.clone();if(a){b=this.add(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var a in this.handlers){if(this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"){this.handlers[a].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}},setMap:function(a){this.map=a;if(this.handler){this.handler.setMap(a)}},draw:function(a){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}if(this.title!=""){this.div.title=this.title}}if(a!=null){this.position=a.clone()}this.moveTo(this.position);return this.div},moveTo:function(a){if((a!=null)&&(this.div!=null)){this.div.style.left=a.x+"px";this.div.style.top=a.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(b){var d;if(!b){b=(OpenLayers.Util.getBrowserName()=="msie")?navigator.userLanguage:navigator.language}var c=b.split("-");c[0]=c[0].toLowerCase();if(typeof OpenLayers.Lang[c[0]]=="object"){d=c[0]}if(c[1]){var a=c[0]+"-"+c[1].toUpperCase();if(typeof OpenLayers.Lang[a]=="object"){d=a}}if(!d){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language");d=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=d},translate:function(b,a){var d=OpenLayers.Lang[OpenLayers.Lang.getCode()];var c=d[b];if(!c){c=b}if(a){c=OpenLayers.String.format(c,a)}return c}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(h,d,g,c,b,f,e){var a=[h,d,g,c,f,e];OpenLayers.Popup.prototype.initialize.apply(this,a);this.anchor=(b!=null)?b:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(c){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(c);var d=this.calculateNewPx(c);var a=new Array(d);OpenLayers.Popup.prototype.moveTo.apply(this,a);if(this.relativePosition!=b){this.updateRelativePosition()}},setSize:function(b){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var a=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(a)}},calculateRelativePosition:function(b){var d=this.map.getLonLatFromLayerPx(b);var c=this.map.getExtent();var a=c.determineQuadrant(d);return OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(b){var e=b.offset(this.anchor.offset);var a=this.size||this.contentSize;var d=(this.relativePosition.charAt(0)=="t");e.y+=(d)?-(a.h+this.anchor.size.h):this.anchor.size.h;var c=(this.relativePosition.charAt(1)=="l");e.x+=(c)?-(a.w+this.anchor.size.w):this.anchor.size.w;return e},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Protocol.SOS=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Protocol.SOS.DEFAULTS);var a=OpenLayers.Protocol.SOS["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported SOS version: "+b.version}return new a(b)};OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};OpenLayers.Protocol.SQL=OpenLayers.Class(OpenLayers.Protocol,{databaseName:"ol",tableName:"ol_vector_features",postReadFiltering:true,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Protocol.prototype.destroy.apply(this)},supported:function(){return false},evaluateFilter:function(a,b){return b&&this.postReadFiltering?b.evaluate(a):true},CLASS_NAME:"OpenLayers.Protocol.SQL"});OpenLayers.Protocol.WFS=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Protocol.WFS.DEFAULTS);var a=OpenLayers.Protocol.WFS["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported WFS version: "+b.version}return new a(b)};OpenLayers.Protocol.WFS.fromWMSLayer=function(d,c){var a,e;var g=d.params.LAYERS;var f=(g instanceof Array?g[0]:g).split(":");if(f.length>1){e=f[0]}a=f.pop();var b={url:d.url,featureType:a,featurePrefix:e,srsName:d.projection&&d.projection.getCode()||d.map&&d.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(c,b))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{canvas:null,features:null,initialize:function(a){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={}},eraseGeometry:function(b,a){this.eraseFeatures(this.features[a][0])},supported:function(){var a=document.createElement("canvas");return !!a.getContext},setExtent:function(a){this.extent=a.clone();this.resolution=null;this.redraw()},setSize:function(a){this.size=a.clone();this.root.style.width=a.w+"px";this.root.style.height=a.h+"px";this.root.width=a.w;this.root.height=a.h;this.resolution=null},drawFeature:function(a,b){b=b||a.style;b=this.applyDefaultSymbolizer(b);this.features[a.id]=[a,b];this.redraw()},drawGeometry:function(d,c){var b=d.CLASS_NAME;if((b=="OpenLayers.Geometry.Collection")||(b=="OpenLayers.Geometry.MultiPoint")||(b=="OpenLayers.Geometry.MultiLineString")||(b=="OpenLayers.Geometry.MultiPolygon")){for(var a=0;a<d.components.length;a++){this.drawGeometry(d.components[a],c)}return}switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(d,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(d,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(d,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(d,c);break;default:break}},drawExternalGraphic:function(g,f){var b=new Image();if(f.graphicTitle){b.title=f.graphicTitle}var e=f.graphicWidth||f.graphicHeight;var a=f.graphicHeight||f.graphicWidth;e=e?e:f.pointRadius*2;a=a?a:f.pointRadius*2;var d=(f.graphicXOffset!=undefined)?f.graphicXOffset:-(0.5*e);var h=(f.graphicYOffset!=undefined)?f.graphicYOffset:-(0.5*a);var c={img:b,x:(g[0]+d),y:(g[1]+h),width:e,height:a,opacity:f.graphicOpacity||f.fillOpacity,canvas:this.canvas};b.onload=OpenLayers.Function.bind(function(){this.canvas.globalAlpha=this.opacity;this.canvas.drawImage(this.img,this.x,this.y,this.width,this.height)},c);b.src=f.externalGraphic},setCanvasStyle:function(b,a){if(b=="fill"){this.canvas.globalAlpha=a.fillOpacity;this.canvas.fillStyle=a.fillColor}else{if(b=="stroke"){this.canvas.globalAlpha=a.strokeOpacity;this.canvas.strokeStyle=a.strokeColor;this.canvas.lineWidth=a.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},drawPoint:function(c,a){if(a.graphic!==false){var b=this.getLocalXY(c);if(a.externalGraphic){this.drawExternalGraphic(b,a)}else{if(a.fill!==false){this.setCanvasStyle("fill",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],a.pointRadius,0,Math.PI*2,true);this.canvas.fill()}if(a.stroke!==false){this.setCanvasStyle("stroke",a);this.canvas.beginPath();this.canvas.arc(b[0],b[1],a.pointRadius,0,Math.PI*2,true);this.canvas.stroke();this.setCanvasStyle("reset")}}}},drawLineString:function(d,b){if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var e=this.getLocalXY(d.components[0]);this.canvas.moveTo(e[0],e[1]);for(var a=1;a<d.components.length;a++){var c=this.getLocalXY(d.components[a]);this.canvas.lineTo(c[0],c[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawLinearRing:function(d,b){if(b.fill!==false){this.setCanvasStyle("fill",b);this.canvas.beginPath();var e=this.getLocalXY(d.components[0]);this.canvas.moveTo(e[0],e[1]);for(var a=1;a<d.components.length-1;a++){var c=this.getLocalXY(d.components[a]);this.canvas.lineTo(c[0],c[1])}this.canvas.fill()}if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.canvas.beginPath();var e=this.getLocalXY(d.components[0]);this.canvas.moveTo(e[0],e[1]);for(var a=1;a<d.components.length;a++){var c=this.getLocalXY(d.components[a]);this.canvas.lineTo(c[0],c[1])}this.canvas.stroke()}this.setCanvasStyle("reset")},drawPolygon:function(c,b){this.drawLinearRing(c.components[0],b);for(var a=1;a<c.components.length;a++){this.drawLinearRing(c.components[a],{fillOpacity:0,strokeWidth:0,strokeOpacity:0,strokeColor:"#000000",fillColor:"#000000"})}},drawText:function(b,d){d=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},d);var e=this.getLocalXY(b);this.setCanvasStyle("reset");this.canvas.fillStyle=d.fontColor;this.canvas.globalAlpha=d.fontOpacity||1;var f=d.fontWeight+" "+d.fontSize+" "+d.fontFamily;if(this.canvas.fillText){var c=OpenLayers.Renderer.Canvas.LABEL_ALIGN[d.labelAlign[0]]||"center";this.canvas.font=f;this.canvas.textAlign=c;this.canvas.fillText(d.label,e[0],e[1])}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=f;var a=this.canvas.mozMeasureText(d.label);switch(d.labelAlign[0]){case"l":break;case"r":e[0]-=a;break;case"c":default:e[0]-=a/2}this.canvas.translate(e[0],e[1]);this.canvas.mozDrawText(d.label);this.canvas.translate(-1*e[0],-1*e[1])}}this.setCanvasStyle("reset")},getLocalXY:function(b){var c=this.getResolution();var d=this.extent;var a=(b.x/c+(-d.left/c));var e=((d.top/c)-b.y/c);return[a,e]},clear:function(){this.canvas.clearRect(0,0,this.root.width,this.root.height);this.features={}},getFeatureIdFromEvent:function(a){var f=this.map.getLonLatFromPixel(a.xy);var b=this.getResolution();var e=new OpenLayers.Bounds(f.lon-b*5,f.lat-b*5,f.lon+b*5,f.lat+b*5);var c=e.toGeometry();for(var d in this.features){if(!this.features.hasOwnProperty(d)){continue}if(this.features[d][0].geometry.intersects(c)){return d}}return null},eraseFeatures:function(b){if(!(b instanceof Array)){b=[b]}for(var a=0;a<b.length;++a){delete this.features[b[a].id]}this.redraw()},redraw:function(){if(!this.locked){this.canvas.clearRect(0,0,this.root.width,this.root.height);var f=[];var c,d;for(var g in this.features){if(!this.features.hasOwnProperty(g)){continue}c=this.features[g][0];d=this.features[g][1];if(!c.geometry){continue}this.drawGeometry(c.geometry,d);if(d.label){f.push([c,d])}}var e;for(var b=0,a=f.length;b<a;++b){e=f[b];this.drawText(e[0].geometry.getCentroid(),e[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right"};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.order=[];this.indices={};this.maxZIndex=0},insert:function(c){if(this.exists(c)){this.remove(c)}var f=c.id;this.determineZIndex(c);var d=-1;var e=this.order.length;var a;while(e-d>1){a=parseInt((d+e)/2);var b=this.compare(this,c,OpenLayers.Util.getElement(this.order[a]));if(b>0){d=a}else{e=a}}this.order.splice(e,0,f);this.indices[f]=this.getZIndex(c);return this.getNextElement(e)},remove:function(b){var d=b.id;var a=OpenLayers.Util.indexOf(this.order,d);if(a>=0){this.order.splice(a,1);delete this.indices[d];if(this.order.length>0){var c=this.order[this.order.length-1];this.maxZIndex=this.indices[c]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(a){return(this.indices[a.id]!=null)},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;if(b==null){b=this.maxZIndex;a._style.graphicZIndex=b}else{if(b>this.maxZIndex){this.maxZIndex=b}}},getNextElement:function(b){var a=b+1;if(a<this.order.length){var c=OpenLayers.Util.getElement(this.order[a]);if(c==undefined){c=this.getNextElement(a)}return c}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,d,b){var a=e.getZIndex(d);var f=0;if(b){var c=e.getZIndex(b);f=a-c}return f},Z_ORDER_DRAWING_ORDER:function(c,b,a){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(c,b,a);if(a&&d==0){d=1}return d},Z_ORDER_Y_ORDER:function(d,c,b){var e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,c,b);if(b&&e===0){var a=b._boundsBottom-c._boundsBottom;e=(a===0)?1:a}return e}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(b&&(b.zIndexing||b.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var b;var a=this.vectorRoot;if(a){while(b=a.firstChild){a.removeChild(b)}}a=this.textRoot;if(a){while(b=a.firstChild){a.removeChild(b)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(b,a){},drawGeometry:function(g,d,f){var c=g.CLASS_NAME;var h=true;if((c=="OpenLayers.Geometry.Collection")||(c=="OpenLayers.Geometry.MultiPoint")||(c=="OpenLayers.Geometry.MultiLineString")||(c=="OpenLayers.Geometry.MultiPolygon")){for(var b=0,a=g.components.length;b<a;b++){h=this.drawGeometry(g.components[b],d,f)&&h}return h}h=false;if(d.display!="none"){if(d.backgroundGraphic){this.redrawBackgroundNode(g.id,g,d,f)}h=this.redrawNode(g.id,g,d,f)}if(h==false){var e=document.getElementById(g.id);if(e){if(e._style.backgroundGraphic){e.parentNode.removeChild(document.getElementById(g.id+this.BACKGROUND_ID_SUFFIX))}e.parentNode.removeChild(e)}}return h},redrawNode:function(g,f,b,e){b=this.applyDefaultSymbolizer(b);var c=this.nodeFactory(g,this.getNodeType(f,b));c._featureId=e;c._boundsBottom=f.getBounds().bottom;c._geometryClass=f.CLASS_NAME;c._style=b;var a=this.drawGeometryNode(c,f,b);if(a===false){return false}c=a.node;if(this.indexer){var d=this.indexer.insert(c);if(d){this.vectorRoot.insertBefore(c,d)}else{this.vectorRoot.appendChild(c)}}else{if(c.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(c)}}this.postDraw(c);return a.complete},redrawBackgroundNode:function(e,d,b,c){var a=OpenLayers.Util.extend({},b);a.externalGraphic=a.backgroundGraphic;a.graphicXOffset=a.backgroundXOffset;a.graphicYOffset=a.backgroundYOffset;a.graphicZIndex=a.backgroundGraphicZIndex;a.graphicWidth=a.backgroundWidth||a.graphicWidth;a.graphicHeight=a.backgroundHeight||a.graphicHeight;a.backgroundGraphic=null;a.backgroundXOffset=null;a.backgroundYOffset=null;a.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,d,a,null)},drawGeometryNode:function(c,e,b){b=b||c._style;var a={isFilled:b.fill===undefined?true:b.fill,isStroked:b.stroke===undefined?!!b.strokeWidth:b.stroke};var d;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.graphic===false){a.isFilled=false;a.isStroked=false}d=this.drawPoint(c,e);break;case"OpenLayers.Geometry.LineString":a.isFilled=false;d=this.drawLineString(c,e);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(c,e);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(c,e);break;case"OpenLayers.Geometry.Surface":d=this.drawSurface(c,e);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(c,e);break;default:break}c._options=a;if(d!=false){return{node:this.setStyle(c,b,a,e),complete:d}}else{return false}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},drawSurface:function(a,b){},removeText:function(b){var a=document.getElementById(b+this.LABEL_ID_SUFFIX);if(a){this.textRoot.removeChild(a)}},getFeatureIdFromEvent:function(a){var d=a.target;var b=d&&d.correspondingUseElement;var c=b?b:(d||a.srcElement);var e=c._featureId;return e},eraseGeometry:function(g,f){if((g.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(g.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(g.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(g.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var d=0,a=g.components.length;d<a;d++){this.eraseGeometry(g.components[d],f)}}else{var c=OpenLayers.Util.getElement(g.id);if(c&&c.parentNode){if(c.geometry){c.geometry.destroy();c.geometry=null}c.parentNode.removeChild(c);if(this.indexer){this.indexer.remove(c)}if(c._style.backgroundGraphic){var b=g.id+this.BACKGROUND_ID_SUFFIX;var e=OpenLayers.Util.getElement(b);if(e&&e.parentNode){e.parentNode.removeChild(e)}}}}},nodeFactory:function(c,a){var b=OpenLayers.Util.getElement(c);if(b){if(!this.nodeTypeCompare(b,a)){b.parentNode.removeChild(b);b=this.nodeFactory(c,a)}}else{b=this.createNode(a,c)}return b},nodeTypeCompare:function(b,a){},createNode:function(a,b){},moveRoot:function(b){var a=this.root;if(b.root.parentNode==this.rendererRoot){a=b.root}a.parentNode.removeChild(a);b.rendererRoot.appendChild(a)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return(a!="circle")&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return a},cacheFeatures:function(b){var a=true;if(!this.clustering){this.clearCache();this.features=b.features;this.cluster();a=false}return a},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var c=this.layer.map.getResolution();if(c!=this.resolution||!this.clustersExist()){this.resolution=c;var h=[];var m,b,k;for(var e=0;e<this.features.length;++e){m=this.features[e];if(m.geometry){b=false;for(var d=h.length-1;d>=0;--d){k=h[d];if(this.shouldCluster(k,m)){this.addToCluster(k,m);b=true;break}}if(!b){h.push(this.createCluster(this.features[e]))}}}this.layer.removeAllFeatures();if(h.length>0){if(this.threshold>1){var g=h.slice();h=[];var l;for(var e=0,f=g.length;e<f;++e){l=g[e];if(l.attributes.count<this.threshold){Array.prototype.push.apply(h,l.cluster)}else{h.push(l)}}}this.clustering=true;this.layer.addFeatures(h);this.clustering=false}this.clusters=h}}},clustersExist:function(){var b=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){b=true;for(var a=0;a<this.clusters.length;++a){if(this.clusters[a]!=this.layer.features[a]){b=false;break}}}return b},shouldCluster:function(a,b){var e=a.geometry.getBounds().getCenterLonLat();var c=b.geometry.getBounds().getCenterLonLat();var d=(Math.sqrt(Math.pow((e.lon-c.lon),2)+Math.pow((e.lat-c.lat),2))/this.resolution);return(d<=this.distance)},addToCluster:function(a,b){a.cluster.push(b);a.attributes.count+=1},createCluster:function(c){var b=c.geometry.getBounds().getCenterLonLat();var a=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});a.cluster=[c];return a},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},destroy:function(){OpenLayers.Strategy.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return a},load:function(a){this.layer.events.triggerEvent("loadstart");this.layer.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:this.layer.filter,scope:this},a));this.layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(g){this.layer.destroyFeatures();var e=g.features;if(e&&e.length>0){var f=this.layer.projection;var d=this.layer.map.getProjectionObject();if(!d.equals(f)){var c;for(var b=0,a=e.length;b<a;++b){c=e[b].geometry;if(c){c.transform(f,d)}}}this.layer.addFeatures(e)}this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})}return a},cacheFeatures:function(a){if(!this.paging){this.clearCache();this.features=a.features;this.pageNext(a)}},clearCache:function(){if(this.features){for(var a=0;a<this.features.length;++a){this.features[a].destroy()}}this.features=null;this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){if(a&&a>0){this.length=a}return this.length},pageNext:function(a){var b=false;if(this.features){if(this.num===null){this.num=-1}var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=false;if(this.features){if(this.num===null){this.num=this.pageCount()}var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(e,c){var d=false;if(this.features){if(e>=0&&e<this.features.length){var a=Math.floor(e/this.length);if(a!=this.num){this.paging=true;var b=this.features.slice(e,e+this.length);this.layer.removeFeatures(this.layer.features);this.num=a;if(c&&c.features){c.features=b}else{this.layer.addFeatures(b)}this.paging=false;d=true}}}return d},CLASS_NAME:"OpenLayers.Strategy.Paging"});OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:false,interval:0,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){if(this.layer.visibility===true){this.start()}this.layer.events.on({visibilitychanged:this.reset,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.stop()}return a},reset:function(){if(this.layer.visibility===true){this.start()}else{this.stop()}},start:function(){if(this.interval&&typeof this.interval==="number"&&this.interval>0){this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval)}},refresh:function(){if(this.layer&&this.layer.refresh&&typeof this.layer.refresh=="function"){this.layer.refresh({force:this.force})}},stop:function(){if(this.timer!==null){window.clearInterval(this.timer);this.timer=null}},CLASS_NAME:"OpenLayers.Strategy.Refresh"});OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{EVENT_TYPES:["start","success","fail"],events:null,auto:false,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),this.auto*1000)}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){if(this.auto){if(typeof this.auto==="number"){window.clearInterval(this.timer)}else{this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})}}}return a},triggerSave:function(b){var a=b.feature;if(a.state===OpenLayers.State.INSERT||a.state===OpenLayers.State.UPDATE||a.state===OpenLayers.State.DELETE){this.save([b.feature])}},save:function(d){if(!d){d=this.layer.features}this.events.triggerEvent("start",{features:d});var f=this.layer.projection;var c=this.layer.map.getProjectionObject();if(!c.equals(f)){var a=d.length;var e=new Array(a);var h,g;for(var b=0;b<a;++b){h=d[b];g=h.clone();g.fid=h.fid;g.state=h.state;if(h.url){g.url=h.url}g._original=h;g.geometry.transform(c,f);e[b]=g}d=e}this.layer.protocol.commit(d,{callback:this.onCommit,scope:this})},onCommit:function(d){var k={response:d};if(d.success()){var b=d.reqFeatures;var a,l;var c=[];var h=d.insertIds||[];var e=0;for(var f=0,g=b.length;f<g;++f){l=b[f];l=l._original||l;a=l.state;if(a){if(a==OpenLayers.State.DELETE){c.push(l)}else{if(a==OpenLayers.State.INSERT){l.fid=h[e];++e}}l.state=null}}if(c.length>0){this.layer.destroyFeatures(c)}this.events.triggerEvent("success",k)}else{this.events.triggerEvent("fail",k)}},CLASS_NAME:"OpenLayers.Strategy.Save"});OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{strokeColor:null,strokeOpacity:null,strokeWidth:null,strokeLinecap:null,strokeDashstyle:null,initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"});OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{strokeColor:null,strokeOpacity:null,strokeWidth:null,strokeLinecap:null,strokeDashstyle:null,fillColor:null,fillOpacity:null,pointRadius:null,externalGraphic:null,graphicWidth:null,graphicHeight:null,graphicOpacity:null,graphicXOffset:null,graphicYOffset:null,rotation:null,graphicName:null,initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"});OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{strokeColor:null,strokeOpacity:null,strokeWidth:null,strokeLinecap:null,strokeDashstyle:null,fillColor:null,fillOpacity:null,initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{label:null,fontFamily:null,fontSize:null,fontWeight:null,fontStyle:null,initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"});OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(a){this.easing=(a)?a:OpenLayers.Easing.Expo.easeOut},start:function(c,b,d,a){this.playing=true;this.begin=c;this.finish=b;this.duration=d;this.callbacks=a.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var g={};for(var d in this.begin){var a=this.begin[d];var e=this.finish[d];if(a==null||e==null||isNaN(a)||isNaN(e)){OpenLayers.Console.error("invalid value for Tween")}var h=e-a;g[d]=this.easing.apply(this,[this.time,a,h,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,g)}if(this.time>this.duration){this.stop()}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,a,g,f){return g*e/f+a},easeOut:function(e,a,g,f){return g*e/f+a},easeInOut:function(e,a,g,f){return g*e/f+a},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a},easeOut:function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a},easeInOut:function(e,a,g,f){if(e==0){return a}if(e==f){return a+g}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a}return g/2*(-Math.pow(2,-10*--e)+2)+a},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,a,g,f){return g*(e/=f)*e+a},easeOut:function(e,a,g,f){return -g*(e/=f)*(e-2)+a},easeInOut:function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var c=0,a=this.map.controls.length;c<a;c++){var d=this.map.controls[c];if((d!=this)&&(d.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(d.displayProjection!=this.displayProjection){this.displayProjection=d.displayProjection}break}}if(c==this.map.controls.length){var b=OpenLayers.Util.getParameters();if(b.layers){this.layers=b.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(b.lat&&b.lon){this.center=new OpenLayers.LonLat(parseFloat(b.lon),parseFloat(b.lat));if(b.zoom){this.zoom=parseInt(b.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var d=0,a=this.layers.length;d<a;d++){var b=this.map.layers[d];var e=this.layers.charAt(d);if(e=="B"){this.map.setBaseLayer(b)}else{if((e=="T")||(e=="F")){b.setVisibility(e=="T")}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var d=[];if(this.map&&this.map.layers){for(var c=0,a=this.map.layers.length;c<a;c++){var b=this.map.layers[c];if(b.attribution&&b.getVisibility()){if(OpenLayers.Util.indexOf(d,b.attribution)===-1){d.push(b.attribution)}}}this.div.innerHTML=d.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:true,visible:true,numPoints:50,targetSize:200,layerName:null,labelled:true,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{};a.layerName=a.layerName||OpenLayers.i18n("graticule");OpenLayers.Control.prototype.initialize.apply(this,[a]);this.labelSymbolizer.stroke=false;this.labelSymbolizer.fill=false;this.labelSymbolizer.label="${label}";this.labelSymbolizer.labelAlign="${labelAlign}";this.labelSymbolizer.labelXOffset="${xOffset}";this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.gratLayer){this.gratLayer.destroy();this.gratLayer=null}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.gratLayer){var a=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.addLayer(this.gratLayer);this.map.events.register("moveend",this,this.update);this.update();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("moveend",this,this.update);this.map.removeLayer(this.gratLayer);return true}else{return false}},update:function(){var k=this.map.getExtent();if(!k){return}this.gratLayer.destroyFeatures();var l=new OpenLayers.Projection("EPSG:4326");var H=this.map.getProjectionObject();var g=this.map.getResolution();if(H.proj&&H.proj.projName=="longlat"){this.numPoints=1}var K=this.map.getCenter();var D=new OpenLayers.Pixel(K.lon,K.lat);OpenLayers.Projection.transform(D,H,l);var y=this.targetSize*g;y*=y;var q;for(var C=0;C<this.intervals.length;++C){q=this.intervals[C];var I=q/2;var d=D.offset(new OpenLayers.Pixel(-I,-I));var b=D.offset(new OpenLayers.Pixel(I,I));OpenLayers.Projection.transform(d,l,H);OpenLayers.Projection.transform(b,l,H);var e=(d.x-b.x)*(d.x-b.x)+(d.y-b.y)*(d.y-b.y);if(e<=y){break}}D.x=Math.floor(D.x/q)*q;D.y=Math.floor(D.y/q)*q;var B=0;var r=[D.clone()];var p=D.clone();var z;do{p=p.offset(new OpenLayers.Pixel(0,q));z=OpenLayers.Projection.transform(p.clone(),l,H);r.unshift(p)}while(k.containsPixel(z)&&++B<1000);p=D.clone();do{p=p.offset(new OpenLayers.Pixel(0,-q));z=OpenLayers.Projection.transform(p.clone(),l,H);r.push(p)}while(k.containsPixel(z)&&++B<1000);B=0;var w=[D.clone()];p=D.clone();do{p=p.offset(new OpenLayers.Pixel(-q,0));z=OpenLayers.Projection.transform(p.clone(),l,H);w.unshift(p)}while(k.containsPixel(z)&&++B<1000);p=D.clone();do{p=p.offset(new OpenLayers.Pixel(q,0));z=OpenLayers.Projection.transform(p.clone(),l,H);w.push(p)}while(k.containsPixel(z)&&++B<1000);var a=[];for(var C=0;C<w.length;++C){var f=w[C].x;var v=[];var J=null;var E=Math.min(r[0].y,90);var o=Math.max(r[r.length-1].y,-90);var c=(E-o)/this.numPoints;var h=o;for(var A=0;A<=this.numPoints;++A){var F=new OpenLayers.Geometry.Point(f,h);F.transform(l,H);v.push(F);h+=c;if(F.y>=k.bottom&&!J){J=F}}if(this.labelled){var t=new OpenLayers.Geometry.Point(J.x,k.bottom);var G={value:f,label:this.labelled?OpenLayers.Util.getFormattedLonLat(f,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(t,G))}var u=new OpenLayers.Geometry.LineString(v);a.push(new OpenLayers.Feature.Vector(u))}for(var A=0;A<r.length;++A){h=r[A].y;if(h<-90||h>90){continue}var v=[];var x=w[0].x;var s=w[w.length-1].x;var m=(s-x)/this.numPoints;var f=x;var J=null;for(var C=0;C<=this.numPoints;++C){var F=new OpenLayers.Geometry.Point(f,h);F.transform(l,H);v.push(F);f+=m;if(F.x<k.right){J=F}}if(this.labelled){var t=new OpenLayers.Geometry.Point(k.right,J.y);var G={value:h,label:this.labelled?OpenLayers.Util.getFormattedLonLat(h,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(t,G))}var u=new OpenLayers.Geometry.LineString(v);a.push(new OpenLayers.Feature.Vector(u))}this.gratLayer.addFeatures(a)},CLASS_NAME:"OpenLayers.Control.Graticule"});OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:true,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.layerStates=[]},destroy:function(){OpenLayers.Event.stopObservingElement(this.div);OpenLayers.Event.stopObservingElement(this.minimizeDiv);OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.clearLayersArray("base");this.clearLayersArray("data");this.map.events.un({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},draw:function(){OpenLayers.Control.prototype.draw.apply(this);this.loadContents();if(!this.outsideViewport){this.minimizeControl()}this.redraw();return this.div},clearLayersArray:function(d){var e=this[d+"Layers"];if(e){for(var c=0,a=e.length;c<a;c++){var b=e[c];OpenLayers.Event.stopObservingElement(b.inputElem);OpenLayers.Event.stopObservingElement(b.labelSpan)}}this[d+"LayersDiv"].innerHTML="";this[d+"Layers"]=[]},checkRedraw:function(){var e=false;if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){e=true}else{for(var c=0,a=this.layerStates.length;c<a;c++){var d=this.layerStates[c];var b=this.map.layers[c];if((d.name!=b.name)||(d.inRange!=b.inRange)||(d.id!=b.id)||(d.visibility!=b.visibility)){e=true;break}}}return e},redraw:function(){if(!this.checkRedraw()){return this.div}this.clearLayersArray("base");this.clearLayersArray("data");var d=false;var m=false;var h=this.map.layers.length;this.layerStates=new Array(h);for(var f=0;f<h;f++){var g=this.map.layers[f];this.layerStates[f]={name:g.name,visibility:g.visibility,inRange:g.inRange,id:g.id}}var e=this.map.layers.slice();if(!this.ascending){e.reverse()}for(var f=0,h=e.length;f<h;f++){var g=e[f];var j=g.isBaseLayer;if(g.displayInLayerSwitcher){if(j){m=true}else{d=true}var l=(j)?(g==this.map.baseLayer):g.getVisibility();var k=document.createElement("input");k.id=this.id+"_input_"+g.name;k.name=(j)?this.id+"_baseLayers":g.name;k.type=(j)?"radio":"checkbox";k.value=g.name;k.checked=l;k.defaultChecked=l;if(!j&&!g.inRange){k.disabled=true}var a={inputElem:k,layer:g,layerSwitcher:this};OpenLayers.Event.observe(k,"mouseup",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var b=document.createElement("span");OpenLayers.Element.addClass(b,"labelSpan");if(!j&&!g.inRange){b.style.color="gray"}b.innerHTML=g.name;b.style.verticalAlign=(j)?"bottom":"baseline";OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.onInputClick,a));var p=document.createElement("br");var o=(j)?this.baseLayers:this.dataLayers;o.push({layer:g,inputElem:k,labelSpan:b});var c=(j)?this.baseLayersDiv:this.dataLayersDiv;c.appendChild(k);c.appendChild(b);c.appendChild(p)}}this.dataLbl.style.display=(d)?"":"none";this.baseLbl.style.display=(m)?"":"none";return this.div},onInputClick:function(a){if(!this.inputElem.disabled){if(this.inputElem.type=="radio"){this.inputElem.checked=true;this.layer.map.setBaseLayer(this.layer)}else{this.inputElem.checked=!this.inputElem.checked;this.layerSwitcher.updateMap()}}OpenLayers.Event.stop(a)},onLayerClick:function(a){this.updateMap()},updateMap:function(){for(var b=0,a=this.baseLayers.length;b<a;b++){var c=this.baseLayers[b];if(c.inputElem.checked){this.map.setBaseLayer(c.layer,false)}}for(var b=0,a=this.dataLayers.length;b<a;b++){var c=this.dataLayers[b];c.layer.setVisibility(c.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="";this.div.style.height="";this.showControls(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.div.style.width="0px";this.div.style.height="0px";this.showControls(true);if(a!=null){OpenLayers.Event.stop(a)}},showControls:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":"";this.layersDiv.style.display=a?"none":""},loadContents:function(){OpenLayers.Event.observe(this.div,"mouseup",OpenLayers.Function.bindAsEventListener(this.mouseUp,this));OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);OpenLayers.Event.observe(this.div,"mousedown",OpenLayers.Function.bindAsEventListener(this.mouseDown,this));OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);this.layersDiv=document.createElement("div");this.layersDiv.id=this.id+"_layersDiv";OpenLayers.Element.addClass(this.layersDiv,"layersDiv");this.baseLbl=document.createElement("div");this.baseLbl.innerHTML=OpenLayers.i18n("baseLayer");OpenLayers.Element.addClass(this.baseLbl,"baseLbl");this.baseLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");this.dataLbl=document.createElement("div");this.dataLbl.innerHTML=OpenLayers.i18n("overlays");OpenLayers.Element.addClass(this.dataLbl,"dataLbl");this.dataLayersDiv=document.createElement("div");OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");if(this.ascending){this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv);this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv)}else{this.layersDiv.appendChild(this.dataLbl);this.layersDiv.appendChild(this.dataLayersDiv);this.layersDiv.appendChild(this.baseLbl);this.layersDiv.appendChild(this.baseLayersDiv)}this.div.appendChild(this.layersDiv);if(this.roundedCorner){OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:false});OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75)}var c=OpenLayers.Util.getImagesLocation();var b=new OpenLayers.Size(18,18);var a=c+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,b,a,"absolute");OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv");this.maximizeDiv.style.display="none";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var a=c+"layer-switcher-minimize.png";var b=new OpenLayers.Size(18,18);this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,b,a,"absolute");OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv");this.minimizeDiv.style.display="none";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv)},ignoreEvent:function(a){OpenLayers.Event.stop(a)},mouseDown:function(a){this.isMouseDown=true;this.ignoreEvent(a)},mouseUp:function(a){if(this.isMouseDown){this.isMouseDown=false;this.ignoreEvent(a)}},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});OpenLayers.Control.MouseDefaults=OpenLayers.Class(OpenLayers.Control,{performedDrag:false,wheelObserver:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;this.map.events.un({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});OpenLayers.Event.stopObserving(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.stopObserving(window,"mousewheel",this.wheelObserver);OpenLayers.Event.stopObserving(document,"mousewheel",this.wheelObserver);this.wheelObserver=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.map.events.on({click:this.defaultClick,dblclick:this.defaultDblClick,mousedown:this.defaultMouseDown,mouseup:this.defaultMouseUp,mousemove:this.defaultMouseMove,mouseout:this.defaultMouseOut,scope:this});this.registerWheelEvents()},registerWheelEvents:function(){this.wheelObserver=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this);OpenLayers.Event.observe(window,"DOMMouseScroll",this.wheelObserver);OpenLayers.Event.observe(window,"mousewheel",this.wheelObserver);OpenLayers.Event.observe(document,"mousewheel",this.wheelObserver)},defaultClick:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}var a=!this.performedDrag;this.performedDrag=false;return a},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;if(a.shiftKey){this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox)}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a)},defaultMouseMove:function(e){this.mousePosition=e.xy.clone();if(this.mouseDragStart!=null){if(this.zoomBox){var d=Math.abs(this.mouseDragStart.x-e.xy.x);var b=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,d)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(e.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=e.xy.x+"px"}if(e.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=e.xy.y+"px"}}else{var d=this.mouseDragStart.x-e.xy.x;var b=this.mouseDragStart.y-e.xy.y;var f=this.map.getSize();var a=new OpenLayers.Pixel(f.w/2+d,f.h/2+b);var c=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(c,null,true);this.mouseDragStart=e.xy.clone();this.map.div.style.cursor="move"}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.zoomBox){this.zoomBoxEnd(a)}else{if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor=""},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox()}this.mouseDragStart=null}},defaultWheelUp:function(a){if(this.map.getZoom()<=this.map.getNumZoomLevels()){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()+1)}},defaultWheelDown:function(a){if(this.map.getZoom()>0){this.map.setCenter(this.map.getLonLatFromPixel(a.xy),this.map.getZoom()-1)}},zoomBoxEnd:function(b){if(this.mouseDragStart!=null){if(Math.abs(this.mouseDragStart.x-b.xy.x)>5||Math.abs(this.mouseDragStart.y-b.xy.y)>5){var h=this.map.getLonLatFromViewPortPx(this.mouseDragStart);var a=this.map.getLonLatFromViewPortPx(b.xy);var g=Math.max(h.lat,a.lat);var c=Math.min(h.lat,a.lat);var f=Math.min(h.lon,a.lon);var d=Math.max(h.lon,a.lon);var e=new OpenLayers.Bounds(f,c,d,g);this.map.zoomToExtent(e)}else{var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(new OpenLayers.LonLat((a.lon),(a.lat)),this.map.getZoom()+1)}this.removeZoomBox()}},removeZoomBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null},onWheelEvent:function(c){var b=false;var a=OpenLayers.Event.element(c);while(a!=null){if(this.map&&a==this.map.div){b=true;break}a=a.parentNode}if(b){var d=0;if(!c){c=window.event}if(c.wheelDelta){d=c.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){d=-d}}else{if(c.detail){d=-c.detail/3}}if(d){c.xy=this.mousePosition;if(d<0){this.defaultWheelDown(c)}else{this.defaultWheelUp(c)}}OpenLayers.Event.stop(c)}},CLASS_NAME:"OpenLayers.Control.MouseDefaults"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}return this.div},redraw:function(a){var c;if(a==null){this.reset();return}else{if(this.lastXy==null||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity){this.lastXy=a.xy;return}c=this.map.getLonLatFromPixel(a.xy);if(!c){return}if(this.displayProjection){c.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=a.xy}var b=this.formatOutput(c);if(b!=this.element.innerHTML){this.element.innerHTML=b}},reset:function(a){if(this.emptyString!=null){this.element.innerHTML=this.emptyString}},formatOutput:function(b){var c=parseInt(this.numDigits);var a=this.prefix+b.lon.toFixed(c)+this.separator+b.lat.toFixed(c)+this.suffix;return a},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(b,a){this.direction=b;this.CLASS_NAME+=this.direction;OpenLayers.Control.prototype.initialize.apply(this,[a])},trigger:function(){switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,this.slideFactor);break;case OpenLayers.Control.Pan.WEST:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(this.slideFactor,0);break}},CLASS_NAME:"OpenLayers.Control.Pan"});OpenLayers.Control.Pan.NORTH="North";OpenLayers.Control.Pan.SOUTH="South";OpenLayers.Control.Pan.EAST="East";OpenLayers.Control.Pan.WEST="West";OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);this.removeButtons();this.buttons=null;this.position=null},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position;this.buttons=[];var c=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+c.w/2,b.y);this._addButton("panup","north-mini.png",a,c);b.y=a.y+c.h;this._addButton("panleft","west-mini.png",b,c);this._addButton("panright","east-mini.png",b.add(c.w,0),c);this._addButton("pandown","south-mini.png",a.add(0,c.h*2),c);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,c.h*3+5),c);this._addButton("zoomworld","zoom-world-mini.png",a.add(0,c.h*4+5),c);this._addButton("zoomout","zoom-minus-mini.png",a.add(0,c.h*5+5),c);return this.div},_addButton:function(a,d,j,g){var f=OpenLayers.Util.getImagesLocation()+d;var b=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,j,g,f,"absolute");this.div.appendChild(b);OpenLayers.Event.observe(b,"mousedown",OpenLayers.Function.bindAsEventListener(this.buttonDown,b));OpenLayers.Event.observe(b,"dblclick",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bindAsEventListener(this.doubleClick,b));b.action=a;b.map=this.map;if(!this.slideRatio){var c=this.slideFactor;var e=function(){return c}}else{var h=this.slideRatio;var e=function(k){return this.map.getSize()[k]*h}}b.getSlideFactor=e;this.buttons.push(b);return b},_removeButton:function(a){OpenLayers.Event.stopObservingElement(a);a.map=null;a.getSlideFactor=null;this.div.removeChild(a);OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a){this._removeButton(this.buttons[a])}},doubleClick:function(a){OpenLayers.Event.stop(a);return false},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent();break}OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.controls=[];this.activeState={}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a=this.controls.length-1;a>=0;a--){if(this.controls[a].events){this.controls[a].events.un({activate:this.redraw,deactivate:this.redraw,scope:this})}OpenLayers.Event.stopObservingElement(this.controls[a].panel_div);this.controls[a].panel_div=null}this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){var c;for(var b=0,a=this.controls.length;b<a;b++){c=this.controls[b];if(c===this.defaultControl||(this.saveState&&this.activeState[c.id])){c.activate()}}if(this.saveState===true){this.defaultControl=null}this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){var c;for(var b=0,a=this.controls.length;b<a;b++){c=this.controls[b];this.activeState[c.id]=c.deactivate()}return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.addControlsToMap(this.controls);return this.div},redraw:function(){if(this.div.children.length>0){for(var b=this.div.children.length,d=b-1;d>=0;d--){this.div.removeChild(this.div.children[d])}}this.div.innerHTML="";if(this.active){for(var d=0,a=this.controls.length;d<a;d++){var c=this.controls[d].panel_div;if(this.controls[d].active){c.className=this.controls[d].displayClass+"ItemActive"}else{c.className=this.controls[d].displayClass+"ItemInactive"}this.div.appendChild(c)}}},activateControl:function(d){if(!this.active){return false}if(d.type==OpenLayers.Control.TYPE_BUTTON){d.trigger();this.redraw();return}if(d.type==OpenLayers.Control.TYPE_TOGGLE){if(d.active){d.deactivate()}else{d.activate()}this.redraw();return}var e;for(var b=0,a=this.controls.length;b<a;b++){e=this.controls[b];if(e!=d&&(e.type===OpenLayers.Control.TYPE_TOOL||e.type==null)){e.deactivate()}}d.activate()},addControls:function(b){if(!(b instanceof Array)){b=[b]}this.controls=this.controls.concat(b);for(var d=0,a=b.length;d<a;d++){var c=document.createElement("div");b[d].panel_div=c;if(b[d].title!=""){b[d].panel_div.title=b[d].title}OpenLayers.Event.observe(b[d].panel_div,"click",OpenLayers.Function.bind(this.onClick,this,b[d]));OpenLayers.Event.observe(b[d].panel_div,"dblclick",OpenLayers.Function.bind(this.onDoubleClick,this,b[d]));OpenLayers.Event.observe(b[d].panel_div,"mousedown",OpenLayers.Function.bindAsEventListener(OpenLayers.Event.stop))}if(this.map){this.addControlsToMap(b);this.redraw()}},addControlsToMap:function(b){var d;for(var c=0,a=b.length;c<a;c++){d=b[c];if(d.autoActivate===true){d.autoActivate=false;this.map.addControl(d);d.autoActivate=true}else{this.map.addControl(d);d.deactivate()}d.events.on({activate:this.redraw,deactivate:this.redraw,scope:this})}},onClick:function(b,a){OpenLayers.Event.stop(a?a:window.event);this.activateControl(b)},onDoubleClick:function(b,a){OpenLayers.Event.stop(a?a:window.event)},getControlsBy:function(c,a){var d=(typeof a.test=="function");var b=OpenLayers.Array.filter(this.controls,function(e){return e[c]==a||(d&&a.test(e[c]))});return b},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"});OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.element=document.createElement("div");this.div.appendChild(this.element)}this.map.events.register("moveend",this,this.updateScale);this.updateScale();return this.div},updateScale:function(){var c;if(this.geodesic===true){var a=this.map.getUnits();if(!a){return}var b=OpenLayers.INCHES_PER_UNIT;c=(this.map.getGeodesicPixelSize().w||0.000001)*b.km*OpenLayers.DOTS_PER_INCH}else{c=this.map.getScale()}if(!c){return}if(c>=9500&&c<=950000){c=Math.round(c/1000)+"K"}else{if(c>=950000){c=Math.round(c/1000000)+"M"}else{c=Math.round(c)}}this.element.innerHTML=OpenLayers.i18n("scale",{scaleDenom:c})},CLASS_NAME:"OpenLayers.Control.Scale"});OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";var a=this.topInUnits.length;this.div.appendChild(this.eTop);if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"}else{this.eTop.style.visibility="visible"}this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"}else{this.eBottom.style.visibility="visible"}}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(b){var d=parseInt(Math.log(b)/Math.log(10));var a=Math.pow(10,d);var c=parseInt(b/a);var e;if(c>5){e=5}else{if(c>2){e=2}else{e=1}}return e*a},update:function(){var k=this.map.getResolution();if(!k){return}var q=this.map.getUnits();var e=OpenLayers.INCHES_PER_UNIT;var m=this.maxWidth*k*e[q];var p=1;if(this.geodesic===true){var b=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;var f=m/e.km;p=b/f;m*=p}var a;var d;if(m>100000){a=this.topOutUnits;d=this.bottomOutUnits}else{a=this.topInUnits;d=this.bottomInUnits}var h=m/e[a];var l=m/e[d];var j=this.getBarLen(h);var g=this.getBarLen(l);h=j/e[q]*e[a];l=g/e[q]*e[d];var c=h/k/p;var o=l/k/p;if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(o)+"px";this.eBottom.innerHTML=g+" "+d}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(c)+"px";this.eTop.innerHTML=j+" "+a}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"});OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"});OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return(((a.which)&&(a.which==1))||((a.button)&&(a.button==1)))},isRightClick:function(a){return(((a.which)&&(a.which==3))||((a.button)&&(a.button==2)))},stop:function(b,a){if(!a){if(b.preventDefault){b.preventDefault()}else{b.returnValue=false}}if(b.stopPropagation){b.stopPropagation()}else{b.cancelBubble=true}},findElement:function(c,b){var a=OpenLayers.Event.element(c);while(a.parentNode&&(!a.tagName||(a.tagName.toUpperCase()!=b.toUpperCase()))){a=a.parentNode}return a},observe:function(b,d,c,a){var e=OpenLayers.Util.getElement(b);a=a||false;if(d=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)){d="keydown"}if(!this.observers){this.observers={}}if(!e._eventCacheID){var f="eventCacheID_";if(e.id){f=e.id+"_"+f}e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;if(!this.observers[g]){this.observers[g]=[]}this.observers[g].push({element:e,name:d,observer:c,useCapture:a});if(e.addEventListener){e.addEventListener(d,c,a)}else{if(e.attachEvent){e.attachEvent("on"+d,c)}}},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a);var c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(e){if(e){for(var b=e.length-1;b>=0;b--){var c=e[b];var a=new Array(c.element,c.name,c.observer,c.useCapture);var d=OpenLayers.Event.stopObserving.apply(this,a)}}},stopObserving:function(h,a,g,b){b=b||false;var f=OpenLayers.Util.getElement(h);var d=f._eventCacheID;if(a=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||f.detachEvent){a="keydown"}}var k=false;var c=OpenLayers.Event.observers[d];if(c){var e=0;while(!k&&e<c.length){var j=c[e];if((j.name==a)&&(j.observer==g)&&(j.useCapture==b)){c.splice(e,1);if(c.length==0){delete OpenLayers.Event.observers[d]}k=true;break}e++}}if(k){if(f.removeEventListener){f.removeEventListener(a,g,b)}else{if(f&&f.detachEvent){f.detachEvent("on"+a,g)}}}return k},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(c,e,g,f,b){OpenLayers.Util.extend(this,b);this.object=c;this.fallThrough=f;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(g!=null){for(var d=0,a=g.length;d<a;d++){this.addEventType(g[d])}}if(e!=null){this.attachToElement(e)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(a){if(!this.listeners[a]){this.eventTypes.push(a);this.listeners[a]=[]}},attachToElement:function(d){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=d;for(var c=0,a=this.BROWSER_EVENTS.length;c<a;c++){var b=this.BROWSER_EVENTS[c];this.addEventType(b);OpenLayers.Event.observe(d,b,this.eventHandler)}OpenLayers.Event.observe(d,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a){if(b!="scope"){this.register(b,a.scope,a[b])}}},register:function(b,d,c){if((c!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,b)!=-1)){if(d==null){d=this.object}var a=this.listeners[b];a.push({obj:d,func:c})}},registerPriority:function(b,d,c){if(c!=null){if(d==null){d=this.object}var a=this.listeners[b];if(a!=null){a.unshift({obj:d,func:c})}}},un:function(a){for(var b in a){if(b!="scope"){this.unregister(b,a.scope,a[b])}}},unregister:function(d,f,e){if(f==null){f=this.object}var c=this.listeners[d];if(c!=null){for(var b=0,a=c.length;b<a;b++){if(c[b].obj==f&&c[b].func==e){c.splice(b,1);break}}}},remove:function(a){if(this.listeners[a]!=null){this.listeners[a]=[]}},triggerEvent:function(e,b){var d=this.listeners[e];if(!d||d.length==0){return}if(b==null){b={}}b.object=this.object;b.element=this.element;if(!b.type){b.type=e}var d=d.slice(),f;for(var c=0,a=d.length;c<a;c++){var g=d[c];f=g.func.apply(g.obj,[b]);if((f!=undefined)&&(f==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(b,true)}return f},handleBrowserEvent:function(a){if(this.includeXY){a.xy=this.getMousePosition(a)}this.triggerEvent(a.type,a)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(a){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){this.element.scrolls=[(document.documentElement.scrollLeft||document.body.scrollLeft),(document.documentElement.scrollTop||document.body.scrollTop)]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element);this.element.offsets[0]+=this.element.scrolls[0];this.element.offsets[1]+=this.element.scrolls[1]}return new OpenLayers.Pixel((a.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(a.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},destroy:function(){},read:function(a){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(a){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Lang.ar=OpenLayers.Util.applyDefaults({permalink:"???????? ??????????",baseLayer:"???????????? ????????????????",readNotImplemented:"?????????????? ?????? ??????????.",writeNotImplemented:"?????????????? ?????? ??????????",errorLoadingGML:"?????? ?????? ?????????? ?????????? ???? ???? ???? ${url}",scale:"???????????? = 1 : ${scaleDenom}",W:"??",E:"????",N:"????",S:"??"});OpenLayers.Lang["be-tarask"]=OpenLayers.Util.applyDefaults({unhandledRequest:"???????????????????????? ?????????? ???????????? ${statusText}",permalink:"???????????? ????????????????",overlays:"????????",baseLayer:"???????????? ????????",sameProjection:"???????????????? ???????? ???????????? ???????????? ???????? ?????? ?????? ?????? ?? ????????????????, ?????? ?? ???????????????? ????????",readNotImplemented:"?????????????????????????????????? ???????????????? ???? ??????????????????.",writeNotImplemented:"?????????????????????????????????? ???????????? ???? ??????????????????.",noFID:"?????????????????? ???????????????? ??????????????????????, ?????? ?????????? ???? ?????????? FID.",errorLoadingGML:"?????????????? ???????????????? ?????????? GML ${url}",browserNotSupported:"?????? ?????????????? ???? ???????????????????????? ?????????????????? ??????????????. ?? ?????????????????? ???????????? ??????????????????????????????: ${renderers}",componentShouldBe:"addFeatures : ?????????????????? ?????????????? ???????? ${geomType}",getFeatureError:"getFeatureFromEvent ?????????????????? ?????? ???????? ?????? ??????????????. ???????????????? ???????? ??????????????, ?????? ???? ?????????????????? ????????, ?????? ???????????????? ???????????????? ???? ???? ??????????????????????.",minZoomLevelError:"?????????????????????????? minZoomLevel ???????????????????? ???????????? ?????? ?????????????????????????? ???? ???????????? ???????????????????? ???? FixedZoomLevels. ??????, ??????  ???????? wfs-???????? ?????????????????????? ???? minZoomLevel ??? ???????? ????????????????. ?????? ???? ???? ?????????? ???????????????? ?????????? ??????????????????????, ???????? ?????? ???? ???? ???????????????? ?????????????????? ???????????????????? ???? OL ??????????????????????????. ?????? ???? ????????, ???????????????? minZoomLevel ?????????? ?????????????????? ?? ???????????? 3.0. ???????? ??????????, ?????????????????????????????? ???????????? ???? ?????????????????? ????????????????????????/?????????????????????????? ??????????????, ???? ?????????????? ??????: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-????????????????????: ?????????????? ${response}",commitFailed:"WFS-????????????????????: ?????????????? ${response}",googleWarning:"???? ???????????????????? ?????????????????? ???????? Google. \x3cbr\x3e\x3cbr\x3e?????? ???????????????????? ???????????? ??????????????????????????, ???????????????? ???????? ???????????? ???????? ?? ???????????? ?? ?????????????? ???????????? ????????.\x3cbr\x3e\x3cbr\x3e ???????????? ???? ??????, ?????????????? ?? ??????, ?????? ???????????? ???????????????????? Google Maps ???? ?????? ?????????????????? ?????????? ???? ???????????????????? ???????????? API-???????? ?????? ???????????? ??????????.\x3cbr\x3e\x3cbr\x3e??????????????????????????????: ?????? ????????, ?????? ?????????????????? ???? ?????????????? ??????, ?????? ?????? ??????????????????, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3e???????????????????? ??????\x3c/a\x3e",getLayerWarning:"?????????????????? ?????????????????? ???????? ${layerType}.\x3cbr\x3e\x3cbr\x3e?????? ???????????????????? ???????????? ??????????????????????????, ???????????????? ???????? ???????????? ???????? ?? ???????????? ?? ?????????????? ???????????? ????????.\x3cbr\x3e\x3cbr\x3e???????????? ???? ??????, ?????????????? ?? ??????, ?????? ???????????? ???????????????????? ${layerLib} ???? ?????? ???????????? ????????????????.\x3cbr\x3e\x3cbr\x3e??????????????????????????????: ?????? ????????, ?????? ?????????????????? ???? ?????????????? ??????, ?????? ?????? ??????????????????, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3e???????????????????? ??????\x3c/a\x3e",scale:"???????????? = 1 : ${scaleDenom}",W:"??",E:"??",N:"????",S:"????",layerAlreadyAdded:"???? ???????????????????????? ???????????? ???????? ${layerName} ???? ????????, ?????? ???? ?????? ??????????????????",reprojectDeprecated:"???? ?????????????????????????????? ?????????????????? 'reproject' ?????? ???????? ${layerName}. ?????????? ?????????????????? ???????????????????? ????????????????????: ?????? ???????????????????????????????? ?????? ?????????????????? ???????????? ???????????????? ???? ?????????????????????? ?????????????? ??????????, ?????? ???????? ?????????????? ?????????? ???????????????????????? ?? ???????????????????? ?????????????????? ?????????????????? ???????????????? ??????????????????. ???????????????????? ???????????????????? ?????????? ???? http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"???????? ?????????? ?????????????????? ?? ?????????? ???????????????? ?? ???????????? 3.0. ???????? ??????????, ???????????? ?????? ?????????????????????????????? ${newMethod}.",boundsAddError:"?????? ?????????????????? ???????????? ???????????? ?????????????????? x ?? y ?????? ?????????????? ????????????????????.",lonlatAddError:"?????? ?????????????????? ???????????? ???????????? ?????????????????? lon ?? lat ?????? ?????????????? ????????????????????.",pixelAddError:"?????? ?????????????????? ???????????? ???????????? ?????????????????? x ?? y ?????? ?????????????? ????????????????????.",unsupportedGeometryType:"?????? ?????????????????? ???? ??????????????????????????????: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: ?????????????????? ?????????????? ?? ?????????????????????????????? ${elemId} ???????????? ?????????????????? ??????????.",filterEvaluateNotImplemented:"evaluate ???? ?????????????????????? ?????? ???????????? ???????? ??????????????."});OpenLayers.Lang.bg=OpenLayers.Util.applyDefaults({permalink:"?????????????????? ??????????????????",baseLayer:"?????????????? ????????",errorLoadingGML:"???????????? ?????? ?????????????????? ???? GML ???????? ${url}",scale:"?????????? = 1 : ${scaleDenom}",layerAlreadyAdded:"???????????????? ???? ???????????????? ???????? ${layerName} ?? ??????????????, ???? ?????? ???????? ?? ??????????????",methodDeprecated:"???????? ?????????? ?? ?????????????? ?? ???? ???????? ?????????????????? ?? 3.0. ???????????? ???????? ?????????????????????? ${newMethod}."});OpenLayers.Lang.br=OpenLayers.Util.applyDefaults({unhandledRequest:"Distro evel reked anveret ${statusText}",permalink:"Peurliamm",overlays:"Gwiskado??",baseLayer:"Gwiskad diazez",sameProjection:"Ne'z ar gartenn lec'hia?? en-dro nemet pa vez he??vel ar banndres anezhi ha hini ar gartenn benna??",readNotImplemented:"N'eo ket emplementet al lenn.",writeNotImplemented:"N'eo ket emplementet ar skriva??.",noFID:"N'haller ket hizivaat un elfenn ma n'eus ket a niverenn-anaout (FID) eviti.",errorLoadingGML:"Fazi e-ser karga?? ar restr GML ${url}",browserNotSupported:"N'eo ket skoret an daskor vektorel gant ho merdeer. Setu aze an daskorerio?? skoret evit ar poent :\n${renderers}",componentShouldBe:"addFeatures : bez' e tlefe ar parzh besa?? eus ar seurt ${geomType}",getFeatureError:"Galvet eo bet getFeatureFromEvent called war ur gwiskad hep daskorer. Kement-se a dalvez ez eus bet freuzet ur gwiskad hag hoc'h eus miret un embreger bennak stag outa??.",minZoomLevelError:"Ne zleer implijout ar perzh minZoomLevel nemet evit gwiskado?? FixedZoomLevels-descendent. Ar fed ma wiria ar gwiskad WHS-se hag-e?? ez eus eus minZoomLevel zo un aspadenn gozh. Koulskoude n'omp ket evit e ziverka?? kuit da derri?? arloado?? diazezet war OL a c'hallfe beza?? stag outa??. Setu perak eo dispredet -- Lamet kuit e vo ar gwiria?? minZoomLevel a-is er stumm 3.0. Ober gant an arventenno?? bihana??/brasa?? evel deskrivet ama?? e plas : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Treuzgread WFS : MAT EO ${response}",commitFailed:"Treuzgread WFS Transaction: C'HWITET ${response}",googleWarning:"N'eus ket bet gallet karga?? ar gwiskad Google ent reizh.\x3cbr\x3e\x3cbr\x3eEvit en em zizober eus ar c'hemenn-ma??, dibabit ur BaseLayer nevez en diuzer gwiskado?? er c'horn deho?? el laez.\x3cbr\x3e\x3cbr\x3eSur a-walc'h eo peogwir n'eo ket bet ensoc'het levraoueg Google Maps pe neuze ne glot ket an alc'hwez API gant ho lec'hienn.\x3cbr\x3e\x3cbr\x3eDiorroerien : Evit reizha?? an dra-se, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eclick here\x3c/a\x3e",getLayerWarning:"N'haller ket karga?? ar gwiskad ${layerType} ent reizh.\x3cbr\x3e\x3cbr\x3eEvit en em zizober eus ar c'hemenn-ma??, dibabit ur BaseLayer nevez en diuzer gwiskado?? er c'horn deho?? el laez.\x3cbr\x3e\x3cbr\x3eSur a-walc'h eo peogwir n'eo ket bet ensoc'het mat al levraoueg ${layerLib}.\x3cbr\x3e\x3cbr\x3eDiorroerien : Evit gouzout penaos reizha?? an dra-se, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eclick here\x3c/a\x3e",scale:"Skeul = 1 : ${scaleDenom}",W:"K",E:"R",N:"N",S:"S",layerAlreadyAdded:"Klasket hoc'h eus ouzhpenna?? ar gwiskad : ${layerName} d'ar gartenn, met ouzhpennet e oa bet c'hoazh",reprojectDeprecated:"Emaoc'h oc'h implijout an dibarzh 'reproject' war ar gwiskad ${layerName}. Dispredet eo an dibarzh-ma?? : bet eo hag e talveze da ziskwel roadenno?? war-c'horre kartenno?? diazez kenwerzhel, un dra hag a c'haller ober brema?? gant an arc'hwel dre skor banndres boullek Mercator. Muioc'h a ditouro?? a c'haller da gaout war http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Dispredet eo an daore-se ha tennet e vo kuit eus ar stumm 3.0. Grit gant ${newMethod} e plas.",boundsAddError:"Rekis eo tremen an div dalvoudenn x ha y d'an arc'hwel add.",lonlatAddError:"Rekis eo tremen an div dalvoudenn hedred ha ledred d'an arc'hwel add.",pixelAddError:"Rekis eo tremen an div dalvoudenn x ha y d'an arc'hwel add.",unsupportedGeometryType:"Seurt mentoniezh anskoret : ${geomType}",pagePositionFailed:"C'hwitet eo OpenLayers.Util.pagePosition : marteze ema?? lec'hiet fall an elfenn id ${elemId}.",filterEvaluateNotImplemented:"N'eo ket bet emplementet ar prizia?? evit seurt silo?? c'hoazh."});OpenLayers.Lang.el=OpenLayers.Util.applyDefaults({scale:"?????????????? ~ 1 : ${scaleDenom}"});OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Base Layer",sameProjection:"The overview map only works when it is in the same projection as the main map",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>",scale:"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: element with id ${elemId} may be misplaced.",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",end:""};OpenLayers.Lang.fi=OpenLayers.Util.applyDefaults({permalink:"Ikilinkki",overlays:"Kerrokset",baseLayer:"Peruskerros",sameProjection:"Yleiskuvakarttaa voi k??ytt???? vain, kun sill?? on sama projektio kuin p????kartalla.",W:"L",E:"I",N:"P",S:"E"});OpenLayers.Lang.fur=OpenLayers.Util.applyDefaults({permalink:"Leam Permanent",overlays:"Livei parsore",baseLayer:"Livel di base",browserNotSupported:"Il to sgarfad??r nol supuarte la renderizazion vetori??l. Al moment a son supuart??ts:\n${renderers}",scale:"Scjale = 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S"});OpenLayers.Lang.gl=OpenLayers.Util.applyDefaults({unhandledRequest:"Solicitude non xerada; a resposta foi: ${statusText}",permalink:"Ligaz??n permanente",overlays:"Capas superpostas",baseLayer:"Capa base",sameProjection:"A vista xeral do mapa s?? funciona cando est?? na mesma proxecci??n c?? mapa principal",readNotImplemented:"Lectura non implementada.",writeNotImplemented:"Escritura non implementada.",noFID:"Non se pode actualizar a funcionalidade para a que non hai FID.",errorLoadingGML:"Erro ao cargar o ficheiro GML ${url}",browserNotSupported:"O seu navegador non soporta a renderizaci??n de vectores. Os renderizadores soportados actualmente son:\n${renderers}",componentShouldBe:"addFeatures: o compo??ente debera ser de tipo ${geomType}",getFeatureError:"getFeatureFromEvent ten sido chamado a unha capa sen renderizador. Isto normalmente significa que destru??u unha capa, mais non o executador que est?? asociado con ela.",minZoomLevelError:"A propiedade minZoomLevel ?? s?? para uso conxuntamente coas capas FixedZoomLevels-descendent. O feito de que esa capa wfs verifique o minZoomLevel ?? unha reliquia do pasado. Non podemos, con todo, eliminala sen a posibilidade de non romper as aplicaci??ns baseadas en OL que poidan depender dela. Por iso a estamos deixando obsoleta (a comprobaci??n minZoomLevel de embaixo ser?? eliminada na versi??n 3.0). Por favor, no canto diso use o axuste de resoluci??n m??n/m??x tal e como est?? descrito aqu??: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transacci??n WFS: ??XITO ${response}",commitFailed:"Transacci??n WFS: FALLIDA ${response}",googleWarning:"A capa do Google non puido cargarse correctamente.\x3cbr\x3e\x3cbr\x3ePara evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.\x3cbr\x3e\x3cbr\x3eProbablemente, isto acontece porque a escritura da librar??a do Google Maps ou ben non foi inclu??da ou ben non cont??n a clave API correcta para o seu sitio.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: para axudar a facer funcionar isto correctamente, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3epremede aqu??\x3c/a\x3e",getLayerWarning:"A capa ${layerType} foi incapaz de cargarse correctamente.\x3cbr\x3e\x3cbr\x3ePara evitar esta mensaxe, escolla unha nova capa base no seleccionador de capas na marxe superior dereita.\x3cbr\x3e\x3cbr\x3eProbablemente, isto acontece porque a escritura da librar??a ${layerLib} non foi ben inclu??da.\x3cbr\x3e\x3cbr\x3eDesenvolvedores: para axudar a facer funcionar isto correctamente, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3epremede aqu??\x3c/a\x3e",scale:"Escala = 1 : ${scaleDenom}",W:"O",E:"L",N:"N",S:"S",layerAlreadyAdded:"Intentou engadir a capa: ${layerName} ao mapa, pero xa fora engadida",reprojectDeprecated:'Est?? usando a opci??n "reproject" na capa ${layerName}. Esta opci??n est?? obsoleta: o seu uso foi dese??ado para a visualizaci??n de datos sobre mapas base comerciais, pero esta funcionalidade debera agora ser obtida utilizando a proxecci??n Spherical Mercator. Hai dispo??ible m??is informaci??n en http://trac.openlayers.org/wiki/SphericalMercator.',methodDeprecated:"Este m??todo est?? obsoleto e ser?? eliminado na versi??n 3.0. Por favor, no canto deste use ${newMethod}.",boundsAddError:"Debe achegar os valores x e y ?? funci??n add.",lonlatAddError:"Debe achegar tanto o valor lon coma o lat ?? funci??n add.",pixelAddError:"Debe achegar os valores x e y ?? funci??n add.",unsupportedGeometryType:"Tipo xeom??trico non soportado: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition fallou: o elemento con id ${elemId} pode non estar na s??a posici??n.",filterEvaluateNotImplemented:"avaliar non est?? implementado para este tipo de filtro."});OpenLayers.Lang.gsw=OpenLayers.Util.applyDefaults({unhandledRequest:"Nit behandleti Aafrogsruckm??ldig ${statusText}",permalink:"Permalink",overlays:"Iberlagerige",baseLayer:"Grundcharte",sameProjection:"D Ibersichts-Charte funktioniert nume, w??nn si di glych Proj??ktion brucht wie d Hauptcharte",readNotImplemented:"L??se nit implementiert.",writeNotImplemented:"Schrybe nit implementiert.",noFID:"E Feature, wu s kei FID derfir git, cha nit aktualisiert w??re.",errorLoadingGML:"F??hler bim Lade vu dr GML-Datei ${url}",browserNotSupported:"Dyy Browser unterstitzt kei Vektordarstellig. Aktu??ll unterstitzti Renderer:\n${renderers}",componentShouldBe:"addFeatures : Kompon??nt sott dr Typ ${geomType} syy",getFeatureError:"getFeatureFromEvent isch uf eme Layer ohni Renderer ufgruefe wore. Des heisst normalerwys, ass Du e Layer kaputt gmacht hesch, aber nit dr Handler, wu derzue ghert.",minZoomLevelError:"D minZoomLevel-Eigeschaft isch nume d??nk fir d Layer, wu vu dr FixedZoomLevels abstamme. Ass d???? wfs-Layer minZoomLevel prieft, scih e Relikt us dr Vergangeheit. Mir chenne s aber nit ??ndere ohni OL_basierti Aaw??ndige villicht kaputt gehn, wu dervu abh??nge.  Us d??m Grund het die Funktion d Eigeschaft 'deprecated' iberchuu. D minZoomLevel-Priefig unte wird in dr Version 3.0 usegnuu. Bitte verw??nd statt d??m e min/max-Uflesig wie s do bschriben isch: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-Transaktion: ERFOLGRYCH ${response}",commitFailed:"WFS-Transaktion: F??HLGSCHLAA ${response}",googleWarning:"Dr Google-Layer het nit korr??kt chenne glade w??re.\x3cbr\x3e\x3cbr\x3eGo die M??ldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im r??chte obere Ecke.\x3cbr\x3e\x3cbr\x3eD???? F??hler git s seli hyfig, wel s Skript vu dr Google-Maps-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.\x3cbr\x3e\x3cbr\x3eEntwickler: Fir Hilf zum korr??kte Yybinde vum Google-Layer \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3edoo drucke\x3c/a\x3e",getLayerWarning:"Dr ${layerType}-Layer het nit korr??kt chenne glade w??re.\x3cbr\x3e\x3cbr\x3eGo die M??ldig nimi z kriege, wehl e andere Hintergrundlayer us em LayerSwitcher im r??chte obere Ecke.\x3cbr\x3e\x3cbr\x3eD???? F??hler git s seli hyfig, wel s Skript vu dr '${layerLib}'-Bibliothek nit yybunde woren isch oder wel s kei giltige API-Schlissel fir Dyy URL din het.\x3cbr\x3e\x3cbr\x3eEntwickler: Fir Hilf zum korr??kte Yybinde vu Layer \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3edoo drucke\x3c/a\x3e",scale:"Ma??stab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Du hesch versuecht d???? Layer in d Charte yyzfiege: ${layerName}, aber ??r isch schoi yygfiegt",reprojectDeprecated:"Du bruchsch d 'reproject'-Option bim ${layerName}-Layer. Die Option isch nimi giltig: si isch aagleit wore go   Date iber kommerzi??lli Grundcharte lege, aber des sott mer jetz mache mit dr Unterstitzig vu Spherical Mercator. Meh Informatione git s uf http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Die Methode isch veraltet un wird us dr Version 3.0 usegnuu. Bitte verw??bnd statt d??m ${newMethod}.",boundsAddError:"Du muesch e x-W??rt un e y-W??rt yygee bi dr Zuefieg-Funktion",lonlatAddError:"Du meusch e Lengi- un e Breiti-Grad yygee bi dr Zuefieg-Funktion.",pixelAddError:"Du muesch x- un y-W??rt aagee bi dr Zuefieg-Funktion.",unsupportedGeometryType:"Nit unterstitze Geometrii-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition f??hlgschlaa: Elem??nt mit ID ${elemId} isch villicht falsch gsetzt.",filterEvaluateNotImplemented:"evaluiere isch nit implem??ntiert in d??m Filtertyp."});OpenLayers.Lang.hr=OpenLayers.Util.applyDefaults({unhandledRequest:"Nepodr??ani zahtjev ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Osnovna karta",sameProjection:"Pregledna karta radi jedino kao je u istoj projekciji kao i glava karta",readNotImplemented:"??itanje nije implementirano.",writeNotImplemented:"Pisanje nije implementirano.",noFID:"Ne mogu a??urirati zna??ajku za koju ne postoji FID.",errorLoadingGML:"Gre??ka u u??itavanju GML datoteke ${url}",browserNotSupported:"Va?? preglednik ne podr??ava vektorsko renderiranje. Trenutno podr??ani rendereri su: ${renderers}",componentShouldBe:"addFeatures : komponenta bi trebala biti ${geomType}",getFeatureError:"getFeatureFromEvent je pozvao Layer bez renderera. Ovo obi??no zna??i da ste uni??tiili Layer, a ne neki Handler koji je povezan s njim.",commitSuccess:"WFS Transakcija: USPJE??NA ${response}",commitFailed:"WFS Transakcija: NEUSPJE??NA ${response}",scale:"Mjerilo = 1 : ${scaleDenom}",layerAlreadyAdded:"Poku??ali ste dodati layer:  ${layerName} na kartu, ali je ve?? dodan",methodDeprecated:"Ova metoda nije odobrena i biti ??e maknuta u 3.0. Koristite ${newMethod}.",boundsAddError:"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju.",lonlatAddError:"Morate dati obje vrijednosti , (lon i lat) da bi dodali funkciju.",pixelAddError:"Morate dati obje vrijednosti ,  x i y  da bi dodali funkciju.",unsupportedGeometryType:"Nepodr??ani tip geometrije: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition nije uspjelo: element sa id ${elemId} mo??e biti krivo smje??ten."});OpenLayers.Lang.hsb=OpenLayers.Util.applyDefaults({unhandledRequest:"Wotmo??wa njewobd??????aneho napra??owanja ${statusText}",permalink:"Trajny wotkaz",overlays:"Nawor??towanja",baseLayer:"Zak??adna runina",sameProjection:"P??ehladowa karta jeno?? funguje, hdy?? je w samsnej projekciji ka?? h??owna karta",readNotImplemented:"??itanje njeimplementowane.",writeNotImplemented:"Pisanje njeimplementowane.",noFID:"Funkcija, za kotru?? FID njeje, njeda so aktualizowa??.",errorLoadingGML:"Zmylk p??i za??itowanju dataje ${url}",browserNotSupported:"Tw??j wobhladowak wektorowe rysowanje njepodp??ruje. Tuchwilu podp??rowane rysowaki su:\n${renderers}",componentShouldBe:"addFeatures: komponenta m????a ${geomType} by??",getFeatureError:"getFeatureFromEvent bu na wor????e bjez rysowak zawo??any. To zwjet??a woznamjenja, zo sy wor??tu zni??i??, ale nic wobd??????ak, kotry?? je z njej zwjazany.",minZoomLevelError:"Kajkos?? minZoomLevel je jeno?? za wu??iwanje z wor??tami myslena, kotre?? wot FixedZoomLevels pochad??eja. Zo tuta wor??ta wfs za minZoomLevel p??epruwuje, je relikt za??d??enos??e. Njem????emy w??ak ju wotstroni??, bjeztoho zo aplikacije, kotre?? na OpenLayers baz??ruja a snano tutu kajkos?? wu??iwaja, hi??o njefunguja. Tohodla smy ju jako zestarjenu woznamjenili -- p??epruwowanje za minZoomLevel budu so we wersiji 3.0 wotstronje??. Pro??u wu??ij m??sto toho nastajenje min/max, ka?? je tu wopisane: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-Transakcija: WUSP????NA ${response}",commitFailed:"WFS-Transakcija: NJEPORAD??ENA ${response}",googleWarning:"Wor??ta Google njem????e??e so korektnje za??ita??.\x3cbr\x3e\x3cbr\x3eZo by tutu zd????lenku wotby??, wubjer nowy BaseLayer z wub??ra wor??tow horjeka naprawo.\x3cbr\x3e\x3cbr\x3eNajskerje so to stawa, dokel?? skript biblioteki Google Maps pak njebu zap??ijaty pak njewobsahuje korektny klu?? API za twoje syd??o.\x3cbr\x3e\x3cbr\x3eWuwiwarjo: Za pomoc ke korektnemu fungowanju wor??tow\n\x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3etu klikny??\x3c/a\x3e",getLayerWarning:"Wor??ta ${layerType} njem????e??e so korektnje za??ita??.\x3cbr\x3e\x3cbr\x3eZo by tutu zd????lenku wotby??, wubjer nowy BaseLayer z wub??ra wor??tow horjeka naprawo.\x3cbr\x3e\x3cbr\x3eNajskerje so to stawa, dokel?? skript biblioteki ${layerLib} njebu korektnje zap??ijaty.\x3cbr\x3e\x3cbr\x3eWuwiwarjo: Za pomoc ke korektnemu fungowanju wor??tow\n\x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3etu klikny??\x3c/a\x3e",scale:"M??ritko = 1 : ${scaleDenom}",W:"Z",E:"W",N:"S",S:"J",layerAlreadyAdded:"Sy spyta?? runinu ${layerName} kar??e doda??, ale je so hi??o doda??a",reprojectDeprecated:'Wu??iwa?? opciju "reproject" wo????ty ${layerName}. Tuta opcija je zestarjena: jeje wu??iwanje b?? myslene, zo by zwobraznjenje datow nad komercielnymi bazowymi kartami podp??ra??o, ale funkcionalnos?? m????a so n??tko z pomocu Sperical Mercator docp????. Dal??e informacije steja na http://trac.openlayers.org/wiki/SphericalMercator k dispoziciji.',methodDeprecated:"Tuta metoda je so njeschwali??a a bud??e so w 3.0 wotstronje??. Pro??u wu??ij ${newMethod} m??sto toho.",boundsAddError:'Dyrbi?? h??dnotu x ka?? te?? y funkciji "add" p??epoda??.',lonlatAddError:'Dyrbi?? h??dnotu lon ka?? te?? lat funkciji "add" p??epoda??.',pixelAddError:'Dyrbi?? h??dnotu x ka?? te?? y funkciji "add" p??epoda??.',unsupportedGeometryType:"Njepodp??rowany geometrijowy typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition je so njeporad??i??: element z id ${elemId} bu snano wopak zam??stnjeny.",filterEvaluateNotImplemented:"wuh??dno??enje njeje za tut??n filtrowy typ implementowany."});OpenLayers.Lang.hu=OpenLayers.Util.applyDefaults({unhandledRequest:"Nem kezelt k??r??s visszat??r??se ${statusText}",permalink:"Permalink",overlays:"R??vet??t??sek",baseLayer:"Alapr??teg",sameProjection:"Az ??ttekint?? t??rk??p csak abban az esetben m??k??dik, ha ugyanazon a vet??leten van, mint a f?? t??rk??p.",readNotImplemented:"Olvas??s nincs v??grehajtva.",writeNotImplemented:"??r??s nincs v??grehajtva.",noFID:"Nem friss??thet?? olyan jellemz??, amely nem rendelkezik FID-del.",errorLoadingGML:"Hiba GML-f??jl bet??lt??sekor ${url}",browserNotSupported:"A b??ng??sz??je nem t??mogatja a vektoros renderel??st. A jelenleg t??mogatott renderel??k:\n${renderers}",componentShouldBe:"addFeatures : az ??sszetev??nek ilyen t??pus??nak kell lennie: ${geomType}",getFeatureError:"getFeatureFromEvent r??teget h??vott meg renderel?? n??lk??l. Ez rendszerint azt jelenti, hogy megsemmis??tett egy f??li??t, de n??h??ny ahhoz t??rs??tott kezel??t nem.",minZoomLevelError:"A minZoomLevel tulajdons??got csak a k??vetkez??vel val?? haszn??latra sz??nt??k: FixedZoomLevels-lesz??rmazott f??li??k. Ez azt jelenti, hogy a minZoomLevel wfs f??lia jel??l??n??gyzetei m??r a m??lt??. Mi azonban nem t??vol??thatjuk el annak a vesz??lye n??lk??l, hogy az esetlegesen ett??l f??gg?? OL alap?? alkalmaz??sokat t??nkretenn??nk. Ez??rt ezt ??rv??nytelen??tj??k -- a minZoomLevel az alul lev?? jel??l??n??gyzet a 3.0-s verzi??b??l el lesz t??vol??tva. K??rj??k, helyette haszn??lja a  min/max felbont??s be??ll??t??st, amelyr??l az al??bbi helyen tal??l le??r??st: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS tranzakci??: SIKERES ${response}",commitFailed:"WFS tranzakci??: SIKERTELEN ${response}",googleWarning:"A Google f??lia bet??lt??se sikertelen.\x3cbr\x3e\x3cbr\x3eAhhoz, hogy ez az ??zenet elt??nj??n, v??lasszon egy ??j BaseLayer f??li??t a jobb fels?? sarokban tal??lhat?? f??liakapcsol?? seg??ts??g??vel.\x3cbr\x3e\x3cbr\x3eNagy val??sz??n??s??ggel ez az??rt van, mert a Google Maps k??nyvt??r parancsf??jlja nem tal??lhat??, vagy nem tartalmazza az ??n oldal??hoz tartoz?? megfelel?? API-kulcsot.\x3cbr\x3e\x3cbr\x3eFejleszt??knek: A helyes m??k??dtet??sre vonatkoz?? seg??ts??g az al??bbi helyen ??rhet?? el, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3ekattintson ide\x3c/a\x3e",getLayerWarning:"A(z) ${layerType} f??lia nem t??lt??d??tt be helyesen.\x3cbr\x3e\x3cbr\x3eAhhoz, hogy ez az ??zenet elt??nj??n, v??lasszon egy ??j BaseLayer f??li??t a jobb fels?? sarokban tal??lhat?? f??liakapcsol?? seg??ts??g??vel.\x3cbr\x3e\x3cbr\x3eNagy val??sz??n??s??ggel ez az??rt van, mert a(z) ${layerLib} k??nyvt??r parancsf??jlja helytelen.\x3cbr\x3e\x3cbr\x3eFejleszt??knek: A helyes m??k??dtet??sre vonatkoz?? seg??ts??g az al??bbi helyen ??rhet?? el, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3ekattintson ide\x3c/a\x3e",scale:"L??pt??k = 1 : ${scaleDenom}",W:"Ny",E:"K",N:"??",S:"D",layerAlreadyAdded:"Megpr??b??lta hozz??adni a(z) ${layerName} f??li??t a t??rk??phez, de az m??r hozz?? van adva",reprojectDeprecated:"??n a 'reproject' be??ll??t??st haszn??lja a(z) ${layerName} f??li??n. Ez a be??ll??t??s ??rv??nytelen: haszn??lata az ??zleti alapt??rk??pek f??l??tti adatok megjelen??t??s??nek t??mogat??s??ra szolg??lt, de ezt a funkci?? ezent??l a G??mbi Mercator haszn??lat??val ??rhet?? el. Tov??bbi inform??ci?? az al??bbi helyen ??rhet?? el: http://trac.openlayers.org/wiki/SphericalMercator",methodDeprecated:"Ez a m??dszer ??rv??nytelen??tve lett ??s a 3.0-s verzi??b??l el lesz t??vol??tva. Haszn??lja a(z) ${newMethod} m??dszert helyette.",boundsAddError:"Az x ??s y ??rt??keknek egyar??nt meg kell felelnie, hogy a funkci??t hozz??adhassa.",lonlatAddError:"A hossz. ??s sz??l. ??rt??keknek egyar??nt meg kell felelnie, hogy a funkci??t hozz??adhassa.",pixelAddError:"Az x ??s y ??rt??keknek egyar??nt meg kell felelnie, hogy a funkci??t hozz??adhassa.",unsupportedGeometryType:"Nem t??mogatott geometriat??pus: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition sikertelen: lehets??ges, hogy a(z) ${elemId} azonos??t??j?? elem t??ves helyre ker??lt.",filterEvaluateNotImplemented:"enn??l a sz??r??t??pusn??l ki??rt??kel??s nem hajt??dik v??gre."});OpenLayers.Lang.ia=OpenLayers.Util.applyDefaults({unhandledRequest:"Le responsa a un requesta non esseva maneate: ${statusText}",permalink:"Permaligamine",overlays:"Superpositiones",baseLayer:"Strato de base",sameProjection:"Le mini-carta functiona solmente si illo es in le mesme projection que le carta principal",readNotImplemented:"Lectura non implementate.",writeNotImplemented:"Scriptura non implementate.",noFID:"Non pote actualisar un elemento sin FID.",errorLoadingGML:"Error al cargamento del file GML ${url}",browserNotSupported:"Tu navigator non supporta le rendition de vectores. Le renditores actualmente supportate es:\n${renderers}",componentShouldBe:"addFeatures: le componente debe esser del typo ${geomType}",getFeatureError:"getFeatureFromEvent ha essite appellate in un strato sin renditor. Isto significa generalmente que tu ha destruite un strato, ma lassava un gestor associate con illo.",minZoomLevelError:"Le proprietate minZoomLevel es solmente pro uso con le stratos descendente de FixedZoomLevels. Le facto que iste strato WFS verifica minZoomLevel es un reliquia del passato. Nonobstante, si nos lo remove immediatemente, nos pote rumper applicationes a base de OL que depende de illo. Ergo nos lo declara obsolete; le verification de minZoomLevel in basso essera removite in version 3.0. Per favor usa in su loco le configuration de resolutiones min/max como describite a: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaction WFS: SUCCESSO ${response}",commitFailed:"Transaction WFS: FALLEVA ${response}",googleWarning:"Le strato Google non poteva esser cargate correctemente.\x3cbr\x3e\x3cbr\x3ePro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.\x3cbr\x3e\x3cbr\x3eMulto probabilemente, isto es proque le script del libreria de Google Maps non esseva includite o non contine le clave API correcte pro tu sito.\x3cbr\x3e\x3cbr\x3eDisveloppatores: Pro adjuta de corriger isto, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eclicca hic\x3c/a",getLayerWarning:"Le strato ${layerType} non poteva esser cargate correctemente.\x3cbr\x3e\x3cbr\x3ePro disfacer te de iste message, selige un nove BaseLayer in le selector de strato in alto a dextra.\x3cbr\x3e\x3cbr\x3eMulto probabilemente, isto es proque le script del libreria de ${layerLib} non esseva correctemente includite.\x3cbr\x3e\x3cbr\x3eDisveloppatores: Pro adjuta de corriger isto, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eclicca hic\x3c/a\x3e",scale:"Scala = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",layerAlreadyAdded:"Tu tentava adder le strato: ${layerName} al carta, ma illo es ja presente",reprojectDeprecated:"Tu usa le option 'reproject' in le strato ${layerName} layer. Iste option es obsolescente: illo esseva pro poter monstrar datos super cartas de base commercial, ma iste functionalitate pote ora esser attingite con le uso de Spherical Mercator. Ulterior information es disponibile a http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Iste methodo ha essite declarate obsolescente e essera removite in version 3.0. Per favor usa ${newMethod} in su loco.",boundsAddError:"Tu debe passar le duo valores x e y al function add.",lonlatAddError:"Tu debe passar le duo valores lon e lat al function add.",pixelAddError:"Tu debe passar le duo valores x e y al function add.",unsupportedGeometryType:"Typo de geometria non supportate: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition falleva: le elemento con id ${elemId} pote esser mal placiate.",filterEvaluateNotImplemented:'"evaluate" non es implementate pro iste typo de filtro.'});OpenLayers.Lang.id=OpenLayers.Util.applyDefaults({unhandledRequest:"Permintaan yang tak tertangani menghasilkan ${statusText}",permalink:"Pranala permanen",overlays:"Hamparan",baseLayer:"Lapisan Dasar",sameProjection:"Peta tinjauan hanya bekerja bila dalam proyeksi yang sama dengan peta utama",readNotImplemented:"Membaca tidak diterapkan.",writeNotImplemented:"Menyimpan tidak diterapkan.",noFID:"Tidak dapat memperbarui fitur yang tidak memiliki FID.",errorLoadingGML:"Kesalahan dalam memuat berkas GML ${url}",browserNotSupported:"Peramban Anda tidak mendukung penggambaran vektor. Penggambar yang didukung saat ini adalah:\n${renderers}",componentShouldBe:"addFeatures : komponen harus berupa ${geomType}",getFeatureError:"getFeatureFromEvent diterapkan pada lapisan tanpa penggambar. Ini biasanya berarti Anda menghapus sebuah lapisan, tetapi tidak menghapus penangan yang terkait dengannya.",minZoomLevelError:"Properti minZoomLevel hanya ditujukan bekerja dengan lapisan FixedZoomLevels-descendent. Pengecekan minZoomLevel oleh lapisan wfs adalah peninggalan masa lalu. Kami tidak dapat menghapusnya tanpa kemungkinan merusak aplikasi berbasis OL yang mungkin bergantung padanya. Karenanya, kami menganggapnya tidak berlaku -- Cek minZoomLevel di bawah ini akan dihapus pada 3.0. Silakan gunakan penyetelan resolusi min/maks seperti dijabarkan di sini: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaksi: BERHASIL ${respon}",commitFailed:"WFS Transaksi: GAGAL ${respon}",googleWarning:"Lapisan Google tidak dapat dimuat dengan benar.\x3cbr\x3e\x3cbr\x3eUntuk menghilangkan pesan ini, pilih suatu BaseLayer baru melalui penukar lapisan (layer switcher) di ujung kanan atas.\x3cbr\x3e\x3cbr\x3eKemungkinan besar ini karena pustaka skrip Google Maps tidak disertakan atau tidak mengandung kunci API yang tepat untuk situs Anda.\x3cbr\x3e\x3cbr\x3ePengembang: Untuk bantuan mengatasi masalah ini, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eklik di sini\x3c/a\x3e",getLayerWarning:"Lapisan ${layerType} tidak dapat dimuat dengan benar.\x3cbr\x3e\x3cbr\x3eUntuk menghilangkan pesan ini, pilih suatu BaseLayer baru melalui penukar lapisan (layer switcher) di ujung kanan atas.\x3cbr\x3e\x3cbr\x3eKemungkinan besar ini karena pustaka skrip Google Maps tidak disertakan dengan benar.\x3cbr\x3e\x3cbr\x3ePengembang: Untuk bantuan mengatasi masalah ini, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik di sini\x3c/a\x3e",scale:"Sekala = 1 : ${scaleDenom}",W:"B",E:"T",N:"U",S:"S",layerAlreadyAdded:"Anda mencoba menambahkan lapisan: ${layerName} ke dalam peta, tapi lapisan itu telah ditambahkan",reprojectDeprecated:"Anda menggunakan opsi 'reproject' pada lapisan ${layerName}. Opsi ini telah ditinggalkan: penggunaannya dirancang untuk mendukung tampilan data melalui peta dasar komersial, tapi fungsionalitas tersebut saat ini harus dilakukan dengan menggunakan dukungan Spherical Mercator. Informasi lebih lanjut tersedia di http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Metode ini telah usang dan akan dihapus di 3.0. Sebaliknya, harap gunakan ${newMethod}.",boundsAddError:"Anda harus memberikan kedua nilai x dan y ke fungsi penambah.",lonlatAddError:"Anda harus memberikan kedua nilai lon dan lat ke fungsi penambah.",pixelAddError:"Anda harus memberikan kedua nilai x dan y ke fungsi penambah.",unsupportedGeometryType:"Tipe geometri tak didukung: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition gagal: elemen dengan id ${elemId} mungkin salah tempat.",filterEvaluateNotImplemented:"evaluasi tidak tersedia untuk tipe filter ini."});OpenLayers.Lang.io=OpenLayers.Util.applyDefaults({scale:"Skalo = 1 : ${scaleDenom}"});OpenLayers.Lang.is=OpenLayers.Util.applyDefaults({permalink:"Varanlegur tengill",overlays:"??ekjur",baseLayer:"Grunnlag",sameProjection:"Yfirlitskorti?? virkar a??eins ef ??a?? er ?? s??mu v??rpun og a??alkorti??",readNotImplemented:"Skrifun er ????tf??r??.",writeNotImplemented:"Lestur er ????tf??r??ur.",errorLoadingGML:"Villa kom upp vi?? a?? hla??a inn GML skr??nni ${url}",scale:"Skali = 1 : ${scaleDenom}",layerAlreadyAdded:"???? reyndir a?? b??ta laginu ${layerName} ?? korti?? en ??a?? er ??egar b??i?? a?? b??ta ??v?? vi??",methodDeprecated:"??etta fall hefur veri?? ??relt og ver??ur fjarl??gt ?? 3.0. Nota??u ${newMethod} ?? sta??in."});OpenLayers.Lang.ja=OpenLayers.Util.applyDefaults({unhandledRequest:"????????????????????? ${statusText} ???????????????",permalink:"??????????????????",overlays:"??????????????????",baseLayer:"??????????????????",sameProjection:"???????????????????????????????????????????????????????????????????????????????????????",readNotImplemented:"?????????????????????????????????????????????",writeNotImplemented:"?????????????????????????????????????????????",noFID:"FID ??????????????????????????????????????????",errorLoadingGML:"GML ???????????? ${url} ????????????????????????",browserNotSupported:"??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????\n${renderers}",componentShouldBe:"addFeatures: ????????? ${geomType} ?????????????????????",getFeatureError:"getFeatureFromEvent ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????",minZoomLevelError:"minZoomLevel ?????????????????? FixedZoomLevels ?????????????????????????????????????????????????????????????????????????????? minZoomLevel ???????????? WFS ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? OpenLayers ??????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? minZoomLevel ????????????????????????3.0???????????????????????????????????????http://trac.openlayers.org/wiki/SettingZoomLevels ?????????????????????????????????????????????????????????????????????????????????????????????",commitSuccess:"WFS ????????????????????????: ?????? ${response}",commitFailed:"WFS ????????????????????????: ?????? ${response}",googleWarning:"Google ??????????????????????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e???????????????????????? Google ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? API ????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e??????????????????: ????????????????????????????????????\x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3e?????????????????????\x3c/a\x3e??????????????????????????????",getLayerWarning:"${layerType} ??????????????????????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e???????????????????????? ${layerLib} ???????????????????????????????????????????????????????????????????????????????????????\x3cbr\x3e\x3cbr\x3e??????????????????: ????????????????????????????????????\x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3e?????????????????????\x3c/a\x3e??????????????????????????????",scale:"?????? = 1 : ${scaleDenom}",W:"???",E:"???",N:"???",S:"???",layerAlreadyAdded:"???????????????${layerName}?????????????????????????????????????????????????????????????????????????????????????????????????????????",reprojectDeprecated:"???????????????${layerName}?????????????????? reproject ?????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? Spherical Mercator ???????????????????????????????????????????????????????????????????????????????????????????????????????????????????????? http://trac.openlayers.org/wiki/SphericalMercator ????????????????????????",methodDeprecated:"?????????????????????????????????????????????????????????????????????3.0???????????????????????????????????? ${newMethod} ??????????????????????????????",boundsAddError:"x ??? y ??????????????? add ?????????????????????????????????????????????",lonlatAddError:"lon ??? lat ??????????????? add ?????????????????????????????????????????????",pixelAddError:"x ??? y ??????????????? add ?????????????????????????????????????????????",unsupportedGeometryType:"?????????????????????: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition ?????????????????????: id ${elemId} ?????????????????????????????????????????????????????????????????????",filterEvaluateNotImplemented:"???????????????????????????????????? evaluate ?????????????????????????????????"});OpenLayers.Lang.km=OpenLayers.Util.applyDefaults({permalink:"????????????????????????????????????????????????????????????",baseLayer:"?????????????????????????????????",errorLoadingGML:"????????????????????????????????????????????????????????????????????? GML ${url}",scale:"?????????????????????????????? = ??? ??? ${scaleDenom}"});OpenLayers.Lang.ksh=OpenLayers.Util.applyDefaults({unhandledRequest:"Met d?? Antwoot op en Aanfrooch ham_mer nix aanjefange: ${statusText}",permalink:"Lengk op Duuer",overlays:"Dr??vver jelaat",baseLayer:"Jrund-Nivoh",sameProjection:"De ??vverseeschs_Kaat deiht et blo??, wann se de s??lve Proj??xjuhn bruche deiht, wi de Houp_Kaat",readNotImplemented:'???\x3ccode lang="en"\x3eread\x3c/code\x3e??? is em Projramm nit f??rjesinn.',writeNotImplemented:'???\x3ccode lang="en"\x3ewrite\x3c/code\x3e??? is em Projramm nit f??rjesinn.',noFID:'En Saach, woh kein \x3ci lang="en"\x3eFID\x3c/i\x3e f??r doh es, l??ht sesch nit ??ndere.',errorLoadingGML:'F??hler beim \x3ci lang="en"\x3eGML\x3c/i\x3e-Datei-Laade vun \x3ccode\x3e${url}\x3c/code\x3e',browserNotSupported:"Dinge Brauser kann kein V??ktore u??j??vve. De Zoote U??jaabe, di em Momang jon, sen:\n${renderers}",componentShouldBe:'\x3ccode lang="en"\x3eaddFeatures\x3c/code\x3e: d?? Aandeil sullt vun d?? Zoot ???\x3ccode lang="en"\x3e${geomType}\x3c/code\x3e??? sin.',getFeatureError:'\x3ccode lang="en"\x3egetFeatureFromEvent\x3c/code\x3e es vun enem Nivoh opjeroofe woode, woh et kei Projramm zom U??j??vve jit. Dat bed??gg f??r jew??hnlesch, dat De e Nivoh kapott jemaat h??s, ??vver nit e Projramm f??r domet ??mzejonn, wat domet verbonge es.',minZoomLevelError:'De Eijeschaff ???\x3ccode lang="en"\x3eminZoomLevel\x3c/code\x3e??? es blo?? dof??r jedaach, dat mer se met d?? Nivvoh?? bruch, di vun \x3ccode lang="en"\x3eFixedZoomLevels\x3c/code\x3e affhange don. Dat dat \x3ci lang="en"\x3eWFS\x3c/i\x3e-Nivvoh ??vverhoup de Eijeschaff ???\x3ccode lang="en"\x3eminZoomLevel\x3c/code\x3e??? pr??hfe deiht, es noch ??vveresch vun fr??hjer. Mer k??nne dat ??vver jez nit fott loh??e, oohne dat mer Jevaa loufe, dat Aanwendunge vun OpenLayers nit mieh loufe, di sesch doh velleijsch noch drop am verloh??e sin. Dr??m sare mer, dat mer et nit mieh han welle, un de ???\x3ccode lang="en"\x3eminZoomLevel\x3c/code\x3e???-Eijeschaff weed hee vun de Version 3.0 af nit mieh jepr????f w??de. Nemm dof??r de Enstellung f??r de h??h??te un de klein??te Opl??hsung, esu wi et en http://trac.openlayers.org/wiki/SettingZoomLevels opjeschrevve es.',commitSuccess:'D?? \x3ci lang="en"\x3eWFS\x3c/i\x3e-V??rjang es joot jeloufe: ${response}',commitFailed:'D?? \x3ci lang="en"\x3eWFS\x3c/i\x3e-V??rjang es scheif jejange: ${response}',googleWarning:'Dat Nivvoh \x3ccode lang="en"\x3eGoogle\x3c/code\x3e kunnt nit reschtesch jelaade w????de.\x3cbr /\x3e\x3cbr /\x3e??m hee di Nohreesch lo?? ze krijje, donn en ander Jrund-Nivvoh u??s??hke, r??h?? bovve en de ??k.\x3cbr /\x3e\x3cbr /\x3eWascheinlesch es dat wiel dat \x3ci lang="en"\x3eGoogle-Maps\x3c/i\x3e-Skrepp entweeder nit reschtesch enjebonge wood, udder nit d?? reschtejje \x3ci lang="en"\x3eAPI\x3c/i\x3e-Schl????el f??r Ding Web-??ait scheke deiht.\x3cbr /\x3e\x3cbr /\x3eF??r Projrammierer jidd_et H??lp do_dr??vver, \x3ca href="http://trac.openlayers.org/wiki/Google" target="_blank"\x3ewi mer dat aan et Loufe brengk\x3c/a\x3e.',getLayerWarning:'Dat Nivvoh \x3ccode\x3e${layerType}\x3c/code\x3e kunnt nit reschtesch jelaade w????de.\x3cbr /\x3e\x3cbr /\x3e??m hee di Nohreesch lo?? ze krijje, donn en ander Jrund-Nivvoh u??s??hkre, r??h?? bovve en de ??k.\x3cbr /\x3e\x3cbr /\x3eWascheinlesch es dat, wiel dat Skrepp \x3ccode\x3e${layerLib}\x3c/code\x3e nit reschtesch enjebonge wood.\x3cbr /\x3e\x3cbr /\x3eF??r Projrammierer jidd_Et H??lp do_dr??vver, \x3ca href="http://trac.openlayers.org/wiki/${layerLib}" target="_blank"\x3ewi mer dat aan et Loufe brengk\x3c/a\x3e.',scale:"Moh??shtaab = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"S",layerAlreadyAdded:"Do h???? vers??hk, dat Nivvoh \x3ccode\x3e${layerName}\x3c/code\x3e en di Kaat eren ze br??nge, et wohr ??vver ald do dren.",reprojectDeprecated:"Do bruchs de U??wahl \x3ccode\x3ereproject\x3c/code\x3e op d??m Nivvoh \x3ccode\x3e${layerName}\x3c/code\x3e. Di U??wahl es nit mieh j??hn jesinn. Se wohr dof??r jedaach, ??m Date op jesch????fsm????esch eru?? jejovve Kaate bovve drop ze moole, wat ??vver enzwesche besser met d?? ??ngersht??zung f??r de ??f????resche M??kaator Beldscher jeiht. Doh kanns De mieh dr??vver fenge op d?? Sigg: http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Hee di Metood es nim_mih akto??ll un et weed se en d?? Version 3.0 nit mieh j??vve. Nemm \x3ccode\x3e${newMethod}\x3c/code\x3e dof????r.",boundsAddError:"Do mo?? beeds vun de \x3ccode\x3ex\x3c/code\x3e un \x3ccode\x3ey\x3c/code\x3e W????te aan de Fungk??john \x3ccode\x3eadd\x3c/code\x3e j??vve.",lonlatAddError:"Do mo?? beeds \x3ccode\x3elon\x3c/code\x3e un \x3ccode\x3elat\x3c/code\x3e aan de Fungk??john \x3ccode\x3eadd\x3c/code\x3e j??vve.",pixelAddError:"Do mo?? beeds \x3ccode\x3ex\x3c/code\x3e un \x3ccode\x3ey\x3c/code\x3e aan de Fungk??john \x3ccode\x3eadd\x3c/code\x3e j??vve.",unsupportedGeometryType:"De Zoot Jommetrii dom_mer nit ongersht??ze: \x3ccode\x3e${geomType}\x3c/code\x3e",pagePositionFailed:'\x3ccode lang="en"\x3eOpenLayers.Util.pagePosition\x3c/code\x3e es donevve jejange: dat Denge met d?? K??nnong \x3ccode\x3e${elemId}\x3c/code\x3e k??nnt am verkeehte Plaz sin.',filterEvaluateNotImplemented:'???\x3ccode lang="en"\x3eevaluate\x3c/code\x3e??? es f??r di Zoot Fellter nit enjereschdt.'});OpenLayers.Lang.nds=OpenLayers.Util.applyDefaults({unhandledRequest:"Unbehannelt Tr??chmellels f??r de Anfraag ${statusText}",permalink:"Permalink",overlays:"Overlays",baseLayer:"Achtergrundkoort",sameProjection:"De ??versichtskoort geiht blot, wenn de s??lve Projekschoon as bi de H????ftkoort bruukt warrt",readNotImplemented:"Lesen is nich inricht.",writeNotImplemented:"Schrieven is nich inricht.",noFID:"En Feature, dat keen FID hett, kann nich aktuell maakt warrn.",errorLoadingGML:"Fehler bi???t Laden vun de GML-Datei ${url}",browserNotSupported:"Dien Browser ??nnerst??tt keen Vektorbiller. ??nnerst??tt Renderers:\n${renderers}",componentShouldBe:"addFeatures : Kumponent schull man den Typ ${geomType} hebben",getFeatureError:"getFeatureFromEvent is von en Laag ahn Render opropen worrn. Dat bed????dt normalerwies, dat en Laag wegmaakt worrn is, aver nich de Handler, de dor op verwiest.",commitSuccess:"WFS-Transakschoon: hett klappt ${response}",commitFailed:"WFS-Transakschoon: hett nich klappt ${response}",scale:"Skaal = 1 : ${scaleDenom}",layerAlreadyAdded:"Du vers??chst de Laag ???${layerName}??? to de Koort totof??gen, man de is al tof????gt",methodDeprecated:"Disse Methood is oold un schall dat in 3.0 nich mehr geven. Bruuk dor man beter ${newMethod} f??r.",boundsAddError:"De Weert x un y, de m????t all beid an de add-Funkschoon ??vergeven warrn.",lonlatAddError:"De Weert lon un lat, de m????t all beid an de add-Funkschoon ??vergeven warrn.",pixelAddError:"De Weert x un y, de m????t all beid an de add-Funkschoon ??vergeven warrn.",unsupportedGeometryType:"Nich ??nnerst??tt Geometrie-Typ: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition g??ng nich: Element mit de Id ${elemId} is villicht an???n verkehrten Platz."});OpenLayers.Lang.nn=OpenLayers.Util.applyDefaults({scale:"Skala = 1 : ${scaleDenom}",layerAlreadyAdded:"Du freista ?? leggja til laget ??${layerName}?? p?? kartet, men det har alt vorte lagt til.",boundsAddError:"Du er n??ydd til ?? gje b??de ein x- og ein y-verdi til ??add??-funksjonen.",lonlatAddError:"Du er n??ydd til ?? gje b??de lon- og lat-verdiar til ??add??-funksjonen.",pixelAddError:"Du er n??ydd til ?? gje b??de ein x- og ein y-verdi til ??add??-funksjonen."});OpenLayers.Lang.oc=OpenLayers.Util.applyDefaults({unhandledRequest:"Requ??sta pas gerida, retorna ${statusText}",permalink:"Permaligam",overlays:"Calques",baseLayer:"Calc de basa",sameProjection:"La carta de situacion fonciona pas que quora sa projeccion es la meteissa que la de la carta principala",readNotImplemented:"Lectura pas implementada.",writeNotImplemented:"Escritura pas implementada.",noFID:"Impossible de metre a jorn un obj??cte sens identificant (fid).",errorLoadingGML:"Error al cargament del fichi??r GML ${url}",browserNotSupported:"V??stre navegidor sup??rta pas lo rendut vectorial. Los renderers actualament suportats son : \n${renderers}",componentShouldBe:"addFeatures : lo compausant deuri?? ??sser de tipe ${geomType}",getFeatureError:"getFeatureFromEvent es estat apelat sus un calc sens renderer. Aqu?? significa generalament qu'av??tz destruch aqueste ja??, mas qu'av??tz conservat un handler que li ??ra associat.",minZoomLevelError:"La proprietat minZoomLevel deu ??sser utilizada solament per de jaces FixedZoomLevels-descendent. Lo fach qu'aqueste ja?? WFS verifique la pres??ncia de minZoomLevel es una relica del passat. ??aquel??, la pod??m suprimir sens copar d'aplicacions que ne poiri??n dependre. Es per aqu?? que la depreciam -- la verificacion del minZoomLevel ser?? suprimida en version 3.0. A la pla??a, merc??s d'utilizar los param??tres de resolucions min/max tal coma descrich sus : http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaccion WFS : SUCCES ${response}",commitFailed:"Transaccion WFS : FRACAS ${response}",googleWarning:"Lo ja?? Google es pas estat en mesura de se cargar corr??ctament.\x3cbr\x3e\x3cbr\x3ePer suprimir aqueste messatge, causiss??tz una BaseLayer nov??la dins lo selector de ja?? en naut a drecha.\x3cbr\x3e\x3cbr\x3eAqu?? es possiblament causat par la non-inclusion de la librari?? Google Maps, o alara perque que la clau de l'API correspond pas a v??stre site.\x3cbr\x3e\x3cbr\x3eDesvolopaires : per saber coss?? corregir aqu??, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eclicatz aic??\x3c/a\x3e",getLayerWarning:"Lo ja?? ${layerType} es pas en mesura de se cargar corr??ctament.\x3cbr\x3e\x3cbr\x3ePer suprimir aqueste messatge, causiss??tz una  BaseLayer nov??la dins lo selector de ja?? en naut a drecha.\x3cbr\x3e\x3cbr\x3eAqu?? es possiblament causat per la non-inclusion de la librari?? ${layerLib}.\x3cbr\x3e\x3cbr\x3eDesvolopaires : per saber coss?? corregir aqu??, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eclicatz aic??\x3c/a\x3e",scale:"Escala ~ 1 : ${scaleDenom}",W:"O",E:"??",N:"N",S:"S",layerAlreadyAdded:"Av??tz ensajat d'apondre a la carta lo calc : ${layerName}, mas ja es present",reprojectDeprecated:"Utilizatz l'opcion 'reproject' sul ja?? ${layerName}. Aquesta opcion es despreciada : Son usatge permeti?? d'afichar de donadas al dess??s de jaces raster comercials. Aquesta foncionalitat ara es suportada en utilizant lo sup??rt de la projeccion Mercator Esferica. Mai d'informacion es disponibla sus http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Aqueste met??de es despreciada, e ser?? suprimida a la version 3.0. Merc??s d'utilizar ${newMethod} a la pla??a.",boundsAddError:"Vos cal passar las doas valors x e y a la foncion add.",lonlatAddError:"Vos cal passar las doas valors lon e lat a la foncion add.",pixelAddError:"Vos cal passar las doas valors x e y a la foncion add.",unsupportedGeometryType:"Tipe de geometria pas suportat : ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition a fracassat : l'element d'id ${elemId} poiri?? ??sser mal posicionat.",filterEvaluateNotImplemented:"evaluar es pas encara estat implementat per aqueste tipe de filtre."});OpenLayers.Lang.pt=OpenLayers.Util.applyDefaults({unhandledRequest:"Servidor devolveu erro n??o contemplado ${statusText}",permalink:"Liga????o permanente",overlays:"Sobreposi????es",baseLayer:"Camada Base",sameProjection:"O mapa panor??mico s?? funciona quando est?? na mesma proje????o que o mapa principal",readNotImplemented:"Leitura n??o implementada.",writeNotImplemented:"Escrita n??o implementada.",noFID:"N??o ?? poss??vel atualizar um elemento para a qual n??o h?? FID.",errorLoadingGML:"Erro ao carregar ficheiro GML ${url}",browserNotSupported:"O seu navegador n??o suporta renderiza????o vetorial. Actualmente os renderizadores suportados s??o:\n${renderers}",componentShouldBe:"addFeatures: componente deve ser um(a) ${geomType}",getFeatureError:"getFeatureFromEvent foi chamado numa camada sem renderizador. Isto normalmente significa que destruiu uma camada, mas n??o um manipulador ''(handler)'' que lhe est?? associado.",minZoomLevelError:"A propriedade minZoomLevel s?? deve ser usada com as camadas descendentes da FixedZoomLevels. A verifica????o da propriedade por esta camada wfs ?? uma rel??quia do passado. No entanto, n??o podemos remov??-la sem correr o risco de afectar aplica????es OL que dependam dela. Portanto, estamos a torn??-la obsoleta -- a verifica????o minZoomLevel ser?? removida na vers??o 3.0. Em vez dela, por favor, use as op????es de resolu????o min/max descritas aqui: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transac????o WFS: SUCESSO ${response}",commitFailed:"Transac????o WFS: FALHOU ${response}",googleWarning:"A Camada Google n??o foi correctamente carregada.\x3cbr\x3e\x3cbr\x3ePara deixar de receber esta mensagem, seleccione uma nova Camada-Base no ''switcher'' de camadas no canto superior direito.\x3cbr\x3e\x3cbr\x3eProvavelmente, isto acontece porque o ''script'' da biblioteca do Google Maps n??o foi inclu??do ou n??o cont??m a chave API correcta para o seu s??tio.\x3cbr\x3e\x3cbr\x3eProgramadores: Para ajuda sobre como solucionar o problema \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eclique aqui\x3c/a\x3e .",getLayerWarning:"A camada ${layerType} n??o foi correctamente carregada.\x3cbr\x3e\x3cbr\x3ePara desactivar esta mensagem, seleccione uma nova Camada-Base no ''switcher'' de camadas no canto superior direito.\x3cbr\x3e\x3cbr\x3eProvavelmente, isto acontece porque o ''script'' da biblioteca ${layerLib} n??o foi inclu??do correctamente.\x3cbr\x3e\x3cbr\x3eProgramadores: Para ajuda sobre como solucionar o problema \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eclique aqui\x3c/a\x3e .",scale:"Escala = 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",layerAlreadyAdded:"Voc?? tentou adicionar a camada: ${layerName} ao mapa, mas ela j?? tinha sido adicionada antes",reprojectDeprecated:"Est?? usando a op????o 'reproject' na camada ${layerName}. Esta op????o ?? obsoleta: foi concebida para permitir a apresenta????o de dados sobre mapas-base comerciais, mas esta funcionalidade ?? agora suportada pelo Mercator Esf??rico. Mais informa????o est?? dispon??vel em http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Este m??todo foi declarado obsoleto e ser?? removido na vers??o 3.0. Por favor, use ${newMethod} em vez disso.",boundsAddError:"Voc?? deve passar tanto o valor x como o y ?? fun????o de adi????o.",lonlatAddError:"Voc?? deve passar tanto o valor lon como o lat ?? fun????o de adi????o.",pixelAddError:"Voc?? deve passar tanto o valor x como o y ?? fun????o de adi????o.",unsupportedGeometryType:"Tipo de geometria n??o suportado: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition falhou: o elemento com o id ${elemId} poder?? estar mal-posicionado.",filterEvaluateNotImplemented:"avaliar n??o est?? implementado para este tipo de filtro."});OpenLayers.Lang.ru=OpenLayers.Util.applyDefaults({unhandledRequest:"???????????????????????????? ???????????? ???????????? ${statusText}",permalink:"???????????????????? ????????????",overlays:"????????",baseLayer:"???????????????? ????????",sameProjection:"???????????????? ?????????? ???????????????? ???????????? ??????????, ?????????? ?????????? ???? ???? ????????????????, ?????? ?? ????????????????",readNotImplemented:"???????????? ???? ??????????????????????.",writeNotImplemented:"???????????? ???? ??????????????????????.",noFID:"???????????????????? ???????????????? ????????????, ?????? ???????????????? ?????? FID.",errorLoadingGML:"???????????? ?????? ???????????????? ?????????? GML ${url}",browserNotSupported:"?????? ?????????????? ???? ???????????????????????? ?????????????????? ??????????????. ???? ???????????? ???????????? ????????????????????????????:\n${renderers}",componentShouldBe:"addFeatures: ?????????????????? ???????????? ???????? ${geomType}",getFeatureError:"getFeatureFromEvent ???????????? ?????? ???????? ?????? ??????????????????. ???????????? ?????? ?????????????? ?? ??????, ?????? ???? ???????????????????? ????????, ???? ???????????????? ?????????????????? ?? ?????? ????????????????????.",minZoomLevelError:"???????????????? minZoomLevel ?????????????????????????? ???????????? ?????? ?????????????????????????? ???? ????????????, ?????????????????????? ?????????????????? FixedZoomLevels. ????, ?????? ???????? WFS-???????? ?????????????????????? ???? minZoomLevel ??? ???????????? ????????????????. ???????????? ???? ???? ?????????? ?????????????? ?????? ??????????????, ?????? ??????, ????????????????, ???? ?????? ?????????????? ?????????????????? ???????????????????? ???? OpenLayers ????????????????????. ?????????????? ?????????????????? ???????????????????? ??? ???????????????? minZoomLevel ?????????? ?????????????? ?? 3.0. ????????????????????, ?????????????????????? ???????????? ?????? ?????????????????? ??????/???????? ????????????????????, ?????????????????? ??????????: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"???????????????????? WFS: ?????????????? ${response}",commitFailed:"???????????????????? WFS: ???????????? ${response}",googleWarning:"???????? Google ???? ?????????????? ?????????????????? ??????????????????.\x3cbr\x3e\x3cbr\x3e?????????? ???????????????????? ???? ?????????? ??????????????????, ???????????? ???????????? ???????????????? ???????? ?? ?????????????????????????? ?? ???????????? ?????????????? ????????.\x3cbr\x3e\x3cbr\x3e???????????? ??????????, ?????????????? ?? ??????, ?????? ???????????????????? Google Maps ???? ???????? ???????????????? ?????? ???? ???????????????? ?????????????????????? API-?????????? ?????? ???????????? ??????????.\x3cbr\x3e\x3cbr\x3e??????????????????????????: ?????????? ????????????, ?????? ??????????????, ?????????? ?????? ????????????????????, \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3e???????????????? ??????\x3c/a\x3e",getLayerWarning:"???????? ${layerType} ???? ?????????????? ?????????????????? ??????????????????. \x3cbr\x3e\x3cbr\x3e?????????? ???????????????????? ???? ?????????? ??????????????????, ???????????? ???????????? ???????????????? ???????? ?? ?????????????????????????? ?? ???????????? ?????????????? ????????.\x3cbr\x3e\x3cbr\x3e???????????? ??????????, ?????????????? ?? ??????, ?????? ???????????????????? ${layerLib} ???? ???????? ???????????????? ?????? ???????? ???????????????? ??????????????????????.\x3cbr\x3e\x3cbr\x3e??????????????????????????: ?????????? ????????????, ?????? ??????????????, ?????????? ?????? ????????????????????, \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3e???????????????? ??????\x3c/a\x3e",scale:"?????????????? = 1 : ${scaleDenom}",W:"??",E:"??",N:"??",S:"??",layerAlreadyAdded:"???? ???????????????????? ???????????????? ???????? ??${layerName}?? ???? ??????????, ???? ???? ?????? ?????? ????????????????",reprojectDeprecated:"???? ?????????????????????? ?????????? 'reproject' ?????? ???????? ${layerName}. ?????? ?????????? ???????????????? ????????????????????: ???? ?????????????????????????? ???????????????????????????? ?????? ?????????????????? ???????????? ???????????? ???????????? ???????????????????????? ?????????????? ????????, ???? ???????????? ???????? ???????????????????? ?????????? ???????????????????? ?????????????????? ?????????????????????? ???????????????? ??????????????????. ???????????? ???????????????? ???????????????? ???? http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"???????? ?????????? ?????????????????? ???????????????????? ?? ?????????? ???????????? ?? ???????????? 3.0. ????????????????????, ?????????????????????? ${newMethod}.",boundsAddError:"?????????????? add ???????? ???????????????????? ?????? ????????????????, x ?? y.",lonlatAddError:"?????????????? add ???????? ???????????????????? ?????? ????????????????, lon ?? lat.",pixelAddError:"?????????????? add ???????? ???????????????????? ?????? ????????????????, x ?? y.",unsupportedGeometryType:"???????????????????????????????? ?????? ??????????????????: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition failed: ?????????????? ?? id ${elemId} ?????????? ???????????????????? ???? ?? ???????????? ??????????.",filterEvaluateNotImplemented:"evaluate ???? ?????????????????????? ?????? ?????????????? ?????????????? ????????."});OpenLayers.Lang.sk=OpenLayers.Util.applyDefaults({unhandledRequest:"Neobsl????en?? po??iadavky vracaj?? ${statusText}",permalink:"Trval?? odkaz",overlays:"Prekrytia",baseLayer:"Z??kladn?? vrstva",sameProjection:"Preh??adov?? mapka funguje iba vtedy, ke?? je v rovnakej projekcii ako hlavn?? mapa",readNotImplemented:"????tanie nie je implementovan??.",writeNotImplemented:"Z??pis nie je implementovan??.",noFID:"Nie je mo??n?? aktualizova?? vlastnos??, pre ktor?? neexistuje FID.",errorLoadingGML:"Chyba pri na????tan?? s??boru GML ${url}",browserNotSupported:"V???? prehliada?? nepodporuje vykres??ovanie vektorov. Moment??lne podporovan?? vykres??ova??e s??:\n${renderers}",componentShouldBe:"addFeatures: komponent by mal by?? ${geomType}",getFeatureError:"getFeatureFromEvent bola zavolan?? na vrstve bez vykres??ova??a. To zvy??ajne znamen??, ??e ste odstr??nili vrstvu, ale nie niektor?? z obsl??h, ktor?? je s ??ou asociovan??.",minZoomLevelError:"Vlastnos?? minZoomLevel je ur??en?? iba na pou??itie s vrstvami odvoden??mi od FixedZoomLevels. To, ??e t??to wfs vrstva kontroluje minZoomLevel je pozostatok z minulosti. Nem????eme ho v??ak odstr??ni??, aby sme sa vyhli mo??n??mu poru??eniu aplik??ci?? zalo??en??ch na Open Layers, ktor?? na tomto m????e z??visie??. Preto ho ozna??ujeme ako zavrhovan?? - dolu uveden?? kontrola minZoomLevel bude odstr??nen?? vo verzii 3.0. Pou??ite pros??m namiesto toho kontrolu min./max. rozl????enia pod??a tu uveden??ho popisu: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transakcia WFS: ??SPE??N?? ${response}",commitFailed:"Transakcia WFS: ZLYHALA ${response}",googleWarning:"Vrstvu Google nebolo mo??n?? spr??vne na????ta??.\x3cbr\x3e\x3cbr\x3eAby ste sa tejto spr??vy zbavili vyberte nov?? BaseLayer v prep??na??i vrstiev v pravom hornom rohu.\x3cbr\x3e\x3cbr\x3eToto sa stalo pravdepodobne preto, ??e skript kni??nice Google Maps bu?? nebol na????tan?? alebo neobsahuje spr??vny k?????? API pre va??u lokalitu.\x3cbr\x3e\x3cbr\x3eV??voj??ri: Tu m????ete z??ska?? \x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3epomoc so sfunk??nen??m\x3c/a\x3e",getLayerWarning:"Vrstvu ${layerType} nebolo mo??n?? spr??vne na????ta??.\x3cbr\x3e\x3cbr\x3eAby ste sa tejto spr??vy zbavili vyberte nov?? BaseLayer v prep??na??i vrstiev v pravom hornom rohu.\x3cbr\x3e\x3cbr\x3eToto sa stalo pravdepodobne preto, ??e skript kni??nice ${layerType} bu?? nebol na????tan?? alebo neobsahuje spr??vny k?????? API pre va??u lokalitu.\x3cbr\x3e\x3cbr\x3eV??voj??ri: Tu m????ete z??ska?? \x3ca href='http://trac.openlayers.org/wiki/${layerType}' target='_blank'\x3epomoc so sfunk??nen??m\x3c/a\x3e",scale:"Mierka = 1 : ${scaleDenom}",layerAlreadyAdded:"Pok??sili ste sa do mapy prida?? vrstvu ${layerName}, ale t?? u?? bola pridan??",reprojectDeprecated:"Pou????vate vo??by ???reproject??? vrstvy ${layerType}. T??to vo??ba je zzavrhovan??: jej pou??itie bolo navrhnut?? na podporu zobrazovania ??dajov nad komer??n??mi z??kladov??mi mapami, ale t??to funkcionalitu je teraz mo??n?? dosiahnu?? pomocou Spherical Mercator. ??al??ie inform??cie z??skate na str??nke http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"T??to met??da je zavrhovan?? a bude odstr??nen?? vo verzii 3.0. Pou??ite pros??m namiesto nej met??du ${newMethod}.",boundsAddError:"S????tacej funkcii mus??te da?? hodnoty x aj y.",lonlatAddError:"S????tacej funkcii mus??te da?? hodnoty lon (zem. d????ka) aj lat (zem. ????rka).",pixelAddError:"S????tacej funkcii mus??te da?? hodnoty x aj y.",unsupportedGeometryType:"Nepodporovan?? typ geometrie: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition zlyhalo: prvok s id ${elemId} m????e by?? zle umiestnen??.",filterEvaluateNotImplemented:"evaluate nie je implementovan?? pre tento typ filtra"});OpenLayers.Lang.te=OpenLayers.Util.applyDefaults({permalink:"??????????????????????????????",W:"???",E:"??????",N:"???",S:"???"});OpenLayers.Lang.vi=OpenLayers.Util.applyDefaults({unhandledRequest:"Kh??ng x??? l?? ???????c ph???n h???i ${statusText} cho y??u c???u",permalink:"Li??n k???t th?????ng tr???c",overlays:"L???p b???n ?????",baseLayer:"L???p n???n",sameProjection:"B???n ????? to??n c???nh ch??? ho???t ?????ng khi c??ng ph??p chi???u v???i b???n ????? ch??nh",readNotImplemented:"Ch??a h??? tr??? ch???c n??ng ?????c.",writeNotImplemented:"Ch??a h??? tr??? ch???c n??ng vi???t.",noFID:"Kh??ng th??? c???p nh???t t??nh n??ng thi???u FID.",errorLoadingGML:"L???i t???i t???p tin GML t???i ${url}",browserNotSupported:"Tr??nh duy???t c???a b???n kh??ng h??? tr??? ch???c n??ng v??? b???ng vect??. Hi???n h??? tr??? c??c b??? k???t xu???t:\n${renderers}",componentShouldBe:"addFeatures: b??? ph???n c???n ph???i l?? ${geomType}",getFeatureError:"getFeatureFromEvent ???????c g???i t??? l???p kh??ng c?? b??? k???t xu???t. Th?????ng th?? c?? l??? l???p b??? x??a nh??ng m???t ph???n x??? l?? c???a n?? v???n c??n.",minZoomLevelError:"Ch??? n??n s??? d???ng thu???c t??nh minZoomLevel v???i c??c l???p FixedZoomLevels-descendent. Vi???c l???p wfs n??y t??m cho minZoomLevel l?? di t??ch c??n l???i t??? x??a. Tuy nhi??n, n???u ch??ng t??i d???i n?? th?? s??? v??? c??c ch????ng tr??nh OpenLayers m?? d???a tr??n n??. B???i v???y ch??ng t??i ph???n ?????i s??? d???ng n??\x26nbsp;??? b?????c t??m cho minZoomLevel s??? ???????c d???i v??o phi??n b???n 3.0. Xin s??? d???ng thi???t l???p ????? ph??n t??ch t???i thi???u / t???i ??a thay th???, theo h?????ng d???n n??y: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Giao d???ch WFS: TH??NH C??NG ${response}",commitFailed:"Giao d???ch WFS: TH???T B???I ${response}",googleWarning:"Kh??ng th??? t???i l???p Google ????ng ?????n.\x3cbr\x3e\x3cbr\x3e????? tr??nh th??ng b??o n??y l???n sau, h??y ch???n BaseLayer m???i d??ng ??i???u khi???n ch???n l???p ??? g??c tr??n ph???i.\x3cbr\x3e\x3cbr\x3eCh???c script th?? vi???n Google Maps ho???c kh??ng ???????c bao g???m ho???c kh??ng ch???a kh??a API h???p v???i website c???a b???n.\x3cbr\x3e\x3cbr\x3e\x3ca href='http://trac.openlayers.org/wiki/Google' target='_blank'\x3eTr??? gi??p v??? t??nh n??ng n??y\x3c/a\x3e cho ng?????i ph??t tri???n.",getLayerWarning:"Kh??ng th??? t???i l???p ${layerType} ????ng ?????n.\x3cbr\x3e\x3cbr\x3e????? tr??nh th??ng b??o n??y l???n sau, h??y ch???n BaseLayer m???i d??ng ??i???u khi???n ch???n l???p ??? g??c tr??n ph???i.\x3cbr\x3e\x3cbr\x3eCh???c script th?? vi???n ${layerLib} kh??ng ???????c bao g???m ????ng ki???u.\x3cbr\x3e\x3cbr\x3e\x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eTr??? gi??p v??? t??nh n??ng n??y\x3c/a\x3e cho ng?????i ph??t tri???n.",scale:"T??? l??? = 1 : ${scaleDenom}",W:"T",E:"??",N:"B",S:"N",layerAlreadyAdded:"B???n mu???n th??m l???p ${layerName} v??o b???n ?????, nh??ng l???p n??y ???? ???????c th??m",reprojectDeprecated:"B???n ??ang ??p d???ng ch??? ????? ???reproject??? v??o l???p ${layerName}. Ch??? ????? n??y ???? b??? ph???n ?????i: n?? c?? m???c ????ch h??? tr??? l???p d??? li???u tr??n c??c n???n b???n ????? th????ng m???i; n??n th???c hi???n hi???u ???ng ???? d??ng t??nh n??ng Mercator H??nh c???u. C?? s???n th??m chi ti???t t???i http://trac.openlayers.org/wiki/SphericalMercator .",methodDeprecated:"Ph????ng th???c n??y ???? b??? ph???n ?????i v?? s??? b??? d???i v??o phi??n b???n 3.0. Xin h??y s??? d???ng ${newMethod} thay th???.",boundsAddError:"C???n ph???i cho c??? gi?? tr??? x v?? y v??o h??m add.",lonlatAddError:"C???n ph???i cho c??? gi?? tr??? lon v?? lat v??o h??m add.",pixelAddError:"C???n ph???i cho c??? gi?? tr??? x v?? y v??o h??m add.",unsupportedGeometryType:"Kh??ng h??? tr??? ki???u ?????a l??: ${geomType}",pagePositionFailed:"OpenLayers.Util.pagePosition b??? th???t b???i: nguy??n t??? v???i ID ${elemId} c?? th??? ??? ch??? sai.",filterEvaluateNotImplemented:"ch??a h??? tr??? evaluate cho lo???i b??? l???c n??y."});OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(g,c,f,b,a,e,d){this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(a){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);this.setContentHTML();this.setBackgroundColor();this.setOpacity();return this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.setRicoCorners()},setBackgroundColor:function(a){if(a!=undefined){this.backgroundColor=a}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)}}},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a);if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)}}},setBorder:function(a){this.border=0},setRicoCorners:function(){var a=this.getCornersToRound(this.relativePosition);var b={corners:a,color:this.backgroundColor,bgColor:"transparent",blend:false};if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,b);this.rounded=true}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,b);this.setBackgroundColor();this.setOpacity()}},getCornersToRound:function(){var a=["tl","tr","bl","br"];var b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);OpenLayers.Util.removeItem(a,b);return a.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(g,c,f,b,a,e,d){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(h){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(e){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];if(b.image){b.div.removeChild(b.image)}b.image=null;if(b.div){this.groupDiv.removeChild(b.div)}b.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px";this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);b=b.offset(this.positionBlocks[this.relativePosition].offset);return b},createBlocks:function(){this.blocks=[];var f=null;for(var e in this.positionBlocks){f=e;break}var a=this.positionBlocks[f];for(var d=0;d<a.blocks.length;d++){var h={};this.blocks.push(h);var b=this.id+"_FrameDecorationDiv_"+d;h.div=OpenLayers.Util.createDiv(b,null,null,null,"absolute",null,"hidden",null);var c=this.id+"_FrameDecorationImg_"+d;var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;h.image=g(c,null,this.imageSize,this.imageSrc,"absolute",null,null,null);h.div.appendChild(h.image);this.groupDiv.appendChild(h.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var j=this.positionBlocks[this.relativePosition];for(var f=0;f<j.blocks.length;f++){var c=j.blocks[f];var e=this.blocks[f];var d=c.anchor.left;var k=c.anchor.bottom;var a=c.anchor.right;var o=c.anchor.top;var m=(isNaN(c.size.w))?this.size.w-(a+d):c.size.w;var g=(isNaN(c.size.h))?this.size.h-(k+o):c.size.h;e.div.style.width=(m<0?0:m)+"px";e.div.style.height=(g<0?0:g)+"px";e.div.style.left=(d!=null)?d+"px":"";e.div.style.bottom=(k!=null)?k+"px":"";e.div.style.right=(a!=null)?a+"px":"";e.div.style.top=(o!=null)?o+"px":"";e.image.style.left=c.position.x+"px";e.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.projCode=b;if(window.Proj4js){this.proj=new Proj4js.Proj(b)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){if(a&&a.getCode){return this.getCode()==a.getCode()}else{return false}},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(c,b,a){if(!OpenLayers.Projection.transforms[c]){OpenLayers.Projection.transforms[c]={}}OpenLayers.Projection.transforms[c][b]=a};OpenLayers.Projection.transform=function(a,c,b){if(c.proj&&b.proj){a=Proj4js.transform(c.proj,b.proj,a)}else{if(c&&b&&OpenLayers.Projection.transforms[c.getCode()]&&OpenLayers.Projection.transforms[c.getCode()][b.getCode()]){OpenLayers.Projection.transforms[c.getCode()][b.getCode()](a)}}return a};OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,initialize:function(b){OpenLayers.Protocol.prototype.initialize.apply(this,[b]);if(!b.format){this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))}if(!this.featureNS&&this.featurePrefix){var a=this.format.readNode;this.format.readNode=function(c,d){if(!this.featureNS&&c.prefix==this.featurePrefix){this.featureNS=c.namespaceURI;this.setNamespace("feature",this.featureNS)}return a.apply(this,arguments)}}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(b){OpenLayers.Protocol.prototype.read.apply(this,arguments);b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options||{});var a=new OpenLayers.Protocol.Response({requestType:"read"});var c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",b)]);a.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleRead,a,b),params:b.params,headers:b.headers,data:c});return a},handleRead:function(a,b){if(b.callback){var c=a.priv;if(c.status>=200&&c.status<300){a.features=this.parseFeatures(c);a.code=OpenLayers.Protocol.Response.SUCCESS}else{a.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return(this.readFormat!==null)?this.readFormat.read(b):this.format.read(b)},commit:function(c,b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options);var a=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:c});a.priv=OpenLayers.Request.POST({url:b.url,data:this.format.write(c,b),callback:this.createCallback(this.handleCommit,a,b)});return a},handleCommit:function(a,b){if(b.callback){var c=a.priv;var d=c.responseXML;if(!d||!d.documentElement){d=c.responseText}var e=this.format.read(d)||{};a.insertIds=e.insertIds||[];a.code=(e.success)?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},filterDelete:function(e,c){c=OpenLayers.Util.extend({},c);OpenLayers.Util.applyDefaults(c,this.options);var b=new OpenLayers.Protocol.Response({requestType:"commit"});var a=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});var d=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(c.featureNS?this.featurePrefix+":":"")+c.featureType}});if(c.featureNS){d.setAttribute("xmlns:"+this.featurePrefix,c.featureNS)}var g=this.format.writeNode("ogc:Filter",e);d.appendChild(g);a.appendChild(d);var f=OpenLayers.Format.XML.prototype.write.apply(this.format,[a]);return OpenLayers.Request.POST({url:this.url,callback:c.callback||function(){},data:f})},abort:function(a){if(a){a.priv.abort()}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,isGecko:null,supportUse:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.supportUse=(navigator.userAgent.toLowerCase().indexOf("applewebkit/5")==-1);this.isGecko=(navigator.userAgent.toLowerCase().indexOf("gecko/")!=-1);this.symbolMetrics={}},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1")))},inValidRange:function(a,e,b){var d=a+(b?0:this.translationParameters.x);var c=e+(b?0:this.translationParameters.y);return(d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&c>=-this.MAX_PIXEL&&c<=this.MAX_PIXEL)},setExtent:function(b,d){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var a=this.getResolution();var f=-b.left/a;var e=b.top/a;if(d){this.left=f;this.top=e;var c="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",c);this.translate(0,0);return true}else{var g=this.translate(f-this.left,e-this.top);if(!g){this.setExtent(b,true)}return g}},translate:function(a,c){if(!this.inValidRange(a,c,true)){return false}else{var b="";if(a||c){b="translate("+a+","+c+")"}this.root.setAttributeNS(null,"transform",b);this.translationParameters={x:a,y:c};return true}},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="image"}else{if(this.isComplexSymbol(b.graphicName)){a=this.supportUse===false?"svg":"use"}else{a="circle"}}break;case"OpenLayers.Geometry.Rectangle":a="rect";break;case"OpenLayers.Geometry.LineString":a="polyline";break;case"OpenLayers.Geometry.LinearRing":a="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="path";break;default:break}return a},setStyle:function(q,u,b){u=u||q._style;b=b||q._options;var k=parseFloat(q.getAttributeNS(null,"r"));var j=1;var d;if(q._geometryClass=="OpenLayers.Geometry.Point"&&k){q.style.visibility="";if(u.graphic===false){q.style.visibility="hidden"}else{if(u.externalGraphic){d=this.getPosition(q);if(u.graphicTitle){q.setAttributeNS(null,"title",u.graphicTitle)}if(u.graphicWidth&&u.graphicHeight){q.setAttributeNS(null,"preserveAspectRatio","none")}var p=u.graphicWidth||u.graphicHeight;var m=u.graphicHeight||u.graphicWidth;p=p?p:u.pointRadius*2;m=m?m:u.pointRadius*2;var v=(u.graphicXOffset!=undefined)?u.graphicXOffset:-(0.5*p);var f=(u.graphicYOffset!=undefined)?u.graphicYOffset:-(0.5*m);var a=u.graphicOpacity||u.fillOpacity;q.setAttributeNS(null,"x",(d.x+v).toFixed());q.setAttributeNS(null,"y",(d.y+f).toFixed());q.setAttributeNS(null,"width",p);q.setAttributeNS(null,"height",m);q.setAttributeNS(this.xlinkns,"href",u.externalGraphic);q.setAttributeNS(null,"style","opacity: "+a)}else{if(this.isComplexSymbol(u.graphicName)){var c=u.pointRadius*3;var l=c*2;var o=this.importSymbol(u.graphicName);d=this.getPosition(q);j=this.symbolMetrics[o][0]*3/l;var g=q.parentNode;var h=q.nextSibling;if(g){g.removeChild(q)}if(this.supportUse===false){var e=document.getElementById(o);q.firstChild&&q.removeChild(q.firstChild);q.appendChild(e.firstChild.cloneNode(true));q.setAttributeNS(null,"viewBox",e.getAttributeNS(null,"viewBox"))}else{q.setAttributeNS(this.xlinkns,"href","#"+o)}q.setAttributeNS(null,"width",l);q.setAttributeNS(null,"height",l);q.setAttributeNS(null,"x",d.x-c);q.setAttributeNS(null,"y",d.y-c);if(h){g.insertBefore(q,h)}else{if(g){g.appendChild(q)}}}else{q.setAttributeNS(null,"r",u.pointRadius)}}}var t=u.rotation;if((t!==undefined||q._rotation!==undefined)&&d){q._rotation=t;t|=0;if(q.nodeName!=="svg"){q.setAttributeNS(null,"transform","rotate("+t+" "+d.x+" "+d.y+")")}else{var s=this.symbolMetrics[o];q.firstChild.setAttributeNS(null,"transform","rotate("+u.rotation+" "+s[1]+" "+s[2]+")")}}}if(b.isFilled){q.setAttributeNS(null,"fill",u.fillColor);q.setAttributeNS(null,"fill-opacity",u.fillOpacity)}else{q.setAttributeNS(null,"fill","none")}if(b.isStroked){q.setAttributeNS(null,"stroke",u.strokeColor);q.setAttributeNS(null,"stroke-opacity",u.strokeOpacity);q.setAttributeNS(null,"stroke-width",u.strokeWidth*j);q.setAttributeNS(null,"stroke-linecap",u.strokeLinecap||"round");q.setAttributeNS(null,"stroke-linejoin","round");u.strokeDashstyle&&q.setAttributeNS(null,"stroke-dasharray",this.dashStyle(u,j))}else{q.setAttributeNS(null,"stroke","none")}if(u.pointerEvents){q.setAttributeNS(null,"pointer-events",u.pointerEvents)}if(u.cursor!=null){q.setAttributeNS(null,"cursor",u.cursor)}return q},dashStyle:function(c,b){var a=c.strokeWidth*b;var d=c.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*a].join();case"dash":return[4*a,4*a].join();case"dashdot":return[4*a,4*a,1,4*a].join();case"longdash":return[8*a,4*a].join();case"longdashdot":return[8*a,4*a,1,4*a].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,c){var b=document.createElementNS(this.xmlns,a);if(c){b.setAttributeNS(null,"id",c)}return b},nodeTypeCompare:function(b,a){return(a==b.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(a);return a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(d,e,b){var c=this.getResolution();var a=(e.x/c+this.left);var f=(this.top-e.y/c);if(this.inValidRange(a,f)){d.setAttributeNS(null,"cx",a);d.setAttributeNS(null,"cy",f);d.setAttributeNS(null,"r",b);return d}else{return false}},drawLineString:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawLinearRing:function(b,c){var a=this.getComponentsString(c.components);if(a.path){b.setAttributeNS(null,"points",a.path);return(a.complete?b:null)}else{return false}},drawPolygon:function(b,h){var g="";var k=true;var a=true;var c,l;for(var e=0,f=h.components.length;e<f;e++){g+=" M";c=this.getComponentsString(h.components[e].components," ");l=c.path;if(l){g+=" "+l;a=c.complete&&a}else{k=false}}g+=" z";if(k){b.setAttributeNS(null,"d",g);b.setAttributeNS(null,"fill-rule","evenodd");return a?b:null}else{return false}},drawRectangle:function(c,d){var b=this.getResolution();var a=(d.x/b+this.left);var e=(this.top-d.y/b);if(this.inValidRange(a,e)){c.setAttributeNS(null,"x",a);c.setAttributeNS(null,"y",e);c.setAttributeNS(null,"width",d.width/b);c.setAttributeNS(null,"height",d.height/b);return c}else{return false}},drawSurface:function(f,h){var g=null;var b=true;for(var e=0,a=h.components.length;e<a;e++){if((e%3)==0&&(e/3)==0){var c=this.getShortString(h.components[e]);if(!c){b=false}g="M "+c}else{if((e%3)==1){var c=this.getShortString(h.components[e]);if(!c){b=false}g+=" C "+c}else{var c=this.getShortString(h.components[e]);if(!c){b=false}g+=" "+c}}}g+=" Z";if(b){f.setAttributeNS(null,"d",g);return f}else{return false}},drawText:function(c,a,j){var b=this.getResolution();var h=(j.x/b+this.left);var e=(j.y/b-this.top);var g=this.nodeFactory(c+this.LABEL_ID_SUFFIX,"text");var f=this.nodeFactory(c+this.LABEL_ID_SUFFIX+"_tspan","tspan");g.setAttributeNS(null,"x",h);g.setAttributeNS(null,"y",-e);if(a.fontColor){g.setAttributeNS(null,"fill",a.fontColor)}if(a.fontOpacity){g.setAttributeNS(null,"opacity",a.fontOpacity)}if(a.fontFamily){g.setAttributeNS(null,"font-family",a.fontFamily)}if(a.fontSize){g.setAttributeNS(null,"font-size",a.fontSize)}if(a.fontWeight){g.setAttributeNS(null,"font-weight",a.fontWeight)}if(a.labelSelect===true){g.setAttributeNS(null,"pointer-events","visible");g._featureId=c;f._featureId=c;f._geometry=j;f._geometryClass=j.CLASS_NAME}else{g.setAttributeNS(null,"pointer-events","none")}var d=a.labelAlign||"cm";g.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[d[0]]||"middle");if(this.isGecko){g.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[d[1]]||"central")}else{f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[d[1]]||"-35%")}f.textContent=a.label;if(!g.parentNode){g.appendChild(f);this.textRoot.appendChild(g)}},getComponentsString:function(d,c){var f=[];var a=true;var e=d.length;var j=[];var g,h;for(var b=0;b<e;b++){h=d[b];f.push(h);g=this.getShortString(h);if(g){j.push(g)}else{if(b>0){if(this.getShortString(d[b-1])){j.push(this.clipLine(d[b],d[b-1]))}}if(b<e-1){if(this.getShortString(d[b+1])){j.push(this.clipLine(d[b],d[b+1]))}}a=false}}return{path:j.join(c||","),complete:a}},clipLine:function(e,h){if(h.equals(e)){return""}var f=this.getResolution();var b=this.MAX_PIXEL-this.translationParameters.x;var a=this.MAX_PIXEL-this.translationParameters.y;var d=h.x/f+this.left;var l=this.top-h.y/f;var c=e.x/f+this.left;var j=this.top-e.y/f;var g;if(c<-b||c>b){g=(j-l)/(c-d);c=c<0?-b:b;j=l+(c-d)*g}if(j<-a||j>a){g=(c-d)/(j-l);j=j<0?-a:a;c=d+(j-l)*g}return c+","+j},getShortString:function(b){var c=this.getResolution();var a=(b.x/c+this.left);var d=(this.top-b.y/c);if(this.inValidRange(a,d)){return a+","+d}else{return false}},getPosition:function(a){return({x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))})},importSymbol:function(e){if(!this.defs){this.defs=this.createDefs()}var b=this.container.id+"-"+e;if(document.getElementById(b)!=null){return b}var d=OpenLayers.Renderer.symbol[e];if(!d){throw new Error(e+" is not a valid symbol name")}var g=this.nodeFactory(b,"symbol");var c=this.nodeFactory(null,"polygon");g.appendChild(c);var m=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var k=[];var j,h;for(var f=0;f<d.length;f=f+2){j=d[f];h=d[f+1];m.left=Math.min(m.left,j);m.bottom=Math.min(m.bottom,h);m.right=Math.max(m.right,j);m.top=Math.max(m.top,h);k.push(j,",",h)}c.setAttributeNS(null,"points",k.join(" "));var a=m.getWidth();var l=m.getHeight();var o=[m.left-a,m.bottom-l,a*3,l*3];g.setAttributeNS(null,"viewBox",o.join(" "));this.symbolMetrics[b]=[Math.max(a,l),m.getCenterLonLat().lon,m.getCenterLonLat().lat];this.defs.appendChild(g);return g.id},getFeatureIdFromEvent:function(a){var c=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(this.supportUse===false&&!c){var b=a.target;c=b.parentNode&&b!=this.rendererRoot&&b.parentNode._featureId}return c},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(b){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var e=document.createStyleSheet();var c=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var d=0,a=c.length;d<a;d++){e.addRule("olv\\:"+c[d],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Renderer.Elements.prototype.destroy.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(j,a){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var c=this.getResolution();var b=(j.left/c)|0;var f=(j.top/c-this.size.h)|0;if(a||!this.offset){this.offset={x:b,y:f};b=0;f=0}else{b=b-this.offset.x;f=f-this.offset.y}var l=b+" "+f;this.root.coordorigin=l;var h=[this.root,this.vectorRoot,this.textRoot];var g;for(var d=0,e=h.length;d<e;++d){g=h[d];var k=this.size.w+" "+this.size.h;g.coordsize=k}this.root.style.flip="y";return true},setSize:function(f){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var d=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var c=this.size.w+"px";var g=this.size.h+"px";var b;for(var e=0,a=d.length;e<a;++e){b=d[e];b.style.width=c;b.style.height=g}},getNodeType:function(c,b){var a=null;switch(c.CLASS_NAME){case"OpenLayers.Geometry.Point":if(b.externalGraphic){a="olv:rect"}else{if(this.isComplexSymbol(b.graphicName)){a="olv:shape"}else{a="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":a="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":a="olv:shape";break;default:break}return a},setStyle:function(e,b,s,l){b=b||e._style;s=s||e._options;var c=b.fillColor;if(e._geometryClass==="OpenLayers.Geometry.Point"){if(b.externalGraphic){if(b.graphicTitle){e.title=b.graphicTitle}var d=b.graphicWidth||b.graphicHeight;var m=b.graphicHeight||b.graphicWidth;d=d?d:b.pointRadius*2;m=m?m:b.pointRadius*2;var g=this.getResolution();var j=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*d);var f=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*m);e.style.left=(((l.x/g-this.offset.x)+j)|0)+"px";e.style.top=(((l.y/g-this.offset.y)-(f+m))|0)+"px";e.style.width=d+"px";e.style.height=m+"px";e.style.flip="y";c="none";s.isStroked=false}else{if(this.isComplexSymbol(b.graphicName)){var a=this.importSymbol(b.graphicName);e.path=a.path;e.coordorigin=a.left+","+a.bottom;var r=a.size;e.coordsize=r+","+r;this.drawCircle(e,l,b.pointRadius);e.style.flip="y"}else{this.drawCircle(e,l,b.pointRadius)}}}if(s.isFilled){e.fillcolor=c}else{e.filled="false"}var k=e.getElementsByTagName("fill");var q=(k.length==0)?null:k[0];if(!s.isFilled){if(q){e.removeChild(q)}}else{if(!q){q=this.createNode("olv:fill",e.id+"_fill")}q.opacity=b.fillOpacity;if(e._geometryClass==="OpenLayers.Geometry.Point"&&b.externalGraphic){if(b.graphicOpacity){q.opacity=b.graphicOpacity}q.src=b.externalGraphic;q.type="frame";if(!(b.graphicWidth&&b.graphicHeight)){q.aspect="atmost"}}if(q.parentNode!=e){e.appendChild(q)}}var p=b.rotation;if((p!==undefined||e._rotation!==undefined)){e._rotation=p;if(b.externalGraphic){this.graphicRotate(e,j,f,b);q.opacity=0}else{if(e._geometryClass==="OpenLayers.Geometry.Point"){e.style.rotation=p||0}}}var h=e.getElementsByTagName("stroke");var o=(h.length==0)?null:h[0];if(!s.isStroked){e.stroked=false;if(o){o.on=false}}else{if(!o){o=this.createNode("olv:stroke",e.id+"_stroke");e.appendChild(o)}o.on=true;o.color=b.strokeColor;o.weight=b.strokeWidth+"px";o.opacity=b.strokeOpacity;o.endcap=b.strokeLinecap=="butt"?"flat":(b.strokeLinecap||"round");if(b.strokeDashstyle){o.dashstyle=this.dashStyle(b)}}if(b.cursor!="inherit"&&b.cursor!=null){e.style.cursor=b.cursor}return e},graphicRotate:function(p,t,e,s){var s=s||p._style;var q=s.rotation||0;var a,k;if(!(s.graphicWidth&&s.graphicHeight)){var u=new Image();u.onreadystatechange=OpenLayers.Function.bind(function(){if(u.readyState=="complete"||u.readyState=="interactive"){a=u.width/u.height;k=Math.max(s.pointRadius*2,s.graphicWidth||0,s.graphicHeight||0);t=t*a;s.graphicWidth=k*a;s.graphicHeight=k;this.graphicRotate(p,t,e,s)}},this);u.src=s.externalGraphic;return}else{k=Math.max(s.graphicWidth,s.graphicHeight);a=s.graphicWidth/s.graphicHeight}var o=Math.round(s.graphicWidth||k*a);var l=Math.round(s.graphicHeight||k);p.style.width=o+"px";p.style.height=l+"px";var m=document.getElementById(p.id+"_image");if(!m){m=this.createNode("olv:imagedata",p.id+"_image");p.appendChild(m)}m.style.width=o+"px";m.style.height=l+"px";m.src=s.externalGraphic;m.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var f=q*Math.PI/180;var h=Math.sin(f);var d=Math.cos(f);var g="progid:DXImageTransform.Microsoft.Matrix(M11="+d+",M12="+(-h)+",M21="+h+",M22="+d+",SizingMethod='auto expand')\n";var b=s.graphicOpacity||s.fillOpacity;if(b&&b!=1){g+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+b+")\n"}p.style.filter=g;var r=new OpenLayers.Geometry.Point(-t,-e);var c=new OpenLayers.Bounds(0,0,o,l).toGeometry();c.rotate(s.rotation,r);var j=c.getBounds();p.style.left=Math.round(parseInt(p.style.left)+j.left)+"px";p.style.top=Math.round(parseInt(p.style.top)-j.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var c=a._style.fillColor;var b=a._style.strokeColor;if(c=="none"&&a.fillcolor!=c){a.fillcolor=c}if(b=="none"&&a.strokecolor!=b){a.strokecolor=b}},setNodeDimension:function(b,e){var d=e.getBounds();if(d){var a=this.getResolution();var c=new OpenLayers.Bounds((d.left/a-this.offset.x)|0,(d.bottom/a-this.offset.y)|0,(d.right/a-this.offset.x)|0,(d.top/a-this.offset.y)|0);b.style.left=c.left+"px";b.style.top=c.top+"px";b.style.width=c.getWidth()+"px";b.style.height=c.getHeight()+"px";b.coordorigin=c.left+" "+c.top;b.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){var c=a.strokeDashstyle;switch(c){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return c;default:var b=c.split(/[ ,]/);if(b.length==2){if(1*b[0]>=2*b[1]){return"longdash"}return(b[0]==1||b[1]==1)?"dot":"dash"}else{if(b.length==4){return(1*b[0]>=2*b[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(a,c){var b=document.createElement(a);if(c){b.id=c}b.unselectable="on";b.onselectstart=OpenLayers.Function.False;return b},nodeTypeCompare:function(c,b){var d=b;var a=d.indexOf(":");if(a!=-1){d=d.substr(a+1)}var e=c.nodeName;a=e.indexOf(":");if(a!=-1){e=e.substr(a+1)}return(d==e)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(d,e,a){if(!isNaN(e.x)&&!isNaN(e.y)){var b=this.getResolution();d.style.left=(((e.x/b-this.offset.x)|0)-a)+"px";d.style.top=(((e.y/b-this.offset.y)|0)-a)+"px";var c=a*2;d.style.width=c+"px";d.style.height=c+"px";return d}return false},drawLineString:function(a,b){return this.drawLine(a,b,false)},drawLinearRing:function(a,b){return this.drawLine(a,b,true)},drawLine:function(b,k,g){this.setNodeDimension(b,k);var c=this.getResolution();var a=k.components.length;var e=new Array(a);var h,l,j;for(var f=0;f<a;f++){h=k.components[f];l=(h.x/c-this.offset.x)|0;j=(h.y/c-this.offset.y)|0;e[f]=" "+l+","+j+" l "}var d=(g)?" x e":" e";b.path="m"+e.join("")+d;return b},drawPolygon:function(b,l){this.setNodeDimension(b,l);var c=this.getResolution();var o=[];var f,e,d,h,a,g,m,k;for(d=0,h=l.components.length;d<h;d++){f=l.components[d];o.push("m");for(e=0,a=f.components.length;e<a;e++){g=f.components[e];m=(g.x/c-this.offset.x)|0;k=(g.y/c-this.offset.y)|0;o.push(" "+m+","+k);if(e==0){o.push(" l")}}o.push(" x ")}o.push("e");b.path=o.join("");return b},drawRectangle:function(b,c){var a=this.getResolution();b.style.left=((c.x/a-this.offset.x)|0)+"px";b.style.top=((c.y/a-this.offset.y)|0)+"px";b.style.width=((c.width/a)|0)+"px";b.style.height=((c.height/a)|0)+"px";return b},drawText:function(d,a,h){var g=this.nodeFactory(d+this.LABEL_ID_SUFFIX,"olv:rect");var f=this.nodeFactory(d+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var c=this.getResolution();g.style.left=((h.x/c-this.offset.x)|0)+"px";g.style.top=((h.y/c-this.offset.y)|0)+"px";g.style.flip="y";f.innerText=a.label;if(a.fontColor){f.style.color=a.fontColor}if(a.fontOpacity){f.style.filter="alpha(opacity="+(a.fontOpacity*100)+")"}if(a.fontFamily){f.style.fontFamily=a.fontFamily}if(a.fontSize){f.style.fontSize=a.fontSize}if(a.fontWeight){f.style.fontWeight=a.fontWeight}if(a.labelSelect===true){g._featureId=d;f._featureId=d;f._geometry=h;f._geometryClass=h.CLASS_NAME}f.style.whiteSpace="nowrap";f.inset="1px,0px,0px,0px";if(!g.parentNode){g.appendChild(f);this.textRoot.appendChild(g)}var e=a.labelAlign||"cm";if(e.length==1){e+="m"}var j=f.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[e.substr(0,1)]);var b=f.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[e.substr(1,1)]);g.style.left=parseInt(g.style.left)-j-1+"px";g.style.top=parseInt(g.style.top)+b+"px"},drawSurface:function(a,g){this.setNodeDimension(a,g);var b=this.getResolution();var j=[];var d,h,f;for(var c=0,e=g.components.length;c<e;c++){d=g.components[c];h=(d.x/b-this.offset.x)|0;f=(d.y/b-this.offset.y)|0;if((c%3)==0&&(c/3)==0){j.push("m")}else{if((c%3)==1){j.push(" c")}}j.push(" "+h+","+f)}j.push(" x e");a.path=j.join("");return a},moveRoot:function(b){var a=this.map.getLayer(b.container.id);if(a instanceof OpenLayers.Layer.Vector.RootContainer){a=this.map.getLayer(this.container.id)}a&&a.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);a&&a.redraw()},importSymbol:function(d){var b=this.container.id+"-"+d;var a=this.symbolCache[b];if(a){return a}var c=OpenLayers.Renderer.symbol[d];if(!c){throw new Error(d+" is not a valid symbol name")}var k=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var e=["m"];for(var f=0;f<c.length;f=f+2){var h=c[f];var g=c[f+1];k.left=Math.min(k.left,h);k.bottom=Math.min(k.bottom,g);k.right=Math.max(k.right,h);k.top=Math.max(k.top,g);e.push(h);e.push(g);if(f==0){e.push("l")}}e.push("x e");var l=e.join(" ");var j=(k.getWidth()-k.getHeight())/2;if(j>0){k.bottom=k.bottom-j;k.top=k.top+j}else{k.left=k.left+j;k.right=k.right-j}a={path:l,size:k.getWidth(),left:k.left,bottom:k.bottom};this.symbolCache[b]=a;return a},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(d,a,e,b,c){this.layer=d;this.position=a.clone();this.bounds=e.clone();this.url=b;this.size=c.clone();this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(a,this);return a},draw:function(){var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));this.shouldDraw=(b||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw},moveTo:function(b,a,c){if(c==null){c=true}this.bounds=b.clone();this.position=a.clone();if(c){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(a){var f=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(f);var d=this.layer.map.getLonLatFromLayerPx(a);var c=a.clone();c.x+=this.size.w;c.y+=this.size.h;var b=this.layer.map.getLonLatFromLayerPx(c);if(d.lon>b.lon){if(d.lon<0){d.lon=-180-(d.lon+180)}else{b.lon=180+b.lon+180}}var e=new OpenLayers.Bounds(d.lon,b.lat,b.lon,d.lat);return e},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Control.MouseToolbar=OpenLayers.Class(OpenLayers.Control.MouseDefaults,{mode:null,buttons:null,direction:"vertical",buttonClicked:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.position=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,OpenLayers.Control.MouseToolbar.Y);if(a){this.position=a}if(b){this.direction=b}this.measureDivs=[]},destroy:function(){for(var b in this.buttons){var a=this.buttons[b];a.map=null;a.events.destroy()}OpenLayers.Control.MouseDefaults.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);OpenLayers.Control.MouseDefaults.prototype.draw.apply(this,arguments);this.buttons={};var b=new OpenLayers.Size(28,28);var a=new OpenLayers.Pixel(OpenLayers.Control.MouseToolbar.X,0);this._addButton("zoombox","drag-rectangle-off.png","drag-rectangle-on.png",a,b,"Shift->Drag to zoom to area");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this._addButton("pan","panning-hand-off.png","panning-hand-on.png",a,b,"Drag the map to pan.");a=a.add((this.direction=="vertical"?0:b.w),(this.direction=="vertical"?b.h:0));this.switchModeTo("pan");return this.div},_addButton:function(a,e,d,j,g,h){var f=OpenLayers.Util.getImagesLocation()+e;var c=OpenLayers.Util.getImagesLocation()+d;var b=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MouseToolbar_"+a,j,g,f,"absolute");this.div.appendChild(b);b.imgLocation=f;b.activeImgLocation=c;b.events=new OpenLayers.Events(this,b,null,true);b.events.on({mousedown:this.buttonDown,mouseup:this.buttonUp,dblclick:OpenLayers.Event.stop,scope:this});b.action=a;b.title=h;b.alt=h;b.map=this.map;this.buttons[a]=b;return b},buttonDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.buttonClicked=a.element.action;OpenLayers.Event.stop(a)},buttonUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}if(this.buttonClicked!=null){if(this.buttonClicked==a.element.action){this.switchModeTo(a.element.action)}OpenLayers.Event.stop(a);this.buttonClicked=null}},defaultDblClick:function(b){this.switchModeTo("pan");this.performedDrag=false;var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1);OpenLayers.Event.stop(b);return false},defaultMouseDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.mouseDragStart=a.xy.clone();this.performedDrag=false;this.startViaKeyboard=false;if(a.shiftKey&&this.mode!="zoombox"){this.switchModeTo("zoombox");this.startViaKeyboard=true}else{if(a.altKey&&this.mode!="measure"){this.switchModeTo("measure")}else{if(!this.mode){this.switchModeTo("pan")}}}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.mouseDragStart,null,null,"absolute","2px solid red");this.zoomBox.style.backgroundColor="white";this.zoomBox.style.filter="alpha(opacity=50)";this.zoomBox.style.opacity="0.50";this.zoomBox.style.fontSize="1px";this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);this.performedDrag=true;break;case"measure":var c="";if(this.measureStart){var b=this.map.getLonLatFromViewPortPx(this.mouseDragStart);c=OpenLayers.Util.distVincenty(this.measureStart,b);c=Math.round(c*100)/100;c=c+"km";this.measureStartBox=this.measureBox}this.measureStart=this.map.getLonLatFromViewPortPx(this.mouseDragStart);this.measureBox=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),-2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBox.style.width="4px";this.measureBox.style.height="4px";this.measureBox.style.fontSize="1px";this.measureBox.style.backgroundColor="red";this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);if(c){this.measureBoxDistance=OpenLayers.Util.createDiv(null,this.mouseDragStart.add(-2-parseInt(this.map.layerContainerDiv.style.left),2-parseInt(this.map.layerContainerDiv.style.top)),null,null,"absolute");this.measureBoxDistance.innerHTML=c;this.measureBoxDistance.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBoxDistance);this.measureDivs.push(this.measureBoxDistance)}this.measureBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.layerContainerDiv.appendChild(this.measureBox);this.measureDivs.push(this.measureBox);break;default:this.map.div.style.cursor="move";break}document.onselectstart=OpenLayers.Function.False;OpenLayers.Event.stop(a)},switchModeTo:function(c){if(c!=this.mode){if(this.mode&&this.buttons[this.mode]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[this.mode],null,null,null,this.buttons[this.mode].imgLocation)}if(this.mode=="measure"&&c!="measure"){for(var b=0,a=this.measureDivs.length;b<a;b++){if(this.measureDivs[b]){this.map.layerContainerDiv.removeChild(this.measureDivs[b])}}this.measureDivs=[];this.measureStart=null}this.mode=c;if(this.buttons[c]){OpenLayers.Util.modifyAlphaImageDiv(this.buttons[c],null,null,null,this.buttons[c].activeImgLocation)}switch(this.mode){case"zoombox":this.map.div.style.cursor="crosshair";break;default:this.map.div.style.cursor="";break}}},leaveMode:function(){this.switchModeTo("pan")},defaultMouseMove:function(e){if(this.mouseDragStart!=null){switch(this.mode){case"zoombox":var d=Math.abs(this.mouseDragStart.x-e.xy.x);var b=Math.abs(this.mouseDragStart.y-e.xy.y);this.zoomBox.style.width=Math.max(1,d)+"px";this.zoomBox.style.height=Math.max(1,b)+"px";if(e.xy.x<this.mouseDragStart.x){this.zoomBox.style.left=e.xy.x+"px"}if(e.xy.y<this.mouseDragStart.y){this.zoomBox.style.top=e.xy.y+"px"}break;default:var d=this.mouseDragStart.x-e.xy.x;var b=this.mouseDragStart.y-e.xy.y;var f=this.map.getSize();var a=new OpenLayers.Pixel(f.w/2+d,f.h/2+b);var c=this.map.getLonLatFromViewPortPx(a);this.map.setCenter(c,null,true);this.mouseDragStart=e.xy.clone()}this.performedDrag=true}},defaultMouseUp:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}switch(this.mode){case"zoombox":this.zoomBoxEnd(a);if(this.startViaKeyboard){this.leaveMode()}break;case"pan":if(this.performedDrag){this.map.setCenter(this.map.center)}}document.onselectstart=null;this.mouseDragStart=null;this.map.div.style.cursor="default"},defaultMouseOut:function(a){if(this.mouseDragStart!=null&&OpenLayers.Util.mouseLeft(a,this.map.div)){if(this.zoomBox){this.removeZoomBox();if(this.startViaKeyboard){this.leaveMode()}}this.mouseDragStart=null;this.map.div.style.cursor="default"}},defaultClick:function(a){if(this.performedDrag){this.performedDrag=false;return false}},CLASS_NAME:"OpenLayers.Control.MouseToolbar"});OpenLayers.Control.MouseToolbar.X=6;OpenLayers.Control.MouseToolbar.Y=300;OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions);this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions);this.next=new OpenLayers.Control.Button(c);this.clear()},onPreviousChange:function(b,a){if(b&&!this.previous.active){this.previous.activate()}else{if(!b&&this.previous.active){this.previous.deactivate()}}},onNextChange:function(b,a){if(b&&!this.next.active){this.next.activate()}else{if(!b&&this.next.active){this.next.deactivate()}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var a in this){this[a]=null}},setMap:function(a){this.map=a;this.next.setMap(a);this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var b=this.previousStack.shift();var a=this.previousStack.shift();if(a!=undefined){this.nextStack.unshift(b);this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else{this.previousStack.unshift(b)}return a},nextTrigger:function(){var a=this.nextStack.shift();if(a!=undefined){this.previousStack.unshift(a);this.restoring=true;this.restore(a);this.restoring=false;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return a},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var a,d;if(this.map.getProjectionObject()==e.projection){d=this.map.getZoomForResolution(e.resolution);a=e.center}else{a=e.center.clone();a.transform(e.projection,this.map.getProjectionObject());var f=e.units;var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var c=f&&b?OpenLayers.INCHES_PER_UNIT[f]/OpenLayers.INCHES_PER_UNIT[b]:1;d=this.map.getZoomForResolution(c*e.resolution)}this.map.setCenter(a,d)},setListeners:function(){this.listeners={};for(var a in this.registry){this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b);if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()}if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return true},this)}},activate:function(){var a=false;if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()}for(var b in this.listeners){this.map.events.register(b,this,this.listeners[b])}a=true;if(this.previousStack.length==0){this.initStack()}}}return a},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()}},deactivate:function(){var b=false;if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var a in this.listeners){this.map.events.unregister(a,this,this.listeners[a])}if(this.clearOnDeactivate){this.clear()}b=true}}return b},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,{slideFactor:this.slideFactor}),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,{slideFactor:this.slideFactor}),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,{slideFactor:this.slideFactor}),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,{slideFactor:this.slideFactor})])},CLASS_NAME:"OpenLayers.Control.PanPanel"});OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,divEvents:null,zoomWorldIcon:false,forceFixedZoomLevel:false,mouseDragStart:null,zoomStart:null,initialize:function(){OpenLayers.Control.PanZoom.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){if(this.div!=null){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(b){OpenLayers.Control.prototype.draw.apply(this,arguments);b=this.position.clone();this.buttons=[];var d=new OpenLayers.Size(18,18);var a=new OpenLayers.Pixel(b.x+d.w/2,b.y);var c=d.w;if(this.zoomWorldIcon){a=new OpenLayers.Pixel(b.x+d.w,b.y)}this._addButton("panup","north-mini.png",a,d);b.y=a.y+d.h;this._addButton("panleft","west-mini.png",b,d);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",b.add(d.w,0),d);c*=2}this._addButton("panright","east-mini.png",b.add(c,0),d);this._addButton("pandown","south-mini.png",a.add(0,d.h*2),d);this._addButton("zoomin","zoom-plus-mini.png",a.add(0,d.h*3+5),d);a=this._addZoomBar(a.add(0,d.h*4+5));this._addButton("zoomout","zoom-minus-mini.png",a,d);return this.div},_addZoomBar:function(a){var e=OpenLayers.Util.getImagesLocation();var g=this.id+"_"+this.map.id;var b=this.map.getNumZoomLevels()-1-this.map.getZoom();var c=OpenLayers.Util.createAlphaImageDiv(g,a.add(-1,b*this.zoomStopHeight),new OpenLayers.Size(20,9),e+"slider.png","absolute");this.slider=c;this.sliderEvents=new OpenLayers.Events(this,c,null,true,{includeXY:true});this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var d=new OpenLayers.Size();d.h=this.zoomStopHeight*this.map.getNumZoomLevels();d.w=this.zoomStopWidth;var f=null;if(OpenLayers.Util.alphaHack()){var g=this.id+"_"+this.map.id;f=OpenLayers.Util.createAlphaImageDiv(g,a,new OpenLayers.Size(d.w,this.zoomStopHeight),e+"zoombar.png","absolute",null,"crop");f.style.height=d.h+"px"}else{f=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,d,e+"zoombar.png")}this.zoombarDiv=f;this.divEvents=new OpenLayers.Events(this,f,null,true,{includeXY:true});this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.div.appendChild(f);this.startTop=parseInt(f.style.top);this.div.appendChild(c);this.map.events.register("zoomend",this,this.moveZoomBar);a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());return a},_removeZoomBar:function(){this.sliderEvents.un({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});this.sliderEvents.destroy();this.divEvents.un({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick});this.divEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},divClick:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}var e=a.xy.y;var d=OpenLayers.Util.pagePosition(a.object)[1];var c=(e-d)/this.zoomStopHeight;if(this.forceFixedZoomLevel||!this.map.fractionalZoom){c=Math.floor(c)}var b=(this.map.getNumZoomLevels()-1)-c;b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(b);OpenLayers.Event.stop(a)},zoomBarDown:function(a){if(!OpenLayers.Event.isLeftClick(a)){return}this.map.events.on({mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=a.xy.clone();this.zoomStart=a.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(a)},zoomBarDrag:function(b){if(this.mouseDragStart!=null){var a=this.mouseDragStart.y-b.xy.y;var d=OpenLayers.Util.pagePosition(this.zoombarDiv);if((b.clientY-d[1])>0&&(b.clientY-d[1])<parseInt(this.zoombarDiv.style.height)-2){var c=parseInt(this.slider.style.top)-a;this.slider.style.top=c+"px";this.mouseDragStart=b.xy.clone()}OpenLayers.Event.stop(b)}},zoomBarUp:function(b){if(!OpenLayers.Event.isLeftClick(b)){return}if(this.mouseDragStart){this.div.style.cursor="";this.map.events.un({mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var a=this.zoomStart.y-b.xy.y;var c=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){c+=a/this.zoomStopHeight;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1)}else{c+=Math.round(a/this.zoomStopHeight)}this.map.zoomTo(c);this.mouseDragStart=null;this.zoomStart=null;OpenLayers.Event.stop(b)}},moveZoomBar:function(){var a=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,base:"",displayProjection:null,initialize:function(b,c,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.element=OpenLayers.Util.getElement(b);this.base=c||document.location.href},destroy:function(){if(this.element.parentNode==this.div){this.div.removeChild(this.element)}this.element=null;this.map.events.unregister("moveend",this,this.updateLink);OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,a=this.map.controls.length;b<a;b++){var c=this.map.controls[b];if(c.CLASS_NAME==this.argParserClass.CLASS_NAME){if(c.displayProjection!=this.displayProjection){this.displayProjection=c.displayProjection}break}}if(b==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.className=this.displayClass;this.element=document.createElement("a");this.element.innerHTML=OpenLayers.i18n("permalink");this.element.href="";this.div.appendChild(this.element)}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});this.updateLink();return this.div},updateLink:function(){var a=this.base;if(a.indexOf("?")!=-1){a=a.substring(0,a.indexOf("?"))}a+="?"+OpenLayers.Util.getParameterString(this.createParams());this.element.href=a},createParams:function(a,k,e){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=k||this.map.getZoom();var j=a.lat;var b=a.lon;if(this.displayProjection){var c=OpenLayers.Projection.transform({x:b,y:j},this.map.getProjectionObject(),this.displayProjection);b=c.x;j=c.y}d.lat=Math.round(j*100000)/100000;d.lon=Math.round(b*100000)/100000;e=e||this.map.layers;d.layers="";for(var f=0,h=e.length;f<h;f++){var g=e[f];if(g.isBaseLayer){d.layers+=(g==this.map.baseLayer)?"B":"0"}else{d.layers+=(g.getVisibility())?"T":"F"}}}return d},CLASS_NAME:"OpenLayers.Control.Permalink"});OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.ZoomIn(),new OpenLayers.Control.ZoomToMaxExtent(),new OpenLayers.Control.ZoomOut()])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});OpenLayers.Format.CSWGetDomain=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.CSWGetDomain.DEFAULTS);var a=OpenLayers.Format.CSWGetDomain["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported CSWGetDomain version: "+b.version}return new a(b)};OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};OpenLayers.Format.CSWGetRecords=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.CSWGetRecords.DEFAULTS);var a=OpenLayers.Format.CSWGetRecords["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported CSWGetRecords version: "+b.version}return new a(b)};OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(json,filter){try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){var object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}if(this.keepData){this.data=object}return object}}catch(e){}return null},write:function(e,c){this.pretty=!!c;var a=null;var b=typeof e;if(this.serialize[b]){try{a=this.serialize[b].apply(this,[e])}catch(d){OpenLayers.Console.error("Trouble serializing: "+d)}}return a},writeIndent:function(){var b=[];if(this.pretty){for(var a=0;a<this.level;++a){b.push(this.indent)}}return b.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{object:function(c){if(c==null){return"null"}if(c.constructor==Date){return this.serialize.date.apply(this,[c])}if(c.constructor==Array){return this.serialize.array.apply(this,[c])}var f=["{"];this.level+=1;var d,b,e;var a=false;for(d in c){if(c.hasOwnProperty(d)){b=OpenLayers.Format.JSON.prototype.write.apply(this,[d,this.pretty]);e=OpenLayers.Format.JSON.prototype.write.apply(this,[c[d],this.pretty]);if(b!=null&&e!=null){if(a){f.push(",")}f.push(this.writeNewline(),this.writeIndent(),b,":",this.writeSpace(),e);a=true}}}this.level-=1;f.push(this.writeNewline(),this.writeIndent(),"}");return f.join("")},array:function(e){var c;var d=["["];this.level+=1;for(var b=0,a=e.length;b<a;++b){c=OpenLayers.Format.JSON.prototype.write.apply(this,[e[b],this.pretty]);if(c!=null){if(b>0){d.push(",")}d.push(this.writeNewline(),this.writeIndent(),c)}}this.level-=1;d.push(this.writeNewline(),this.writeIndent(),"]");return d.join("")},string:function(b){var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(b)){return'"'+b.replace(/([\x00-\x1f\\"])/g,function(e,d){var f=a[d];if(f){return f}f=d.charCodeAt();return"\\u00"+Math.floor(f/16).toString(16)+(f%16).toString(16)})+'"'}return'"'+b+'"'},number:function(a){return isFinite(a)?String(a):"null"},"boolean":function(a){return String(a)},date:function(a){function b(c){return(c<10)?"0"+c:c}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.WFST=function(b){b=OpenLayers.Util.applyDefaults(b,OpenLayers.Format.WFST.DEFAULTS);var a=OpenLayers.Format.WFST["v"+b.version.replace(/\./g,"_")];if(!a){throw"Unsupported WFST version: "+b.version}return new a(b)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[a]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var b in this.namespaces){this.namespaceAlias[this.namespaces[b]]=b}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b;this.namespaceAlias[b]=a},read:function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var d;if(window.ActiveXObject&&!this.xmldom){d=new ActiveXObject("Microsoft.XMLDOM")}else{d=this.xmldom}d.loadXML(c);return d}),this),function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var d=new XMLHttpRequest();d.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send(null);return d.responseXML});if(this.keepData){this.data=b}return b},write:function(b){var c;if(this.xmldom){c=b.xml}else{var a=new XMLSerializer();if(b.nodeType==1){var d=document.implementation.createDocument("","",null);if(d.importNode){b=d.importNode(b,true)}d.appendChild(b);c=a.serializeToString(d)}else{c=a.serializeToString(b)}}return c},createElementNS:function(c,a){var b;if(this.xmldom){if(typeof c=="string"){b=this.xmldom.createNode(1,a,c)}else{b=this.xmldom.createNode(1,a,"")}}else{b=document.createElementNS(c,a)}return b},createTextNode:function(b){var a;if(typeof b!=="string"){b=String(b)}if(this.xmldom){a=this.xmldom.createTextNode(b)}else{a=document.createTextNode(b)}return a},getElementsByTagNameNS:function(e,d,c){var a=[];if(e.getElementsByTagNameNS){a=e.getElementsByTagNameNS(d,c)}else{var b=e.getElementsByTagName("*");var j,f;for(var g=0,h=b.length;g<h;++g){j=b[g];f=(j.prefix)?(j.prefix+":"+c):c;if((c=="*")||(f==j.nodeName)){if((d=="*")||(d==j.namespaceURI)){a.push(j)}}}}return a},getAttributeNodeNS:function(c,b,a){var j=null;if(c.getAttributeNodeNS){j=c.getAttributeNodeNS(b,a)}else{var e=c.attributes;var h,d;for(var f=0,g=e.length;f<g;++f){h=e[f];if(h.namespaceURI==b){d=(h.prefix)?(h.prefix+":"+a):a;if(d==h.nodeName){j=h;break}}}}return j},getAttributeNS:function(e,d,a){var b="";if(e.getAttributeNS){b=e.getAttributeNS(d,a)||""}else{var c=this.getAttributeNodeNS(e,d,a);if(c){b=c.nodeValue}}return b},getChildValue:function(a,c){var b=c||"";if(a){for(var d=a.firstChild;d;d=d.nextSibling){switch(d.nodeType){case 3:case 4:b+=d.nodeValue}}}return b},concatChildValues:function(b,d){var c="";var e=b.firstChild;var a;while(e){a=e.nodeValue;if(a){c+=a}e=e.nextSibling}if(c==""&&d!=undefined){c=d}return c},isSimpleContent:function(a){var c=true;for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeType===1){c=false;break}}return c},contentType:function(c){var e=false,b=false;var a=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var d=c.firstChild;d;d=d.nextSibling){switch(d.nodeType){case 1:b=true;break;case 8:break;default:e=true}if(b&&e){break}}if(b&&e){a=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(b){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else{if(e){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}}return a},hasAttributeNS:function(c,b,a){var d=false;if(c.hasAttributeNS){d=c.hasAttributeNS(b,a)}else{d=!!this.getAttributeNodeNS(c,b,a)}return d},setAttributeNS:function(d,c,a,e){if(d.setAttributeNS){d.setAttributeNS(c,a,e)}else{if(this.xmldom){if(c){var b=d.ownerDocument.createNode(2,a,c);b.nodeValue=e;d.setAttributeNode(b)}else{d.setAttribute(a,e)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(b,a){a=a||{};var d=a.uri||this.namespaces[a.prefix];if(!d){var f=b.indexOf(":");d=this.namespaces[b.substring(0,f)]}if(!d){d=this.namespaces[this.defaultPrefix]}var c=this.createElementNS(d,b);if(a.attributes){this.setAttributes(c,a.attributes)}var e=a.value;if(e!=null){c.appendChild(this.createTextNode(e))}return c},setAttributes:function(c,e){var d,b;for(var a in e){if(e[a]!=null&&e[a].toString){d=e[a].toString();b=this.namespaces[a.substring(0,a.indexOf(":"))]||null;this.setAttributeNS(c,b,a,d)}}},readNode:function(c,e){if(!e){e={}}var d=this.readers[c.namespaceURI?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix];if(d){var b=c.localName||c.nodeName.split(":").pop();var a=d[b]||d["*"];if(a){a.apply(this,[c,e])}}return e},readChildNodes:function(d,e){if(!e){e={}}var c=d.childNodes;var f;for(var b=0,a=c.length;b<a;++b){f=c[b];if(f.nodeType==1){this.readNode(f,e)}}return e},writeNode:function(a,f,d){var e,c;var b=a.indexOf(":");if(b>0){e=a.substring(0,b);c=a.substring(b+1)}else{if(d){e=this.namespaceAlias[d.namespaceURI]}else{e=this.defaultPrefix}c=a}var g=this.writers[e][c].apply(this,[f]);if(d){d.appendChild(g)}return g},getChildEl:function(c,a,b){return c&&this.getThisOrNextEl(c.firstChild,a,b)},getNextEl:function(c,a,b){return c&&this.getThisOrNextEl(c.nextSibling,a,b)},getThisOrNextEl:function(d,a,c){outer:for(var b=d;b;b=b.nextSibling){switch(b.nodeType){case 1:if((!a||a===(b.localName||b.nodeName.split(":").pop()))&&(!c||c===b.namespaceURI)){break outer}b=null;break outer;case 3:if(/^\s*$/.test(b.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:b=null;break outer}}return b||null},lookupNamespaceURI:function(e,f){var d=null;if(e){if(e.lookupNamespaceURI){d=e.lookupNamespaceURI(f)}else{outer:switch(e.nodeType){case 1:if(e.namespaceURI!==null&&e.prefix===f){d=e.namespaceURI;break outer}var b=e.attributes.length;if(b){var a;for(var c=0;c<b;++c){a=e.attributes[c];if(a.prefix==="xmlns"&&a.name==="xmlns:"+f){d=a.value||null;break outer}else{if(a.name==="xmlns"&&f===null){d=a.value||null;break outer}}}}d=this.lookupNamespaceURI(e.parentNode,f);break outer;case 2:d=this.lookupNamespaceURI(e.ownerElement,f);break outer;case 9:d=this.lookupNamespaceURI(e.documentElement,f);break outer;case 6:case 12:case 10:case 11:break outer;default:d=this.lookupNamespaceURI(e.parentNode,f);break outer}}}return d},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(d,b,a){OpenLayers.Util.extend(this,a);this.control=d;this.callbacks=b;var c=this.map||d.map;if(c){this.setMap(c)}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){if(this.keyMask==null){return true}var b=(a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0);return(b==this.keyMask)},activate:function(){if(this.active){return false}var c=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=c.length;b<a;b++){if(this[c[b]]){this.register(c[b],this[c[b]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var c=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var b=0,a=c.length;b<a;b++){if(this[c[b]]){this.unregister(c[b],this[c[b]])}}this.active=false;return true},callback:function(b,a){if(b&&this.callbacks[b]){this.callbacks[b].apply(this.control,a)}},register:function(a,b){this.map.events.registerPriority(a,this,b);this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b);this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){this.evt=a;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,initialize:function(h,d){if(arguments.length===1&&typeof h==="object"){d=h;h=d&&d.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,d);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var g=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);g=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(g);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var f=true;var c=document.getElementsByTagName("link");for(var e=0,a=c.length;e<a;++e){if(OpenLayers.Util.isEquivalentUrl(c.item(e).href,this.theme)){f=false;break}}if(f){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b)}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var e=0,a=this.controls.length;e<a;e++){this.addControlToMap(this.controls[e])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(d&&d.layers){this.addLayers(d.layers);if(d.center){this.setCenter(d.center,d.zoom)}}},render:function(a){this.div=OpenLayers.Util.getElement(a);OpenLayers.Element.addClass(this.div,"olMap");this.events.attachToElement(this.div);this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var a=this.controls.length-1;a>=0;--a){this.controls[a].destroy()}this.controls=null}if(this.layers!=null){for(var a=this.layers.length-1;a>=0;--a){this.layers[a].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(a){OpenLayers.Util.extend(this,a)},getTileSize:function(){return this.tileSize},getBy:function(e,c,a){var d=(typeof a.test=="function");var b=OpenLayers.Array.filter(this[e],function(f){return f[c]==a||(d&&a.test(f[c]))});return b},getLayersBy:function(b,a){return this.getBy("layers",b,a)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(b,a){return this.getBy("controls",b,a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(e){var b=null;for(var d=0,a=this.layers.length;d<a;d++){var c=this.layers[d];if(c.id==e){b=c;break}}return b},setLayerZIndex:function(b,a){b.setZIndex(this.Z_INDEX_BASE[b.isBaseLayer?"BaseLayer":"Overlay"]+a*5)},resetLayersZIndex:function(){for(var c=0,a=this.layers.length;c<a;c++){var b=this.layers[c];this.setLayerZIndex(b,c)}},addLayer:function(c){for(var b=0,a=this.layers.length;b<a;b++){if(this.layers[b]==c){var d=OpenLayers.i18n("layerAlreadyAdded",{layerName:c.name});OpenLayers.Console.warn(d);return false}}if(this.allOverlays){c.isBaseLayer=false}if(this.events.triggerEvent("preaddlayer",{layer:c})===false){return}c.div.className="olLayerDiv";c.div.style.overflow="";this.setLayerZIndex(c,this.layers.length);if(c.isFixed){this.viewPortDiv.appendChild(c.div)}else{this.layerContainerDiv.appendChild(c.div)}this.layers.push(c);c.setMap(this);if(c.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(c)}else{c.setVisibility(false)}}else{c.redraw()}this.events.triggerEvent("addlayer",{layer:c});c.afterAdd()},addLayers:function(c){for(var b=0,a=c.length;b<a;b++){this.addLayer(c[b])}},removeLayer:function(c,e){if(e==null){e=true}if(c.isFixed){this.viewPortDiv.removeChild(c.div)}else{this.layerContainerDiv.removeChild(c.div)}OpenLayers.Util.removeItem(this.layers,c);c.removeMap(this);c.map=null;if(this.baseLayer==c){this.baseLayer=null;if(e){for(var b=0,a=this.layers.length;b<a;b++){var d=this.layers[b];if(d.isBaseLayer||this.allOverlays){this.setBaseLayer(d);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:c})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(d,b){var e=this.getLayerIndex(d);if(b<0){b=0}else{if(b>this.layers.length){b=this.layers.length}}if(e!=b){this.layers.splice(e,1);this.layers.splice(b,0,d);for(var c=0,a=this.layers.length;c<a;c++){this.setLayerZIndex(this.layers[c],c)}this.events.triggerEvent("changelayer",{layer:d,property:"order"});if(this.allOverlays){if(b===0){this.setBaseLayer(d)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(b,c){var a=this.getLayerIndex(b)+c;this.setLayerIndex(b,a)},setBaseLayer:function(c){if(c!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,c)!=-1){var a=this.getCenter();var d=OpenLayers.Util.getResolutionFromScale(this.getScale(),c.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=c;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true)}if(a!=null){var b=this.getZoomForResolution(d||this.resolution,true);this.setCenter(a,b,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(b,a){this.controls.push(b);this.addControlToMap(b,a)},addControls:function(b,g){var e=(arguments.length===1)?[]:g;for(var d=0,a=b.length;d<a;d++){var f=b[d];var c=(e[d])?e[d]:null;this.addControl(f,c)}},addControlToMap:function(b,a){b.outsideViewport=(b.div!=null);if(this.displayProjection&&!b.displayProjection){b.displayProjection=this.displayProjection}b.setMap(this);var c=b.draw(a);if(c){if(!b.outsideViewport){c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(c)}}if(b.autoActivate){b.activate()}},getControl:function(e){var b=null;for(var c=0,a=this.controls.length;c<a;c++){var d=this.controls[c];if(d.id==e){b=d;break}}return b},removeControl:function(a){if((a)&&(a==this.getControl(a.id))){if(a.div&&(a.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(a.div)}OpenLayers.Util.removeItem(this.controls,a)}},addPopup:function(a,d){if(d){for(var b=this.popups.length-1;b>=0;--b){this.removePopup(this.popups[b])}}a.map=this;this.popups.push(a);var c=a.draw();if(c){c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(c)}},removePopup:function(a){OpenLayers.Util.removeItem(this.popups,a);if(a.div){try{this.layerContainerDiv.removeChild(a.div)}catch(b){}}a.map=null},getSize:function(){var a=null;if(this.size!=null){a=this.size.clone()}return a},updateSize:function(){var c=this.getCurrentSize();if(c&&!isNaN(c.h)&&!isNaN(c.w)){this.events.clearMouseCache();var f=this.getSize();if(f==null){this.size=f=c}if(!c.equals(f)){this.size=c;for(var d=0,b=this.layers.length;d<b;d++){this.layers[d].onMapResize()}var a=this.getCenter();if(this.baseLayer!=null&&a!=null){var e=this.getZoom();this.zoom=null;this.setCenter(a,e)}}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=this.div.offsetWidth;a.h=this.div.offsetHeight}if(a.w==0&&a.h==0||isNaN(a.w)&&isNaN(a.h)){a.w=parseInt(this.div.style.width);a.h=parseInt(this.div.style.height)}return a},calculateBounds:function(a,b){var e=null;if(a==null){a=this.getCenter()}if(b==null){b=this.getResolution()}if((a!=null)&&(b!=null)){var d=this.getSize();var f=d.w*b;var c=d.h*b;e=new OpenLayers.Bounds(a.lon-f/2,a.lat-c/2,a.lon+f/2,a.lat+c/2)}return e},getCenter:function(){var a=null;if(this.center){a=this.center.clone()}return a},getZoom:function(){return this.zoom},pan:function(d,c,e){e=OpenLayers.Util.applyDefaults(e,{animate:true,dragging:false});var f=this.getViewPortPxFromLonLat(this.getCenter());var b=f.add(d,c);if(!e.dragging||!b.equals(f)){var a=this.getLonLatFromViewPortPx(b);if(e.animate){this.panTo(a)}else{this.setCenter(a,null,e.dragging)}}},panTo:function(b){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(b)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var a=this.getCenter();if(b.lon==a.lon&&b.lat==a.lat){return}var d={lon:a.lon,lat:a.lat};var c={lon:b.lon,lat:b.lat};this.panTween.start(d,c,this.panDuration,{callbacks:{start:OpenLayers.Function.bind(function(e){this.events.triggerEvent("movestart")},this),eachStep:OpenLayers.Function.bind(function(e){e=new OpenLayers.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{dragging:true,noEvent:true})},this),done:OpenLayers.Function.bind(function(e){e=new OpenLayers.LonLat(e.lon,e.lat);this.moveTo(e,this.zoom,{noEvent:true});this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(b)}},setCenter:function(c,a,b,d){this.moveTo(c,a,{dragging:b,forceZoomChange:d,caller:"setCenter"})},moveTo:function(g,o,r){if(!r){r={}}if(o!=null){o=parseFloat(o);if(!this.fractionalZoom){o=Math.round(o)}}var m=r.dragging;var c=r.forceZoomChange;var h=r.noEvent;if(this.panTween&&r.caller=="setCenter"){this.panTween.stop()}if(!this.center&&!this.isValidLonLat(g)){g=this.maxExtent.getCenterLonLat()}if(this.restrictedExtent!=null){if(g==null){g=this.getCenter()}if(o==null){o=this.getZoom()}var d=this.getResolutionForZoom(o);var p=this.calculateBounds(g,d);if(!this.restrictedExtent.containsBounds(p)){var q=this.restrictedExtent.getCenterLonLat();if(p.getWidth()>this.restrictedExtent.getWidth()){g=new OpenLayers.LonLat(q.lon,g.lat)}else{if(p.left<this.restrictedExtent.left){g=g.add(this.restrictedExtent.left-p.left,0)}else{if(p.right>this.restrictedExtent.right){g=g.add(this.restrictedExtent.right-p.right,0)}}}if(p.getHeight()>this.restrictedExtent.getHeight()){g=new OpenLayers.LonLat(g.lon,q.lat)}else{if(p.bottom<this.restrictedExtent.bottom){g=g.add(0,this.restrictedExtent.bottom-p.bottom)}else{if(p.top>this.restrictedExtent.top){g=g.add(0,this.restrictedExtent.top-p.top)}}}}}var b=c||((this.isValidZoomLevel(o))&&(o!=this.getZoom()));var e=(this.isValidLonLat(g))&&(!g.equals(this.center));if(b||e||!m){if(!this.dragging&&!h){this.events.triggerEvent("movestart")}if(e){if((!b)&&(this.center)){this.centerLayerContainer(g)}this.center=g.clone()}if((b)||(this.layerContainerOrigin==null)){this.layerContainerOrigin=this.center.clone();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(b){this.zoom=o;this.resolution=this.getResolutionForZoom(o);this.viewRequestID++}var a=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(a,b,m);if(m){this.baseLayer.events.triggerEvent("move")}else{this.baseLayer.events.triggerEvent("moveend",{zoomChanged:b})}}a=this.baseLayer.getExtent();for(var f=0,k=this.layers.length;f<k;f++){var j=this.layers[f];if(j!==this.baseLayer&&!j.isBaseLayer){var l=j.calculateInRange();if(j.inRange!=l){j.inRange=l;if(!l){j.display(false)}this.events.triggerEvent("changelayer",{layer:j,property:"visibility"})}if(l&&j.visibility){j.moveTo(a,b,m);if(m){j.events.triggerEvent("move")}else{j.events.triggerEvent("moveend",{zoomChanged:b})}}}}if(b){for(var f=0,k=this.popups.length;f<k;f++){this.popups[f].updatePosition()}}this.events.triggerEvent("move");if(b){this.events.triggerEvent("zoomend")}}if(!m&&!h){this.events.triggerEvent("moveend")}this.dragging=!!m},centerLayerContainer:function(b){var a=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var c=this.getViewPortPxFromLonLat(b);if((a!=null)&&(c!=null)){this.layerContainerDiv.style.left=Math.round(a.x-c.x)+"px";this.layerContainerDiv.style.top=Math.round(a.y-c.y)+"px"}},isValidZoomLevel:function(a){return((a!=null)&&(a>=0)&&(a<this.getNumZoomLevels()))},isValidLonLat:function(c){var b=false;if(c!=null){var a=this.getMaxExtent();b=a.containsLonLat(c)}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.projection}return a},getMaxResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.maxResolution}return a},getMaxExtent:function(b){var a=null;if(b&&b.restricted&&this.restrictedExtent){a=this.restrictedExtent}else{if(this.baseLayer!=null){a=this.baseLayer.maxExtent}}return a},getNumZoomLevels:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.numZoomLevels}return a},getExtent:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getExtent()}return a},getResolution:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){a=this.layers[0].getResolution()}}return a},getUnits:function(){var a=null;if(this.baseLayer!=null){a=this.baseLayer.units}return a},getScale:function(){var c=null;if(this.baseLayer!=null){var b=this.getResolution();var a=this.baseLayer.units;c=OpenLayers.Util.getScaleFromResolution(b,a)}return c},getZoomForExtent:function(c,b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getZoomForExtent(c,b)}return a},getResolutionForZoom:function(b){var a=null;if(this.baseLayer){a=this.baseLayer.getResolutionForZoom(b)}return a},getZoomForResolution:function(a,c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForResolution(a,c)}return b},zoomTo:function(a){if(this.isValidZoomLevel(a)){this.setCenter(null,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(d,c){var b=d.getCenterLonLat();if(this.baseLayer.wrapDateLine){var a=this.getMaxExtent();d=d.clone();while(d.right<d.left){d.right+=a.getWidth()}b=d.getCenterLonLat().wrapDateLine(a)}this.setCenter(b,this.getZoomForExtent(d,c))},zoomToMaxExtent:function(c){var b=(c)?c.restricted:true;var a=this.getMaxExtent({restricted:b});this.zoomToExtent(a)},zoomToScale:function(h,g){var d=OpenLayers.Util.getResolutionFromScale(h,this.baseLayer.units);var c=this.getSize();var f=c.w*d;var b=c.h*d;var a=this.getCenter();var e=new OpenLayers.Bounds(a.lon-f/2,a.lat-b/2,a.lon+f/2,a.lat+b/2);this.zoomToExtent(e,g)},getLonLatFromViewPortPx:function(a){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getLonLatFromViewPortPx(a)}return b},getViewPortPxFromLonLat:function(b){var a=null;if(this.baseLayer!=null){a=this.baseLayer.getViewPortPxFromLonLat(b)}return a},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(b){var a=this.getViewPortPxFromLonLat(b);a.x=Math.round(a.x);a.y=Math.round(a.y);return a},getGeodesicPixelSize:function(g){var d=g?this.getLonLatFromPixel(g):(this.getCenter()||new OpenLayers.LonLat(0,0));var e=this.getResolution();var c=d.add(-e/2,0);var j=d.add(e/2,0);var b=d.add(0,-e/2);var f=d.add(0,e/2);var h=new OpenLayers.Projection("EPSG:4326");var a=this.getProjectionObject()||h;if(!a.equals(h)){c.transform(a,h);j.transform(a,h);b.transform(a,h);f.transform(a,h)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(c,j),OpenLayers.Util.distVincenty(b,f))},getViewPortPxFromLayerPx:function(d){var c=null;if(d!=null){var b=parseInt(this.layerContainerDiv.style.left);var a=parseInt(this.layerContainerDiv.style.top);c=d.add(b,a)}return c},getLayerPxFromViewPortPx:function(c){var d=null;if(c!=null){var b=-parseInt(this.layerContainerDiv.style.left);var a=-parseInt(this.layerContainerDiv.style.top);d=c.add(b,a);if(isNaN(d.x)||isNaN(d.y)){d=null}}return d},getLonLatFromLayerPx:function(a){a=this.getViewPortPxFromLayerPx(a);return this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(b){var a=this.getPixelFromLonLat(b);return this.getLayerPxFromViewPortPx(a)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(c,b){this.lonlat=c;var a=(b)?b:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=a}else{this.icon.url=a.url;this.icon.size=a.size;this.icon.offset=a.offset;this.icon.calculateOffset=a.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(a){return this.icon.draw(a)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(a){if((a!=null)&&(this.icon!=null)){this.icon.moveTo(a)}this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){var a=(this.icon&&this.icon.isDrawn());return a},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},inflate:function(b){if(this.icon){var a=new OpenLayers.Size(this.icon.size.w*b,this.icon.size.h*b);this.icon.setSize(a)}},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var a=OpenLayers.Util.getImagesLocation()+"marker.png";var b=new OpenLayers.Size(21,25);var c=function(d){return new OpenLayers.Pixel(-(d.w/2),-d.h)};return new OpenLayers.Icon(a,b,null,c)};OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(g,c,f,b,a,e,d){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(b){var e=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});b=OpenLayers.Util.applyDefaults(b,e);var d=new OpenLayers.Request.XMLHttpRequest();var a=b.url;if(b.params){var c=OpenLayers.Util.getParameterString(b.params);if(c.length>0){var g=(a.indexOf("?")>-1)?"&":"?";a+=g+c}}if(b.proxy&&(a.indexOf("http")==0)){if(typeof b.proxy=="function"){a=b.proxy(a)}else{a=b.proxy+encodeURIComponent(a)}}d.open(b.method,a,b.async,b.user,b.password);for(var f in b.headers){d.setRequestHeader(f,b.headers[f])}var j=this.events;var h=this;d.onreadystatechange=function(){if(d.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var k=j.triggerEvent("complete",{request:d,config:b,requestUrl:a});if(k!==false){h.runCallbacks({request:d,config:b,requestUrl:a})}}};if(b.async===false){d.send(b.data)}else{window.setTimeout(function(){if(d._aborted!==true){d.send(b.data)}},0)}return d},runCallbacks:function(d){var e=d.request;var c=d.config;var a=(c.scope)?OpenLayers.Function.bind(c.callback,c.scope):c.callback;var f;if(c.success){f=(c.scope)?OpenLayers.Function.bind(c.success,c.scope):c.success}var b;if(c.failure){b=(c.scope)?OpenLayers.Function.bind(c.failure,c.scope):c.failure}a(e);if(!e.status||(e.status>=200&&e.status<300)){this.events.triggerEvent("success",d);if(f){f(e)}}if(e.status&&(e.status<200||e.status>=300)){this.events.triggerEvent("failure",d);if(b){b(e)}}},GET:function(a){a=OpenLayers.Util.extend(a,{method:"GET"});return OpenLayers.Request.issue(a)},POST:function(a){a=OpenLayers.Util.extend(a,{method:"POST"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},PUT:function(a){a=OpenLayers.Util.extend(a,{method:"PUT"});a.headers=a.headers?a.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(a.headers))){a.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(a)},DELETE:function(a){a=OpenLayers.Util.extend(a,{method:"DELETE"});return OpenLayers.Request.issue(a)},HEAD:function(a){a=OpenLayers.Util.extend(a,{method:"HEAD"});return OpenLayers.Request.issue(a)},OPTIONS:function(a){a=OpenLayers.Util.extend(a,{method:"OPTIONS"});return OpenLayers.Request.issue(a)}};OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,lastRatio:1,isFirstDraw:true,backBufferTile:null,initialize:function(d,a,e,b,c){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=b;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){if(this.layerAlphaHack){OpenLayers.Event.stopObservingElement(this.imgDiv.childNodes[0])}OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null;this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.prototype.clone.apply(this,[a]);a.imgDiv=null;return a},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(a){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(a&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!a){return false}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var a=this.layer.maxExtent;var b=(a&&this.bounds.intersectsBounds(a,false));if(b){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){if(this.imgDiv==null){this.initImgDiv()}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;if(this.layer.async){this.layer.getURLasync(this.bounds,this,"url",this.positionImage)}else{if(this.layer.url instanceof Array){this.imgDiv.urls=this.layer.url.slice()}this.url=this.layer.getURL(this.bounds);this.positionImage()}return true},positionImage:function(){if(this.layer===null){return}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var a=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,a,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,a);this.imgDiv.src=this.url}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){var d=this.layer.imageOffset;var b=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,d,b,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,d,b,null,"relative",null,null,true)}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var c=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(c,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(c,this))}var a=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){c.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(a,this))},checkImgURL:function(){if(this.layer){var a=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(a,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var d=1;if(this.backBufferTile.resolution){d=this.backBufferTile.resolution/this.layer.getResolution()}if(d!=this.lastRatio){if(this.layer.transitionEffect=="resize"){var c=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var b=new OpenLayers.Size(this.backBufferTile.size.w*d,this.backBufferTile.size.h*d);var a=this.layer.map.getLayerPxFromLonLat(c);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,a,b);var e=this.backBufferTile.imageSize;e=new OpenLayers.Size(e.w*d,e.h*d);var f=this.backBufferTile.imageOffset;if(f){f=new OpenLayers.Pixel(f.x*d,f.y*d)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,f,e);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}this.lastRatio=d},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.Util.getBrowserName()=="safari"||OpenLayers.Util.getBrowserName()=="opera");OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:new OpenLayers.Size(180,90),layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,maximized:false,initialize:function(a){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){if(!this.mapDiv){return}if(this.handlers.click){this.handlers.click.destroy()}if(this.handlers.drag){this.handlers.drag.destroy()}this.mapDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){OpenLayers.Event.stopObservingElement(this.maximizeDiv);this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){OpenLayers.Event.stopObservingElement(this.minimizeDiv);this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!(this.layers.length>0)){if(this.map.baseLayer){var d=this.map.baseLayer.clone();this.layers=[d]}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1000;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.mapDiv.appendChild(this.extentRectangle);this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";var e=OpenLayers.Util.getImagesLocation();var b=e+"layer-switcher-maximize.png";this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,new OpenLayers.Size(18,18),b,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton";OpenLayers.Event.observe(this.maximizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.maximizeControl,this));this.div.appendChild(this.maximizeDiv);var b=e+"layer-switcher-minimize.png";this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,new OpenLayers.Size(18,18),b,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton";OpenLayers.Event.observe(this.minimizeDiv,"click",OpenLayers.Function.bindAsEventListener(this.minimizeControl,this));this.div.appendChild(this.minimizeDiv);var f=["dblclick","mousedown"];for(var c=0,a=f.length;c<a;c++){OpenLayers.Event.observe(this.maximizeDiv,f[c],OpenLayers.Event.stop);OpenLayers.Event.observe(this.minimizeDiv,f[c],OpenLayers.Event.stop)}this.minimizeControl()}else{this.element.style.display=""}if(this.map.getExtent()){this.update()}this.map.events.register("moveend",this,this.update);if(this.maximized){this.maximizeControl()}return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(j){var d=this.handlers.drag.last.x-j.x;var b=this.handlers.drag.last.y-j.y;if(d!=0||b!=0){var g=this.rectPxBounds.top;var a=this.rectPxBounds.left;var e=Math.abs(this.rectPxBounds.getHeight());var c=this.rectPxBounds.getWidth();var f=Math.max(0,(g-b));f=Math.min(f,this.ovmap.size.h-this.hComp-e);var h=Math.max(0,(a-d));h=Math.min(h,this.ovmap.size.w-this.wComp-c);this.setRectPxBounds(new OpenLayers.Bounds(h,f+e,h+c,f))}},mapDivClick:function(j){var b=this.rectPxBounds.getCenterPixel();var e=j.xy.x-b.x;var d=j.xy.y-b.y;var g=this.rectPxBounds.top;var c=this.rectPxBounds.left;var k=Math.abs(this.rectPxBounds.getHeight());var a=this.rectPxBounds.getWidth();var f=Math.max(0,(g+d));f=Math.min(f,this.ovmap.size.h-k);var h=Math.max(0,(c+e));h=Math.min(h,this.ovmap.size.w-a);this.setRectPxBounds(new OpenLayers.Bounds(h,f+k,h+a,f));this.updateMapToRect()},maximizeControl:function(a){this.element.style.display="";this.showToggle(false);if(a!=null){OpenLayers.Event.stop(a)}},minimizeControl:function(a){this.element.style.display="none";this.showToggle(true);if(a!=null){OpenLayers.Event.stop(a)}},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none";this.minimizeDiv.style.display=a?"none":""},update:function(){if(this.ovmap==null){this.createMap()}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()}this.updateRectToMap()},isSuitableOverview:function(){var b=this.map.getExtent();var a=this.map.maxExtent;var c=new OpenLayers.Bounds(Math.max(b.left,a.left),Math.max(b.bottom,a.bottom),Math.min(b.right,a.right),Math.min(b.top,a.top));if(this.ovmap.getProjection()!=this.map.getProjection()){c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}var d=this.ovmap.getResolution()/this.map.getResolution();return((d>this.minRatio)&&(d<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(c)))},updateOverview:function(){var c=this.map.getResolution();var b=this.ovmap.getResolution();var d=b/c;if(d>this.maxRatio){b=this.minRatio*c}else{if(d<=this.minRatio){b=this.maxRatio*c}}var a;if(this.ovmap.getProjection()!=this.map.getProjection()){a=this.map.center.clone();a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{a=this.map.center}this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var b=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,b);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=(this.wComp)?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=(this.hComp)?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);this.rectEvents.register("mouseover",this,function(d){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()}});this.rectEvents.register("mouseout",this,function(d){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()}});if(this.ovmap.getProjection()!=this.map.getProjection()){var c=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;var a=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=c&&a?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[a]:1}},updateRectToMap:function(){var b;if(this.ovmap.getProjection()!=this.map.getProjection()){b=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else{b=this.map.getExtent()}var a=this.getRectBoundsFromMapBounds(b);if(a){this.setRectPxBounds(a)}},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);if(this.ovmap.getProjection()!=this.map.getProjection()){a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())}this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(d){var g=Math.max(d.top,0);var e=Math.max(d.left,0);var b=Math.min(d.top+Math.abs(d.getHeight()),this.ovmap.size.h-this.hComp);var h=Math.min(d.left+d.getWidth(),this.ovmap.size.w-this.wComp);var c=Math.max(h-e,0);var j=Math.max(b-g,0);if(c<this.minRectSize||j<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var f=e+(c/2)-(this.minRectSize/2);var a=g+(j/2)-(this.minRectSize/2);this.extentRectangle.style.top=Math.round(a)+"px";this.extentRectangle.style.left=Math.round(f)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(g)+"px";this.extentRectangle.style.left=Math.round(e)+"px";this.extentRectangle.style.height=Math.round(j)+"px";this.extentRectangle.style.width=Math.round(c)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(e),Math.round(b),Math.round(h),Math.round(g))},getRectBoundsFromMapBounds:function(d){var a=new OpenLayers.LonLat(d.left,d.bottom);var f=new OpenLayers.LonLat(d.right,d.top);var c=this.getOverviewPxFromLonLat(a);var b=this.getOverviewPxFromLonLat(f);var e=null;if(c&&b){e=new OpenLayers.Bounds(c.x,c.y,b.x,b.y)}return e},getMapBoundsFromRectBounds:function(d){var c=new OpenLayers.Pixel(d.left,d.bottom);var b=new OpenLayers.Pixel(d.right,d.top);var a=this.getLonLatFromOverviewPx(c);var e=this.getLonLatFromOverviewPx(b);return new OpenLayers.Bounds(a.lon,a.lat,e.lon,e.lat)},getLonLatFromOverviewPx:function(f){var c=this.ovmap.size;var b=this.ovmap.getResolution();var a=this.ovmap.getExtent().getCenterLonLat();var e=f.x-(c.w/2);var d=f.y-(c.h/2);return new OpenLayers.LonLat(a.lon+e*b,a.lat-d*b)},getOverviewPxFromLonLat:function(d){var b=this.ovmap.getResolution();var c=this.ovmap.getExtent();var a=null;if(c){a=new OpenLayers.Pixel(Math.round(1/b*(d.lon-c.left)),Math.round(1/b*(c.top-d.lat)))}return a},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:OpenLayers.Popup.AnchoredBubble,popup:null,initialize:function(a,c,b){this.layer=a;this.lonlat=c;this.data=(b!=null)?b:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var b=false;if((this.layer!=null)&&(this.layer.map!=null)){var a=this.layer.map.getExtent();b=a.containsLonLat(this.lonlat)}return b},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(b){if(this.lonlat!=null){var c=this.id+"_popup";var a=(this.marker)?this.marker.icon:null;if(!this.popup){this.popup=new this.popupClass(c,this.lonlat,this.data.popupSize,this.data.popupContentHTML,a,b)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={};this.readNode(a,b);return b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(d,e){if(!(e.DomainValues instanceof Array)){e.DomainValues=[]}var b=d.attributes;var f={};for(var c=0,a=b.length;c<a;++c){f[b[c].name]=b[c].nodeValue}this.readChildNodes(d,f);e.DomainValues.push(f)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,b){if(!(b.ListOfValues instanceof Array)){b.ListOfValues=[]}this.readChildNodes(a,b.ListOfValues)},Value:function(d,f){var b=d.attributes;var e={};for(var c=0,a=b.length;c<a;++c){e[b[c].name]=b[c].nodeValue}e.value=this.getChildValue(d);f.push({Value:e})},ConceptualScheme:function(a,b){b.ConceptualScheme={};this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},RangeOfValues:function(a,b){b.RangeOfValues={};this.readChildNodes(a,b.RangeOfValues)},MinValue:function(d,f){var b=d.attributes;var e={};for(var c=0,a=b.length;c<a;++c){e[b[c].name]=b[c].nodeValue}e.value=this.getChildValue(d);f.MinValue=e},MaxValue:function(d,f){var b=d.attributes;var e={};for(var c=0,a=b.length;c<a;++c){e[b[c].name]=b[c].nodeValue}e.value=this.getChildValue(d);f.MaxValue=e}}},write:function(a){var b=this.writeNode("csw:GetDomain",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(a){var b=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});if(a.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b)}else{if(a.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b)}}this.readChildNodes(b,a);return b},PropertyName:function(b){var a=this.createElementNSPlus("csw:PropertyName",{value:b});return a},ParameterName:function(b){var a=this.createElementNSPlus("csw:ParameterName",{value:b});return a}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});OpenLayers.Format.Context=OpenLayers.Class({version:null,layerOptions:null,layerParams:null,parser:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.options=a},read:function(f,d){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}var b=f.documentElement;var a=this.version;if(!a){a=b.getAttribute("version")}var h=this.getParser(a);var e=h.read(f,d);var g;if(d&&d.map){this.context=e;if(d.map instanceof OpenLayers.Map){g=this.mergeContextToMap(e,d.map)}else{var c=d.map;if(OpenLayers.Util.isElement(c)||typeof c=="string"){c={div:c}}g=this.contextToMap(e,c)}}else{g=e}return g},getLayerFromContext:function(g){var c,f;var j={queryable:g.queryable,visibility:g.visibility,maxExtent:g.maxExtent,metadata:OpenLayers.Util.applyDefaults(g.metadata,{styles:g.styles}),numZoomLevels:g.numZoomLevels,units:g.units,isBaseLayer:g.isBaseLayer,opacity:g.opacity,displayInLayerSwitcher:g.displayInLayerSwitcher,singleTile:g.singleTile,tileSize:(g.tileSize)?new OpenLayers.Size(g.tileSize.width,g.tileSize.height):undefined,minScale:g.minScale||g.maxScaleDenominator,maxScale:g.maxScale||g.minScaleDenominator};if(this.layerOptions){OpenLayers.Util.applyDefaults(j,this.layerOptions)}var b={layers:g.name,transparent:g.transparent,version:g.version};if(g.formats&&g.formats.length>0){b.format=g.formats[0].value;for(c=0,f=g.formats.length;c<f;c++){var h=g.formats[c];if(h.current==true){b.format=h.value;break}}}if(g.styles&&g.styles.length>0){for(c=0,f=g.styles.length;c<f;c++){var a=g.styles[c];if(a.current==true){if(a.href){b.sld=a.href}else{if(a.body){b.sld_body=a.body}else{b.styles=a.name}}break}}}if(this.layerParams){OpenLayers.Util.applyDefaults(b,this.layerParams)}var d=null;var e=g.service;if(e==OpenLayers.Format.Context.serviceTypes.WFS){j.strategies=[new OpenLayers.Strategy.BBOX()];j.protocol=new OpenLayers.Protocol.WFS({url:g.url,featurePrefix:g.name.split(":")[0],featureType:g.name.split(":").pop()});d=new OpenLayers.Layer.Vector(g.title||g.name,j)}else{if(e==OpenLayers.Format.Context.serviceTypes.KML){j.strategies=[new OpenLayers.Strategy.Fixed()];j.protocol=new OpenLayers.Protocol.HTTP({url:g.url,format:new OpenLayers.Format.KML()});d=new OpenLayers.Layer.Vector(g.title||g.name,j)}else{if(e==OpenLayers.Format.Context.serviceTypes.GML){j.strategies=[new OpenLayers.Strategy.Fixed()];j.protocol=new OpenLayers.Protocol.HTTP({url:g.url,format:new OpenLayers.Format.GML()});d=new OpenLayers.Layer.Vector(g.title||g.name,j)}else{if(g.features){d=new OpenLayers.Layer.Vector(g.title||g.name,j);d.addFeatures(g.features)}else{if(g.categoryLayer!==true){d=new OpenLayers.Layer.WMS(g.title||g.name,g.url,b,j)}}}}}return d},getLayersFromContext:function(d){var e=[];for(var c=0,a=d.length;c<a;c++){var b=this.getLayerFromContext(d[c]);if(b!==null){e.push(b)}}return e},contextToMap:function(b,a){a=OpenLayers.Util.applyDefaults({maxExtent:b.maxExtent,projection:b.projection},a);var c=new OpenLayers.Map(a);c.addLayers(this.getLayersFromContext(b.layersContext));c.setCenter(b.bounds.getCenterLonLat(),c.getZoomForExtent(b.bounds,true));return c},mergeContextToMap:function(a,b){b.addLayers(this.getLayersFromContext(a.layersContext));return b},write:function(d,b){d=this.toContext(d);var a=b&&b.version;var e=this.getParser(a);var c=e.write(d,b);return c},CLASS_NAME:"OpenLayers.Format.Context"});OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};if(!OpenLayers.Format.OWSCommon){OpenLayers.Format.OWSCommon={}}OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{ows:{ServiceIdentification:function(a,b){b.serviceIdentification={};this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={};this.readChildNodes(a,b.keywords)},Keyword:function(b,a){a[this.getChildValue(b)]=true},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={};this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={};this.readChildNodes(a,b.serviceContact)},IndividualName:function(b,a){a.individualName=this.getChildValue(b)},PositionName:function(b,a){a.positionName=this.getChildValue(b)},ContactInfo:function(b,a){a.contactInfo={};this.readChildNodes(b,a.contactInfo)},Phone:function(b,a){a.phone={};this.readChildNodes(b,a.phone)},Voice:function(b,a){a.voice=this.getChildValue(b)},Address:function(b,a){a.address={};this.readChildNodes(b,a.address)},DeliveryPoint:function(b,a){a.deliveryPoint=this.getChildValue(b)},City:function(b,a){a.city=this.getChildValue(b)},AdministrativeArea:function(b,a){a.administrativeArea=this.getChildValue(b)},PostalCode:function(b,a){a.postalCode=this.getChildValue(b)},Country:function(b,a){a.country=this.getChildValue(b)},ElectronicMailAddress:function(b,a){a.electronicMailAddress=this.getChildValue(b)},Role:function(b,a){a.role=this.getChildValue(b)},OperationsMetadata:function(a,b){b.operationsMetadata={};this.readChildNodes(a,b.operationsMetadata)},Operation:function(c,b){var a=c.getAttribute("name");b[a]={};this.readChildNodes(c,b[a])},DCP:function(b,a){a.dcp={};this.readChildNodes(b,a.dcp)},HTTP:function(b,a){a.http={};this.readChildNodes(b,a.http)},Get:function(b,a){a.get=this.getAttributeNS(b,this.namespaces.xlink,"href")},Post:function(b,a){a.post=this.getAttributeNS(b,this.namespaces.xlink,"href")},Parameter:function(c,a){if(!a.parameters){a.parameters={}}var b=c.getAttribute("name");a.parameters[b]={};this.readChildNodes(c,a.parameters[b])},Value:function(a,b){b[this.getChildValue(a)]=true},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)});this.readChildNodes(a,b)},WGS84BoundingBox:function(b,c){var a={};a.crs=b.getAttribute("crs");if(c.BoundingBox){c.BoundingBox.push(a)}else{c.projection=a.crs;a=c}this.readChildNodes(b,a)},BoundingBox:function(a,b){this.readers.ows["WGS84BoundingBox"].apply(this,[a,b])},LowerCorner:function(b,c){var d=this.getChildValue(b).replace(this.regExes.trimSpace,"");d=d.replace(this.regExes.trimComma,",");var a=d.split(this.regExes.splitSpace);c.left=a[0];c.bottom=a[1]},UpperCorner:function(b,c){var d=this.getChildValue(b).replace(this.regExes.trimSpace,"");d=d.replace(this.regExes.trimComma,",");var a=d.split(this.regExes.splitSpace);c.right=a[0];c.top=a[1];c.bounds=new OpenLayers.Bounds(c.left,c.bottom,c.right,c.top);delete c.left;delete c.bottom;delete c.right;delete c.top}}},writers:{ows:{BoundingBox:function(a){var b=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:a.projection}});this.writeNode("ows:LowerCorner",a,b);this.writeNode("ows:UpperCorner",a,b);return b},LowerCorner:function(a){var b=this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom});return b},UpperCorner:function(a){var b=this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top});return b},Title:function(b){var a=this.createElementNSPlus("ows:Title",{value:b});return a},OutputFormat:function(b){var a=this.createElementNSPlus("ows:OutputFormat",{value:b});return a}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var c=e.documentElement;var b=this.version||c.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==b){var d=OpenLayers.Format.SOSCapabilities["v"+b.replace(/\./g,"_")];if(!d){throw"Can't find a SOS capabilities parser for version "+b}var f=new d(this.options)}var a=f.read(e);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.0",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var c=e.documentElement;var b=this.version;if(!b){b=c.getAttribute("version");if(!b){b=this.defaultVersion}}var d=OpenLayers.Format.WFSCapabilities["v"+b.replace(/\./g,"_")];if(!d){throw"Can't find a WFS capabilities parser for version "+b}var f=new d(this.options);var a=f.read(e);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},readers:{xsd:{schema:function(d,j){var e=[];var b={};var f={complexTypes:e,customTypes:b};this.readChildNodes(d,f);var g=d.attributes;var l,a;for(var h=0,k=g.length;h<k;++h){l=g[h];a=l.name;if(a.indexOf("xmlns")==0){this.setNamespace(a.split(":")[1]||"",l.value)}else{j[a]=l.value}}j.featureTypes=e;j.targetPrefix=this.namespaceAlias[j.targetNamespace];var m,c;for(var h=0,k=e.length;h<k;++h){m=e[h];c=b[m.typeName];if(b[m.typeName]){m.typeName=c.name}}},complexType:function(b,c){var a={typeName:b.getAttribute("name")};this.readChildNodes(b,a);c.complexTypes.push(a)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c);b.properties=c.elements},element:function(a,c){if(c.elements){var d={};var b=a.attributes;var g;for(var e=0,f=b.length;e<f;++e){g=b[e];d[g.name]=g.value}var h=d.type;if(!h){h={};this.readChildNodes(a,h);d.restriction=h;d.type=h.base}var k=h.base||h;d.localType=k.split(":").pop();c.elements.push(d)}if(c.complexTypes){var h=a.getAttribute("type");var j=h.split(":").pop();c.customTypes[j]={name:a.getAttribute("name"),type:h}}},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base");this.readRestriction(a,b)}}},readRestriction:function(d,f){var c=d.childNodes;var h,g,e;for(var b=0,a=c.length;b<a;++b){h=c[b];if(h.nodeType==1){g=h.nodeName.split(":").pop();e=h.getAttribute("value");if(!f[g]){f[g]=e}else{if(typeof f[g]=="string"){f[g]=[f[g]]}f[g].push(e)}}}},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);return a},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(a){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(c,b){var a=b&&b.srsName;if(!a){if(c&&c.layer){a=c.layer.projection.getCode()}else{a=this.srsName}}return a},read:function(b,a){a=a||{};OpenLayers.Util.applyDefaults(a,{output:"features"});if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var c={};if(b){this.readNode(b,c)}if(c.features&&a.output==="features"){c=c.features}return c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[];this.readChildNodes(a,b)}}},write:function(a){var b=this.writeNode("wfs:Transaction",a);var c=this.schemaLocationAttr();if(c){this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",c)}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wfs:{GetFeature:function(b){var d=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,outputFormat:b&&b.outputFormat,maxFeatures:b&&b.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(b)}});if(typeof this.featureType=="string"){this.writeNode("Query",b,d)}else{for(var c=0,a=this.featureType.length;c<a;c++){b.featureType=this.featureType[c];this.writeNode("Query",b,d)}}return d},Transaction:function(e){var f=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});if(e){var b,d;for(var c=0,a=e.length;c<a;++c){d=e[c];b=this.stateName[d.state];if(b){this.writeNode(b,d,f)}}}return f},Insert:function(a){var b=this.createElementNSPlus("wfs:Insert");this.srsName=this.getSrsName(a);this.writeNode("feature:_typeName",a,b);return b},Update:function(b){var c=this.createElementNSPlus("wfs:Update",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){c.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}if(this.geometryName!==null){this.writeNode("Property",{name:this.geometryName,value:b},c)}for(var a in b.attributes){if(b.attributes[a]!==undefined){this.writeNode("Property",{name:a,value:b.attributes[a]},c)}}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),c);return c},Property:function(b){var a=this.createElementNSPlus("wfs:Property");this.writeNode("Name",b.name,a);if(b.value!==null){this.writeNode("Value",b.value,a)}return a},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(c){var b;if(c instanceof OpenLayers.Feature.Vector){b=this.createElementNSPlus("wfs:Value");this.srsName=this.getSrsName(c);var a=this.writeNode("feature:_geometry",c.geometry).firstChild;b.appendChild(a)}else{b=this.createElementNSPlus("wfs:Value",{value:c})}return b},Delete:function(a){var b=this.createElementNSPlus("wfs:Delete",{attributes:{typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});if(this.featureNS){b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[a.fid]}),b);return b}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var f=OpenLayers.Util.extend({},this.schemaLocations);if(a.schema){f[a.featurePrefix]=a.schema}var e=[];var c;for(var b in f){c=this.namespaces[b];if(c){e.push(c+" "+f[b])}}var d=e.join(" ")||undefined;return d},setFilterProperty:function(c){if(c.filters){for(var b=0,a=c.filters.length;b<a;++b){this.setFilterProperty(c.filters[b])}}else{if(c instanceof OpenLayers.Filter.Spatial){c.property=this.geometryName}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var c=e.documentElement;var b=this.version||c.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==b){var d=OpenLayers.Format.WMSCapabilities["v"+b.replace(/\./g,"_")];if(!d){throw"Can't find a WMS capabilities parser for version "+b}this.parser=new d(this.options)}var a=this.parser.read(e);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.1",version:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var c=e.documentElement;var b=this.version;if(!b){b=c.getAttribute("version");if(!b){b=this.defaultVersion}}if(b=="1.1.1"||b=="1.1.0"){b="1.1"}var d=OpenLayers.Format.WMSDescribeLayer["v"+b.replace(/\./g,"_")];if(!d){throw"Can't find a WMS DescribeLayer parser for version "+b}var f=new d(this.options);var a=f.read(e);a.version=b;return a},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,arguments);OpenLayers.Util.extend(this,a);this.options=a},read:function(e){var a;if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var b=e.documentElement;if(b){var c=this;var d=this["read_"+b.nodeName];if(d){a=d.call(this,b)}else{a=new OpenLayers.Format.GML((this.options?this.options:{})).read(e)}}else{a=e}return a},read_msGMLOutput:function(h){var e=[];var b=this.getSiblingNodesByTagCriteria(h,this.layerIdentifier);if(b){for(var k=0,o=b.length;k<o;++k){var c=b[k];var l=c.nodeName;if(c.prefix){l=l.split(":")[1]}var l=l.replace(this.layerIdentifier,"");var m=this.getSiblingNodesByTagCriteria(c,this.featureIdentifier);if(m){for(var g=0;g<m.length;g++){var a=m[g];var d=this.parseGeometry(a);var f=this.parseAttributes(a);var p=new OpenLayers.Feature.Vector(d.geometry,f,null);p.bounds=d.bounds;p.type=l;e.push(p)}}}}return e},read_FeatureInfoResponse:function(f){var c=[];var h=this.getElementsByTagNameNS(f,"*","FIELDS");for(var g=0,k=h.length;g<k;g++){var a=h[g];var l=null;var e={};for(var d=0,m=a.attributes.length;d<m;d++){var b=a.attributes[d];e[b.nodeName]=b.nodeValue}c.push(new OpenLayers.Feature.Vector(l,e,null))}return c},getSiblingNodesByTagCriteria:function(f,j){var a=[];var c,e,d,g,b;if(f&&f.hasChildNodes()){c=f.childNodes;d=c.length;for(var h=0;h<d;h++){b=c[h];while(b&&b.nodeType!=1){b=b.nextSibling;h++}e=(b?b.nodeName:"");if(e.length>0&&e.indexOf(j)>-1){a.push(b)}else{g=this.getSiblingNodesByTagCriteria(b,j);if(g.length>0){(a.length==0)?a=g:a.push(g)}}}}return a},parseAttributes:function(e){var f={};if(e.nodeType==1){var c=e.childNodes;var d=c.length;for(var g=0;g<d;++g){var b=c[g];if(b.nodeType==1){var k=b.childNodes;if(k.length==1){var j=k[0];if(j.nodeType==3||j.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var h=j.nodeValue.replace(this.regExes.trimSpace,"");f[a]=h}}}}}return f},parseGeometry:function(c){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML()}var a=this.gmlFormat.parseFeature(c);var d,b=null;if(a){d=a.geometry&&a.geometry.clone();b=a.bounds&&a.bounds.clone();a.destroy()}return{geometry:d,bounds:b}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,yx:{"urn:ogc:def:crs:EPSG::4326":true},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var b=d.documentElement;var a=this.version||b.getAttribute("version")||this.defaultVersion;if(!this.parser||this.parser.version!==a){var c=OpenLayers.Format.WMTSCapabilities["v"+a.replace(/\./g,"_")];if(!c){throw new Error("Can't find a WMTS capabilities parser for version "+a)}this.parser=new c(this.options)}return this.parser.read(d)},createLayer:function(e,f){var k;var l={layer:true,matrixSet:true};for(var c in l){if(!(c in f)){throw new Error("Missing property '"+c+"' in layer configuration.")}}var g=e.contents;var d=g.tileMatrixSets[f.matrixSet];var j=g.layers;var b;for(var h=0,m=g.layers.length;h<m;++h){if(g.layers[h].identifier===f.layer){b=g.layers[h];break}}if(b&&d){var a;for(var h=0,m=b.styles.length;h<m;++h){a=b.styles[h];if(a.isDefault){break}}k=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(f,{url:e.operationsMetadata.GetTile.dcp.http.get,name:b.title,style:a,matrixIds:d.matrixIds}))}return k},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false,timerId:null,down:null,rightclickTimerId:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.pixelTolerance!=null){this.mousedown=function(d){this.down=d.xy;return true}}},mousedown:null,mouseup:function(b){var a=true;if(this.checkModifiers(b)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(b)){a=this.rightclick(b)}return a},rightclick:function(b){if(this.passesTolerance(b)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[b]);return !this.stopDouble}else{var a=this["double"]?OpenLayers.Util.extend({},b):this.callback("rightclick",[b]);var c=OpenLayers.Function.bind(this.delayedRightCall,this,a);this.rightclickTimerId=window.setTimeout(c,this.delay)}}return !this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null;if(a){this.callback("rightclick",[a])}return !this.stopSingle},dblclick:function(a){if(this.passesTolerance(a)){if(this["double"]){this.callback("dblclick",[a])}this.clearTimer()}return !this.stopDouble},click:function(b){if(this.passesTolerance(b)){if(this.timerId!=null){this.clearTimer()}else{var a=this.single?OpenLayers.Util.extend({},b):null;this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}}return !this.stopSingle},passesTolerance:function(b){var c=true;if(this.pixelTolerance!=null&&this.down){var a=Math.sqrt(Math.pow(this.down.x-b.xy.x,2)+Math.pow(this.down.y-b.xy.y,2));if(a>this.pixelTolerance){c=false}}return c},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(a){this.timerId=null;if(a){this.callback("click",[a])}},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;a=true}return a},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,last:null,start:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(b){var a=true;this.dragging=false;if(this.checkModifiers(b)&&OpenLayers.Event.isLeftClick(b)){this.started=true;this.start=b.xy;this.last=b.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(b);this.callback("down",[b.xy]);OpenLayers.Event.stop(b);if(!this.oldOnselectstart){this.oldOnselectstart=(document.onselectstart)?document.onselectstart:OpenLayers.Function.True}document.onselectstart=OpenLayers.Function.False;a=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return a},mousemove:function(a){if(this.started&&!this.timeoutId&&(a.xy.x!=this.last.x||a.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(a.element===document){this.adjustXY(a);this.setEvent(a)}else{this.destroyDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(a);this.callback("move",[a.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=this.evt.xy}return true},removeTimeout:function(){this.timeoutId=null},mouseup:function(b){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(b);this.destroyDocumentEvents()}var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(b);this.callback("up",[b.xy]);if(a){this.callback("done",[b.xy])}document.onselectstart=this.oldOnselectstart}return true},mouseout:function(b){if(this.started&&OpenLayers.Util.mouseLeft(b,this.map.div)){if(this.documentDrag===true){this.documentEvents=new OpenLayers.Events(this,document,null,null,{includeXY:true});this.documentEvents.on({mousemove:this.mousemove,mouseup:this.mouseup});OpenLayers.Element.addClass(document.body,"olDragDown")}else{var a=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(b);this.callback("out",[]);if(a){this.callback("done",[b.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(a){return(this.start==this.last)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.dragging=false;this.start=null;this.last=null;a=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.div);a.xy.x-=b[0];a.xy.y-=b[1]},destroyDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents.destroy();this.documentEvents=null},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(d,b,c,a){OpenLayers.Handler.prototype.initialize.apply(this,[d,c,a]);this.layer=b},mousedown:function(a){this.down=a.xy;return this.handle(a)?!this.stopDown:true},mouseup:function(a){this.up=a.xy;return this.handle(a)?!this.stopUp:true},click:function(a){return this.handle(a)?!this.stopClick:true},mousemove:function(a){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(a);return true},dblclick:function(a){return !this.handle(a)},geometryTypeMatches:function(a){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){if(this.feature&&!this.feature.layer){this.feature=null}var c=a.type;var f=false;var e=!!(this.feature);var d=(c=="click"||c=="dblclick");this.feature=this.layer.getFeatureFromEvent(a);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){var b=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(e&&b){if(this.lastFeature){this.triggerCallback(c,"out",[this.lastFeature])}this.triggerCallback(c,"in",[this.feature])}else{if(!e||d){this.triggerCallback(c,"in",[this.feature])}}this.lastFeature=this.feature;f=true}else{if(this.lastFeature&&(e&&b||d)){this.triggerCallback(c,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(e||d)){this.triggerCallback(c,"out",[this.lastFeature])}}return f},triggerCallback:function(d,e,b){var c=this.EVENTMAP[d][e];if(c){if(d=="click"&&this.up&&this.down){var a=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(a<=this.clickTolerance){this.callback(c,b)}}else{this.callback(c,b)}}},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});a=true}return a},handleMapEvents:function(a){if(!a.property||a.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;if(a>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(a)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},mousemove:function(a){if(this.passesTolerance(a.xy)){this.clearTimer();this.callback("move",[a]);this.px=a.xy;a=OpenLayers.Util.extend({},a);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)}return !this.stopMove},mouseout:function(a){if(OpenLayers.Util.mouseLeft(a,this.map.div)){this.clearTimer();this.callback("move",[a])}return true},passesTolerance:function(b){var c=true;if(this.pixelTolerance&&this.px){var a=Math.sqrt(Math.pow(this.px.x-b.x,2)+Math.pow(this.px.y-b.y,2));if(a<this.pixelTolerance){c=false}}return c},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();a=true}return a},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.observe(document,this.KEY_EVENTS[b],this.eventListener)}return true}else{return false}},deactivate:function(){var c=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,a=this.KEY_EVENTS.length;b<a;b++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[b],this.eventListener)}c=true}return c},handleKeyEvent:function(a){if(this.checkModifiers(a)){this.callback(a.type,[a])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(k){if(!this.map||!this.checkModifiers(k)){return}var g=false;var m=false;var f=false;var b=OpenLayers.Event.element(k);while((b!=null)&&!f&&!g){if(!g){try{if(b.currentStyle){c=b.currentStyle.overflow}else{var a=document.defaultView.getComputedStyle(b,null);var c=a.getPropertyValue("overflow")}g=(c&&(c=="auto")||(c=="scroll"))}catch(d){}}if(!m){for(var h=0,j=this.map.layers.length;h<j;h++){if(b==this.map.layers[h].div||b==this.map.layers[h].pane){m=true;break}}}f=(b==this.map.div);b=b.parentNode}if(!g&&f){if(m){var l=0;if(!k){k=window.event}if(k.wheelDelta){l=k.wheelDelta/120;if(window.opera&&window.opera.version()<9.2){l=-l}}else{if(k.detail){l=-k.detail/3}}this.delta=this.delta+l;if(this.interval){window.clearTimeout(this._timeoutId);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(k)},this),this.interval)}else{this.wheelZoom(k)}}OpenLayers.Event.stop(k)}},wheelZoom:function(a){var b=this.delta;this.delta=0;if(b){if(this.mousePosition){a.xy=this.mousePosition}if(!a.xy){a.xy=this.map.getPixelFromLonLat(this.map.getCenter())}if(b<0){this.callback("down",[a,this.cumulative?b:-1])}else{this.callback("up",[a,this.cumulative?b:1])}}},mousemove:function(a){this.mousePosition=a.xy},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",b);OpenLayers.Event.observe(window,"mousewheel",b);OpenLayers.Event.observe(document,"mousewheel",b);return true}else{return false}},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b);OpenLayers.Event.stopObserving(window,"mousewheel",b);OpenLayers.Event.stopObserving(document,"mousewheel",b);return true}else{return false}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(b,a){this.addOptions(a);this.name=b;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(a){if(a==null){a=true}if(this.map!=null){this.map.removeLayer(this,a)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(a){if(a==null){a=new OpenLayers.Layer(this.name,this.getOptions())}OpenLayers.Util.applyDefaults(a,this);a.map=null;return a},getOptions:function(){var a={};for(var b in this.options){a[b]=this[b]}return a},setName:function(a){if(a!=this.name){this.name=a;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(c){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,c);OpenLayers.Util.extend(this,c);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var a=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var b in c){if(c.hasOwnProperty(b)&&OpenLayers.Util.indexOf(a,b)>=0){this.initResolutions();break}}}},onMapResize:function(){},redraw:function(){var b=false;if(this.map){this.inRange=this.calculateInRange();var c=this.getExtent();if(c&&this.inRange&&this.visibility){var a=true;this.moveTo(c,a,false);this.events.triggerEvent("moveend",{zoomChanged:a});b=true}}return b},moveTo:function(b,a,c){var d=this.visibility;if(!this.isBaseLayer){d=d&&this.inRange}this.display(d)},setMap:function(b){if(this.map==null){this.map=b;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var a=((this.visibility)&&(this.inRange));this.div.style.display=a?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return(this.imageSize||this.tileSize)},setTileSize:function(a){var b=(a)?a:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=b;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(b.w+(2*this.gutter),b.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility){this.visibility=a;this.display(a);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(a){if(a!=(this.div.style.display!="none")){this.div.style.display=(a&&this.calculateInRange())?"block":"none"}},calculateInRange:function(){var b=false;if(this.alwaysInRange){b=true}else{if(this.map){var a=this.map.getResolution();b=((a>=this.minResolution)&&(a<=this.maxResolution))}}return b},setIsBaseLayer:function(a){if(a!=this.isBaseLayer){this.isBaseLayer=a;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var e,a;var f={},d=true;for(e=0,a=this.RESOLUTION_PROPERTIES.length;e<a;e++){var h=this.RESOLUTION_PROPERTIES[e];f[h]=this.options[h];if(d&&this.options[h]){d=false}}if(this.alwaysInRange==null){this.alwaysInRange=d}if(f.resolutions==null){f.resolutions=this.resolutionsFromScales(f.scales)}if(f.resolutions==null){f.resolutions=this.calculateResolutions(f)}if(f.resolutions==null){for(e=0,a=this.RESOLUTION_PROPERTIES.length;e<a;e++){var h=this.RESOLUTION_PROPERTIES[e];f[h]=this.options[h]!=null?this.options[h]:this.map[h]}if(f.resolutions==null){f.resolutions=this.resolutionsFromScales(f.scales)}if(f.resolutions==null){f.resolutions=this.calculateResolutions(f)}}var c;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){c=this.options.maxResolution}if(this.options.minScale){c=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)}var b;if(this.options.minResolution&&this.options.minResolution!=="auto"){b=this.options.minResolution}if(this.options.maxScale){b=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(f.resolutions){f.resolutions.sort(function(k,j){return(j-k)});if(!c){c=f.resolutions[0]}if(!b){var g=f.resolutions.length-1;b=f.resolutions[g]}}this.resolutions=f.resolutions;if(this.resolutions){a=this.resolutions.length;this.scales=new Array(a);for(e=0;e<a;e++){this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units)}this.numZoomLevels=a}this.minResolution=b;if(b){this.maxScale=OpenLayers.Util.getScaleFromResolution(b,this.units)}this.maxResolution=c;if(c){this.minScale=OpenLayers.Util.getScaleFromResolution(c,this.units)}},resolutionsFromScales:function(d){if(d==null){return}var b,c,a;a=d.length;b=new Array(a);for(c=0;c<a;c++){b[c]=OpenLayers.Util.getResolutionFromScale(d[c],this.units)}return b},calculateResolutions:function(k){var m=k.maxResolution;if(k.minScale!=null){m=OpenLayers.Util.getResolutionFromScale(k.minScale,this.units)}else{if(m=="auto"&&this.maxExtent!=null){var l=this.map.getSize();var j=this.maxExtent.getWidth()/l.w;var g=this.maxExtent.getHeight()/l.h;m=Math.max(j,g)}}var f=k.minResolution;if(k.maxScale!=null){f=OpenLayers.Util.getResolutionFromScale(k.maxScale,this.units)}else{if(k.minResolution=="auto"&&this.minExtent!=null){var l=this.map.getSize();var j=this.minExtent.getWidth()/l.w;var g=this.minExtent.getHeight()/l.h;f=Math.max(j,g)}}var a=k.maxZoomLevel;var b=k.numZoomLevels;if(typeof f==="number"&&typeof m==="number"&&b===undefined){var h=m/f;b=Math.floor(Math.log(h)/Math.log(2))+1}else{if(b===undefined&&a!=null){b=a+1}}if(typeof b!=="number"||b<=0||(typeof m!=="number"&&typeof f!=="number")){return}var d=new Array(b);var c=2;if(typeof f=="number"&&typeof m=="number"){c=Math.pow((m/f),(1/(b-1)))}var e;if(typeof m==="number"){for(e=0;e<b;e++){d[e]=m/Math.pow(c,e)}}else{for(e=0;e<b;e++){d[b-1-e]=f*Math.pow(c,e)}}return d},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(b,c){var d=this.map.getSize();var a=Math.max(b.getWidth()/d.w,b.getHeight()/d.h);return this.getZoomForResolution(a,c)},getDataExtent:function(){},getResolutionForZoom:function(c){c=Math.max(0,Math.min(c,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var a=Math.floor(c);var d=Math.ceil(c);b=this.resolutions[a]-((c-a)*(this.resolutions[a]-this.resolutions[d]))}else{b=this.resolutions[Math.round(c)]}return b},getZoomForResolution:function(e,a){var o;if(this.map.fractionalZoom){var k=0;var c=this.resolutions.length-1;var d=this.resolutions[k];var b=this.resolutions[c];var j;for(var f=0,g=this.resolutions.length;f<g;++f){j=this.resolutions[f];if(j>=e){d=j;k=f}if(j<=e){b=j;c=f;break}}var h=d-b;if(h>0){o=k+((d-e)/h)}else{o=k}}else{var l;var m=Number.POSITIVE_INFINITY;for(var f=0,g=this.resolutions.length;f<g;f++){if(a){l=Math.abs(this.resolutions[f]-e);if(l>m){break}m=l}else{if(this.resolutions[f]<e){break}}}o=Math.max(0,f-1)}return o},getLonLatFromViewPortPx:function(b){var e=null;if(b!=null){var d=this.map.getSize();var a=this.map.getCenter();if(a){var c=this.map.getResolution();var g=b.x-(d.w/2);var f=b.y-(d.h/2);e=new OpenLayers.LonLat(a.lon+g*c,a.lat-f*c);if(this.wrapDateLine){e=e.wrapDateLine(this.maxExtent)}}}return e},getViewPortPxFromLonLat:function(d){var b=null;if(d!=null){var a=this.map.getResolution();var c=this.map.getExtent();b=new OpenLayers.Pixel((1/a*(d.lon-c.left)),(1/a*(c.top-d.lat)))}return b},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var d=0,a=this.div.childNodes.length;d<a;++d){var c=this.div.childNodes[d].firstChild;OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,b)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(b){if(this.gutter){var a=this.gutter*this.map.getResolution();b=new OpenLayers.Bounds(b.left-a,b.bottom-a,b.right+a,b.top+a)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution()};b=b.wrapDateLine(this.maxExtent,c)}return b},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(b,c,a){this.bounds=b;this.div=OpenLayers.Util.createDiv();this.div.style.overflow="hidden";this.events=new OpenLayers.Events(this,this.div,null);this.setBorder(c,a)},destroy:function(){this.bounds=null;this.div=null;OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){if(!a){a="red"}if(!b){b=2}this.div.style.border=b+"px solid "+a},draw:function(a,b){OpenLayers.Util.modifyDOMElement(this.div,null,a,b);return this.div},onScreen:function(){var b=false;if(this.map){var a=this.map.getExtent();b=a.containsBounds(this.bounds,true,true)}return b},display:function(a){this.div.style.display=(a)?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"});(function(){var e=window.XMLHttpRequest;var a=!!window.controllers,h=window.document.all&&!window.opera,j=h&&window.navigator.userAgent.match(/MSIE ([\.0-9]+)/)&&RegExp.$1==7;function c(){this._object=e&&!j?new e:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}if(a&&e.wrapped){c.wrapped=e.wrapped}c.UNSENT=0;c.OPENED=1;c.HEADERS_RECEIVED=2;c.LOADING=3;c.DONE=4;c.prototype.readyState=c.UNSENT;c.prototype.responseText="";c.prototype.responseXML=null;c.prototype.status=0;c.prototype.statusText="";c.prototype.onreadystatechange=null;c.onreadystatechange=null;c.onopen=null;c.onsend=null;c.onabort=null;c.prototype.open=function(o,r,m,s,l){delete this._headers;if(arguments.length<3){m=true}this._async=m;var q=this,p=this.readyState,k;if(h&&m){k=function(){if(p!=c.DONE){d(q);q.abort()}};window.attachEvent("onunload",k)}if(c.onopen){c.onopen.apply(this,arguments)}if(arguments.length>4){this._object.open(o,r,m,s,l)}else{if(arguments.length>3){this._object.open(o,r,m,s)}else{this._object.open(o,r,m)}}if(!a&&!h){this.readyState=c.OPENED;b(this)}this._object.onreadystatechange=function(){if(a&&!m){return}q.readyState=q._object.readyState;f(q);if(q._aborted){q.readyState=c.UNSENT;return}if(q.readyState==c.DONE){d(q);if(h&&m){window.detachEvent("onunload",k)}}if(p!=q.readyState){b(q)}p=q.readyState}};c.prototype.send=function(k){if(c.onsend){c.onsend.apply(this,arguments)}if(k&&k.nodeType){k=window.XMLSerializer?new window.XMLSerializer().serializeToString(k):k.xml;if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")}}this._object.send(k);if(a&&!this._async){this.readyState=c.OPENED;f(this);while(this.readyState<c.DONE){this.readyState++;b(this);if(this._aborted){return}}}};c.prototype.abort=function(){if(c.onabort){c.onabort.apply(this,arguments)}if(this.readyState>c.UNSENT){this._aborted=true}this._object.abort();d(this)};c.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};c.prototype.getResponseHeader=function(k){return this._object.getResponseHeader(k)};c.prototype.setRequestHeader=function(k,l){if(!this._headers){this._headers={}}this._headers[k]=l;return this._object.setRequestHeader(k,l)};c.prototype.addEventListener=function(o,m,l){for(var k=0,p;p=this._listeners[k];k++){if(p[0]==o&&p[1]==m&&p[2]==l){return}}this._listeners.push([o,m,l])};c.prototype.removeEventListener=function(o,m,l){for(var k=0,p;p=this._listeners[k];k++){if(p[0]==o&&p[1]==m&&p[2]==l){break}}if(p){this._listeners.splice(k,1)}};c.prototype.dispatchEvent=function(l){var m={type:l.type,target:this,currentTarget:this,eventPhase:2,bubbles:l.bubbles,cancelable:l.cancelable,timeStamp:l.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(m.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[m])}for(var k=0,o;o=this._listeners[k];k++){if(o[0]==m.type&&!o[2]){(o[1].handleEvent||o[1]).apply(this,[m])}}};c.prototype.toString=function(){return"[object XMLHttpRequest]"};c.toString=function(){return"[XMLHttpRequest]"};function b(k){if(c.onreadystatechange){c.onreadystatechange.apply(k)}k.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})}function g(m){var l=m.responseXML,k=m.responseText;if(h&&k&&l&&!l.documentElement&&m.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){l=new window.ActiveXObject("Microsoft.XMLDOM");l.async=false;l.validateOnParse=false;l.loadXML(k)}if(l){if((h&&l.parseError!=0)||!l.documentElement||(l.documentElement&&l.documentElement.tagName=="parsererror")){return null}}return l}function f(k){try{k.responseText=k._object.responseText}catch(l){}try{k.responseXML=g(k._object)}catch(l){}try{k.status=k._object.status}catch(l){}try{k.statusText=k._object.statusText}catch(l){}}function d(k){k._object.onreadystatechange=new window.Function}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(k,l){if(!l){l=[]}k.__func=this;k.__func(l[0],l[1],l[2],l[3],l[4]);delete k.__func}}OpenLayers.Request.XMLHttpRequest=c})();OpenLayers.Tile.Image.IFrame=OpenLayers.Class(OpenLayers.Tile.Image,{initialize:function(d,a,e,b,c){OpenLayers.Tile.Image.prototype.initialize.apply(this,arguments);this.layerAlphaHack=false},destroy:function(){if(this.imgDiv!=null){OpenLayers.Event.stopObservingElement(this.imgDiv.firstChild)}OpenLayers.Tile.Image.prototype.destroy.apply(this,arguments)},clear:function(){if(this.imgDiv){var a=this.imgDiv.firstChild;OpenLayers.Event.stopObservingElement(a);this.imgDiv.removeChild(a)}},clone:function(a){if(a==null){a=new OpenLayers.Tile.Image.IFrame(this.layer,this.position,this.bounds,this.url,this.size)}a=OpenLayers.Tile.Image.prototype.clone.apply(this,[a]);return a},renderTile:function(){if(OpenLayers.Tile.Image.prototype.renderTile.apply(this,arguments)){var a=this.createRequestForm();this.imgDiv.appendChild(a);a.submit();this.imgDiv.removeChild(a)}},initImgDiv:function(){this.imgDiv=this.createImgDiv();OpenLayers.Util.modifyDOMElement(this.imgDiv,this.id,null,this.layer.getImageSize(),"relative");this.imgDiv.className="olTileImage";this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map},createImgDiv:function(){var b=document.createElement("div");if(OpenLayers.Util.getBrowserName()=="msie"){b.style.backgroundColor="#FFFFFF";b.style.filter="chroma(color=#FFFFFF)"}OpenLayers.Util.modifyDOMElement(b,null,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");var a=document.createElement("div");a.appendChild(b);return a},createIFrame:function(){var c=this.id+"_iFrame";var a;if(OpenLayers.Util.getBrowserName()=="msie"){a=document.createElement('<iframe name="'+c+'">');a.style.backgroundColor="#FFFFFF";a.style.filter="chroma(color=#FFFFFF)"}else{a=document.createElement("iframe");a.style.backgroundColor="transparent";a.name=c}a.id=c;a.scrolling="no";a.marginWidth="0px";a.marginHeight="0px";a.frameBorder="0";OpenLayers.Util.modifyDOMElement(a,c,new OpenLayers.Pixel(0,0),this.layer.getImageSize(),"absolute");var b=function(){this.show();if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(b,this));return a},createRequestForm:function(){var b=document.createElement("form");b.method="POST";var f=this.layer.params._OLSALT;f=(f?f+"_":"")+this.bounds.toBBOX();b.action=OpenLayers.Util.urlAppend(this.layer.url,f);this.imgDiv.insertBefore(this.createIFrame(),this.imgDiv.firstChild);b.target=this.id+"_iFrame";var c=this.layer.getImageSize();var e=OpenLayers.Util.extend({BBOX:this.encodeBBOX?this.bounds.toBBOX():this.bounds.toArray(),WIDTH:c.w,HEIGHT:c.h},this.layer.params);for(var a in e){var d=document.createElement("input");d.type="hidden";d.name=a;d.value=e[a];b.appendChild(d)}return b},CLASS_NAME:"OpenLayers.Tile.Image.IFrame"});OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(a){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:a.statusText}))};OpenLayers.loadURL=function(d,g,b,e,c){if(typeof g=="string"){g=OpenLayers.Util.getParameters(g)}var f=(e)?e:OpenLayers.nullHandler;var a=(c)?c:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:d,params:g,success:f,failure:a,scope:b})};OpenLayers.parseXMLString=function(c){var a=c.indexOf("<");if(a>0){c=c.substring(a)}var b=OpenLayers.Util.Try(function(){var d=new ActiveXObject("Microsoft.XMLDOM");d.loadXML(c);return d},function(){return new DOMParser().parseFromString(c,"text/xml")},function(){var d=new XMLHttpRequest();d.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(c),false);if(d.overrideMimeType){d.overrideMimeType("text/xml")}d.send(null);return d.responseXML});return b};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(b){for(var a=0;a<this.responders.length;a++){if(b==this.responders[a]){return}}this.responders.push(b)},unregister:function(a){OpenLayers.Util.removeItem(this.reponders,a)},dispatch:function(g,c,f){var a;for(var b=0;b<this.responders.length;b++){a=this.responders[b];if(a[g]&&typeof a[g]=="function"){try{a[g].apply(a,[c,f])}catch(d){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(b,a){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[a]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(b,"http")){b=OpenLayers.ProxyHost+encodeURIComponent(b)}this.transport=OpenLayers.Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var d=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){d._method=this.method;this.method="post"}this.parameters=d;if(d=OpenLayers.Util.getParameterString(d)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+d}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){d+="&_="}}}try{var a=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(typeof c.push=="function"){for(var b=0,d=c.length;b<d;b+=2){e[c[b]]=c[b+1]}}else{for(var b in c){e[b]=c[b]}}}for(var a in e){this.transport.setRequestHeader(a,e[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=OpenLayers.Ajax.Request.Events[a];var b=new OpenLayers.Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(b)}catch(d){this.dispatchException(d)}var f=b.getHeader("Content-type")}try{(this.options["on"+c]||OpenLayers.Ajax.emptyFunction)(b);OpenLayers.Ajax.Responders.dispatch("on"+c,this,b)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},dispatchException:function(c){var d=this.options.onException;if(d){d(this,c);OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{var e=false;var a=OpenLayers.Ajax.Responders.responders;for(var b=0;b<a.length;b++){if(a[b].onException){e=true;break}}if(e){OpenLayers.Ajax.Responders.dispatch("onException",this,c)}else{throw c}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!(!!(window.attachEvent&&!window.opera)))||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=d.responseText==null?"":String(d.responseText)}if(a==4){var b=d.responseXML;this.responseXML=b===undefined?null:b}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(a){return this.transport.getResponseHeader(a)}});OpenLayers.Ajax.getElementsByTagNameNS=function(b,a,c,e){var d=null;if(b.getElementsByTagNameNS){d=b.getElementsByTagNameNS(a,e)}else{d=b.getElementsByTagName(c+":"+e)}return d};OpenLayers.Ajax.serializeXMLToString=function(a){var b=new XMLSerializer();var c=b.serializeToString(a);return c};OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(b,a){},onDrag:function(b,a){},onComplete:function(b,a){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(b,a){OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){if(!this.handlers.drag.dragging){this.feature=a;this.handlers.drag.activate();this.over=true;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over")}else{if(this.feature.id==a.id){this.over=true}else{this.over=false}}},downFeature:function(a){this.lastPixel=a;this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y));this.layer.drawFeature(this.feature);this.lastPixel=a;this.onDrag(this.feature,a)},upFeature:function(a){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.feature=null}else{if(this.feature.id==a.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(a){this.handlers.drag.setMap(a);this.handlers.feature.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:25,documentDrag:false,draw:function(){this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone},{interval:this.interval,documentDrag:this.documentDrag})},panMap:function(a){this.panned=true;this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:this.handler.dragging,animate:false})},panMapDone:function(a){if(this.panned){this.panMap(a);this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,slideFactor:75,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){if(this.handler){this.handler.destroy()}this.handler=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress})},defaultKeyPress:function(a){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:var b=this.map.getSize();this.map.pan(0,-0.75*b.h);break;case 34:var b=this.map.getSize();this.map.pan(0,0.75*b.h);break;case 35:var b=this.map.getSize();this.map.pan(0.75*b.w,0);break;case 36:var b=this.map.getSize();this.map.pan(-0.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","nogetfeatureinfo","getfeatureinfo"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy});this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var e=this.layers||this.map.layers;var f=[];var d,b;for(var c=0,a=e.length;c<a;++c){d=e[c];if(d instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||d.getVisibility())){b=d.url instanceof Array?d.url[0]:d.url;if(this.drillDown===false&&!this.url){this.url=b}if(this.drillDown===true||this.urlMatches(b)){f.push(d)}}}return f},urlMatches:function(b){var d=OpenLayers.Util.isEquivalentUrl(this.url,b);if(!d&&this.layerUrls){for(var c=0,a=this.layerUrls.length;c<a;++c){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],b)){d=true;break}}}return d},buildWMSOptions:function(a,d,b,h){var g=[],j=[];for(var e=0,f=d.length;e<f;e++){g=g.concat(d[e].params.LAYERS);j=j.concat(this.getStyleNames(d[e]))}var c=OpenLayers.Util.extend({service:"WMS",version:d[0].params.VERSION,request:"GetFeatureInfo",layers:g,query_layers:g,styles:j,bbox:this.map.getExtent().toBBOX(null,d[0].reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:h,info_format:this.infoFormat},(parseFloat(d[0].params.VERSION)>=1.3)?{crs:this.map.getProjection(),i:b.x,j:b.y}:{srs:this.map.getProjection(),x:b.x,y:b.y});OpenLayers.Util.applyDefaults(c,this.vendorParams);return{url:a,params:OpenLayers.Util.upperCaseObject(c),callback:function(k){this.handleResponse(b,k)},scope:this}},getStyleNames:function(b){var a;if(b.params.STYLES){a=b.params.STYLES}else{if(b.params.LAYERS instanceof Array){a=new Array(b.params.LAYERS.length)}else{a=b.params.LAYERS.replace(/[^,]/g,"")}}return a},request:function(b,m){var d=this.findLayers();if(d.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return}m=m||{};if(this.drillDown===false){var k=this.buildWMSOptions(this.url,d,b,d[0].params.FORMAT);var c=OpenLayers.Request.GET(k);if(m.hover===true){this.hoverRequest=c}}else{this._requestCount=0;this._numRequests=0;this.features=[];var j={},a;for(var e=0,h=d.length;e<h;e++){var f=d[e];var g,l=false;a=f.url instanceof Array?f.url[0]:f.url;if(a in j){j[a].push(f)}else{this._numRequests++;j[a]=[f]}}var d;for(var a in j){d=j[a];var k=this.buildWMSOptions(a,d,b,d[0].params.FORMAT);OpenLayers.Request.GET(k)}}},triggerGetFeatureInfo:function(b,c,a){this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:a,request:b,xy:c});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(d,b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}var a=this.format.read(c);if(this.drillDown===false){this.triggerGetFeatureInfo(b,d,a)}else{this._requestCount++;this._features=(this._features||[]).concat(a);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(b,d,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,requestEncoding:"KVP",drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:true,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,EVENT_TYPES:["beforegetfeatureinfo","getfeatureinfo","exception"],pending:0,initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.WMTSGetFeatureInfo.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a=a||{};a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)}if(this.drillDown===true){this.hover=false}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))}else{var b={};b[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},activate:function(){if(!this.active){this.handler.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:true})},cancelHover:function(){if(this.hoverRequest){--this.pending;if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){var c=this.layers||this.map.layers;var d=[];var b;for(var a=c.length-1;a>=0;--a){b=c[a];if(b instanceof OpenLayers.Layer.WMTS&&b.requestEncoding===this.requestEncoding&&(!this.queryVisible||b.getVisibility())){d.push(b);if(!this.drillDown||this.hover){break}}}return d},buildRequestOptions:function(b,c){var f=this.map.getLonLatFromPixel(c);var e=b.getURL(new OpenLayers.Bounds(f.lon,f.lat,f.lon,f.lat));var d=OpenLayers.Util.getParameters(e);var a=b.getTileInfo(f);OpenLayers.Util.extend(d,{service:"WMTS",version:b.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:a.i,j:a.j});OpenLayers.Util.applyDefaults(d,this.vendorParams);return{url:b.url instanceof Array?b.url[0]:b.url,params:OpenLayers.Util.upperCaseObject(d),callback:function(g){this.handleResponse(c,g,b)},scope:this}},request:function(h,j){j=j||{};var c=this.findLayers();if(c.length>0){var g,e;for(var d=0,f=c.length;d<f;d++){e=c[d];g=this.events.triggerEvent("beforegetfeatureinfo",{xy:h,layer:e});if(g!==false){++this.pending;var a=this.buildRequestOptions(e,h);var b=OpenLayers.Request.GET(a);if(j.hover===true){this.hoverRequest=b}}}if(this.pending>0){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}}},handleResponse:function(g,e,b){--this.pending;if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");this.pending=0}if(e.status&&(e.status<200||e.status>=300)){this.events.triggerEvent("exception",{xy:g,request:e,layer:b})}else{var f=e.responseXML;if(!f||!f.documentElement){f=e.responseText}var d,c;try{d=this.format.read(f)}catch(a){c=true;this.events.triggerEvent("exception",{xy:g,request:e,error:a,layer:b})}if(!c){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:d,request:e,xy:g,layer:b})}}},setMap:function(a){this.handler.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",initialize:function(c,a,b){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,a]);this.lonlat=null;this.geometry=c?c:null;this.state=null;this.attributes={};if(a){this.attributes=OpenLayers.Util.extend(this.attributes,a)}this.style=b?b:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(d){var c=false;if(this.layer&&this.layer.map){var a=this.layer.map.getExtent();if(d){var b=this.geometry.getBounds();c=a.intersectsBounds(b)}else{var e=a.toGeometry();c=e.intersects(this.geometry)}}return c},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(b,d,c){var a=false;if(this.geometry){a=this.geometry.atPoint(b,d,c)}return a},destroyPopup:function(){},move:function(a){if(!this.layer||!this.geometry.move){return}var b;if(a.CLASS_NAME=="OpenLayers.LonLat"){b=this.layer.getViewPortPxFromLonLat(a)}else{b=a}var d=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var c=this.layer.map.getResolution();this.geometry.move(c*(b.x-d.x),c*(d.y-b.y));this.layer.drawFeature(this);return d},toState:function(a){if(a==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else{if(a==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a;break}}else{if(a==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a;break}}else{if(a==OpenLayers.State.UNKNOWN){this.state=a}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Feature.WFS=OpenLayers.Class(OpenLayers.Feature,{initialize:function(c,b){var a=arguments;var d=this.processXMLNode(b);a=new Array(c,d.lonlat,d);OpenLayers.Feature.prototype.initialize.apply(this,a);this.createMarker();this.layer.addMarker(this.marker)},destroy:function(){if(this.marker!=null){this.layer.removeMarker(this.marker)}OpenLayers.Feature.prototype.destroy.apply(this,arguments)},processXMLNode:function(b){var a=OpenLayers.Ajax.getElementsByTagNameNS(b,"http://www.opengis.net/gml","gml","Point");var d=OpenLayers.Util.getXmlNodeValue(OpenLayers.Ajax.getElementsByTagNameNS(a[0],"http://www.opengis.net/gml","gml","coordinates")[0]);var c=d.split(",");return{lonlat:new OpenLayers.LonLat(parseFloat(c[0]),parseFloat(c[1])),id:null}},CLASS_NAME:"OpenLayers.Feature.WFS"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.0",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({AllowedValues:function(a,b){b.allowedValues={};this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=true},Range:function(a,b){b.range={};this.readChildNodes(a,b.range)},MinimumValue:function(b,a){a.minValue=this.getChildValue(b)},MaximumValue:function(b,a){a.maxValue=this.getChildValue(b)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getParser:function(a){var b=a||this.version||this.defaultVersion;if(b==="0.3.0"){b=this.defaultVersion}if(!this.parser||this.parser.VERSION!=b){var c=OpenLayers.Format.OWSContext["v"+b.replace(/\./g,"_")];if(!c){throw"Can't find a OWSContext parser for version "+b}this.parser=new c(this.options)}return this.parser},toContext:function(b){var a={};if(b.CLASS_NAME=="OpenLayers.Map"){a.bounds=b.getExtent();a.maxExtent=b.maxExtent;a.projection=b.projection;a.size=b.getSize();a.layers=b.layers}return a},CLASS_NAME:"OpenLayers.Format.OWSContext"});OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.WFSCapabilities,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a={};var b=c.documentElement;this.runChildNodes(a,b);return a},runChildNodes:function(f,e){var c=e.childNodes;var b,d;for(var a=0;a<c.length;++a){b=c[a];if(b.nodeType==1){d=this["read_cap_"+b.nodeName];if(d){d.apply(this,[f,b])}}}},read_cap_FeatureTypeList:function(c,b){var a={featureTypes:[]};this.runChildNodes(a,b);c.featureTypeList=a},read_cap_FeatureType:function(a,d,b){var c={};this.runChildNodes(c,d);a.featureTypes.push(c)},read_cap_Name:function(d,b){var a=this.getChildValue(b);if(a){var c=a.split(":");d.name=c.pop();if(c.length>0){d.featureNS=this.lookupNamespaceURI(b,c[0])}}},read_cap_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_cap_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",getParser:function(a){var b=a||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=b){var c=OpenLayers.Format.WMC["v"+b.replace(/\./g,"_")];if(!c){throw"Can't find a WMC parser for version "+b}this.parser=new c(this.options)}return this.parser},layerToContext:function(a){var c=this.getParser();var b={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,metadataURL:a.metadataURL,version:a.params.VERSION,url:a.url,maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:(a.singleTile||!a.tileSize)?undefined:{width:a.tileSize.w,height:a.tileSize.h},minScale:(a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale)?a.minScale:undefined,maxScale:(a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale)?a.maxScale:undefined,formats:[{value:a.params.FORMAT,current:true}],styles:[{href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||c.defaultStyleName,title:c.defaultStyleTitle,current:true}]};return b},toContext:function(f){var d={};var e=f.layers;if(f.CLASS_NAME=="OpenLayers.Map"){d.bounds=f.getExtent();d.maxExtent=f.maxExtent;d.projection=f.projection;d.size=f.getSize()}else{OpenLayers.Util.applyDefaults(d,f);if(d.layers!=undefined){delete (d.layers)}}if(d.layersContext==undefined){d.layersContext=[]}if(e!=undefined&&e instanceof Array){for(var c=0,a=e.length;c<a;c++){var b=e[c];if(b instanceof OpenLayers.Layer.WMS){d.layersContext.push(this.layerToContext(b))}}}return d},CLASS_NAME:"OpenLayers.Format.WMC"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);this.postProcessLayers(a);return a},postProcessLayers:function(b){if(b.capability){b.capability.layers=[];var e=b.capability.nestedLayers;for(var d=0,a=e.length;d<a;++d){var c=e[d];this.processLayer(b.capability,c)}}},processLayer:function(a,k,c){if(k.formats===undefined){k.formats=a.request.getmap.formats}if(c){k.styles=k.styles.concat(c.styles);var f=["queryable","cascaded","fixedWidth","fixedHeight","opaque","noSubsets","llbbox","minScale","maxScale","attribution"];var o=["srs","bbox","dimensions","authorityURLs"];var m;for(var e=0;e<f.length;e++){m=f[e];if(m in c){if(k[m]==null){k[m]=c[m]}if(k[m]==null){var h=["cascaded","fixedWidth","fixedHeight"];var b=["queryable","opaque","noSubsets"];if(OpenLayers.Util.indexOf(h,m)!=-1){k[m]=0}if(OpenLayers.Util.indexOf(b,m)!=-1){k[m]=false}}}}for(var e=0;e<o.length;e++){m=o[e];k[m]=OpenLayers.Util.extend(k[m],c[m])}}for(var g=0,l=k.nestedLayers.length;g<l;g++){var d=k.nestedLayers[g];this.processLayer(a,d,k)}if(k.name){a.layers.push(k)}},readers:{wms:{Service:function(a,b){b.service={};this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},BoundingBox:function(b,c){var d={};d.bbox=[parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy"))];var a={x:parseFloat(b.getAttribute("resx")),y:parseFloat(b.getAttribute("resy"))};if(!(isNaN(a.x)&&isNaN(a.y))){d.res=a}return d},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={};this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={};this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={};this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(b,c){var a=this.getChildValue(b);if(a&&a.toLowerCase()!="none"){c.fees=a}},AccessConstraints:function(a,b){var c=this.getChildValue(a);if(c&&c.toLowerCase()!="none"){b.accessConstraints=c}},Capability:function(a,b){b.capability={nestedLayers:[]};this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={};this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]};this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){if(b.formats instanceof Array){b.formats.push(this.getChildValue(a))}else{b.format=this.getChildValue(a)}},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){this.readChildNodes(a,b)},Post:function(a,b){this.readChildNodes(a,b)},GetMap:function(a,b){b.getmap={formats:[]};this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]};this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]};this.readChildNodes(a,b.exception)},Layer:function(b,e){var l=b.getAttributeNode("queryable");var c=(l&&l.specified)?b.getAttribute("queryable"):null;l=b.getAttributeNode("cascaded");var j=(l&&l.specified)?b.getAttribute("cascaded"):null;l=b.getAttributeNode("opaque");var f=(l&&l.specified)?b.getAttribute("opaque"):null;var k=b.getAttribute("noSubsets");var a=b.getAttribute("fixedWidth");var h=b.getAttribute("fixedHeight");var g={nestedLayers:[],styles:[],srs:{},metadataURLs:[],bbox:{},dimensions:{},authorityURLs:{},identifiers:{},keywords:[],queryable:(c&&c!=="")?(c==="1"||c==="true"):null,cascaded:(j!==null)?parseInt(j):null,opaque:f?(f==="1"||f==="true"):null,noSubsets:(k!==null)?(k==="1"||k==="true"):null,fixedWidth:(a!=null)?parseInt(a):null,fixedHeight:(h!=null)?parseInt(h):null};e.nestedLayers.push(g);this.readChildNodes(b,g);if(g.name){var d=g.name.split(":");if(d.length>0){g.prefix=d[0]}}},Attribution:function(a,b){b.attribution={};this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")};this.readChildNodes(a,b.logo)},Style:function(b,c){var a={};c.styles.push(a);this.readChildNodes(b,a)},LegendURL:function(b,c){var a={width:b.getAttribute("width"),height:b.getAttribute("height")};c.legend=a;this.readChildNodes(b,a)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c);this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={};this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={};this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(b,d){var a=b.getAttribute("name");var c={};this.readChildNodes(b,c);d.authorityURLs[a]=c.href},Identifier:function(a,c){var b=a.getAttribute("authority");c.identifiers[b]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=true}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var j=d.documentElement;var b=j.childNodes;var f=[];var a,m;for(var e=0;e<b.length;++e){a=b[e];m=a.nodeName;if(m=="LayerDescription"){var g=a.getAttribute("name");var l="";var c="";var k="";if(a.getAttribute("owsType")){l=a.getAttribute("owsType");c=a.getAttribute("owsURL")}else{if(a.getAttribute("wfs")!=""){l="WFS";c=a.getAttribute("wfs")}else{if(a.getAttribute("wcs")!=""){l="WCS";c=a.getAttribute("wcs")}}}var h=a.getElementsByTagName("Query");if(h.length>0){k=h[0].getAttribute("typeName");if(!k){k=h[0].getAttribute("typename")}}f.push({layerName:g,owsType:l,owsURL:c,typeName:k})}}return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxCharacteristics:null,initialize:function(c,b,a){OpenLayers.Handler.prototype.initialize.apply(this,arguments);var b={down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox};this.dragHandler=new OpenLayers.Handler.Drag(this,b,{keyMask:this.keyMask})},destroy:function(){if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}OpenLayers.Handler.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(a)}},startBox:function(a){this.zoomBox=OpenLayers.Util.createDiv("zoomBox",this.dragHandler.start);this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(f){var d=this.dragHandler.start.x;var b=this.dragHandler.start.y;var c=Math.abs(d-f.x);var a=Math.abs(b-f.y);this.zoomBox.style.width=Math.max(1,c)+"px";this.zoomBox.style.height=Math.max(1,a)+"px";this.zoomBox.style.left=f.x<d?f.x+"px":d+"px";this.zoomBox.style.top=f.y<b?f.y+"px":b+"px";var e=this.getBoxCharacteristics();if(e.newBoxModel){if(f.x>d){this.zoomBox.style.width=Math.max(1,c-e.xOffset)+"px"}if(f.y>b){this.zoomBox.style.height=Math.max(1,a-e.yOffset)+"px"}}},endBox:function(b){var a;if(Math.abs(this.dragHandler.start.x-b.x)>5||Math.abs(this.dragHandler.start.y-b.y)>5){var g=this.dragHandler.start;var f=Math.min(g.y,b.y);var c=Math.max(g.y,b.y);var e=Math.min(g.x,b.x);var d=Math.max(g.x,b.x);a=new OpenLayers.Bounds(e,c,d,f)}else{a=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[a])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxCharacteristics=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate();return true}else{return false}},getBoxCharacteristics:function(){if(!this.boxCharacteristics){var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"))+1;var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"))+1;var b=OpenLayers.Util.getBrowserName()=="msie"?document.compatMode!="BackCompat":true;this.boxCharacteristics={xOffset:a,yOffset:c,newBoxModel:b}}return this.boxCharacteristics},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(c,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,[c,b,a]);this.options=(a)?a:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},activate:function(){var a=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()}if(this.layer.map!=null){this.layer.destroy(false);if(this.feature){this.feature.destroy()}}this.layer=null;this.feature=null;a=true}return a},down:function(a){this.fixedRadius=!!(this.radius);var b=this.map.getLonLatFromPixel(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat);if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()}if(this.persist){this.clear()}this.feature=new OpenLayers.Feature.Vector();this.createGeometry();this.callback("create",[this.origin,this.feature]);this.layer.addFeatures([this.feature],{silent:true});this.layer.drawFeature(this.feature,this.style)},move:function(c){var f=this.map.getLonLatFromPixel(c.xy);var a=new OpenLayers.Geometry.Point(f.lon,f.lat);if(this.irregular){var g=Math.sqrt(2)*Math.abs(a.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,g)}else{if(this.fixedRadius){this.origin=a}else{this.calculateAngle(a,c);this.radius=Math.max(this.map.getResolution()/2,a.distanceTo(this.origin))}}this.modifyGeometry();if(this.irregular){var d=a.x-this.origin.x;var b=a.y-this.origin.y;var e;if(b==0){e=d/(this.radius*Math.sqrt(2))}else{e=d/b}this.feature.geometry.resize(1,this.origin,e);this.feature.geometry.move(d/2,b/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize();if(this.start==this.last){this.callback("done",[a.xy])}},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var d,a;var b=this.feature.geometry.components[0];if(b.components.length!=(this.sides+1)){this.createGeometry();b=this.feature.geometry.components[0]}for(var c=0;c<this.sides;++c){a=b.components[c];d=this.angle+(c*2*Math.PI/this.sides);a.x=this.origin.x+(this.radius*Math.cos(d));a.y=this.origin.y+(this.radius*Math.sin(d));a.clearBounds()}},calculateAngle:function(a,b){var d=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&(this.snapToggle&&!b[this.snapToggle])){var c=(Math.PI/180)*this.snapAngle;this.angle=Math.round(d/c)*c}else{this.angle=d}},cancel:function(){this.callback("cancel",null);this.finalize()},finalize:function(){this.origin=null;this.radius=this.options.radius},clear:function(){if(this.layer){this.layer.renderer.clear();this.layer.destroyFeatures()}},callback:function(b,a){if(this.callbacks[b]){this.callbacks[b].apply(this.control,[this.feature.geometry.clone()])}if(!this.persist&&(b=="done"||b=="cancel")){this.clear()}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.Util.getBrowserName()=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(a){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var g=this.map.getSize();var a=Math.min(g.w,300);var e=Math.min(g.h,200);var b=new OpenLayers.Size(a,e);var d=new OpenLayers.Pixel(g.w/2,g.h/2);var c=d.add(-b.w/2,-b.h/2);var f=OpenLayers.Util.createDiv(this.name+"_warning",c,b,null,null,null,"auto");f.style.padding="7px";f.style.backgroundColor="yellow";f.innerHTML=this.getWarningHTML();this.div.appendChild(f)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveTo:function(c,d,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var e=this.map.getCenter();var g=this.map.getZoom();if(e!=null){var f=this.getMapObjectCenter();var b=this.getOLLonLatFromMapObjectLonLat(f);var h=this.getMapObjectZoom();var o=this.getOLZoomFromMapObjectZoom(h);if(!(e.equals(b))||!(g==o)){if(k&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(b);var l=this.map.getViewPortPxFromLonLat(e);this.dragPanMapObject(l.x-j.x,j.y-l.y)}else{var a=this.getMapObjectLonLatFromOLLonLat(e);var m=this.getMapObjectZoomFromOLZoom(g);this.setMapObjectCenter(a,m,k)}}}}},getLonLatFromViewPortPx:function(a){var b=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var d=this.getMapObjectPixelFromOLPixel(a);var c=this.getMapObjectLonLatFromMapObjectPixel(d);b=this.getOLLonLatFromMapObjectLonLat(c)}return b},getViewPortPxFromLonLat:function(b){var a=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var d=this.getMapObjectLonLatFromOLLonLat(b);var c=this.getMapObjectPixelFromMapObjectLonLat(d);a=this.getOLPixelFromMapObjectPixel(c)}return a},getOLLonLatFromMapObjectLonLat:function(d){var a=null;if(d!=null){var c=this.getLongitudeFromMapObjectLonLat(d);var b=this.getLatitudeFromMapObjectLonLat(d);a=new OpenLayers.LonLat(c,b)}return a},getMapObjectLonLatFromOLLonLat:function(a){var b=null;if(a!=null){b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)}return b},getOLPixelFromMapObjectPixel:function(d){var b=null;if(d!=null){var a=this.getXFromMapObjectPixel(d);var c=this.getYFromMapObjectPixel(d);b=new OpenLayers.Pixel(a,c)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;if(a!=null){b=this.getMapObjectPixelFromXY(a.x,a.y)}return b},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var c=new Array("minZoomLevel","maxZoomLevel","numZoomLevels");for(var b=0,a=c.length;b<a;b++){var f=c[b];this[f]=(this.options[f]!=null)?this.options[f]:this.map[f]}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL}var g;var e=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){g=this.maxZoomLevel-this.minZoomLevel+1}else{g=this.numZoomLevels}if(g!=null){this.numZoomLevels=Math.min(g,e)}else{this.numZoomLevels=e}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;if(this.RESOLUTIONS!=null){var d=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++){this.resolutions[d++]=this.RESOLUTIONS[b]}this.maxResolution=this.resolutions[0];this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)}else{var a=null;var c=this.map.getSize();var b=this.getExtent();if((c!=null)&&(b!=null)){a=Math.max(b.getWidth()/c.w,b.getHeight()/c.h)}return a}},getExtent:function(){var c=null;var b=this.map.getSize();var e=new OpenLayers.Pixel(0,0);var f=this.getLonLatFromViewPortPx(e);var a=new OpenLayers.Pixel(b.w,b.h);var d=this.getLonLatFromViewPortPx(a);if((f!=null)&&(d!=null)){c=new OpenLayers.Bounds(f.lon,d.lat,d.lon,f.lat)}return c},getZoomForResolution:function(a){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)}else{var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)}},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=a-this.minZoomLevel}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=a+this.minZoomLevel}return b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(d,c,e,b){var a=arguments;a=[d,b];OpenLayers.Layer.prototype.initialize.apply(this,a);this.url=c;this.params=OpenLayers.Util.extend({},e)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setUrl:function(a){this.url=a},mergeNewParams:function(b){this.params=OpenLayers.Util.extend(this.params,b);var a=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return a},redraw:function(a){if(a){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(e,d){var c=1;for(var b=0,a=e.length;b<a;b++){c*=e.charCodeAt(b)*this.URL_HASH_FACTOR;c-=Math.floor(c)}return d[Math.floor(c*d.length)]},getFullRequestString:function(g,d){var b=d||this.url;var f=OpenLayers.Util.extend({},this.params);f=OpenLayers.Util.extend(f,g);var e=OpenLayers.Util.getParameterString(f);if(b instanceof Array){b=this.selectUrl(e,b)}var a=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var c in f){if(c.toUpperCase() in a){delete f[c]}}e=OpenLayers.Util.getParameterString(f);return OpenLayers.Util.urlAppend(b,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(c,b,e,d,a){this.url=b;this.extent=e;this.maxExtent=e;this.size=d;OpenLayers.Layer.prototype.initialize.apply(this,[c,a]);this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null}OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())}a=OpenLayers.Layer.prototype.clone.apply(this,[a]);return a},setMap:function(a){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w}OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(e,a,f){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var b=(this.tile==null);if(a||b){this.setTileSize();var d=new OpenLayers.LonLat(this.extent.left,this.extent.top);var c=this.map.getLayerPxFromLonLat(d);if(b){this.tile=new OpenLayers.Tile.Image(this,c,this.extent,null,this.tileSize);this.addTileMonitoringHooks(this.tile)}else{this.tile.size=this.tileSize.clone();this.tile.position=c.clone()}this.tile.draw()}},setTileSize:function(){var b=this.extent.getWidth()/this.map.getResolution();var a=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(b,a)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.events.triggerEvent("loadend")};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a;this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(b,a){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(b){if(b!=this.opacity){this.opacity=b;for(var c=0,a=this.markers.length;c<a;c++){this.markers[c].setOpacity(this.opacity)}}},moveTo:function(d,b,e){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(b||!this.drawn){for(var c=0,a=this.markers.length;c<a;c++){this.drawMarker(this.markers[c])}this.drawn=true}},addMarker:function(a){this.markers.push(a);if(this.opacity!=null){a.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){a.map=this.map;this.drawMarker(a)}},removeMarker:function(a){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,a);a.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(b==null){a.display(false)}else{if(!a.isDrawn()){var c=a.draw(b);this.div.appendChild(c)}else{if(a.icon){a.icon.moveTo(b)}}}},getDataExtent:function(){var b=null;if(this.markers&&(this.markers.length>0)){var b=new OpenLayers.Bounds();for(var d=0,a=this.markers.length;d<a;d++){var c=this.markers[d];b.extend(c.lonlat)}}return b},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;if(this.sphericalMercator){a=this.map.calculateBounds()}else{a=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)}return a},getLonLatFromViewPortPx:function(a){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(a){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];var a=156543.0339;for(var b=0;b<=this.MAX_ZOOM_LEVEL;++b){this.RESOLUTIONS[b]=a/Math.pow(2,b)}this.units="m";this.projection=this.projection||"EPSG:900913"},forwardMercator:function(c,b){var a=c*20037508.34/180;var d=Math.log(Math.tan((90+b)*Math.PI/360))/(Math.PI/180);d=d*20037508.34/180;return new OpenLayers.LonLat(a,d)},inverseMercator:function(a,d){var c=(a/20037508.34)*180;var b=(d/20037508.34)*180;b=180/Math.PI*(2*Math.atan(Math.exp(b*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(c,b)},projectForward:function(a){var b=OpenLayers.Layer.SphericalMercator.forwardMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a},projectInverse:function(a){var b=OpenLayers.Layer.SphericalMercator.inverseMercator(a.x,a.y);a.x=b.lon;a.y=b.lat;return a}};OpenLayers.Projection.addTransform("EPSG:4326","EPSG:900913",OpenLayers.Layer.SphericalMercator.projectForward);OpenLayers.Projection.addTransform("EPSG:900913","EPSG:4326",OpenLayers.Layer.SphericalMercator.projectInverse);OpenLayers.Tile.WFS=OpenLayers.Class(OpenLayers.Tile,{features:null,url:null,request:null,initialize:function(d,a,e,b,c){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=b;this.features=[]},destroy:function(){OpenLayers.Tile.prototype.destroy.apply(this,arguments);this.destroyAllFeatures();this.features=null;this.url=null;if(this.request){this.request.abort();this.request=null}},clear:function(){this.destroyAllFeatures()},draw:function(){if(OpenLayers.Tile.prototype.draw.apply(this,arguments)){if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}this.loadFeaturesForRegion(this.requestSuccess)}},loadFeaturesForRegion:function(b,a){if(this.request){this.request.abort()}this.request=OpenLayers.Request.GET({url:this.url,success:b,failure:a,scope:this})},requestSuccess:function(b){if(this.features){var d=b.responseXML;if(!d||!d.documentElement){d=b.responseText}if(this.layer.vectorMode){this.layer.addFeatures(this.layer.formatObject.read(d))}else{var a=new OpenLayers.Format.XML();if(typeof d=="string"){d=a.read(d)}var c=a.getElementsByTagNameNS(d,"http://www.opengis.net/gml","featureMember");this.addResults(c)}}if(this.events){this.events.triggerEvent("loadend")}this.request=null},addResults:function(c){for(var b=0;b<c.length;b++){var a=new this.layer.featureClass(this.layer,c[b]);this.features.push(a)}},destroyAllFeatures:function(){while(this.features.length>0){var a=this.features.shift();a.destroy()}},CLASS_NAME:"OpenLayers.Tile.WFS"});OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(b,c,a){this.EVENT_TYPES=OpenLayers.Control.DrawFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(f,e){this.layer.events.triggerEvent("sketchmodified",{vertex:f,feature:e})},create:function(f,e){this.layer.events.triggerEvent("sketchstarted",{vertex:f,feature:e})}},this.callbacks);this.layer=b;this.handlerOptions=this.handlerOptions||{};if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi}var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;if(d){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":d})})}this.handler=new c(this,this.callbacks,this.handlerOptions)},drawFeature:function(c){var a=new OpenLayers.Feature.Vector(c);var b=this.layer.events.triggerEvent("sketchcomplete",{feature:a});if(b!==false){a.state=OpenLayers.State.INSERT;this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a})}},CLASS_NAME:"OpenLayers.Control.DrawFeature"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["measure","measurepartial"],handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.Measure.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.measureComplete,point:this.measurePartial},this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new b(this,this.callbacks,this.handlerOptions)},cancel:function(){this.handler.cancel()},updateHandler:function(b,a){var c=this.active;if(c){this.deactivate()}this.handler=new b(this,this.callbacks,a);if(c){this.activate()}},measureComplete:function(a){if(this.delayedTrigger){window.clearTimeout(this.delayedTrigger)}this.measure(a,"measure")},measurePartial:function(a,b){if(b.getLength()>0){b=b.clone();this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.measure(b,"measurepartial")},this),this.partialDelay)}},measure:function(d,b){var c,a;if(d.CLASS_NAME.indexOf("LineString")>-1){c=this.getBestLength(d);a=1}else{c=this.getBestArea(d);a=2}this.events.triggerEvent(b,{measure:c[0],units:c[1],order:a,geometry:d})},getBestArea:function(f){var b=this.displaySystemUnits[this.displaySystem];var e,d;for(var c=0,a=b.length;c<a;++c){e=b[c];d=this.getArea(f,e);if(d>1){break}}return[d,e]},getArea:function(f,a){var b,c;if(this.geodesic){b=f.getGeodesicArea(this.map.getProjectionObject());c="m"}else{b=f.getArea();c=this.map.getUnits()}var e=OpenLayers.INCHES_PER_UNIT[a];if(e){var d=OpenLayers.INCHES_PER_UNIT[c];b*=Math.pow((d/e),2)}return b},getBestLength:function(f){var b=this.displaySystemUnits[this.displaySystem];var e,d;for(var c=0,a=b.length;c<a;++c){e=b[c];d=this.getLength(f,e);if(d>1){break}}return[d,e]},getLength:function(f,a){var b,c;if(this.geodesic){b=f.getGeodesicLength(this.map.getProjectionObject());c="m"}else{b=f.getLength();c=this.map.getUnits()}var e=OpenLayers.INCHES_PER_UNIT[a];if(e){var d=OpenLayers.INCHES_PER_UNIT[c];b*=(d/e)}return b},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(h){if(h instanceof OpenLayers.Bounds){var b;if(!this.out){var j=this.map.getLonLatFromPixel(new OpenLayers.Pixel(h.left,h.bottom));var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(h.right,h.top));b=new OpenLayers.Bounds(j.lon,j.lat,o.lon,o.lat)}else{var g=Math.abs(h.right-h.left);var k=Math.abs(h.top-h.bottom);var e=Math.min((this.map.size.h/k),(this.map.size.w/g));var p=this.map.getExtent();var a=this.map.getLonLatFromPixel(h.getCenterPixel());var c=a.lon-(p.getWidth()/2)*e;var f=a.lon+(p.getWidth()/2)*e;var m=a.lat-(p.getHeight()/2)*e;var d=a.lat+(p.getHeight()/2)*e;b=new OpenLayers.Bounds(c,m,f,d)}var l=this.map.getZoom();this.map.zoomToExtent(b);if(l==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(l+(this.out?-1:1))}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()+1)}else{this.map.setCenter(this.map.getLonLatFromPixel(h),this.map.getZoom()-1)}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},read_cap_Service:function(b,c){var a={};this.runChildNodes(a,c);b.service=a},read_cap_Fees:function(a,c){var b=this.getChildValue(c);if(b&&b.toLowerCase()!="none"){a.fees=b}},read_cap_AccessConstraints:function(a,b){var c=this.getChildValue(b);if(c&&c.toLowerCase()!="none"){a.accessConstraints=c}},read_cap_OnlineResource:function(a,c){var b=this.getChildValue(c);if(b&&b.toLowerCase()!="none"){a.onlineResource=b}},read_cap_Keywords:function(a,c){var b=this.getChildValue(c);if(b&&b.toLowerCase()!="none"){a.keywords=b.split(", ")}},read_cap_Capability:function(a,c){var b={};this.runChildNodes(b,c);a.capability=b},read_cap_Request:function(c,b){var a={};this.runChildNodes(a,b);c.request=a},read_cap_GetFeature:function(b,a){var c={href:{},formats:[]};this.runChildNodes(c,a);b.getfeature=c},read_cap_ResultFormat:function(e,d){var c=d.childNodes;var b;for(var a=0;a<c.length;a++){b=c[a];if(b.nodeType==1){e.formats.push(b.nodeName)}}},read_cap_DCPType:function(b,a){this.runChildNodes(b,a)},read_cap_HTTP:function(b,a){this.runChildNodes(b.href,a)},read_cap_Get:function(b,a){b.get=a.getAttribute("onlineResource")},read_cap_Post:function(b,a){b.post=a.getAttribute("onlineResource")},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{initialize:function(a){OpenLayers.Format.WFSCapabilities.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(f){var e,d,h;var g=this.regExes.typeStr.exec(f);if(g){d=g[1].toLowerCase();h=g[2];if(this.parse[d]){e=this.parse[d].apply(this,[h])}if(this.internalProjection&&this.externalProjection){if(e&&e.CLASS_NAME=="OpenLayers.Feature.Vector"){e.geometry.transform(this.externalProjection,this.internalProjection)}else{if(e&&d!="geometrycollection"&&typeof e=="object"){for(var c=0,a=e.length;c<a;c++){var b=e[c];b.geometry.transform(this.externalProjection,this.internalProjection)}}}}}return e},write:function(a){var f,j,h,d,b;if(a.constructor==Array){f=a;b=true}else{f=[a];b=false}var c=[];if(b){c.push("GEOMETRYCOLLECTION(")}for(var e=0,g=f.length;e<g;++e){if(b&&e>0){c.push(",")}j=f[e].geometry;h=j.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[h]){return null}if(this.internalProjection&&this.externalProjection){j=j.clone();j.transform(this.internalProjection,this.externalProjection)}d=this.extract[h].apply(this,[j]);c.push(h.toUpperCase()+"("+d+")")}if(b){c.push(")")}return c.join("")},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push("("+this.extract.point.apply(this,[c.components[b]])+")")}return d.join(",")},linestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.point.apply(this,[b.components[c]]))}return d.join(",")},multilinestring:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push("("+this.extract.linestring.apply(this,[c.components[b]])+")")}return d.join(",")},polygon:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push("("+this.extract.linestring.apply(this,[c.components[b]])+")")}return d.join(",")},multipolygon:function(d){var c=[];for(var b=0,a=d.components.length;b<a;++b){c.push("("+this.extract.polygon.apply(this,[d.components[b]])+")")}return c.join(",")}},parse:{point:function(b){var a=OpenLayers.String.trim(b).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(f){var b;var d=OpenLayers.String.trim(f).split(this.regExes.parenComma);var e=[];for(var c=0,a=d.length;c<a;++c){b=d[c].replace(this.regExes.trimParens,"$1");e.push(this.parse.point.apply(this,[b]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(e))},linestring:function(e){var c=OpenLayers.String.trim(e).split(",");var d=[];for(var b=0,a=c.length;b<a;++b){d.push(this.parse.point.apply(this,[c[b]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(d))},multilinestring:function(f){var c;var b=OpenLayers.String.trim(f).split(this.regExes.parenComma);var e=[];for(var d=0,a=b.length;d<a;++d){c=b[d].replace(this.regExes.trimParens,"$1");e.push(this.parse.linestring.apply(this,[c]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(e))},polygon:function(h){var c,b,f;var g=OpenLayers.String.trim(h).split(this.regExes.parenComma);var e=[];for(var d=0,a=g.length;d<a;++d){c=g[d].replace(this.regExes.trimParens,"$1");b=this.parse.linestring.apply(this,[c]).geometry;f=new OpenLayers.Geometry.LinearRing(b.components);e.push(f)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(e))},multipolygon:function(f){var d;var b=OpenLayers.String.trim(f).split(this.regExes.doubleParenComma);var e=[];for(var c=0,a=b.length;c<a;++c){d=b[c].replace(this.regExes.trimParens,"$1");e.push(this.parse.polygon.apply(this,[d]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(e))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");var d=OpenLayers.String.trim(e).split("|");var c=[];for(var b=0,a=d.length;b<a;++b){c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[d[b]]))}return c}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(a==null){b=this.namespaces[this.defaultPrefix]}else{for(b in this.namespaces){if(this.namespaces[b]==a){break}}}return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a=c.documentElement;this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};this.runChildNodes(b,a);return b},runChildNodes:function(e,d){var b=d.childNodes;var a,c,g,j;for(var f=0,h=b.length;f<h;++f){a=b[f];if(a.nodeType==1){g=this.getNamespacePrefix(a.namespaceURI);j=a.nodeName.split(":").pop();c=this["read_"+g+"_"+j];if(c){c.apply(this,[e,a])}}}},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS");a.bounds=new OpenLayers.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")))},read_wmc_LayerList:function(a,b){a.layersContext=[];this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:(b.getAttribute("hidden")!="1"),queryable:(b.getAttribute("queryable")=="1"),formats:[],styles:[]};this.runChildNodes(c,b);a.layersContext.push(c)},read_wmc_Extension:function(b,a){this.runChildNodes(b,a)},read_ol_units:function(b,a){b.units=this.getChildValue(a)},read_ol_maxExtent:function(c,b){var a=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));c.maxExtent=a},read_ol_transparent:function(b,a){b.transparent=this.getChildValue(a)},read_ol_numZoomLevels:function(b,a){b.numZoomLevels=parseInt(this.getChildValue(a))},read_ol_opacity:function(b,a){b.opacity=parseFloat(this.getChildValue(a))},read_ol_singleTile:function(b,a){b.singleTile=(this.getChildValue(a)=="true")},read_ol_tileSize:function(b,a){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.tileSize=c},read_ol_isBaseLayer:function(b,a){b.isBaseLayer=(this.getChildValue(a)=="true")},read_ol_displayInLayerSwitcher:function(b,a){b.displayInLayerSwitcher=(this.getChildValue(a)=="true")},read_wmc_Server:function(c,b){c.version=b.getAttribute("version");var d={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(d,a[0])}c.url=d.href},read_wmc_FormatList:function(b,a){this.runChildNodes(b,a)},read_wmc_Format:function(b,a){var c={value:this.getChildValue(a)};if(a.getAttribute("current")=="1"){c.current=true}b.formats.push(c)},read_wmc_StyleList:function(b,a){this.runChildNodes(b,a)},read_wmc_Style:function(c,b){var a={};this.runChildNodes(a,b);if(b.getAttribute("current")=="1"){a.current=true}c.styles.push(a)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(c,b){var a=OpenLayers.Format.XML.prototype.write.apply(this,[b]);c.body=a},read_wmc_OnlineResource:function(b,a){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},read_wmc_Name:function(c,b){var a=this.getChildValue(b);if(a){c.name=a}},read_wmc_Title:function(b,a){var c=this.getChildValue(a);if(c){b.title=c}},read_wmc_MetadataURL:function(c,b){var d={};var a=b.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(d,a[0])}c.metadataURL=d.href},read_wmc_Abstract:function(c,b){var a=this.getChildValue(b);if(a){c["abstract"]=a}},read_wmc_LegendURL:function(c,d){var b={width:d.getAttribute("width"),height:d.getAttribute("height")};var a=d.getElementsByTagName("OnlineResource");if(a.length>0){this.read_wmc_OnlineResource(b,a[0])}c.legend=b},write:function(c,b){var a=this.createElementDefaultNS("ViewContext");this.setAttributes(a,{version:this.VERSION,id:(b&&typeof b.id=="string")?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);a.appendChild(this.write_wmc_General(c));a.appendChild(this.write_wmc_LayerList(c));return OpenLayers.Format.XML.prototype.write.apply(this,[a])},createElementDefaultNS:function(c,b,a){var d=this.createElementNS(this.namespaces[this.defaultPrefix],c);if(b){d.appendChild(this.createTextNode(b))}if(a){this.setAttributes(d,a)}return d},setAttributes:function(b,d){var c;for(var a in d){c=d[a].toString();if(c.match(/[A-Z]/)){this.setAttributeNS(b,null,a,c)}else{b.setAttribute(a,c)}}},write_wmc_General:function(a){var c=this.createElementDefaultNS("General");if(a.size){c.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}))}var b=a.bounds;c.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:b.left.toPrecision(18),miny:b.bottom.toPrecision(18),maxx:b.right.toPrecision(18),maxy:b.top.toPrecision(18),SRS:a.projection}));c.appendChild(this.createElementDefaultNS("Title",a.title));c.appendChild(this.write_ol_MapExtension(a));return c},write_ol_MapExtension:function(b){var d=this.createElementDefaultNS("Extension");var c=b.maxExtent;if(c){var a=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(a,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)});d.appendChild(a)}return d},write_wmc_LayerList:function(c){var d=this.createElementDefaultNS("LayerList");for(var b=0,a=c.layersContext.length;b<a;++b){d.appendChild(this.write_wmc_Layer(c.layersContext[b]))}return d},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});b.appendChild(this.write_wmc_Server(a));b.appendChild(this.createElementDefaultNS("Name",a.name));b.appendChild(this.createElementDefaultNS("Title",a.title));if(a.metadataURL){b.appendChild(this.write_wmc_MetadataURL(a.metadataURL))}return b},write_wmc_LayerExtension:function(b){var d=this.createElementDefaultNS("Extension");var a=b.maxExtent;var h=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(h,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),maxy:a.top.toPrecision(18)});d.appendChild(h);if(b.tileSize&&!b.singleTile){var j=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(j,b.tileSize);d.appendChild(j)}var g=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];var c;for(var e=0,f=g.length;e<f;++e){c=this.createOLPropertyNode(b,g[e]);if(c){d.appendChild(c)}}return d},createOLPropertyNode:function(b,c){var a=null;if(b[c]!=null){a=this.createElementNS(this.namespaces.ol,"ol:"+c);a.appendChild(this.createTextNode(b[c].toString()))}return a},write_wmc_Server:function(a){var b=this.createElementDefaultNS("Server");this.setAttributes(b,{service:"OGC:WMS",version:a.version});b.appendChild(this.write_wmc_OnlineResource(a.url));return b},write_wmc_MetadataURL:function(b){var a=this.createElementDefaultNS("MetadataURL");a.appendChild(this.write_wmc_OnlineResource(b));return a},write_wmc_FormatList:function(c){var d=this.createElementDefaultNS("FormatList");for(var b=0,a=c.formats.length;b<a;b++){var e=c.formats[b];d.appendChild(this.createElementDefaultNS("Format",e.value,(e.current&&e.current==true)?{current:"1"}:null))}return d},write_wmc_StyleList:function(e){var c=this.createElementDefaultNS("StyleList");var k=e.styles;if(k&&k instanceof Array){var a;for(var d=0,f=k.length;d<f;d++){var l=k[d];var b=this.createElementDefaultNS("Style",null,(l.current&&l.current==true)?{current:"1"}:null);if(l.href){a=this.createElementDefaultNS("SLD");var g=this.write_wmc_OnlineResource(l.href);a.appendChild(g);a.appendChild(this.createElementDefaultNS("Name",l.name));if(l.title){a.appendChild(this.createElementDefaultNS("Title",l.title))}b.appendChild(a)}else{if(l.body){a=this.createElementDefaultNS("SLD");var h=OpenLayers.Format.XML.prototype.read.apply(this,[l.body]);var j=h.documentElement;if(a.ownerDocument&&a.ownerDocument.importNode){j=a.ownerDocument.importNode(j,true)}a.appendChild(j);a.appendChild(this.createElementDefaultNS("Name",l.name));if(l.title){a.appendChild(this.createElementDefaultNS("Title",l.title))}b.appendChild(a)}else{b.appendChild(this.createElementDefaultNS("Name",l.name));b.appendChild(this.createElementDefaultNS("Title",l.title));if(l["abstract"]){b.appendChild(this.createElementDefaultNS("Abstract",l["abstract"]))}}}c.appendChild(b)}}return c},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple");this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a);return b},CLASS_NAME:"OpenLayers.Format.WMC.v1"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){if(b.keywords){b.keywords.push(this.getChildValue(a))}},DescribeLayer:function(a,b){b.describelayer={formats:[]};this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]};this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]};this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]};this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:parseInt(a.getAttribute("SupportSLD"))==1,userLayer:parseInt(a.getAttribute("UserLayer"))==1,userStyle:parseInt(a.getAttribute("UserStyle"))==1,remoteWFS:parseInt(a.getAttribute("RemoteWFS"))==1};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS");b.bbox[c.srs]=c},ScaleHint:function(e,f){var d=e.getAttribute("min");var a=e.getAttribute("max");var c=Math.pow(2,0.5);var b=OpenLayers.INCHES_PER_UNIT.m;f.maxScale=parseFloat(((d/c)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13));f.minScale=parseFloat(((a/c)*b*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(b,d){var a=b.getAttribute("name").toLowerCase();var c={name:a,units:b.getAttribute("units"),unitsymbol:b.getAttribute("unitSymbol")};d.dimensions[c.name]=c},Extent:function(d,e){var b=d.getAttribute("name").toLowerCase();if(b in e.dimensions){var c=e.dimensions[b];c.nearestVal=d.getAttribute("nearestValue")==="1";c.multipleVal=d.getAttribute("multipleValues")==="1";c.current=d.getAttribute("current")==="1";c["default"]=d.getAttribute("default")||"";var a=this.getChildValue(d);c.values=a.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS");b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[];this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(b,d){var a=b.getAttribute("name").toLowerCase();var c={name:a,units:b.getAttribute("units"),unitsymbol:b.getAttribute("unitSymbol"),nearestVal:b.getAttribute("nearestValue")==="1",multipleVal:b.getAttribute("multipleValues")==="1","default":b.getAttribute("default")||"",current:b.getAttribute("current")==="1",values:this.getChildValue(b).split(",")};d.dimensions[c.name]=c},Keyword:function(b,c){var a={value:this.getChildValue(b),vocabulary:b.getAttribute("vocabulary")};if(c.keywords){c.keywords.push(a)}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]);b.userSymbols.inlineFeature=parseInt(a.getAttribute("InlineFeature"))==1;b.userSymbols.remoteWCS=parseInt(a.getAttribute("RemoteWCS"))==1},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(b){OpenLayers.Format.XML.prototype.initialize.apply(this,[b]);this.options=b;var a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);a.version=this.version;return a},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};b.contents.layers=[];b.contents.tileMatrixSets={};this.readChildNodes(a,b.contents)},Layer:function(b,c){var a={styles:[],formats:[],tileMatrixSetLinks:[]};a.layers=[];this.readChildNodes(b,a);c.layers.push(a)},Style:function(b,c){var a={};a.isDefault=(b.getAttribute("isDefault")==="true");this.readChildNodes(b,a);c.styles.push(a)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(b,c){var a={};this.readChildNodes(b,a);c.tileMatrixSetLinks.push(a)},TileMatrixSet:function(b,c){if(c.layers){var a={matrixIds:[]};this.readChildNodes(b,a);c.tileMatrixSets[a.identifier]=a}else{c.tileMatrixSet=this.getChildValue(b)}},TileMatrix:function(b,c){var a={supportedCRS:c.supportedCRS};this.readChildNodes(b,a);c.matrixIds.push(a)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(d,f){var c=this.getChildValue(d);var e=c.split(" ");var a;if(f.supportedCRS){var b=f.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");a=!!this.yx[b]}if(a){f.topLeftCorner=new OpenLayers.LonLat(e[1],e[0])}else{f.topLeftCorner=new OpenLayers.LonLat(e[0],e[1])}},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},WSDL:function(a,b){b.wsdl={};b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={};b.serviceMetadataUrl.href=a.getAttribute("xlink:href")}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments)},drawMarker:function(a){var d=a.bounds;var f=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(d.left,d.top));var c=this.map.getLayerPxFromLonLat(new OpenLayers.LonLat(d.right,d.bottom));if(c==null||f==null){a.display(false)}else{var e=new OpenLayers.Size(Math.max(1,c.x-f.x),Math.max(1,c.y-f.y));var b=a.draw(f,e);if(!a.drawn){this.div.appendChild(b);a.drawn=true}}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a);if((a.div!=null)&&(a.div.parentNode==this.div)){this.div.removeChild(a.div)}},CLASS_NAME:"OpenLayers.Layer.Boxes"});OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(c,a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[c,b]);this.location=a;this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});this.loaded=true}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadRSS()}},parseData:function(k){var p=k.responseXML;if(!p||!p.documentElement){p=OpenLayers.Format.XML.prototype.read(k.responseText)}if(this.useFeedTitle){var a=null;try{a=p.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(j){a=p.getElementsByTagName("title")[0].firstChild.nodeValue}if(a){this.setName(a)}}var t={};OpenLayers.Util.extend(t,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){t.externalProjection=this.projection;t.internalProjection=this.map.getProjectionObject()}var q=new OpenLayers.Format.GeoRSS(t);var b=q.read(p);for(var g=0,h=b.length;g<h;g++){var f={};var s=b[g];if(!s.geometry){continue}var m=s.attributes.title?s.attributes.title:"Untitled";var r=s.attributes.description?s.attributes.description:"No description.";var l=s.attributes.link?s.attributes.link:"";var o=s.geometry.getBounds().getCenterLonLat();f.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();f.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);if(m||r){f.title=m;f.description=r;var c='<div class="olLayerGeoRSSClose">[x]</div>';c+='<div class="olLayerGeoRSSTitle">';if(l){c+='<a class="link" href="'+l+'" target="_blank">'}c+=m;if(l){c+="</a>"}c+="</div>";c+='<div style="" class="olLayerGeoRSSDescription">';c+=r;c+="</div>";f.popupContentHTML=c}var s=new OpenLayers.Feature(this,o,f);this.features.push(s);var d=s.createMarker();d.events.register("click",s,this.markerClick);this.addMarker(d)}this.events.triggerEvent("loadend")},markerClick:function(c){var e=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!e)?this:null;for(var d=0,a=this.layer.map.popups.length;d<a;d++){this.layer.map.removePopup(this.layer.map.popups[d])}if(!e){var b=this.createPopup();OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var g=0,f=this.layer.map.popups.length;g<f;g++){this.layer.map.removePopup(this.layer.map.popups[g])}},this));this.layer.map.addPopup(b)}OpenLayers.Event.stop(c)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257,0.000001341104507446289,6.705522537231445e-7],type:null,wrapDateLine:true,sphericalMercator:false,version:null,initialize:function(c,b){b=b||{};if(!b.version){b.version=typeof GMap2==="function"?"2":"3"}var a=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(a){OpenLayers.Util.applyDefaults(b,a)}else{throw"Unsupported Google Maps API version: "+b.version}OpenLayers.Util.applyDefaults(b,a.DEFAULTS);if(b.maxExtent){b.maxExtent=b.maxExtent.clone()}OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[c,b]);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[c,b]);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(b){var a=this.opacity==null?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);this.setOpacity(a)},display:function(a){if(!this._dragging){this.setGMapVisibility(a)}OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(b,a,c){this._dragging=c;OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);delete this._dragging},setOpacity:function(b){if(b!==this.opacity){if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}this.opacity=b}if(this.getVisibility()){var a=this.getMapContainer();OpenLayers.Util.modifyDOMElement(a,null,null,null,null,null,null,b)}},destroy:function(){if(this.map){this.setGMapVisibility(false);var a=OpenLayers.Layer.Google.cache[this.map.id];if(a&&a.count<=1){this.removeGMapElements()}}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var d=OpenLayers.Layer.Google.cache[this.map.id];if(d){var b=this.mapObject&&this.getMapContainer();if(b&&b.parentNode){b.parentNode.removeChild(b)}var c=d.termsOfUse;if(c&&c.parentNode){c.parentNode.removeChild(c)}var a=d.poweredBy;if(a&&a.parentNode){a.parentNode.removeChild(a)}}},removeMap:function(b){if(this.visibility&&this.mapObject){this.setGMapVisibility(false)}var a=OpenLayers.Layer.Google.cache[b.id];if(a){if(a.count<=1){this.removeGMapElements();delete OpenLayers.Layer.Google.cache[b.id]}else{--a.count}}delete this.termsOfUse;delete this.poweredBy;delete this.mapObject;delete this.dragObject;OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(b){var c=null;if(b!=null){var a=b.getSouthWest();var d=b.getNorthEast();if(this.sphericalMercator){a=this.forwardMercator(a.lng(),a.lat());d=this.forwardMercator(d.lng(),d.lat())}else{a=new OpenLayers.LonLat(a.lng(),a.lat());d=new OpenLayers.LonLat(d.lng(),d.lat())}c=new OpenLayers.Bounds(a.lon,a.lat,d.lon,d.lat)}return c},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(b){var a=this.sphericalMercator?this.forwardMercator(b.lng(),b.lat()).lat:b.lat();return a},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"});OpenLayers.Layer.Google.cache={};OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){if(!this.type){this.type=G_NORMAL_MAP}var g,d,a;var c=OpenLayers.Layer.Google.cache[this.map.id];if(c){g=c.mapObject;d=c.termsOfUse;a=c.poweredBy;++c.count}else{var b=this.map.viewPortDiv;var h=document.createElement("div");h.id=this.map.id+"_GMap2Container";h.style.position="absolute";h.style.width="100%";h.style.height="100%";b.appendChild(h);try{g=new GMap2(h);d=h.lastChild;b.appendChild(d);d.style.zIndex="1100";d.style.right="";d.style.bottom="";d.className="olLayerGoogleCopyright";a=h.lastChild;b.appendChild(a);a.style.zIndex="1100";a.style.right="";a.style.bottom="";a.className="olLayerGooglePoweredBy gmnoprint"}catch(f){throw (f)}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:g,termsOfUse:d,poweredBy:a,count:1}}this.mapObject=g;this.termsOfUse=d;this.poweredBy=a;if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1){this.mapObject.addMapType(this.type)}if(typeof g.getDragObject=="function"){this.dragObject=g.getDragObject()}else{this.dragPanMapObject=null}if(this.isBaseLayer===false){this.setGMapVisibility(this.div.style.display!=="none")}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()}else{if(!this._resized){var a=this;var b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b);delete a._resized;a.mapObject.checkResize();a.moveTo(a.map.getCenter(),a.map.getZoom())})}this._resized=true}},setGMapVisibility:function(c){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var a=this.mapObject.getContainer();if(c===true){this.mapObject.setMapType(this.type);a.style.display="";this.termsOfUse.style.left="";this.termsOfUse.style.display="";this.poweredBy.style.display="";b.displayed=this.id}else{if(b.displayed===this.id){delete b.displayed}if(!b.displayed){a.style.display="none";this.termsOfUse.style.display="none";this.termsOfUse.style.left="-9999px";this.poweredBy.style.display="none"}}}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(c){var b=null;if(c!=null){var a=this.sphericalMercator?this.inverseMercator(c.bottom,c.left):new OpenLayers.LonLat(c.bottom,c.left);var d=this.sphericalMercator?this.inverseMercator(c.top,c.right):new OpenLayers.LonLat(c.top,c.right);b=new GLatLngBounds(new GLatLng(a.lat,a.lon),new GLatLng(d.lat,d.lon))}return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(b,a){this.dragObject.moveBy(new GSize(-b,a))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(d,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(d,b);c=new GLatLng(a.lat,a.lon)}else{c=new GLatLng(b,d)}return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}};OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,grid:null,singleTile:false,ratio:1.5,buffer:2,numLoadingTiles:0,initialize:function(c,b,d,a){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[]},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var f=0,b=this.grid.length;f<b;f++){var e=this.grid[f];for(var c=0,a=e.length;c<a;c++){var d=e[c];this.removeTileMonitoringHooks(d);d.destroy()}}this.grid=[]}},clone:function(a){if(a==null){a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},moveTo:function(d,a,e){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);d=d||this.map.getExtent();if(d!=null){var c=!this.grid.length||a;var b=this.getTilesBounds();if(this.singleTile){if(c||(!e&&!b.containsBounds(d))){this.initSingleTile(d)}}else{if(c||!b.containsBounds(d,true)){this.initGriddedTiles(d)}else{this.moveGriddedTiles(d)}}}},setTileSize:function(a){if(this.singleTile){a=this.map.getSize();a.h=parseInt(a.h*this.ratio);a.w=parseInt(a.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getGridBounds:function(){var a="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(a);return this.getTilesBounds()},getTilesBounds:function(){var e=null;if(this.grid.length){var a=this.grid.length-1;var d=this.grid[a][0];var b=this.grid[0].length-1;var c=this.grid[0][b];e=new OpenLayers.Bounds(d.bounds.left,d.bounds.bottom,c.bounds.right,c.bounds.top)}return e},initSingleTile:function(f){var a=f.getCenterLonLat();var h=f.getWidth()*this.ratio;var b=f.getHeight()*this.ratio;var g=new OpenLayers.Bounds(a.lon-(h/2),a.lat-(b/2),a.lon+(h/2),a.lat+(b/2));var d=new OpenLayers.LonLat(g.left,g.top);var c=this.map.getLayerPxFromLonLat(d);if(!this.grid.length){this.grid[0]=[]}var e=this.grid[0][0];if(!e){e=this.addTile(g,c);this.addTileMonitoringHooks(e);e.draw();this.grid[0][0]=e}else{e.moveTo(g,c)}this.removeExcessTiles(1,1)},calculateGridLayout:function(a,q,e){var l=e*this.tileSize.w;var c=e*this.tileSize.h;var j=a.left-q.left;var m=Math.floor(j/l)-this.buffer;var k=j/l-m;var f=-k*this.tileSize.w;var o=q.left+m*l;var b=a.top-(q.bottom+c);var h=Math.ceil(b/c)+this.buffer;var p=h-b/c;var d=-p*this.tileSize.h;var g=q.bottom+h*c;return{tilelon:l,tilelat:c,tileoffsetlon:o,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},initGriddedTiles:function(j){var g=this.map.getSize();var z=Math.ceil(g.h/this.tileSize.h)+Math.max(1,2*this.buffer);var B=Math.ceil(g.w/this.tileSize.w)+Math.max(1,2*this.buffer);var q=this.getMaxExtent();var t=this.map.getResolution();var s=this.calculateGridLayout(j,q,t);var f=Math.round(s.tileoffsetx);var c=Math.round(s.tileoffsety);var l=s.tileoffsetlon;var p=s.tileoffsetlat;var e=s.tilelon;var k=s.tilelat;this.origin=new OpenLayers.Pixel(f,c);var w=f;var A=l;var v=0;var a=parseInt(this.map.layerContainerDiv.style.left);var u=parseInt(this.map.layerContainerDiv.style.top);do{var h=this.grid[v++];if(!h){h=[];this.grid.push(h)}l=A;f=w;var d=0;do{var b=new OpenLayers.Bounds(l,p,l+e,p+k);var o=f;o-=a;var m=c;m-=u;var r=new OpenLayers.Pixel(o,m);var C=h[d++];if(!C){C=this.addTile(b,r);this.addTileMonitoringHooks(C);h.push(C)}else{C.moveTo(b,r,false)}l+=e;f+=this.tileSize.w}while((l<=j.right+e*this.buffer)||d<B);p-=k;c+=this.tileSize.h}while((p>=j.bottom-k*this.buffer)||v<z);this.removeExcessTiles(v,d);this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){var b=[];var h=["right","down","left","up"];var g=0;var a=-1;var k=OpenLayers.Util.indexOf(h,"right");var l=0;while(l<h.length){var j=g;var c=a;switch(h[k]){case"right":c++;break;case"down":j++;break;case"left":c--;break;case"up":j--;break}var f=null;if((j<this.grid.length)&&(j>=0)&&(c<this.grid[0].length)&&(c>=0)){f=this.grid[j][c]}if((f!=null)&&(!f.queued)){b.unshift(f);f.queued=true;l=0;g=j;a=c}else{k=(k+1)%4;l++}}for(var d=0,e=b.length;d<e;d++){var f=b[d];f.draw();f.queued=false}},addTile:function(b,a){},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};a.events.register("loadstart",this,a.onLoadStart);a.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};a.events.register("loadend",this,a.onLoadEnd);a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},moveGriddedTiles:function(c){var b=this.buffer||1;while(true){var a=this.grid[0][0].position;var d=this.map.getViewPortPxFromLayerPx(a);if(d.x>-this.tileSize.w*(b-1)){this.shiftColumn(true)}else{if(d.x<-this.tileSize.w*b){this.shiftColumn(false)}else{if(d.y>-this.tileSize.h*(b-1)){this.shiftRow(true)}else{if(d.y<-this.tileSize.h*b){this.shiftRow(false)}else{break}}}}}},shiftRow:function(o){var c=(o)?0:(this.grid.length-1);var b=this.grid;var f=b[c];var e=this.map.getResolution();var h=(o)?-this.tileSize.h:this.tileSize.h;var g=e*-h;var m=(o)?b.pop():b.shift();for(var j=0,l=f.length;j<l;j++){var d=f[j];var a=d.bounds.clone();var k=d.position.clone();a.bottom=a.bottom+g;a.top=a.top+g;k.y=k.y+h;m[j].moveTo(a,k)}if(o){b.unshift(m)}else{b.push(m)}},shiftColumn:function(m){var d=(m)?-this.tileSize.w:this.tileSize.w;var c=this.map.getResolution();var k=c*d;for(var e=0,g=this.grid.length;e<g;e++){var l=this.grid[e];var j=(m)?0:(l.length-1);var b=l[j];var a=b.bounds.clone();var f=b.position.clone();a.left=a.left+k;a.right=a.right+k;f.x=f.x+d;var h=m?this.grid[e].pop():this.grid[e].shift();h.moveTo(a,f);if(m){l.unshift(h)}else{l.push(h)}}},removeExcessTiles:function(e,c){while(this.grid.length>e){var f=this.grid.pop();for(var b=0,a=f.length;b<a;b++){var d=f[b];this.removeTileMonitoringHooks(d);d.destroy()}}while(this.grid[0].length>c){for(var b=0,a=this.grid.length;b<a;b++){var f=this.grid[b];var d=f.pop();this.removeTileMonitoringHooks(d);d.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(d){var c=this.maxExtent;var f=this.getResolution();var e=f*this.tileSize.w;var b=f*this.tileSize.h;var h=this.getLonLatFromViewPortPx(d);var a=c.left+(e*Math.floor((h.lon-c.left)/e));var g=c.bottom+(b*Math.floor((h.lat-c.bottom)/b));return new OpenLayers.Bounds(a,g,a+e,g+b)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.MultiMap=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[9,1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125],type:null,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters();this.RESOLUTIONS.unshift(10)}},loadMapObject:function(){try{this.mapObject=new MultimapViewer(this.div)}catch(a){}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"MM",layerLib:"MultiMap"})},setMapObjectCenter:function(a,b){this.mapObject.goToPosition(a,b)},getMapObjectCenter:function(){return this.mapObject.getCurrentPosition()},getMapObjectZoom:function(){return this.mapObject.getZoomFactor()},getMapObjectLonLatFromMapObjectPixel:function(a){a.x=a.x-(this.map.getSize().w/2);a.y=a.y-(this.map.getSize().h/2);return this.mapObject.getMapPositionAt(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.geoPosToContainerPixels(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lon:a.lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lon,a.lat).lat:a.lat},getMapObjectLonLatFromLonLat:function(d,c){var a;if(this.sphericalMercator){var b=this.inverseMercator(d,c);a=new MMLatLon(b.lat,b.lon)}else{a=new MMLatLon(c,d)}return a},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new MMPoint(a,b)},CLASS_NAME:"OpenLayers.Layer.MultiMap"});OpenLayers.Layer.VirtualEarth=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:1,MAX_ZOOM_LEVEL:19,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515],type:null,wrapDateLine:true,sphericalMercator:false,animationEnabled:true,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){var a=OpenLayers.Util.createDiv(this.name);var c=this.map.getSize();a.style.width=c.w+"px";a.style.height=c.h+"px";this.div.appendChild(a);try{this.mapObject=new VEMap(this.name)}catch(b){}if(this.mapObject!=null){try{this.mapObject.LoadMap(null,null,this.type,true);this.mapObject.AttachEvent("onmousedown",OpenLayers.Function.True)}catch(b){}this.mapObject.HideDashboard();if(typeof this.mapObject.SetAnimationEnabled=="function"){this.mapObject.SetAnimationEnabled(this.animationEnabled)}}if(!this.mapObject||!this.mapObject.vemapcontrol||!this.mapObject.vemapcontrol.PanMap||(typeof this.mapObject.vemapcontrol.PanMap!="function")){this.dragPanMapObject=null}},onMapResize:function(){this.mapObject.Resize(this.map.size.w,this.map.size.h)},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"VE",layerLib:"VirtualEarth"})},setMapObjectCenter:function(a,b){this.mapObject.SetCenterAndZoom(a,b)},getMapObjectCenter:function(){return this.mapObject.GetCenter()},dragPanMapObject:function(b,a){this.mapObject.vemapcontrol.PanMap(b,-a)},getMapObjectZoom:function(){return this.mapObject.GetZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return(typeof VEPixel!="undefined")?this.mapObject.PixelToLatLong(a):this.mapObject.PixelToLatLong(a.x,a.y)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.LatLongToPixel(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lon:a.Longitude},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Longitude,a.Latitude).lat:a.Latitude},getMapObjectLonLatFromLonLat:function(d,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(d,b);c=new VELatLong(a.lat,a.lon)}else{c=new VELatLong(b,d)}return c},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return(typeof VEPixel!="undefined")?new VEPixel(a,b):new Msn.VE.Pixel(a,b)},CLASS_NAME:"OpenLayers.Layer.VirtualEarth"});OpenLayers.Layer.Yahoo=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:17,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031],type:null,wrapDateLine:true,sphericalMercator:false,initialize:function(b,a){OpenLayers.Layer.EventPane.prototype.initialize.apply(this,arguments);OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,arguments);if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);this.initMercatorParameters()}},loadMapObject:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject=new YMap(this.div,this.type,a);this.mapObject.disableKeyControls();this.mapObject.disableDragMap();if(!this.mapObject.moveByXY||(typeof this.mapObject.moveByXY!="function")){this.dragPanMapObject=null}}catch(b){}},onMapResize:function(){try{var a=this.getMapObjectSizeFromOLSize(this.map.getSize());this.mapObject.resizeTo(a)}catch(b){}},setMap:function(a){OpenLayers.Layer.EventPane.prototype.setMap.apply(this,arguments);this.map.events.register("moveend",this,this.fixYahooEventPane)},fixYahooEventPane:function(){var a=OpenLayers.Util.getElement("ygddfdiv");if(a!=null){if(a.parentNode!=null){a.parentNode.removeChild(a)}this.map.events.unregister("moveend",this,this.fixYahooEventPane)}},getWarningHTML:function(){return OpenLayers.i18n("getLayerWarning",{layerType:"Yahoo",layerLib:"Yahoo"})},getOLZoomFromMapObjectZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getOLZoomFromMapObjectZoom.apply(this,[a]);b=18-b}return b},getMapObjectZoomFromOLZoom:function(a){var b=null;if(a!=null){b=OpenLayers.Layer.FixedZoomLevels.prototype.getMapObjectZoomFromOLZoom.apply(this,[a]);b=18-b}return b},setMapObjectCenter:function(a,b){this.mapObject.drawZoomAndCenter(a,b)},getMapObjectCenter:function(){return this.mapObject.getCenterLatLon()},dragPanMapObject:function(b,a){this.mapObject.moveByXY({x:-b,y:a})},getMapObjectZoom:function(){return this.mapObject.getZoomLevel()},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.convertXYLatLon(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.convertLatLonXY(a)},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lon:a.Lon},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.Lon,a.Lat).lat:a.Lat},getMapObjectLonLatFromLonLat:function(d,c){var a;if(this.sphericalMercator){var b=this.inverseMercator(d,c);a=new YGeoPoint(b.lat,b.lon)}else{a=new YGeoPoint(c,d)}return a},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},getMapObjectPixelFromXY:function(a,b){return new YCoordPoint(a,b)},getMapObjectSizeFromOLSize:function(a){return new YSize(a.w,a.h)},CLASS_NAME:"OpenLayers.Layer.Yahoo"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(b,a){OpenLayers.Util.extend(this,a);this.rules=[];if(a&&a.rules){this.addRules(a.rules)}this.setDefaultStyle(b||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy();this.rules[b]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(k){var a=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),k);var j=this.rules;var h,b;var c=[];var f=false;for(var d=0,e=j.length;d<e;d++){h=j[d];var g=h.evaluate(k);if(g){if(h instanceof OpenLayers.Rule&&h.elseFilter){c.push(h)}else{f=true;this.applySymbolizer(h,a,k)}}}if(f==false&&c.length>0){f=true;for(var d=0,e=c.length;d<e;d++){this.applySymbolizer(c[d],a,k)}}if(j.length>0&&f==false){a.display="none"}return a},applySymbolizer:function(f,d,b){var a=b.geometry?this.getSymbolizerPrefix(b.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var c=f.symbolizer[a]||f.symbolizer;if(this.defaultsPerSymbolizer===true){var e=this.defaultStyle;OpenLayers.Util.applyDefaults(c,{pointRadius:e.pointRadius});if(c.stroke===true||c.graphic===true){OpenLayers.Util.applyDefaults(c,{strokeWidth:e.strokeWidth,strokeColor:e.strokeColor,strokeOpacity:e.strokeOpacity,strokeDashstyle:e.strokeDashstyle,strokeLinecap:e.strokeLinecap})}if(c.fill===true||c.graphic===true){OpenLayers.Util.applyDefaults(c,{fillColor:e.fillColor,fillOpacity:e.fillOpacity})}if(c.graphic===true){OpenLayers.Util.applyDefaults(c,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(d,c),b)},createLiterals:function(d,c){var b=OpenLayers.Util.extend({},c.attributes||c.data);OpenLayers.Util.extend(b,this.context);for(var a in this.propertyStyles){d[a]=OpenLayers.Style.createLiteral(d[a],b,c,a)}return d},findPropertyStyles:function(){var d={};var f=this.defaultStyle;this.addPropertyStyles(d,f);var h=this.rules;var e,g;for(var c=0,a=h.length;c<a;c++){e=h[c].symbolizer;for(var b in e){g=e[b];if(typeof g=="object"){this.addPropertyStyles(d,g)}else{this.addPropertyStyles(d,e);break}}}return d},addPropertyStyles:function(b,c){var d;for(var a in c){d=c[a];if(typeof d=="string"&&d.match(/\$\{\w+\}/)){b[a]=true}}return b},addRules:function(a){Array.prototype.push.apply(this.rules,a);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(d){var c=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var b=0,a=c.length;b<a;b++){if(d.CLASS_NAME.indexOf(c[b])!=-1){return c[b]}}},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.rules){b.rules=[];for(var c=0,a=this.rules.length;c<a;++c){b.rules.push(this.rules[c].clone())}}b.context=this.context&&OpenLayers.Util.extend({},this.context);var d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,b)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(d,b,a,c){if(typeof d=="string"&&d.indexOf("${")!=-1){d=OpenLayers.String.format(d,b,[a,c]);d=(isNaN(d)||!d)?d:parseFloat(d)}return d};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(a){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.zoomBox){this.zoomBox.destroy()}this.zoomBox=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();if(this.zoomWheelEnabled){this.handlers.wheel.activate()}this.handlers.click.activate();if(this.zoomBoxEnabled){this.zoomBox.activate()}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False}var a={dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};var b={"double":true,stopDouble:true};this.handlers.click=new OpenLayers.Handler.Click(this,a,b);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions)},defaultDblClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom+1)},defaultDblRightClick:function(b){var a=this.map.getLonLatFromViewPortPx(b.xy);this.map.setCenter(a,this.map.zoom-1)},wheelChange:function(j,c){var h=this.map.getZoom();var f=this.map.getZoom()+Math.round(c);f=Math.max(f,0);f=Math.min(f,this.map.getNumZoomLevels());if(f===h){return}var k=this.map.getSize();var e=k.w/2-j.xy.x;var d=j.xy.y-k.h/2;var g=this.map.baseLayer.getResolutionForZoom(f);var a=this.map.getLonLatFromPixel(j.xy);var b=new OpenLayers.LonLat(a.lon+e*g,a.lat+d*g);this.map.setCenter(b,f)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=false;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=true;if(this.active){this.zoomBox.activate()}},disableZoomWheel:function(){this.zoomWheelEnabled=false;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=true;if(this.active){this.handlers.wheel.activate()}},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return true},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);b.appendChild(this.write_wmc_FormatList(a));b.appendChild(this.write_wmc_StyleList(a));b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(c,b){var a=parseFloat(this.getChildValue(b));if(a>0){c.maxScale=a}},read_sld_MaxScaleDenominator:function(b,a){b.minScale=parseFloat(this.getChildValue(a))},write_wmc_Layer:function(b){var c=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[b]);if(b.maxScale){var d=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");d.appendChild(this.createTextNode(b.maxScale.toPrecision(16)));c.appendChild(d)}if(b.minScale){var a=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");a.appendChild(this.createTextNode(b.minScale.toPrecision(16)));c.appendChild(a)}c.appendChild(this.write_wmc_FormatList(b));c.appendChild(this.write_wmc_StyleList(b));c.appendChild(this.write_wmc_LayerExtension(b));return c},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,f){var d=this.getChildValue(e);var b=d.split(/ +/);for(var c=0,a=b.length;c<a;c++){f.srs[b[c]]=true}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",initialize:function(a){OpenLayers.Format.WMSCapabilities.v1_1.prototype.initialize.apply(this,[a])},readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=true}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry()},setBounds:function(a){if(a){this.bounds=a.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(b){var a=this.getBounds();if(!a){this.setBounds(b)}else{this.bounds.extend(b)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(b,a){},getVertices:function(a){},atPoint:function(e,h,f){var c=false;var d=this.getBounds();if((d!=null)&&(e!=null)){var b=(h!=null)?h:0;var a=(f!=null)?f:0;var g=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-a,this.bounds.right+b,this.bounds.top+a);c=g.containsLonLat(e)}return c},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(f){var g=arguments.callee.format;if(!g){g=new OpenLayers.Format.WKT();arguments.callee.format=g}var d;var b=g.read(f);if(b instanceof OpenLayers.Feature.Vector){d=b.geometry}else{if(b instanceof Array){var a=b.length;var e=new Array(a);for(var c=0;c<a;++c){e[c]=b[c].geometry}d=new OpenLayers.Geometry.Collection(e)}}return d};OpenLayers.Geometry.segmentsIntersect=function(a,I,b){var t=b&&b.point;var A=b&&b.tolerance;var f=false;var C=a.x1-I.x1;var G=a.y1-I.y1;var q=a.x2-a.x1;var z=a.y2-a.y1;var u=I.y2-I.y1;var l=I.x2-I.x1;var E=(u*q)-(l*z);var e=(l*G)-(u*C);var c=(q*G)-(z*C);if(E==0){if(e==0&&c==0){f=true}}else{var F=e/E;var D=c/E;if(F>=0&&F<=1&&D>=0&&D<=1){if(!t){f=true}else{var h=a.x1+(F*q);var g=a.y1+(F*z);f=new OpenLayers.Geometry.Point(h,g)}}}if(A){var s;if(f){if(t){var o=[a,I];var B,h,g;outer:for(var w=0;w<2;++w){B=o[w];for(var v=1;v<3;++v){h=B["x"+v];g=B["y"+v];s=Math.sqrt(Math.pow(h-f.x,2)+Math.pow(g-f.y,2));if(s<A){f.x=h;f.y=g;break outer}}}}}else{var o=[a,I];var r,H,h,g,m,k;outer:for(var w=0;w<2;++w){r=o[w];H=o[(w+1)%2];for(var v=1;v<3;++v){m={x:r["x"+v],y:r["y"+v]};k=OpenLayers.Geometry.distanceToSegment(m,H);if(k.distance<A){if(t){f=new OpenLayers.Geometry.Point(m.x,m.y)}else{f=true}break outer}}}}}return f};OpenLayers.Geometry.distanceToSegment=function(l,d){var c=l.x;var k=l.y;var b=d.x1;var j=d.y1;var a=d.x2;var f=d.y2;var o=a-b;var m=f-j;var h=((o*(c-b))+(m*(k-j)))/(Math.pow(o,2)+Math.pow(m,2));var g,e;if(h<=0){g=b;e=j}else{if(h>=1){g=a;e=f}else{g=b+h*o;e=j+h*m}}return{distance:Math.sqrt(Math.pow(g-c,2)+Math.pow(e-k,2)),x:g,y:e}};OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(d,c,e,b){var a=[];e=OpenLayers.Util.upperCaseObject(e);a.push(d,c,e,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="jpg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(e){e=this.adjustBounds(e);var d=this.projection.getCode().split(":");var c=d[d.length-1];var g=this.getImageSize();var h={BBOX:e.toBBOX(),SIZE:g.w+","+g.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var f=[];var a;for(a in this.layerDefs){if(this.layerDefs.hasOwnProperty(a)){if(this.layerDefs[a]){f.push(a);f.push(":");f.push(this.layerDefs[a]);f.push(";")}}}if(f.length>0){h.LAYERDEFS=f.join("")}}var b=this.getFullRequestString(h);return b},setLayerFilter:function(b,a){if(!this.layerDefs){this.layerDefs={}}if(a){this.layerDefs[b]=a}else{delete this.layerDefs[b]}},clearLayerFilter:function(a){if(a){delete this.layerDefs[a]}else{delete this.layerDefs}},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});OpenLayers.Layer.Google.v3={DEFAULTS:{maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),sphericalMercator:true,maxResolution:156543.0339,units:"m",projection:"EPSG:900913"},loadMapObject:function(){if(!this.type){this.type=google.maps.MapTypeId.ROADMAP}var d;var c=OpenLayers.Layer.Google.cache[this.map.id];if(c){d=c.mapObject;++c.count}else{var b=this.map.viewPortDiv;var e=document.createElement("div");e.id=this.map.id+"_GMapContainer";e.style.position="absolute";e.style.width="100%";e.style.height="100%";b.appendChild(e);var a=this.map.getCenter();d=new google.maps.Map(e,{center:a?new google.maps.LatLng(a.lat,a.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false});c={mapObject:d,count:1};OpenLayers.Layer.Google.cache[this.map.id]=c;this.repositionListener=google.maps.event.addListenerOnce(d,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))}this.mapObject=d;this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var e=this.mapObject.getDiv().firstChild;if(!e||e.childNodes.length<3){this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250);return false}var d=OpenLayers.Layer.Google.cache[this.map.id];var b=this.map.viewPortDiv;var c=e.lastChild;b.appendChild(c);c.style.zIndex="1100";c.style.bottom="";c.className="olLayerGoogleCopyright olLayerGoogleV3";c.style.display="";d.termsOfUse=c;var a=e.lastChild;b.appendChild(a);a.style.zIndex="1100";a.style.bottom="";a.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint";a.style.display="";d.poweredBy=a;this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")}else{if(!this._resized){var a=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){delete a._resized;google.maps.event.trigger(a.mapObject,"resize");a.moveTo(a.map.getCenter(),a.map.getZoom())})}this._resized=true}},setGMapVisibility:function(g){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var e=this.type;var f=this.map.layers;var d;for(var c=f.length-1;c>=0;--c){d=f[c];if(d instanceof OpenLayers.Layer.Google&&d.visibility===true&&d.inRange===true){e=d.type;g=true;break}}var a=this.mapObject.getDiv();if(g===true){this.mapObject.setMapTypeId(e);a.style.left="";if(b.termsOfUse&&b.termsOfUse.style){b.termsOfUse.style.left="";b.termsOfUse.style.display="";b.poweredBy.style.display=""}b.displayed=this.id}else{delete b.displayed;a.style.left="-9999px";if(b.termsOfUse&&b.termsOfUse.style){b.termsOfUse.style.display="none";b.termsOfUse.style.left="-9999px";b.poweredBy.style.display="none"}}}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(c){var b=null;if(c!=null){var a=this.sphericalMercator?this.inverseMercator(c.bottom,c.left):new OpenLayers.LonLat(c.bottom,c.left);var d=this.sphericalMercator?this.inverseMercator(c.top,c.right):new OpenLayers.LonLat(c.top,c.right);b=new google.maps.LatLngBounds(new google.maps.LatLng(a.lat,a.lon),new google.maps.LatLng(d.lat,d.lon))}return b},getMapObjectLonLatFromMapObjectPixel:function(h){var b=this.map.getSize();var f=this.getLongitudeFromMapObjectLonLat(this.mapObject.center);var d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center);var a=this.map.getResolution();var g=h.x-(b.w/2);var e=h.y-(b.h/2);var c=new OpenLayers.LonLat(f+g*a,d-e*a);if(this.wrapDateLine){c=c.wrapDateLine(this.maxExtent)}return this.getMapObjectLonLatFromLonLat(c.lon,c.lat)},getMapObjectPixelFromMapObjectLonLat:function(f){var e=this.getLongitudeFromMapObjectLonLat(f);var d=this.getLatitudeFromMapObjectLonLat(f);var b=this.map.getResolution();var c=this.map.getExtent();var a=new OpenLayers.Pixel((1/b*(e-c.left)),(1/b*(c.top-d)));return this.getMapObjectPixelFromXY(a.x,a.y)},setMapObjectCenter:function(a,b){this.mapObject.setOptions({center:a,zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(d,b){var c;if(this.sphericalMercator){var a=this.inverseMercator(d,b);c=new google.maps.LatLng(a.lat,a.lon)}else{c=new google.maps.LatLng(b,d)}return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)},destroy:function(){if(this.repositionListener){google.maps.event.removeListener(this.repositionListener)}if(this.repositionTimer){window.clearTimeout(this.repositionTimer)}OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}};OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,units:null,resolution:OpenLayers.DOTS_PER_INCH,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(d,c,e,b){var a=[];a.push(d,c,e,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(c){c=this.adjustBounds(c);var d=this.map.getResolution();var e=Math.round((this.map.getScale()*10000))/10000;var b=Math.round(c.left/d);var a=-Math.round(c.top/d);return this.getFullRequestString({t:a,l:b,s:e})},addTile:function(c,a){var b=this.getURL(c);return new OpenLayers.Tile.Image(this,a,c,b,this.tileSize)},calculateGridLayout:function(a,q,e){var l=e*this.tileSize.w;var c=e*this.tileSize.h;var j=a.left;var m=Math.floor(j/l)-this.buffer;var k=j/l-m;var f=-k*this.tileSize.w;var o=m*l;var b=a.top;var h=Math.ceil(b/c)+this.buffer;var p=h-b/c;var d=-(p+1)*this.tileSize.h;var g=h*c;return{tilelon:l,tilelat:c,tileoffsetlon:o,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},clone:function(a){if(a==null){a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);if(this.tileSize!=null){a.tileSize=this.tileSize.clone()}a.grid=[];return a},getTileBounds:function(c){var e=this.getResolution();var d=e*this.tileSize.w;var b=e*this.tileSize.h;var g=this.getLonLatFromViewPortPx(c);var a=d*Math.floor(g.lon/d);var f=b*Math.floor(g.lat/b);return new OpenLayers.Bounds(a,f,a+d,f+b)},CLASS_NAME:"OpenLayers.Layer.KaMap"});OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,useHttpTile:false,singleTile:false,useOverlay:false,useAsyncOverlay:true,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),initialize:function(c,b,d,a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);if(a==null||a.isBaseLayer==null){this.isBaseLayer=((this.transparent!="true")&&(this.transparent!=true))}if(a&&a.useOverlay!=null){this.useOverlay=a.useOverlay}if(this.singleTile){if(this.useOverlay){OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS);if(!this.useAsyncOverlay){this.params.version="1.0.0"}}else{OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)}}else{if(this.useHttpTile){OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS)}else{OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS)}this.setTileSize(this.defaultSize)}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(a){var d;var b=a.getCenterLonLat();var h=this.map.getSize();if(this.singleTile){var e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:h.h*this.ratio,setdisplaywidth:h.w*this.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var j={};j=OpenLayers.Util.extend(j,e);j.operation="GETVISIBLEMAPEXTENT";j.version="1.0.0";j.session=this.params.session;j.mapName=this.params.mapName;j.format="text/xml";d=this.getFullRequestString(j);OpenLayers.Request.GET({url:d,async:false})}d=this.getFullRequestString(e)}else{var g=this.map.getResolution();var f=Math.floor((a.left-this.maxExtent.left)/g);f=Math.round(f/this.tileSize.w);var c=Math.floor((this.maxExtent.top-a.top)/g);c=Math.round(c/this.tileSize.h);if(this.useHttpTile){d=this.getImageFilePath({tilecol:f,tilerow:c,scaleindex:this.resolutions.length-this.map.zoom-1})}else{d=this.getFullRequestString({tilecol:f,tilerow:c,scaleindex:this.resolutions.length-this.map.zoom-1})}}return d},getFullRequestString:function(f,e){var b=(e==null)?this.url:e;if(typeof b=="object"){b=b[Math.floor(Math.random()*b.length)]}var j=b;var g=OpenLayers.Util.extend({},this.params);g=OpenLayers.Util.extend(g,f);var d=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var h in g){if(h.toUpperCase() in d){delete g[h]}}var a=OpenLayers.Util.getParameterString(g);a=a.replace(/,/g,"+");if(a!=""){var c=b.charAt(b.length-1);if((c=="&")||(c=="?")){j+=a}else{if(b.indexOf("?")==-1){j+="?"+a}else{j+="&"+a}}}return j},getImageFilePath:function(g,e){var c=(e==null)?this.url:e;if(typeof c=="object"){c=c[Math.floor(Math.random()*c.length)]}var b=c;var d="";var f="";if(g.tilerow<0){d="-"}if(g.tilerow==0){d+="0"}else{d+=Math.floor(Math.abs(g.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder}if(g.tilecol<0){f="-"}if(g.tilecol==0){f+="0"}else{f+=Math.floor(Math.abs(g.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder}var a="/S"+Math.floor(g.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+d+"/C"+f+"/"+(g.tilerow%this.params.tileRowsPerFolder)+"_"+(g.tilecol%this.params.tileColumnsPerFolder)+"."+this.params.format;if(this.params.querystring){a+="?"+this.params.querystring}b+=a;return b},calculateGridLayout:function(a,q,e){var l=e*this.tileSize.w;var c=e*this.tileSize.h;var j=a.left-q.left;var m=Math.floor(j/l)-this.buffer;var k=j/l-m;var f=-k*this.tileSize.w;var o=q.left+m*l;var b=q.top-a.top+c;var h=Math.floor(b/c)-this.buffer;var p=h-b/c;var d=p*this.tileSize.h;var g=q.top-c*h;return{tilelon:l,tilelat:c,tileoffsetlon:o,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},CLASS_NAME:"OpenLayers.Layer.MapGuide"});OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(d,c,e,b){var a=[];a.push(d,c,e,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);if(b==null||b.isBaseLayer==null){this.isBaseLayer=((this.params.transparent!="true")&&(this.params.transparent!=true))}},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getURL:function(c){c=this.adjustBounds(c);var b=[c.left,c.bottom,c.right,c.top];var d=this.getImageSize();var a=this.getFullRequestString({mapext:b,imgext:b,map_size:[d.w,d.h],imgx:d.w/2,imgy:d.h/2,imgxy:[d.w,d.h]});return a},getFullRequestString:function(f,e){var b=(e==null)?this.url:e;var g=OpenLayers.Util.extend({},this.params);g=OpenLayers.Util.extend(g,f);var a=OpenLayers.Util.getParameterString(g);if(b instanceof Array){b=this.selectUrl(a,b)}var d=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(b));for(var h in g){if(h.toUpperCase() in d){delete g[h]}}a=OpenLayers.Util.getParameterString(g);var j=b;a=a.replace(/,/g,"+");if(a!=""){var c=b.charAt(b.length-1);if((c=="&")||(c=="?")){j+=a}else{if(b.indexOf("?")==-1){j+="?"+a}else{j+="&"+a}}}return j},CLASS_NAME:"OpenLayers.Layer.MapServer"});OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",isBaseLayer:true,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(d,c,b){var a=[];a.push(d,c,{},b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(d){d=this.adjustBounds(d);var c=this.map.getResolution();var a=Math.round((d.left-this.tileOrigin.lon)/(c*this.tileSize.w));var g=Math.round((d.bottom-this.tileOrigin.lat)/(c*this.tileSize.h));var f=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,c):this.map.getZoom()+this.zoomOffset;var e=this.serviceVersion+"/"+this.layername+"/"+f+"/"+a+"/"+g+"."+this.type;var b=this.url;if(b instanceof Array){b=this.selectUrl(e,b)}return b+e},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.TMS"});OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(c,b,d,a){this.layername=d;OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,{},a]);this.extension=this.format.split("/")[1].toLowerCase();this.extension=(this.extension=="jpg")?"jpeg":this.extension},clone:function(a){if(a==null){a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(b){var f=this.map.getResolution();var g=this.maxExtent;var l=this.tileSize;var a=Math.round((b.left-g.left)/(f*l.w));var k=Math.round((b.bottom-g.bottom)/(f*l.h));var h=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,f):this.map.getZoom();function e(q,p){q=String(q);var m=[];for(var o=0;o<p;++o){m.push("0")}return m.join("").substring(0,p-q.length)+q}var d=[this.layername,e(h,2),e(parseInt(a/1000000),3),e((parseInt(a/1000)%1000),3),e((parseInt(a)%1000),3),e(parseInt(k/1000000),3),e((parseInt(k/1000)%1000),3),e((parseInt(k)%1000),3)+"."+this.extension];var j=d.join("/");var c=this.url;if(c instanceof Array){c=this.selectUrl(j,c)}c=(c.charAt(c.length-1)=="/")?c:c+"/";return c+j},addTile:function(c,a){var b=this.getURL(c);return new OpenLayers.Tile.Image(this,a,c,b,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.TileCache"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(d,c,e,b){var a=[];e=OpenLayers.Util.upperCaseObject(e);if(parseFloat(e.VERSION)>=1.3&&!e.EXCEPTIONS){e.EXCEPTIONS="INIMAGE"}a.push(d,c,e,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((b==null)||(!b.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()])},getURL:function(c){c=this.adjustBounds(c);var d=this.getImageSize();var e={};var b=this.reverseAxisOrder();e.BBOX=this.encodeBBOX?c.toBBOX(null,b):c.toArray(b);e.WIDTH=d.w;e.HEIGHT=d.h;var a=this.getFullRequestString(e);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(d,b){var a=this.map.getProjection();var c=(a=="none")?null:a;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=c}else{this.params.SRS=c}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(c){var f={url:true,layer:true,style:true,matrixSet:true};for(var g in f){if(!(g in c)){throw new Error("Missing property '"+g+"' in layer configuration.")}}c.params=OpenLayers.Util.upperCaseObject(c.params);var b=[c.name,c.url,c.params,c];OpenLayers.Layer.Grid.prototype.initialize.apply(this,b);if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()}if(this.matrixIds){var a=this.matrixIds.length;if(a&&typeof this.matrixIds[0]==="string"){var e=this.matrixIds;this.matrixIds=new Array(a);for(var d=0;d<a;++d){this.matrixIds[d]={identifier:e[d]}}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.updateMatrixProperties()},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)}if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent}}},moveTo:function(b,a,c){if(a||!this.matrix){this.updateMatrixProperties()}return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMTS(this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getMatrix:function(){var b;if(!this.matrixIds||this.matrixIds.length===0){b={identifier:this.map.getZoom()+this.zoomOffset}}else{if("scaleDenominator" in this.matrixIds[0]){var a=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.map.getResolution()/0.00028;var e=Number.POSITIVE_INFINITY;var f;for(var c=0,d=this.matrixIds.length;c<d;++c){f=Math.abs(1-(this.matrixIds[c].scaleDenominator/a));if(f<e){e=f;b=this.matrixIds[c]}}}else{b=this.matrixIds[this.map.getZoom()+this.zoomOffset]}}return b},getTileInfo:function(f){var b=this.map.getResolution();var d=(f.lon-this.tileOrigin.lon)/(b*this.tileSize.w);var c=(this.tileOrigin.lat-f.lat)/(b*this.tileSize.h);var a=Math.floor(d);var e=Math.floor(c);return{col:a,row:e,i:Math.floor((d-a)*this.tileSize.w),j:Math.floor((c-e)*this.tileSize.h)}},getURL:function(d){d=this.adjustBounds(d);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(d)){var a=d.getCenterLonLat();var f=this.getTileInfo(a);var h=this.matrix.identifier;if(this.requestEncoding.toUpperCase()==="REST"){var e=this.version+"/"+this.layer+"/"+this.style+"/";if(this.dimensions){for(var c=0;c<this.dimensions.length;c++){if(this.params[this.dimensions[c]]){e=e+this.params[this.dimensions[c]]+"/"}}}e=e+this.matrixSet+"/"+this.matrix.identifier+"/"+f.row+"/"+f.col+"."+this.formatSuffix;if(this.url instanceof Array){b=this.selectUrl(e,this.url)}else{b=this.url}if(!b.match(/\/$/)){b=b+"/"}b=b+e}else{if(this.requestEncoding.toUpperCase()==="KVP"){var g={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:f.row,TILECOL:f.col,FORMAT:this.format};b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[g])}}}return b},mergeNewParams:function(a){if(this.requestEncoding.toUpperCase()==="KVP"){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])}},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(d,c,e,g,f,b){this.lzd=e;this.zoomLevels=g;var a=[];a.push(d,c,f,b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a);this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},getZoom:function(){var b=this.map.getZoom();var a=this.map.getMaxExtent();b=b-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);return b},getURL:function(e){e=this.adjustBounds(e);var d=this.getZoom();var b=this.map.getMaxExtent();var c=this.lzd/Math.pow(2,this.getZoom());var a=Math.floor((e.left-b.left)/c);var f=Math.floor((e.bottom-b.bottom)/c);if(this.map.getResolution()<=(this.lzd/512)&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:d,X:a,Y:f})}else{return OpenLayers.Util.getImagesLocation()+"blank.gif"}},CLASS_NAME:"OpenLayers.Layer.WorldWind"});OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,initialize:function(d,c,b){if(b&&b.sphericalMercator||this.sphericalMercator){b=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,units:"m",projection:"EPSG:900913"},b)}c=c||this.url;d=d||this.name;var a=[d,c,{},b];OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(e){var c=this.map.getResolution();var a=Math.round((e.left-this.maxExtent.left)/(c*this.tileSize.w));var h=Math.round((this.maxExtent.top-e.top)/(c*this.tileSize.h));var g=this.map.getZoom()+this.zoomOffset;var b=this.url;var d=""+a+h+g;if(b instanceof Array){b=this.selectUrl(d,b)}var f=OpenLayers.String.format(b,{x:a,y:h,z:g});return f},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)}},CLASS_NAME:"OpenLayers.Layer.XYZ"});OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(a){if(a==null){a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())}a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.OSM"});OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{url:null,size:null,isBaseLayer:true,standardTileSize:256,numberOfTiers:0,tileCountUpToTier:new Array(),tierSizeInTiles:new Array(),tierImageSize:new Array(),initialize:function(d,c,e,b){this.initializeZoomify(e);var a=[];a.push(d,c,e,{},b);OpenLayers.Layer.Grid.prototype.initialize.apply(this,a)},initializeZoomify:function(c){var d=c.clone();var a=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles.push(a);this.tierImageSize.push(d);while(d.w>this.standardTileSize||d.h>this.standardTileSize){d=new OpenLayers.Size(Math.floor(d.w/2),Math.floor(d.h/2));a=new OpenLayers.Size(Math.ceil(d.w/this.standardTileSize),Math.ceil(d.h/this.standardTileSize));this.tierSizeInTiles.push(a);this.tierImageSize.push(d)}this.tierSizeInTiles.reverse();this.tierImageSize.reverse();this.numberOfTiers=this.tierSizeInTiles.length;this.tileCountUpToTier[0]=0;for(var b=1;b<this.numberOfTiers;b++){this.tileCountUpToTier.push(this.tierSizeInTiles[b-1].w*this.tierSizeInTiles[b-1].h+this.tileCountUpToTier[b-1])}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);this.tileCountUpToTier.length=0;this.tierSizeInTiles.length=0;this.tierImageSize.length=0},clone:function(a){if(a==null){a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},getURL:function(d){d=this.adjustBounds(d);var c=this.map.getResolution();var a=Math.round((d.left-this.tileOrigin.lon)/(c*this.tileSize.w));var h=Math.round((this.tileOrigin.lat-d.top)/(c*this.tileSize.h));var g=this.map.getZoom();var f=a+h*this.tierSizeInTiles[g].w+this.tileCountUpToTier[g];var e="TileGroup"+Math.floor((f)/256)+"/"+g+"-"+a+"-"+h+".jpg";var b=this.url;if(b instanceof Array){b=this.selectUrl(e,b)}return b+e},getImageSize:function(){if(arguments.length>0){bounds=this.adjustBounds(arguments[0]);var c=this.map.getResolution();var a=Math.round((bounds.left-this.tileOrigin.lon)/(c*this.tileSize.w));var f=Math.round((this.tileOrigin.lat-bounds.top)/(c*this.tileSize.h));var e=this.map.getZoom();var b=this.standardTileSize;var d=this.standardTileSize;if(a==this.tierSizeInTiles[e].w-1){var b=this.tierImageSize[e].w%this.standardTileSize}if(f==this.tierSizeInTiles[e].h-1){var d=this.tierImageSize[e].h%this.standardTileSize}return(new OpenLayers.Size(b,d))}else{return this.tileSize}},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(a,q,e){var l=e*this.tileSize.w;var c=e*this.tileSize.h;var j=a.left-q.left;var m=Math.floor(j/l)-this.buffer;var k=j/l-m;var f=-k*this.tileSize.w;var o=q.left+m*l;var b=q.top-a.top+c;var h=Math.floor(b/c)-this.buffer;var p=h-b/c;var d=p*this.tileSize.h;var g=q.top-c*h;return{tilelon:l,tilelat:c,tileoffsetlon:o,tileoffsetlat:g,tileoffsetx:f,tileoffsety:d}},CLASS_NAME:"OpenLayers.Layer.Zoomify"});OpenLayers.Protocol.SQL.Gears=OpenLayers.Class(OpenLayers.Protocol.SQL,{FID_PREFIX:"__gears_fid__",NULL_GEOMETRY:"__gears_null_geometry__",NULL_FEATURE_STATE:"__gears_null_feature_state__",jsonParser:null,wktParser:null,fidRegExp:null,saveFeatureState:true,typeOfFid:"string",db:null,initialize:function(a){if(!this.supported()){return}OpenLayers.Protocol.SQL.prototype.initialize.apply(this,[a]);this.jsonParser=new OpenLayers.Format.JSON();this.wktParser=new OpenLayers.Format.WKT();this.fidRegExp=new RegExp("^"+this.FID_PREFIX);this.initializeDatabase()},initializeDatabase:function(){this.db=google.gears.factory.create("beta.database");this.db.open(this.databaseName);this.db.execute("CREATE TABLE IF NOT EXISTS "+this.tableName+" (fid TEXT UNIQUE, geometry TEXT, properties TEXT,  state TEXT)")},destroy:function(){this.db.close();this.db=null;this.jsonParser=null;this.wktParser=null;OpenLayers.Protocol.SQL.prototype.destroy.apply(this)},supported:function(){return !!(window.google&&google.gears)},read:function(b){OpenLayers.Protocol.prototype.read.apply(this,arguments);b=OpenLayers.Util.applyDefaults(b,this.options);var c,d=[];var a=this.db.execute("SELECT * FROM "+this.tableName);while(a.isValidRow()){c=this.unfreezeFeature(a);if(this.evaluateFilter(c,b.filter)){if(!b.noFeatureStateReset){c.state=null}d.push(c)}a.next()}a.close();var e=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"read",features:d});if(b&&b.callback){b.callback.call(b.scope,e)}return e},unfreezeFeature:function(d){var a;var b=d.fieldByName("geometry");if(b==this.NULL_GEOMETRY){a=new OpenLayers.Feature.Vector()}else{a=this.wktParser.read(b)}a.attributes=this.jsonParser.read(d.fieldByName("properties"));a.fid=this.extractFidFromField(d.fieldByName("fid"));var c=d.fieldByName("state");if(c==this.NULL_FEATURE_STATE){c=null}a.state=c;return a},extractFidFromField:function(a){if(!a.match(this.fidRegExp)&&this.typeOfFid=="number"){a=parseFloat(a)}return a},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=this.createOrUpdate(b);c.requestType="create";if(a&&a.callback){a.callback.call(a.scope,c)}return c},update:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=this.createOrUpdate(b);c.requestType="update";if(a&&a.callback){a.callback.call(a.scope,c)}return c},createOrUpdate:function(e){if(!(e instanceof Array)){e=[e]}var c,a=e.length,b;var d=new Array(a);for(c=0;c<a;c++){b=e[c];var f=this.freezeFeature(b);this.db.execute("REPLACE INTO "+this.tableName+" (fid, geometry, properties, state) VALUES (?, ?, ?, ?)",f);var g=b.clone();g.fid=this.extractFidFromField(f[0]);d[c]=g}return new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,features:d,reqFeatures:e})},freezeFeature:function(b){b.fid=b.fid!=null?""+b.fid:OpenLayers.Util.createUniqueID(this.FID_PREFIX);var d=b.geometry!=null?b.geometry.toString():this.NULL_GEOMETRY;var a=this.jsonParser.write(b.attributes);var c=this.getFeatureStateForFreeze(b);return[b.fid,d,a,c]},getFeatureStateForFreeze:function(a){var b;if(!this.saveFeatureState){b=this.NULL_FEATURE_STATE}else{if(this.createdOffline(a)){b=OpenLayers.State.INSERT}else{b=a.state}}return b},"delete":function(f,c){if(!(f instanceof Array)){f=[f]}c=OpenLayers.Util.applyDefaults(c,this.options);var e,a,d;for(e=0,a=f.length;e<a;e++){d=f[e];if(this.saveFeatureState&&!this.createdOffline(d)){var b=d.clone();b.fid=d.fid;if(b.geometry){b.geometry.destroy();b.geometry=null}b.state=d.state;this.createOrUpdate(b)}else{this.db.execute("DELETE FROM "+this.tableName+" WHERE fid = ?",[d.fid])}}var g=new OpenLayers.Protocol.Response({code:OpenLayers.Protocol.Response.SUCCESS,requestType:"delete",reqFeatures:f});if(c&&c.callback){c.callback.call(c.scope,g)}return g},createdOffline:function(a){return(typeof a.fid=="string"&&!!(a.fid.match(this.fidRegExp)))},commit:function(c,m){var b,e=[],g=0,h=0;function k(o){if(++h<g){o.last=false}this.callUserCallback(m,o)}var l,j=[],a=[],d=[];for(var f=c.length-1;f>=0;f--){l=c[f];switch(l.state){case OpenLayers.State.INSERT:j.push(l);break;case OpenLayers.State.UPDATE:a.push(l);break;case OpenLayers.State.DELETE:d.push(l);break}}if(j.length>0){g++;b=OpenLayers.Util.applyDefaults({callback:k,scope:this},m.create);e.push(this.create(j,b))}if(a.length>0){g++;b=OpenLayers.Util.applyDefaults({callback:k,scope:this},m.update);e.push(this.update(a,b))}if(d.length>0){g++;b=OpenLayers.Util.applyDefaults({callback:k,scope:this},m["delete"]);e.push(this["delete"](d,b))}return e},clear:function(){this.db.execute("DELETE FROM "+this.tableName)},callUserCallback:function(a,c){var b=a[c.requestType];if(b&&b.callback){b.callback.call(b.scope,c)}if(c.last&&a.callback){a.callback.call(a.scope)}},CLASS_NAME:"OpenLayers.Protocol.SQL.Gears"});OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={};OpenLayers.Util.extend(this,a);if(this.symbolizers){delete this.symbolizer}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer){this.symbolizer[a]=null}this.symbolizer=null;delete this.symbolizers},evaluate:function(c){var b=this.getContext(c);var a=true;if(this.minScaleDenominator||this.maxScaleDenominator){var d=c.layer.map.getScale()}if(this.minScaleDenominator){a=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)}if(a&&this.maxScaleDenominator){a=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)}if(a&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){a=this.filter.evaluate(c)}else{a=this.filter.evaluate(b)}}return a},getContext:function(b){var a=this.context;if(!a){a=b.attributes||b.data}if(typeof this.context=="function"){a=this.context(b)}return a},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.symbolizers){var a=this.symbolizers.length;b.symbolizers=new Array(a);for(var d=0;d<a;++d){b.symbolizers[d]=this.symbolizers[d].clone()}}else{b.symbolizer={};var f,e;for(var c in this.symbolizer){f=this.symbolizer[c];e=typeof f;if(e==="object"){b.symbolizer[c]=OpenLayers.Util.extend({},f)}else{if(e==="string"){b.symbolizer[c]=f}}}}b.filter=this.filter&&this.filter.clone();b.context=this.context&&OpenLayers.Util.extend({},this.context);return new OpenLayers.Rule(b)},CLASS_NAME:"OpenLayers.Rule"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(c,a){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(c instanceof OpenLayers.Style){this.styles["default"]=c;this.styles.select=c;this.styles.temporary=c;this.styles["delete"]=c}else{if(typeof c=="object"){for(var b in c){if(c[b] instanceof OpenLayers.Style){this.styles[b]=c[b]}else{if(typeof c[b]=="object"){this.styles[b]=new OpenLayers.Style(c[b])}else{this.styles["default"]=new OpenLayers.Style(c);this.styles.select=new OpenLayers.Style(c);this.styles.temporary=new OpenLayers.Style(c);this.styles["delete"]=new OpenLayers.Style(c);break}}}}}OpenLayers.Util.extend(this,a)},destroy:function(){for(var a in this.styles){this.styles[a].destroy()}this.styles=null},createSymbolizer:function(b,c){if(!b){b=new OpenLayers.Feature.Vector()}if(!this.styles[c]){c="default"}b.renderIntent=c;var a={};if(this.extendDefault&&c!="default"){a=this.styles["default"].createSymbolizer(b)}return OpenLayers.Util.extend(a,this.styles[c].createSymbolizer(b))},addUniqueValueRules:function(b,d,f,a){var e=[];for(var c in f){e.push(new OpenLayers.Rule({symbolizer:f[c],context:a,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:d,value:c})}))}this.styles[b].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.addControls([new OpenLayers.Control.Navigation(),new OpenLayers.Control.ZoomBox()])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.NavToolbar"});OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){if(c instanceof OpenLayers.Feature.Vector){c=c.attributes}var a=false;var b=c[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:var e=this.value;if(!this.matchCase&&typeof b=="string"&&typeof e=="string"){a=(b.toUpperCase()==e.toUpperCase())}else{a=(b==e)}break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:var e=this.value;if(!this.matchCase&&typeof b=="string"&&typeof e=="string"){a=(b.toUpperCase()!=e.toUpperCase())}else{a=(b!=e)}break;case OpenLayers.Filter.Comparison.LESS_THAN:a=b<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:a=b>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:a=b<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:a=b>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:a=(b>=this.lowerBoundary)&&(b<=this.upperBoundary);break;case OpenLayers.Filter.Comparison.LIKE:var d=new RegExp(this.value,"gi");a=d.test(b);break}return a},value2regex:function(d,b,a){if(d=="."){var c="'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison";OpenLayers.Console.error(c);return null}d=d?d:"*";b=b?b:".";a=a?a:"!";this.value=this.value.replace(new RegExp("\\"+a+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+b,"g"),".");this.value=this.value.replace(new RegExp("\\"+d,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+d);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b);return this.value},regex2value:function(){var a=this.value;a=a.replace(/!/g,"!!");a=a.replace(/(\\)?\\\./g,function(c,b){return b?c:"!."});a=a.replace(/(\\)?\\\*/g,function(c,b){return b?c:"!*"});a=a.replace(/\\\\/g,"\\");a=a.replace(/\.\*/g,"*");return a},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,initialize:function(a){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){for(var b=0,a=this.fids.length;b<a;b++){var d=c.fid||c.id;if(d==this.fids[b]){return true}}return false},clone:function(){var a=new OpenLayers.Filter.FeatureId();OpenLayers.Util.extend(a,this);a.fids=this.fids.slice();return a},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(c){switch(this.type){case OpenLayers.Filter.Logical.AND:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==false){return false}}return true;case OpenLayers.Filter.Logical.OR:for(var b=0,a=this.filters.length;b<a;b++){if(this.filters[b].evaluate(c)==true){return true}}return false;case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(c))}},clone:function(){var c=[];for(var b=0,a=this.filters.length;b<a;++b){c.push(this.filters[b].clone())}return new OpenLayers.Filter.Logical({type:this.type,filters:c})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(c){var a=false;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(c.geometry){var b=this.value;if(this.value.CLASS_NAME=="OpenLayers.Bounds"){b=this.value.toGeometry()}if(c.geometry.intersects(b)){a=true}}break;default:OpenLayers.Console.error(OpenLayers.i18n("filterEvaluateNotImplemented"));break}return a},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(a!=null){this.addComponents(a)}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var b=[];for(var c=0,a=this.components.length;c<a;c++){b.push(this.components[c].toShortString())}return b.join(",")},calculateBounds:function(){this.bounds=null;if(this.components&&this.components.length>0){this.setBounds(this.components[0].getBounds());for(var b=1,a=this.components.length;b<a;b++){this.extendBounds(this.components[b].getBounds())}}},addComponents:function(c){if(!(c instanceof Array)){c=[c]}for(var b=0,a=c.length;b<a;b++){this.addComponent(c[b])}},addComponent:function(b,a){var d=false;if(b){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,b.CLASS_NAME)>-1)){if(a!=null&&(a<this.components.length)){var e=this.components.slice(0,a);var c=this.components.slice(a,this.components.length);e.push(b);this.components=e.concat(c)}else{this.components.push(b)}b.parent=this;this.clearBounds();d=true}}return d},removeComponents:function(b){if(!(b instanceof Array)){b=[b]}for(var a=b.length-1;a>=0;--a){this.removeComponent(b[a])}},removeComponent:function(a){OpenLayers.Util.removeItem(this.components,a);this.clearBounds()},getLength:function(){var c=0;for(var b=0,a=this.components.length;b<a;b++){c+=this.components[b].getLength()}return c},getArea:function(){var c=0;for(var b=0,a=this.components.length;b<a;b++){c+=this.components[b].getArea()}return c},getGeodesicArea:function(b){var d=0;for(var c=0,a=this.components.length;c<a;c++){d+=this.components[c].getGeodesicArea(b)}return d},getCentroid:function(g){if(!g){return this.components.length&&this.components[0].getCentroid()}var l=this.components.length;if(!l){return false}var b=[];var c=[];var d=0;var h=Number.MAX_VALUE;var m;for(var k=0;k<l;++k){m=this.components[k];var e=m.getArea();var f=m.getCentroid(true);if(isNaN(e)||isNaN(f.x)||isNaN(f.y)){continue}b.push(e);d+=e;h=(e<h&&e>0)?e:h;c.push(f)}l=b.length;if(d===0){for(var k=0;k<l;++k){b[k]=1}d=b.length}else{for(var k=0;k<l;++k){b[k]/=h}d/=h}var j=0,a=0,f,e;for(var k=0;k<l;++k){f=c[k];e=b[k];j+=f.x*e;a+=f.y*e}return new OpenLayers.Geometry.Point(j/d,a/d)},getGeodesicLength:function(b){var d=0;for(var c=0,a=this.components.length;c<a;c++){d+=this.components[c].getGeodesicLength(b)}return d},move:function(b,d){for(var c=0,a=this.components.length;c<a;c++){this.components[c].move(b,d)}},rotate:function(d,b){for(var c=0,a=this.components.length;c<a;++c){this.components[c].rotate(d,b)}},resize:function(d,a,c){for(var b=0;b<this.components.length;++b){this.components[b].resize(d,a,c)}return this},distanceTo:function(h,j){var c=!(j&&j.edge===false);var a=c&&j&&j.details;var k,d,b;var e=Number.POSITIVE_INFINITY;for(var f=0,g=this.components.length;f<g;++f){k=this.components[f].distanceTo(h,j);b=a?k.distance:k;if(b<e){e=b;d=k;if(e==0){break}}}return d},equals:function(d){var b=true;if(!d||!d.CLASS_NAME||(this.CLASS_NAME!=d.CLASS_NAME)){b=false}else{if(!(d.components instanceof Array)||(d.components.length!=this.components.length)){b=false}else{for(var c=0,a=this.components.length;c<a;++c){if(!this.components[c].equals(d.components[c])){b=false;break}}}}return b},transform:function(e,c){if(e&&c){for(var d=0,a=this.components.length;d<a;d++){var b=this.components[d];b.transform(e,c)}this.bounds=null}return this},intersects:function(d){var b=false;for(var c=0,a=this.components.length;c<a;++c){b=d.intersects(this.components[c]);if(b){break}}return b},getVertices:function(b){var c=[];for(var d=0,a=this.components.length;d<a;++d){Array.prototype.push.apply(c,this.components[d].getVertices(b))}return c},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(a);this.y=parseFloat(b)},clone:function(a){if(a==null){a=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(a,this);return a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(f,k){var d=!(k&&k.edge===false);var a=d&&k&&k.details;var b,e,h,c,g,j;if(f instanceof OpenLayers.Geometry.Point){e=this.x;h=this.y;c=f.x;g=f.y;b=Math.sqrt(Math.pow(e-c,2)+Math.pow(h-g,2));j=!a?b:{x0:e,y0:h,x1:c,y1:g,distance:b}}else{j=f.distanceTo(this,k);if(a){j={x0:j.x1,y0:j.y1,x1:j.x0,y1:j.y0,distance:j.distance}}}return j},equals:function(a){var b=false;if(a!=null){b=((this.x==a.x&&this.y==a.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)))}return b},toShortString:function(){return(this.x+", "+this.y)},move:function(a,b){this.x=this.x+a;this.y=this.y+b;this.clearBounds()},rotate:function(d,b){d*=Math.PI/180;var a=this.distanceTo(b);var c=d+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+(a*Math.cos(c));this.y=b.y+(a*Math.sin(c));this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(c,a,b){b=(b==undefined)?1:b;this.x=a.x+(c*b*(this.x-a.x));this.y=a.y+(c*(this.y-a.y));this.clearBounds();return this},intersects:function(b){var a=false;if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.equals(b)}else{a=b.intersects(this)}return a},transform:function(b,a){if((b&&a)){OpenLayers.Projection.transform(this,b,a);this.bounds=null}return this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Rectangle=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,width:null,height:null,initialize:function(b,d,c,a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=b;this.y=d;this.width=c;this.height=a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x+this.width,this.y+this.height)},getLength:function(){var a=(2*this.width)+(2*this.height);return a},getArea:function(){var a=this.width*this.height;return a},CLASS_NAME:"OpenLayers.Geometry.Rectangle"});OpenLayers.Geometry.Surface=OpenLayers.Class(OpenLayers.Geometry,{initialize:function(){OpenLayers.Geometry.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.Surface"});OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(c,b,d,a){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var f=this.map.getResolution();var e=Math.round((this.map.getScale()*10000))/10000;var d=Math.round(a.left/f);var c=-Math.round(a.top/f);var j=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;var h=Math.floor(c/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;var b=this.url;if(b instanceof Array){b=this.selectUrl(paramsString,b)}var g=[b,"/",this.params.map,"/",e,"/",this.params.g.replace(/\s/g,"_"),"/def/t",h,"/l",j,"/t",c,"l",d,".",this.extension];return g.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});OpenLayers.Layer.MapServer.Untiled=OpenLayers.Class(OpenLayers.Layer.MapServer,{singleTile:true,initialize:function(c,b,e,a){OpenLayers.Layer.MapServer.prototype.initialize.apply(this,arguments);var d="The OpenLayers.Layer.MapServer.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.MapServer class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.MapServer.Untiled(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.MapServer.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.MapServer.Untiled"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,isVector:true,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(c,b){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var d=0,a=this.strategies.length;d<a;d++){this.strategies[d].setLayer(this)}}},destroy:function(){if(this.strategies){var c,b,a;for(b=0,a=this.strategies.length;b<a;b++){c=this.strategies[b];if(c.autoDestroy){c.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){if(e==null){e=new OpenLayers.Layer.Vector(this.name,this.getOptions())}e=OpenLayers.Layer.prototype.clone.apply(this,[e]);var c=this.features;var a=c.length;var d=new Array(a);for(var b=0;b<a;++b){d[b]=c[b].clone()}e.features=d;return e},refresh:function(a){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",a)}},assignRenderer:function(){for(var c=0,a=this.renderers.length;c<a;c++){var b=this.renderers[c];var d=(typeof b=="function")?b:OpenLayers.Renderer[b];if(d&&d.prototype.supported()){this.renderer=new d(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}},afterAdd:function(){if(this.strategies){var c,b,a;for(b=0,a=this.strategies.length;b<a;b++){c=this.strategies[b];if(c.autoActivate){c.activate()}}}},removeMap:function(c){this.drawn=false;if(this.strategies){var d,b,a;for(b=0,a=this.strategies.length;b<a;b++){d=this.strategies[b];if(d.autoActivate){d.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(g,b,h){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var e=true;if(!h){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var f=this.map.getExtent();e=this.renderer.setExtent(f,b);this.renderer.root.style.visibility="visible";if(navigator.userAgent.toLowerCase().indexOf("gecko")!=-1){this.div.scrollLeft=this.div.scrollLeft}if(!b&&e){for(var d in this.unrenderedFeatures){var c=this.unrenderedFeatures[d];this.drawFeature(c)}}}if(!this.drawn||b||!e){this.drawn=true;var c;for(var d=0,a=this.features.length;d<a;d++){this.renderer.locked=(d!==(a-1));c=this.features[d];this.drawFeature(c)}}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;if(b!=this.renderer.root.style.display){this.renderer.root.style.display=b}},addFeatures:function(b,k){if(!(b instanceof Array)){b=[b]}var h=!k||!k.silent;if(h){var a={features:b};var g=this.events.triggerEvent("beforefeaturesadded",a);if(g===false){return}b=a.features}var d=[];for(var c=0,f=b.length;c<f;c++){if(c!=(b.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var j=b[c];if(this.geometryType&&!(j.geometry instanceof this.geometryType)){var e=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw e}j.layer=this;if(!j.style&&this.style){j.style=OpenLayers.Util.extend({},this.style)}if(h){if(this.events.triggerEvent("beforefeatureadded",{feature:j})===false){continue}this.preFeatureInsert(j)}d.push(j);this.features.push(j);this.drawFeature(j);if(h){this.events.triggerEvent("featureadded",{feature:j});this.onFeatureInsert(j)}}if(h){this.events.triggerEvent("featuresadded",{features:d})}},removeFeatures:function(e,a){if(!e||e.length===0){return}if(e===this.features){return this.removeAllFeatures(a)}if(!(e instanceof Array)){e=[e]}if(e===this.selectedFeatures){e=e.slice()}var d=!a||!a.silent;if(d){this.events.triggerEvent("beforefeaturesremoved",{features:e})}for(var c=e.length-1;c>=0;c--){if(c!=0&&e[c-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var b=e[c];delete this.unrenderedFeatures[b.id];if(d){this.events.triggerEvent("beforefeatureremoved",{feature:b})}this.features=OpenLayers.Util.removeItem(this.features,b);b.layer=null;if(b.geometry){this.renderer.eraseFeatures(b)}if(OpenLayers.Util.indexOf(this.selectedFeatures,b)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,b)}if(d){this.events.triggerEvent("featureremoved",{feature:b})}}if(d){this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(a){var d=!a||!a.silent;var e=this.features;if(d){this.events.triggerEvent("beforefeaturesremoved",{features:e})}var c;for(var b=e.length-1;b>=0;b--){c=e[b];if(d){this.events.triggerEvent("beforefeatureremoved",{feature:c})}c.layer=null;if(d){this.events.triggerEvent("featureremoved",{feature:c})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(d){this.events.triggerEvent("featuresremoved",{features:e})}},destroyFeatures:function(d,a){var c=(d==undefined);if(c){d=this.features}if(d){this.removeFeatures(d,a);for(var b=d.length-1;b>=0;b--){d[b].destroy()}}},drawFeature:function(a,b){if(!this.drawn){return}if(typeof b!="object"){if(!b&&a.state===OpenLayers.State.DELETE){b="delete"}var c=b||a.renderIntent;b=a.style||this.style;if(!b){b=this.styleMap.createSymbolizer(a,c)}}if(!this.renderer.drawFeature(a,b)){this.unrenderedFeatures[a.id]=a}else{delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null}var b=this.renderer.getFeatureIdFromEvent(a);return this.getFeatureById(b)},getFeatureBy:function(e,d){var c=null;for(var b=0,a=this.features.length;b<a;++b){if(this.features[b][e]==d){c=this.features[b];break}}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var b=null;var d=this.features;if(d&&(d.length>0)){b=new OpenLayers.Bounds();var e=null;for(var c=0,a=d.length;c<a;c++){e=d[c].geometry;if(e){b.extend(e.getBounds())}}}return b},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.WMS.Post=OpenLayers.Class(OpenLayers.Layer.WMS,{tileClass:null,unsupportedBrowsers:["mozilla","firefox","opera"],SUPPORTED_TRANSITIONS:[],initialize:function(d,c,e,b){var a=[];a.push(d,c,e,b);OpenLayers.Layer.WMS.prototype.initialize.apply(this,a);this.tileClass=OpenLayers.Util.indexOf(this.unsupportedBrowsers,OpenLayers.Util.getBrowserName())!=-1?OpenLayers.Tile.Image:OpenLayers.Tile.Image.IFrame},addTile:function(b,a){return new this.tileClass(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.WMS.Post"});OpenLayers.Layer.WMS.Untiled=OpenLayers.Class(OpenLayers.Layer.WMS,{singleTile:true,initialize:function(c,b,e,a){OpenLayers.Layer.WMS.prototype.initialize.apply(this,arguments);var d="The OpenLayers.Layer.WMS.Untiled class is deprecated and will be removed in 3.0. Instead, you should use the normal OpenLayers.Layer.WMS class, passing it the option 'singleTile' as true.";OpenLayers.Console.warn(d)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WMS.Untiled(this.name,this.url,this.params,this.getOptions())}a=OpenLayers.Layer.WMS.prototype.clone.apply(this,[a]);return a},CLASS_NAME:"OpenLayers.Layer.WMS.Untiled"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:false,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]);if(!this.filter||!(this.filter instanceof OpenLayers.Filter)){throw new Error("Filter strategy must be constructed with a filter")}},activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(a){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return a},deactivate:function(){this.cache=null;if(this.layer&&this.layer.events){this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching){var d=e.features;e.features=[];var b;for(var a=0,c=d.length;a<c;++a){b=d[a];if(this.filter.evaluate(b)){e.features.push(b)}else{this.cache.push(b)}}}},handleRemove:function(a){if(!this.caching){this.cache=[]}},setFilter:function(a){this.filter=a;var c=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=true;this.layer.removeFeatures(this.cache.slice(),{silent:true});this.caching=false}if(c.length>0){var b={features:c};this.handleAdd(b);this.caching=true;this.layer.addFeatures(b.features,{silent:true});this.caching=false}},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var b=0,a=this.rules.length;b<a;b++){this.rules[b].destroy()}delete this.rules},clone:function(){var b=OpenLayers.Util.extend({},this);if(this.rules){b.rules=[];for(var c=0,a=this.rules.length;c<a;++c){b.rules.push(this.rules[c].clone())}}return new OpenLayers.Style2(b)},CLASS_NAME:"OpenLayers.Style2"});OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,single:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,EVENT_TYPES:["featureselected","featuresselected","featureunselected","clickout","beforefeatureselected","beforefeaturesselected","hoverfeature","outfeature"],initialize:function(a){this.EVENT_TYPES=OpenLayers.Control.GetFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);a.handlerOptions=a.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[a]);this.features={};this.handlers={};if(this.click){this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})}if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))}if(this.hover){this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250}))}},activate:function(){if(!this.active){for(var a in this.handlers){this.handlers[a].activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){for(var a in this.handlers){this.handlers[a].deactivate()}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a);this.request(b,{single:this.single})},selectBox:function(a){var c;if(a instanceof OpenLayers.Bounds){var d=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.left,a.bottom));var b=this.map.getLonLatFromPixel(new OpenLayers.Pixel(a.right,a.top));c=new OpenLayers.Bounds(d.lon,d.lat,b.lon,b.lat)}else{if(this.click){return}c=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt);this.request(c)},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:true,hover:true})},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);this.hoverResponse=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},request:function(d,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,value:d});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var a=this.protocol.read({maxFeatures:b.single==true?this.maxFeatures:undefined,filter:c,callback:function(e){if(e.success()){if(e.features.length){if(b.single==true){this.selectBestFeature(e.features,d.getCenterLonLat(),b)}else{this.select(e.features)}}else{if(b.hover){this.hoverSelect()}else{this.events.triggerEvent("clickout");if(this.clickout){this.unselectAll()}}}}OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});if(b.hover==true){this.hoverResponse=a}},selectBestFeature:function(b,a,j){j=j||{};if(b.length){var g=new OpenLayers.Geometry.Point(a.lon,a.lat);var h,d,e;var f=Number.MAX_VALUE;for(var c=0;c<b.length;++c){h=b[c];if(h.geometry){e=g.distanceTo(h.geometry,{edge:false});if(e<f){f=e;d=h;if(f==0){break}}}}if(j.hover==true){this.hoverSelect(d)}else{this.select(d||b)}}},setModifiers:function(a){this.modifiers={multiple:this.multiple||(this.multipleKey&&a[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&a[this.toggleKey])}},select:function(e){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()}if(!(e instanceof Array)){e=[e]}var b=this.events.triggerEvent("beforefeaturesselected",{features:e});if(b!==false){var f=[];var d;for(var c=0,a=e.length;c<a;++c){d=e[c];if(this.features[d.fid||d.id]){if(this.modifiers.toggle){this.unselect(this.features[d.fid||d.id])}}else{b=this.events.triggerEvent("beforefeatureselected",{feature:d});if(b!==false){this.features[d.fid||d.id]=d;f.push(d);this.events.triggerEvent("featureselected",{feature:d})}}}this.events.triggerEvent("featuresselected",{features:f})}},hoverSelect:function(a){var c=a?a.fid||a.id:null;var b=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;if(b&&b!=c){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});this.hoverFeature=null}if(c&&c!=b){this.events.triggerEvent("hoverfeature",{feature:a});this.hoverFeature=a}},unselect:function(a){delete this.features[a.fid||a.id];this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features){this.unselect(this.features[a])}},setMap:function(b){for(var a in this.handlers){this.handlers[a].setMap(b)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(b){var e=b.add(-this.clickTolerance/2,this.clickTolerance/2);var a=b.add(this.clickTolerance/2,-this.clickTolerance/2);var c=this.map.getLonLatFromPixel(e);var d=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"});OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesnap","snap","unsnap"],DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.layer){this.setLayer(this.options.layer)}var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS);this.setTargets(this.options.targets);if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)}this.geoToleranceCache={}},setLayer:function(a){if(this.active){this.deactivate();this.layer=a;this.activate()}else{this.layer=a}},setTargets:function(b){this.targets=[];if(b&&b.length){var d;for(var c=0,a=b.length;c<a;++c){d=b[c];if(d instanceof OpenLayers.Layer.Vector){this.addTargetLayer(d)}else{this.addTarget(d)}}}},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults);a.nodeTolerance=a.nodeTolerance||a.tolerance;a.vertexTolerance=a.vertexTolerance||a.tolerance;a.edgeTolerance=a.edgeTolerance||a.tolerance;this.targets.push(a)},removeTargetLayer:function(b){var c;for(var a=this.targets.length-1;a>=0;--a){c=this.targets[a];if(c.layer===b){this.removeTarget(c)}}},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})}}this.feature=null;this.point=null;return a},onSketchModified:function(a){this.feature=a.feature;this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(h,d){var a={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};var c=false;var j,f;for(var b=0,e=this.targets.length;b<e;++b){f=this.targets[b];j=this.testTarget(f,d);if(j){if(this.greedy){a=j;a.target=f;c=true;break}else{if((j.rank<a.rank)||(j.rank===a.rank&&j.dist<a.dist)){a=j;a.target=f;c=true}}}}if(c){var g=this.events.triggerEvent("beforesnap",{point:h,x:a.x,y:a.y,distance:a.dist,layer:a.target.layer,snapType:this.precedence[a.rank]});if(g!==false){h.x=a.x;h.y=a.y;this.point=h;this.events.triggerEvent("snap",{point:h,snapType:this.precedence[a.rank],layer:a.target.layer,distance:a.dist})}else{c=false}}if(this.point&&!c){h.x=d.x;h.y=d.y;this.point=null;this.events.triggerEvent("unsnap",{point:h})}},testTarget:function(z,f){var x={node:this.getGeoTolerance(z.nodeTolerance),vertex:this.getGeoTolerance(z.vertexTolerance),edge:this.getGeoTolerance(z.edgeTolerance)};var g=Math.max(x.node,x.vertex,x.edge);var h={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};var e=false;var c=z.layer.features;var b,a,d,y,p,q,o;var m=this.precedence.length;var l=new OpenLayers.LonLat(f.x,f.y);for(var v=0,w=c.length;v<w;++v){b=c[v];if(b!==this.feature&&!b._sketch&&b.state!==OpenLayers.State.DELETE&&(!z.filter||z.filter.evaluate(b.attributes))){if(b.atPoint(l,g,g)){for(var u=0,r=Math.min(h.rank+1,m);u<r;++u){a=this.precedence[u];if(z[a]){if(a==="edge"){p=b.geometry.distanceTo(f,{details:true});q=p.distance;if(q<=x[a]&&q<h.dist){h={rank:u,dist:q,x:p.x0,y:p.y0};e=true;break}}else{d=b.geometry.getVertices(a==="node");o=false;for(var t=0,s=d.length;t<s;++t){y=d[t];q=y.distanceTo(f);if(q<=x[a]&&(u<h.rank||(u===h.rank&&q<h.dist))){h={rank:u,dist:q,x:y.x,y:y.y};e=true;o=true}}if(o){break}}}}}}}return e?h:null},getGeoTolerance:function(a){var b=this.layer.map.getResolution();if(b!==this.resolution){this.resolution=b;this.geoToleranceCache={}}var c=this.geoToleranceCache[a];if(c===undefined){c=a*b;this.geoToleranceCache[a]=c}return c},destroy:function(){if(this.active){this.deactivate()}delete this.layer;delete this.targets;OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"});OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(c,b){var a=(b&&b.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=a){var d=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!d){throw"Can't find a Filter parser for version "+a}this.parser=new d(this.options)}return this.parser.write(c)},read:function(c){if(typeof c=="string"){c=OpenLayers.Format.XML.prototype.read.apply(this,[c])}var a=this.version;if(!a){a=this.defaultVersion}if(!this.parser||this.parser.VERSION!=a){var d=OpenLayers.Format.Filter["v"+a.replace(/\./g,"_")];if(!d){throw"Can't find a Filter parser for version "+a}this.parser=new d(this.options)}var b=this.parser.read(c);return b},CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.0.0",version:null,namedLayersAsArray:false,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},write:function(d,c){var b=(c&&c.version)||this.version||this.defaultVersion;if(!this.parser||this.parser.VERSION!=b){var e=OpenLayers.Format.SLD["v"+b.replace(/\./g,"_")];if(!e){throw"Can't find a SLD parser for version "+b}this.parser=new e(this.options)}var a=this.parser.write(d);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},read:function(e,c){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var b=e.documentElement;var a=this.version;if(!a){a=b.getAttribute("version");if(!a){a=this.defaultVersion}}if(!this.parser||this.parser.VERSION!=a){var f=OpenLayers.Format.SLD["v"+a.replace(/\./g,"_")];if(!f){throw"Can't find a SLD parser for version "+a}this.parser=new f(this.options)}var d=this.parser.read(e,c);return d},CLASS_NAME:"OpenLayers.Format.SLD"});OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:true,initialize:function(a){a=a||{};if(a.extractStyles!==false){a.defaultStyle={externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}}OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(k){var a=k.split("\n");var b;var g=[];for(var v=0;v<(a.length-1);v++){var u=a[v].replace(/^\s*/,"").replace(/\s*$/,"");if(u.charAt(0)!="#"){if(!b){b=u.split("\t")}else{var m=u.split("\t");var d=new OpenLayers.Geometry.Point(0,0);var h={};var r=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null;var s,t,c,p;var l=false;for(var j=0;j<m.length;j++){if(m[j]){if(b[j]=="point"){var q=m[j].split(",");d.y=parseFloat(q[0]);d.x=parseFloat(q[1]);l=true}else{if(b[j]=="lat"){d.y=parseFloat(m[j]);l=true}else{if(b[j]=="lon"){d.x=parseFloat(m[j]);l=true}else{if(b[j]=="title"){h.title=m[j]}else{if(b[j]=="image"||b[j]=="icon"&&r){r.externalGraphic=m[j]}else{if(b[j]=="iconSize"&&r){var o=m[j].split(",");r.graphicWidth=parseFloat(o[0]);r.graphicHeight=parseFloat(o[1])}else{if(b[j]=="iconOffset"&&r){var f=m[j].split(",");r.graphicXOffset=parseFloat(f[0]);r.graphicYOffset=parseFloat(f[1])}else{if(b[j]=="description"){h.description=m[j]}else{if(b[j]=="overflow"){h.overflow=m[j]}else{h[b[j]]=m[j]}}}}}}}}}}}if(l){if(this.internalProjection&&this.externalProjection){d.transform(this.externalProjection,this.internalProjection)}var e=new OpenLayers.Feature.Vector(d,h,r);g.push(e)}}}}return g},CLASS_NAME:"OpenLayers.Format.Text"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,drawing:false,mouseDown:false,lastDown:null,lastUp:null,persist:false,layerOptions:null,initialize:function(c,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var a=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);return true},createFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}if(this.drawing){this.cancel()}this.destroyFeature();if(this.layer.map!=null){this.layer.destroy(false)}this.layer=null;return true},destroyFeature:function(){if(this.layer){this.layer.destroyFeatures()}this.point=null},finalize:function(b){var a=b?"cancel":"done";this.drawing=false;this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.callback(a,[this.geometryClone()]);if(b||!this.persist){this.destroyFeature()}},cancel:function(){this.finalize(true)},click:function(a){OpenLayers.Event.stop(a);return false},dblclick:function(a){OpenLayers.Event.stop(a);return false},modifyFeature:function(a){var b=this.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPoint([a])}return a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){if(!this.checkModifiers(a)){return true}if(this.lastDown&&this.lastDown.equals(a.xy)){return true}this.drawing=true;if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else{this.modifyFeature(a.xy)}this.lastDown=a.xy;return false},mousemove:function(a){if(this.drawing){this.modifyFeature(a.xy)}return true},mouseup:function(a){if(this.drawing){this.finalize();return false}else{return true}},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Layer.GML=OpenLayers.Class(OpenLayers.Layer.Vector,{loaded:false,format:null,formatOptions:null,initialize:function(d,c,b){var a=[];a.push(d,b);OpenLayers.Layer.Vector.prototype.initialize.apply(this,a);this.url=c},setVisibility:function(a,b){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},moveTo:function(c,a,b){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadGML()}},loadGML:function(){if(!this.loaded){this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.url,success:this.requestSuccess,failure:this.requestFailure,scope:this});this.loaded=true}},setUrl:function(a){this.url=a;this.destroyFeatures();this.loaded=false;this.loadGML()},requestSuccess:function(c){var d=c.responseXML;if(!d||!d.documentElement){d=c.responseText}var a={};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}var b=this.format?new this.format(a):new OpenLayers.Format.GML(a);this.addFeatures(b.read(d));this.events.triggerEvent("loadend")},requestFailure:function(a){OpenLayers.Console.userError(OpenLayers.i18n("errorLoadingGML",{url:this.url}));this.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Layer.GML"});OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},addNodes:function(f){if(f.length<2){OpenLayers.Console.error("At least two point features have to be added to createa line from");return}var k=new Array(f.length-1);var g,a,h;for(var c=0,e=f.length;c<e;c++){g=f[c];h=g.geometry;if(!h){var d=g.lonlat;h=new OpenLayers.Geometry.Point(d.lon,d.lat)}else{if(h.CLASS_NAME!="OpenLayers.Geometry.Point"){OpenLayers.Console.error("Only features with point geometries are supported.");return}}if(c>0){var b=(this.dataFrom!=null)?(f[c+this.dataFrom].data||f[c+this.dataFrom].attributes):null;var j=new OpenLayers.Geometry.LineString([a,h]);k[c-1]=new OpenLayers.Feature.Vector(j,b)}a=h}this.addFeatures(k)},CLASS_NAME:"OpenLayers.Layer.PointTrack"});OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(b,a){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(a){var d=this.layers;var c;for(var b=0;b<d.length;b++){c=d[b].getFeatureFromEvent(a);if(c){return c}}},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var b;for(var a=0;a<this.map.layers.length;++a){b=this.map.layers[a];if(OpenLayers.Util.indexOf(this.layers,b)!=-1){b.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var b;for(var a=0;a<this.layers.length;++a){b=this.layers[a];if(this.renderer&&b.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(b.renderer)}}},handleChangeLayer:function(a){var b=a.layer;if(a.property=="order"&&OpenLayers.Util.indexOf(this.layers,b)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Layer.WFS=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.Layer.Markers,{isBaseLayer:false,tile:null,ratio:2,DEFAULT_PARAMS:{service:"WFS",version:"1.0.0",request:"GetFeature"},featureClass:null,format:null,formatObject:null,formatOptions:null,vectorMode:true,encodeBBOX:false,extractAttributes:false,initialize:function(d,c,e,b){if(b==undefined){b={}}if(b.featureClass||!OpenLayers.Layer.Vector||!OpenLayers.Feature.Vector){this.vectorMode=false}e=OpenLayers.Util.upperCaseObject(e);OpenLayers.Util.extend(b,{reportError:false});var a=[];a.push(d,b);OpenLayers.Layer.Vector.prototype.initialize.apply(this,a);if(!this.renderer||!this.vectorMode){this.vectorMode=false;if(!b.featureClass){b.featureClass=OpenLayers.Feature.WFS}OpenLayers.Layer.Markers.prototype.initialize.apply(this,a)}if(this.params&&this.params.typename&&!this.options.typename){this.options.typename=this.params.typename}if(!this.options.geometry_column){this.options.geometry_column="the_geom"}this.params=OpenLayers.Util.applyDefaults(e,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));this.url=c},destroy:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments)}if(this.tile){this.tile.destroy()}this.tile=null;this.ratio=null;this.featureClass=null;this.format=null;if(this.formatObject&&this.formatObject.destroy){this.formatObject.destroy()}this.formatObject=null;this.formatOptions=null;this.vectorMode=null;this.encodeBBOX=null;this.extractAttributes=null},setMap:function(b){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);var a={extractAttributes:this.extractAttributes};OpenLayers.Util.extend(a,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.formatObject=this.format?new this.format(a):new OpenLayers.Format.GML(a)}else{OpenLayers.Layer.Markers.prototype.setMap.apply(this,arguments)}},moveTo:function(a,b,p){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments)}if(p){return false}if(b){if(this.vectorMode){this.renderer.clear()}}if(this.options.minZoomLevel){OpenLayers.Console.warn(OpenLayers.i18n("minZoomLevelError"));if(this.map.getZoom()<this.options.minZoomLevel){return null}}if(a==null){a=this.map.getExtent()}var o=(this.tile==null);var g=(!o&&!this.tile.bounds.containsBounds(a));if(b||o||(!p&&g)){var c=a.getCenterLonLat();var m=a.getWidth()*this.ratio;var h=a.getHeight()*this.ratio;var k=new OpenLayers.Bounds(c.lon-(m/2),c.lat-(h/2),c.lon+(m/2),c.lat+(h/2));var q=this.map.getSize();q.w=q.w*this.ratio;q.h=q.h*this.ratio;var j=new OpenLayers.LonLat(k.left,k.top);var l=this.map.getLayerPxFromLonLat(j);var d=this.getFullRequestString();var f=null;var e=this.params.filter||this.params.FILTER;if(e){f={FILTER:e}}else{f={BBOX:this.encodeBBOX?k.toBBOX():k.toArray()}}if(this.map&&!this.projection.equals(this.map.getProjectionObject())){var r=k.clone();r.transform(this.map.getProjectionObject(),this.projection);if(!e){f.BBOX=this.encodeBBOX?r.toBBOX():r.toArray()}}d+="&"+OpenLayers.Util.getParameterString(f);if(!this.tile){this.tile=new OpenLayers.Tile.WFS(this,l,k,d,q);this.addTileMonitoringHooks(this.tile);this.tile.draw()}else{if(this.vectorMode){this.destroyFeatures();this.renderer.clear()}else{this.clearMarkers()}this.removeTileMonitoringHooks(this.tile);this.tile.destroy();this.tile=null;this.tile=new OpenLayers.Tile.WFS(this,l,k,d,q);this.addTileMonitoringHooks(this.tile);this.tile.draw()}}},addTileMonitoringHooks:function(a){a.onLoadStart=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("loadstart")}};a.events.register("loadstart",a,a.onLoadStart);a.onLoadEnd=function(){if(this==this.layer.tile){this.layer.events.triggerEvent("tileloaded");this.layer.events.triggerEvent("loadend")}};a.events.register("loadend",a,a.onLoadEnd);a.events.register("unload",a,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload();a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:a})},onMapResize:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.onMapResize.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.onMapResize.apply(this,arguments)}},display:function(){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.display.apply(this,arguments)}else{OpenLayers.Layer.Markers.prototype.display.apply(this,arguments)}},mergeNewParams:function(c){var b=OpenLayers.Util.upperCaseObject(c);var a=[b];return OpenLayers.Layer.HTTPRequest.prototype.mergeNewParams.apply(this,a)},clone:function(a){if(a==null){a=new OpenLayers.Layer.WFS(this.name,this.url,this.params,this.getOptions())}if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.clone.apply(this,[a])}else{a=OpenLayers.Layer.Markers.prototype.clone.apply(this,[a])}return a},getFullRequestString:function(c,b){var a=this.projection.getCode()||this.map.getProjection();this.params.SRS=(a=="none")?null:a;return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},commit:function(){if(!this.writer){var a={};if(this.map&&!this.projection.equals(this.map.getProjectionObject())){a.externalProjection=this.projection;a.internalProjection=this.map.getProjectionObject()}this.writer=new OpenLayers.Format.WFS(a,this)}var b=this.writer.write(this.features);OpenLayers.Request.POST({url:this.url,data:b,success:this.commitSuccess,failure:this.commitFailure,scope:this})},commitSuccess:function(c){var a=c.responseText;if(a.indexOf("SUCCESS")!=-1){this.commitReport(OpenLayers.i18n("commitSuccess",{response:a}));for(var b=0;b<this.features.length;b++){this.features[b].state=null}}else{if(a.indexOf("FAILED")!=-1||a.indexOf("Exception")!=-1){this.commitReport(OpenLayers.i18n("commitFailed",{response:a}))}}},commitFailure:function(a){},commitReport:function(b,a){OpenLayers.Console.userError(b)},refresh:function(){if(this.tile){if(this.vectorMode){this.renderer.clear();this.features.length=0}else{this.clearMarkers();this.markers.length=0}this.tile.draw()}},getDataExtent:function(){var a;if(this.vectorMode){a=OpenLayers.Layer.Vector.prototype.getDataExtent.apply(this)}else{a=OpenLayers.Layer.Markers.prototype.getDataExtent.apply(this)}return a},setOpacity:function(a){if(this.vectorMode){OpenLayers.Layer.Vector.prototype.setOpacity.apply(this,[a])}else{OpenLayers.Layer.Markers.prototype.setOpacity.apply(this,[a])}},CLASS_NAME:"OpenLayers.Layer.WFS"});OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,initialize:function(a){a=a||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments)},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments);a=OpenLayers.Util.applyDefaults(a,this.options);a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params);if(a.filter){a.params=this.filterToParams(a.filter,a.params)}var b=(a.readWithPOST!==undefined)?a.readWithPOST:this.readWithPOST;var c=new OpenLayers.Protocol.Response({requestType:"read"});if(b){c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else{c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers})}return c},handleRead:function(b,a){this.handleResponse(b,a)},filterToParams:function(d,g){g=g||{};var c=d.CLASS_NAME;var e=c.substring(c.lastIndexOf(".")+1);switch(e){case"Spatial":switch(d.type){case OpenLayers.Filter.Spatial.BBOX:g.bbox=d.value.toArray();break;case OpenLayers.Filter.Spatial.DWITHIN:g.tolerance=d.distance;case OpenLayers.Filter.Spatial.WITHIN:g.lon=d.value.x;g.lat=d.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+d.type)}break;case"Comparison":var h=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR[d.type];if(h!==undefined){var f=d.value;if(d.type==OpenLayers.Filter.Comparison.LIKE){f=this.regex2value(f);if(this.wildcarded){f="%"+f+"%"}}g[d.property+"__"+h]=f;g.queryable=g.queryable||[];g.queryable.push(d.property)}else{OpenLayers.Console.warn("Unknown comparison filter type "+d.type)}break;case"Logical":if(d.type===OpenLayers.Filter.Logical.AND){for(var b=0,a=d.filters.length;b<a;b++){g=this.filterToParams(d.filters[b],g)}}else{OpenLayers.Console.warn("Unsupported logical filter type "+d.type)}break;default:OpenLayers.Console.warn("Unknown filter type "+e)}return g},regex2value:function(a){a=a.replace(/%/g,"\\%");a=a.replace(/\\\\\.(\*)?/g,function(c,b){return b?c:"\\\\_"});a=a.replace(/\\\\\.\*/g,"\\\\%");a=a.replace(/(\\)?\.(\*)?/g,function(c,b,d){return b||d?c:"_"});a=a.replace(/(\\)?\.\*/g,function(c,b){return b?c:"%"});a=a.replace(/\\\./g,".");a=a.replace(/(\\)?\\\*/g,function(c,b){return b?c:"*"});return a},create:function(b,a){a=OpenLayers.Util.applyDefaults(a,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:b,requestType:"create"});c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleCreate,c,a),headers:a.headers,data:this.format.write(b)});return c},handleCreate:function(b,a){this.handleResponse(b,a)},update:function(c,b){b=b||{};var a=b.url||c.url||this.options.url+"/"+c.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:c,requestType:"update"});d.priv=OpenLayers.Request.PUT({url:a,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(c)});return d},handleUpdate:function(b,a){this.handleResponse(b,a)},"delete":function(c,b){b=b||{};var a=b.url||c.url||this.options.url+"/"+c.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:c,requestType:"delete"});d.priv=OpenLayers.Request.DELETE({url:a,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers});return d},handleDelete:function(b,a){this.handleResponse(b,a)},handleResponse:function(c,a){var b=c.priv;if(a.callback){if(b.status>=200&&b.status<300){if(c.requestType!="delete"){c.features=this.parseFeatures(b)}c.code=OpenLayers.Protocol.Response.SUCCESS}else{c.code=OpenLayers.Protocol.Response.FAILURE}a.callback.call(a.scope,c)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},commit:function(b,r){r=OpenLayers.Util.applyDefaults(r,this.options);var d=[],m=0;var k={};k[OpenLayers.State.INSERT]=[];k[OpenLayers.State.UPDATE]=[];k[OpenLayers.State.DELETE]=[];var q,l,c=[];for(var e=0,j=b.length;e<j;++e){q=b[e];l=k[q.state];if(l){l.push(q);c.push(q)}}var g=(k[OpenLayers.State.INSERT].length>0?1:0)+k[OpenLayers.State.UPDATE].length+k[OpenLayers.State.DELETE].length;var p=true;var a=new OpenLayers.Protocol.Response({reqFeatures:c});function h(t){var s=t.features?t.features.length:0;var v=new Array(s);for(var u=0;u<s;++u){v[u]=t.features[u].fid}a.insertIds=v;o.apply(this,[t])}function o(s){this.callUserCallback(s,r);p=p&&s.success();m++;if(m>=g){if(r.callback){a.code=p?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;r.callback.apply(r.scope,[a])}}}var f=k[OpenLayers.State.INSERT];if(f.length>0){d.push(this.create(f,OpenLayers.Util.applyDefaults({callback:h,scope:this},r.create)))}f=k[OpenLayers.State.UPDATE];for(var e=f.length-1;e>=0;--e){d.push(this.update(f[e],OpenLayers.Util.applyDefaults({callback:o,scope:this},r.update)))}f=k[OpenLayers.State.DELETE];for(var e=f.length-1;e>=0;--e){d.push(this["delete"](f[e],OpenLayers.Util.applyDefaults({callback:o,scope:this},r["delete"])))}return d},abort:function(a){if(a){a.priv.abort()}},callUserCallback:function(c,a){var b=a[c.requestType];if(b&&b.callback){b.callback.call(b.scope,c)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});(function(){var a=OpenLayers.Protocol.HTTP.COMP_TYPE_TO_OP_STR={};a[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";a[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";a[OpenLayers.Filter.Comparison.LESS_THAN]="lt";a[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";a[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";a[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";a[OpenLayers.Filter.Comparison.LIKE]="ilike"})();OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a])},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);if(a){this.layer.events.on({moveend:this.update,scope:this});this.layer.events.on({refresh:this.update,scope:this})}return a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);if(a){this.layer.events.un({moveend:this.update,scope:this});this.layer.events.un({refresh:this.update,scope:this})}return a},update:function(b){var a=this.getMapBounds();if((b&&b.force)||this.invalidBounds(a)){this.calculateBounds(a);this.resolution=this.layer.map.getResolution();this.triggerRead()}},getMapBounds:function(){var a=this.layer.map.getExtent();if(!this.layer.projection.equals(this.layer.map.getProjectionObject())){a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)}return a},invalidBounds:function(a){if(!a){a=this.getMapBounds()}var c=!this.bounds||!this.bounds.containsBounds(a);if(!c&&this.resFactor){var b=this.resolution/this.layer.map.getResolution();c=(b>=this.resFactor||b<=(1/this.resFactor))}return c},calculateBounds:function(b){if(!b){b=this.getMapBounds()}var a=b.getCenterLonLat();var d=b.getWidth()*this.ratio;var c=b.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(a.lon-(d/2),a.lat-(c/2),a.lon+(d/2),a.lat+(c/2))},triggerRead:function(){if(this.response){this.layer.protocol.abort(this.response);this.layer.events.triggerEvent("loadend")}this.layer.events.triggerEvent("loadstart");this.response=this.layer.protocol.read({filter:this.createFilter(),callback:this.merge,scope:this})},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});if(this.layer.filter){a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})}return a},merge:function(g){this.layer.destroyFeatures();var e=g.features;if(e&&e.length>0){var f=this.layer.projection;var d=this.layer.map.getProjectionObject();if(!d.equals(f)){var c;for(var b=0,a=e.length;b<a;++b){c=e[b].geometry;if(c){c.transform(f,d)}}}this.layer.addFeatures(e)}this.response=null;this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"});OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(c,a){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);if(this.scope===null){this.scope=this}this.initLayer(c);var b={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){b.over=this.overFeature;b.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(b,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(a){if(a instanceof Array){this.layers=a;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})}else{this.layer=a}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(b){var f=this.layers||[this.layer];var e,d;for(var a=0;a<f.length;++a){e=f[a];for(var c=e.selectedFeatures.length-1;c>=0;--c){d=e.selectedFeatures[c];if(!b||b.except!=d){this.unselect(d)}}}},clickFeature:function(a){if(!this.hover){var b=(OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1);if(b){if(this.toggleSelect()){this.unselect(a)}else{if(!this.multipleSelect()){this.unselectAll({except:a})}}}else{if(!this.multipleSelect()){this.unselectAll({except:a})}this.select(a)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(a){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(b){var a=b.layer;if(this.hover){if(this.highlightOnly){this.highlight(b)}else{if(OpenLayers.Util.indexOf(a.selectedFeatures,b)==-1){this.select(b)}}}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(a._lastHighlighter==this.id){if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);if(b){b.highlight(a)}}else{this.unhighlight(a)}}}else{this.unselect(a)}}},highlight:function(c){var b=c.layer;var a=this.events.triggerEvent("beforefeaturehighlighted",{feature:c});if(a!==false){c._prevHighlighter=c._lastHighlighter;c._lastHighlighter=this.id;var d=this.selectStyle||this.renderIntent;b.drawFeature(c,d);this.events.triggerEvent("featurehighlighted",{feature:c})}},unhighlight:function(b){var a=b.layer;b._lastHighlighter=b._prevHighlighter;delete b._prevHighlighter;a.drawFeature(b,b.style||b.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:b})},select:function(c){var a=this.onBeforeSelect.call(this.scope,c);var b=c.layer;if(a!==false){a=b.events.triggerEvent("beforefeatureselected",{feature:c});if(a!==false){b.selectedFeatures.push(c);this.highlight(c);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=b.selectedFeatures[0]}b.events.triggerEvent("featureselected",{feature:c});this.onSelect.call(this.scope,c)}}},unselect:function(b){var a=b.layer;this.unhighlight(b);OpenLayers.Util.removeItem(a.selectedFeatures,b);a.events.triggerEvent("featureunselected",{feature:b});this.onUnselect.call(this.scope,b)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var h=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom));var k=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top));var a=new OpenLayers.Bounds(h.lon,h.lat,k.lon,k.lat);if(!this.multipleSelect()){this.unselectAll()}var j=this.multiple;this.multiple=true;var d=this.layers||[this.layer];var f;for(var b=0;b<d.length;++b){f=d[b];for(var c=0,g=f.features.length;c<g;++c){var m=f.features[c];if(!m.getVisibility()){continue}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,m.geometry.CLASS_NAME)>-1){if(a.toGeometry().intersects(m.geometry)){if(OpenLayers.Util.indexOf(f.selectedFeatures,m)==-1){this.select(m)}}}}}this.multiple=j}},setMap:function(a){this.handlers.feature.setMap(a);if(this.box){this.handlers.box.setMap(a)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(b){var a=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(b);this.handlers.feature.layer=this.layer;if(a){this.activate()}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};this.readers.ogc.Filter.apply(this,[a,b]);return b.filter},readers:{ogc:{Filter:function(b,a){var c={fids:[],filters:[]};this.readChildNodes(b,c);if(c.fids.length>0){a.filter=new OpenLayers.Filter.FeatureId({fids:c.fids})}else{if(c.filters.length>0){a.filter=c.filters[0]}}},FeatureId:function(a,b){var c=a.getAttribute("fid");if(c){b.fids.push(c)}},And:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(b,a);c.filters.push(a)},Or:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(b,a);c.filters.push(a)},Not:function(b,c){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThan:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLessThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsGreaterThanOrEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsBetween:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(b,a);c.filters.push(a)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a))},PropertyName:function(b,a){a.property=this.getChildValue(b)},LowerBoundary:function(b,a){a.lowerBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},UpperBoundary:function(b,a){a.upperBoundary=OpenLayers.String.numericIf(this.readOgcExpression(b))},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a));b.distanceUnits=a.getAttribute("units")}}},readSpatial:function(c,d,b){var a=new OpenLayers.Filter.Spatial({type:b});this.readChildNodes(c,a);a.value=a.components[0];delete a.components;d.filters.push(a)},readOgcExpression:function(a){var c={};this.readChildNodes(a,c);var b=c.value;if(b===undefined){b=this.getChildValue(a)}return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(c){var d=this.createElementNSPlus("ogc:Filter");var b=c.CLASS_NAME.split(".").pop();if(b=="FeatureId"){for(var a=0;a<c.fids.length;++a){this.writeNode("FeatureId",c.fids[a],d)}}else{this.writeNode(this.getFilterType(c),c,d)}return d},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(c){var d=this.createElementNSPlus("ogc:And");var b;for(var a=0;a<c.filters.length;++a){b=c.filters[a];this.writeNode(this.getFilterType(b),b,d)}return d},Or:function(c){var d=this.createElementNSPlus("ogc:Or");var b;for(var a=0;a<c.filters.length;++a){b=c.filters[a];this.writeNode(this.getFilterType(b),b,d)}return d},Not:function(b){var c=this.createElementNSPlus("ogc:Not");var a=b.filters[0];this.writeNode(this.getFilterType(a),a,c);return c},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",a,b);this.writeNode("LowerBoundary",a,b);this.writeNode("UpperBoundary",a,b);return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");this.writeNode("Literal",a.lowerBoundary,b);return b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",a.upperBoundary,b);return b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");this.writeNode("Distance",a,b);return b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b){throw"Filter writing not supported for rule type: "+a.type}return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var c=0;if(this.components&&(this.components.length>1)){for(var b=1,a=this.components.length;b<a;b++){c+=this.components[b-1].distanceTo(this.components[b])}}return c},getGeodesicLength:function(b){var e=this;if(b){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(b)){e=this.clone().transform(b,c)}}var f=0;if(e.components&&(e.components.length>1)){var h,g;for(var d=1,a=e.components.length;d<a;d++){h=e.components[d-1];g=e.components[d];f+=OpenLayers.Util.distVincenty({lon:h.x,lat:h.y},{lon:g.x,lat:g.y})}}return f*1000},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(b,a){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);this.features=new Array()},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);this.clearFeatures();this.features=null},loadText:function(){if(!this.loaded){if(this.location!=null){var a=function(b){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart");OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this});this.loaded=true}}},moveTo:function(c,a,b){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);if(this.visibility&&!this.loaded){this.loadText()}},parseData:function(k){var m=k.responseText;var p={};OpenLayers.Util.extend(p,this.formatOptions);if(this.map&&!this.projection.equals(this.map.getProjectionObject())){p.externalProjection=this.projection;p.internalProjection=this.map.getProjectionObject()}var b=new OpenLayers.Format.Text(p);var c=b.read(m);for(var g=0,h=c.length;g<h;g++){var f={};var o=c[g];var l;var j,d;l=new OpenLayers.LonLat(o.geometry.x,o.geometry.y);if(o.style.graphicWidth&&o.style.graphicHeight){j=new OpenLayers.Size(o.style.graphicWidth,o.style.graphicHeight)}if(o.style.graphicXOffset!==undefined&&o.style.graphicYOffset!==undefined){d=new OpenLayers.Pixel(o.style.graphicXOffset,o.style.graphicYOffset)}if(o.style.externalGraphic!=null){f.icon=new OpenLayers.Icon(o.style.externalGraphic,j,d)}else{f.icon=OpenLayers.Marker.defaultIcon();if(j!=null){f.icon.setSize(j)}}if((o.attributes.title!=null)&&(o.attributes.description!=null)){f.popupContentHTML="<h2>"+o.attributes.title+"</h2><p>"+o.attributes.description+"</p>"}f.overflow=o.attributes.overflow||"auto";var a=new OpenLayers.Feature(this,l,f);this.features.push(a);var e=a.createMarker();if((o.attributes.title!=null)&&(o.attributes.description!=null)){e.events.register("click",a,this.markerClick)}this.addMarker(e)}this.events.triggerEvent("loadend")},markerClick:function(b){var d=(this==this.layer.selectedFeature);this.layer.selectedFeature=(!d)?this:null;for(var c=0,a=this.layer.map.popups.length;c<a;c++){this.layer.map.removePopup(this.layer.map.popups[c])}if(!d){this.layer.map.addPopup(this.createPopup())}OpenLayers.Event.stop(b)},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a);a.destroy()}}},CLASS_NAME:"OpenLayers.Layer.Text"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(d,c){this.layer=d;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer());this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[c]);if(!(this.deleteCodes instanceof Array)){this.deleteCodes=[this.deleteCodes]}var f=this;var a={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};if(this.standalone===false){this.selectControl=new OpenLayers.Control.SelectFeature(d,a)}var b={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(h,g){f.dragStart.apply(f,[h,g])},onDrag:function(h,g){f.dragVertex.apply(f,[h,g])},onComplete:function(g){f.dragComplete.apply(f,[g])},featureCallbacks:{over:function(g){if(f.standalone!==true||g._sketch||f.feature===g){f.dragControl.overFeature.apply(f.dragControl,[g])}}}};this.dragControl=new OpenLayers.Control.DragFeature(d,b);var e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e)}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return((this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var c=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();var a=this.feature;var b=a&&a.geometry&&a.layer;if(this.standalone===false){if(b){this.selectControl.unselect.apply(this.selectControl,[a])}this.selectControl.deactivate()}else{if(b){this.unselectFeature(a)}}this.handlers.keyboard.deactivate();c=true}return c},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){this.feature=a;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(a);this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},dragStart:function(b,a){if(b!=this.feature&&!b.geometry.parent&&b!=this.dragHandle&&b!=this.radiusHandle){if(this.standalone===false&&this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)!=-1){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[b]);this.dragControl.overFeature.apply(this.dragControl,[b]);this.dragControl.lastPixel=a;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=a;this.dragControl.handlers.drag.last=a}}},dragVertex:function(b,a){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=b){this.feature=b}this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}else{if(b._index){b.geometry.parent.addComponent(b.geometry,b._index);delete b._index;OpenLayers.Util.removeItem(this.virtualVertices,b);this.vertices.push(b)}else{if(b==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else{if(b!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:b.geometry,feature:this.feature,pixel:a})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent)}this.layer.drawFeature(b)},dragComplete:function(a){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,b)!=-1){var c=this.dragControl.feature;if(c&&OpenLayers.Util.indexOf(this.vertices,c)!=-1&&!this.dragControl.handlers.drag.dragging&&c.geometry.parent){c.geometry.parent.removeComponent(c.geometry);this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var a=this;function b(h){var d,e,j,f;if(h.CLASS_NAME=="OpenLayers.Geometry.Point"){e=new OpenLayers.Feature.Vector(h);e._sketch=true;a.vertices.push(e)}else{var c=h.components.length;if(h.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){c-=1}for(d=0;d<c;++d){j=h.components[d];if(j.CLASS_NAME=="OpenLayers.Geometry.Point"){e=new OpenLayers.Feature.Vector(j);e._sketch=true;a.vertices.push(e)}else{b(j)}}if(h.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(d=0,f=h.components.length;d<f-1;++d){var m=h.components[d];var o=h.components[d+1];if(m.CLASS_NAME=="OpenLayers.Geometry.Point"&&o.CLASS_NAME=="OpenLayers.Geometry.Point"){var k=(m.x+o.x)/2;var g=(m.y+o.y)/2;var l=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,g),null,a.virtualStyle);l.geometry.parent=h;l._index=d+1;l._sketch=true;a.virtualVertices.push(l)}}}}}b.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var d=this.feature.geometry;var a=d.getBounds().getCenterLonLat();var c=new OpenLayers.Geometry.Point(a.lon,a.lat);var b=new OpenLayers.Feature.Vector(c);c.move=function(e,f){OpenLayers.Geometry.Point.prototype.move.call(this,e,f);d.move(e,f)};b._sketch=true;this.dragHandle=b;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var h=this.feature.geometry;var a=h.getBounds();var b=a.getCenterLonLat();var j=new OpenLayers.Geometry.Point(b.lon,b.lat);var g=new OpenLayers.Geometry.Point(a.right,a.bottom);var f=new OpenLayers.Feature.Vector(g);var c=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);var e=(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE);var d=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);g.move=function(v,u){OpenLayers.Geometry.Point.prototype.move.call(this,v,u);var w=this.x-j.x;var r=this.y-j.y;var z=w-v;var s=r-u;if(d){var l=Math.atan2(s,z);var k=Math.atan2(r,w);var p=k-l;p*=180/Math.PI;h.rotate(p,j)}if(c){var o,t;if(e){o=r/s;t=(w/z)/o}else{var q=Math.sqrt((z*z)+(s*s));var m=Math.sqrt((w*w)+(r*r));o=m/q}h.resize(o,j,t)}};f._sketch=true;this.radiusHandle=f;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(a){this.standalone||this.selectControl.setMap(a);this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(a){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(a){if(this.components&&(this.components.length>2)){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}},intersects:function(m){var c=false;var l=m.CLASS_NAME;if(l=="OpenLayers.Geometry.LineString"||l=="OpenLayers.Geometry.LinearRing"||l=="OpenLayers.Geometry.Point"){var q=this.getSortedSegments();var o;if(l=="OpenLayers.Geometry.Point"){o=[{x1:m.x,y1:m.y,x2:m.x,y2:m.y}]}else{o=m.getSortedSegments()}var t,g,e,a,s,r,d,b;outer:for(var h=0,k=q.length;h<k;++h){t=q[h];g=t.x1;e=t.x2;a=t.y1;s=t.y2;inner:for(var f=0,p=o.length;f<p;++f){r=o[f];if(r.x1>e){break}if(r.x2<g){continue}d=r.y1;b=r.y2;if(Math.min(d,b)>Math.max(a,s)){continue}if(Math.max(d,b)<Math.min(a,s)){continue}if(OpenLayers.Geometry.segmentsIntersect(t,r)){c=true;break outer}}}}else{c=m.intersects(this)}return c},getSortedSegments:function(){var a=this.components.length-1;var b=new Array(a),e,d;for(var c=0;c<a;++c){e=this.components[c];d=this.components[c+1];if(e.x<d.x){b[c]={x1:e.x,y1:e.y,x2:d.x,y2:d.y}}else{b[c]={x1:d.x,y1:d.y,x2:e.x,y2:e.y}}}function f(h,g){return h.x1-g.x1}return b.sort(f)},splitWithSegment:function(s,b){var c=!(b&&b.edge===false);var p=b&&b.tolerance;var a=[];var u=this.getVertices();var o=[];var w=[];var h=false;var e,d,l;var j,r,v;var f={point:true,tolerance:p};var g=null;for(var m=0,k=u.length-2;m<=k;++m){e=u[m];o.push(e.clone());d=u[m+1];v={x1:e.x,y1:e.y,x2:d.x,y2:d.y};l=OpenLayers.Geometry.segmentsIntersect(s,v,f);if(l instanceof OpenLayers.Geometry.Point){if((l.x===s.x1&&l.y===s.y1)||(l.x===s.x2&&l.y===s.y2)||l.equals(e)||l.equals(d)){r=true}else{r=false}if(r||c){if(!l.equals(w[w.length-1])){w.push(l.clone())}if(m===0){if(l.equals(e)){continue}}if(l.equals(d)){continue}h=true;if(!l.equals(e)){o.push(l)}a.push(new OpenLayers.Geometry.LineString(o));o=[l.clone()]}}}if(h){o.push(d.clone());a.push(new OpenLayers.Geometry.LineString(o))}if(w.length>0){var q=s.x1<s.x2?1:-1;var t=s.y1<s.y2?1:-1;g={lines:a,points:w.sort(function(y,x){return(q*y.x-q*x.x)||(t*y.y-t*x.y)})}}return g},split:function(y,b){var o=null;var d=b&&b.mutual;var l,e,m,c;if(y instanceof OpenLayers.Geometry.LineString){var x=this.getVertices();var g,f,w,h,a,q;var t=[];m=[];for(var u=0,p=x.length-2;u<=p;++u){g=x[u];f=x[u+1];w={x1:g.x,y1:g.y,x2:f.x,y2:f.y};c=c||[y];if(d){t.push(g.clone())}for(var s=0;s<c.length;++s){h=c[s].splitWithSegment(w,b);if(h){a=h.lines;if(a.length>0){a.unshift(s,1);Array.prototype.splice.apply(c,a);s+=a.length-2}if(d){for(var r=0,v=h.points.length;r<v;++r){q=h.points[r];if(!q.equals(g)){t.push(q);m.push(new OpenLayers.Geometry.LineString(t));if(q.equals(f)){t=[]}else{t=[q.clone()]}}}}}}}if(d&&m.length>0&&t.length>0){t.push(f.clone());m.push(new OpenLayers.Geometry.LineString(t))}}else{o=y.splitWith(this,b)}if(c&&c.length>1){e=true}else{c=[]}if(m&&m.length>1){l=true}else{m=[]}if(e||l){if(d){o=[m,c]}else{o=c}}return o},splitWith:function(b,a){return b.split(this,a)},getVertices:function(a){var b;if(a===true){b=[this.components[0],this.components[this.components.length-1]]}else{if(a===false){b=this.components.slice(1,this.components.length-1)}else{b=this.components.slice()}}return b},distanceTo:function(h,g){var k=!(g&&g.edge===false);var C=k&&g&&g.details;var r,e={};var u=Number.POSITIVE_INFINITY;if(h instanceof OpenLayers.Geometry.Point){var s=this.getSortedSegments();var q=h.x;var p=h.y;var A;for(var w=0,z=s.length;w<z;++w){A=s[w];r=OpenLayers.Geometry.distanceToSegment(h,A);if(r.distance<u){u=r.distance;e=r;if(u===0){break}}else{if(A.x2>q&&((p>A.y1&&p<A.y2)||(p<A.y1&&p>A.y2))){break}}}if(C){e={distance:e.distance,x0:e.x,y0:e.y,x1:q,y1:p}}else{e=e.distance}}else{if(h instanceof OpenLayers.Geometry.LineString){var d=this.getSortedSegments();var c=h.getSortedSegments();var b,a,o,B,f;var m=c.length;var l={point:true};outer:for(var w=0,z=d.length;w<z;++w){b=d[w];B=b.x1;f=b.y1;for(var v=0;v<m;++v){a=c[v];o=OpenLayers.Geometry.segmentsIntersect(b,a,l);if(o){u=0;e={distance:0,x0:o.x,y0:o.y,x1:o.x,y1:o.y};break outer}else{r=OpenLayers.Geometry.distanceToSegment({x:B,y:f},a);if(r.distance<u){u=r.distance;e={distance:u,x0:B,y0:f,x1:r.x,y1:r.y}}}}}if(!C){e=e.distance}if(u!==0){if(b){r=h.distanceTo(new OpenLayers.Geometry.Point(b.x2,b.y2),g);var t=C?r.distance:r;if(t<u){if(C){e={distance:u,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0}}else{e=t}}}}}else{e=h.distanceTo(this,g);if(C){e={distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0}}}}return e},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesetfeature","setfeature","beforetransform","transform","transformcomplete"],geometryTypes:null,layer:null,preserveAspectRatio:false,rotate:true,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.TransformFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.layer=b;if(!this.rotationHandleSymbolizer){this.rotationHandleSymbolizer={stroke:false,pointRadius:10,fillOpacity:0,cursor:"pointer"}}this.createBox();this.createControl()},activate:function(){var a=false;if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragControl.activate();this.layer.addFeatures([this.box]);this.rotate&&this.layer.addFeatures(this.rotationHandles);this.layer.addFeatures(this.handles);a=true}return a},deactivate:function(){var a=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.handles);this.rotate&&this.layer.removeFeatures(this.rotationHandles);this.layer.removeFeatures([this.box]);this.dragControl.deactivate();a=true}return a},setMap:function(a){this.dragControl.setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(k,c){c=OpenLayers.Util.applyDefaults(c,{rotation:0,scale:1,ratio:1});var j={feature:k};var e=this.rotation;var a=this.center;OpenLayers.Util.extend(this,c);if(this.events.triggerEvent("beforesetfeature",j)===false){return}this.feature=k;this.activate();this._setfeature=true;var b=this.feature.geometry.getBounds();this.box.move(b.getCenterLonLat());this.box.geometry.rotate(-e,a);this._angle=0;var f;if(this.rotation){var g=k.geometry.clone();g.rotate(-this.rotation,this.center);var d=new OpenLayers.Feature.Vector(g.getBounds().toGeometry());d.geometry.rotate(this.rotation,this.center);this.box.geometry.rotate(this.rotation,this.center);this.box.move(d.geometry.getBounds().getCenterLonLat());var h=d.geometry.components[0].components[0];f=h.getBounds().getCenterLonLat()}else{f=new OpenLayers.LonLat(b.left,b.bottom)}this.handles[0].move(f);delete this._setfeature;this.events.triggerEvent("setfeature",j)},createBox:function(){var e=this;this.center=new OpenLayers.Geometry.Point(0,0);var f=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);f.geometry.move=function(p,q){e._moving=true;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);e.center.move(p,q);delete e._moving};var a=function(p,q){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.move(p,q);this._handle.geometry.move(p,q)};var o=function(r,p,q){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(r,p,q);this._handle.geometry.resize(r,p,q)};var l=function(q,p){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(q,p);this._handle.geometry.rotate(q,p)};var h=function(C,A){var H=this.x,E=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,C,A);if(e._moving){return}var F=e.dragControl.handlers.drag.evt;var p=!e._setfeature&&e.preserveAspectRatio;var t=!p&&!(F&&F.shiftKey);var B=new OpenLayers.Geometry.Point(H,E);var w=e.center;this.rotate(-e.rotation,w);B.rotate(-e.rotation,w);var D=this.x-w.x;var u=this.y-w.y;var G=D-(this.x-B.x);var v=u-(this.y-B.y);this.x=H;this.y=E;var r,z=1;if(t){r=Math.abs(v)<0.00001?1:u/v;z=(Math.abs(G)<0.00001?1:(D/G))/r}else{var s=Math.sqrt((G*G)+(v*v));var q=Math.sqrt((D*D)+(u*u));r=q/s}e._moving=true;e.box.geometry.rotate(-e.rotation,w);delete e._moving;e.box.geometry.resize(r,w,z);e.box.geometry.rotate(e.rotation,w);e.transformFeature({scale:r,ratio:z})};var c=function(z,v){var F=this.x,C=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,z,v);if(e._moving){return}var D=e.dragControl.handlers.drag.evt;var w=(D&&D.shiftKey)?45:1;var u=e.center;var B=this.x-u.x;var s=this.y-u.y;var E=B-z;var t=s-v;this.x=F;this.y=C;var q=Math.atan2(t,E);var p=Math.atan2(s,B);var r=p-q;r*=180/Math.PI;e._angle=(e._angle+r)%360;var A=e.rotation%w;if(Math.abs(e._angle)>=w||A!==0){r=Math.round(e._angle/w)*w-A;e._angle=0;e.box.geometry.rotate(r,u);e.transformFeature({rotation:r})}};var m=new Array(8);var j=new Array(4);var k,g,b;for(var d=0;d<8;++d){k=f.geometry.components[d];g=new OpenLayers.Feature.Vector(k.clone(),null,typeof this.renderIntent=="string"?null:this.renderIntent);if(d%2==0){b=new OpenLayers.Feature.Vector(k.clone(),null,typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer);b.geometry.move=c;k._rotationHandle=b;j[d/2]=b}k.move=a;k.resize=o;k.rotate=l;g.geometry.move=h;k._handle=g;m[d]=g}this.box=f;this.rotationHandles=j;this.handles=m},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:true,moveFeature:function(b){if(this.feature===a.feature){this.feature=a.box}OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(c,b){if(c===a.box){a.transformFeature({center:a.center});a.drawHandles()}},onStart:function(e,c){var b=!a.geometryTypes||OpenLayers.Util.indexOf(a.geometryTypes,e.geometry.CLASS_NAME)!==-1;var d=OpenLayers.Util.indexOf(a.handles,e);d+=OpenLayers.Util.indexOf(a.rotationHandles,e);if(e!==a.feature&&e!==a.box&&d==-2&&b){a.setFeature(e)}},onComplete:function(c,b){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){var b=this.layer;for(var a=0;a<8;++a){if(this.rotate&&a%2===0){b.drawFeature(this.rotationHandles[a/2],this.rotationHandleSymbolizer)}b.drawFeature(this.handles[a],this.renderIntent)}},transformFeature:function(e){if(!this._setfeature){this.scale*=(e.scale||1);this.ratio*=(e.ratio||1);var b=this.rotation;this.rotation=(this.rotation+(e.rotation||0))%360;if(this.events.triggerEvent("beforetransform",e)!==false){var d=this.feature;var c=d.geometry;var a=this.center;c.rotate(-b,a);if(e.scale||e.ratio){c.resize(e.scale,a,e.ratio)}else{if(e.center){d.move(e.center.getBounds().getCenterLonLat())}}c.rotate(this.rotation,a);this.layer.drawFeature(d);d.toState(OpenLayers.State.UPDATE);this.events.triggerEvent("transform",e)}}this.layer.drawFeature(this.box,this.renderIntent);this.drawHandles()},destroy:function(){var b;for(var a=0;a<8;++a){b=this.box.geometry.components[a];b._handle.destroy();b._handle=null;b._rotationHandle&&b._rotationHandle.destroy();b._rotationHandle=null}this.box.destroy();this.box=null;this.layer=null;this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"});OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(y){if(typeof y=="string"){y=OpenLayers.Format.XML.prototype.read.apply(this,[y])}var c=[];if(this.extractTracks){var u=y.getElementsByTagName("trk");for(var t=0,v=u.length;t<v;t++){var o={};if(this.extractAttributes){o=this.parseAttributes(u[t])}var h=this.getElementsByTagNameNS(u[t],u[t].namespaceURI,"trkseg");for(var s=0,f=h.length;s<f;s++){var m=this.extractSegment(h[s],"trkpt");c.push(new OpenLayers.Feature.Vector(m,o))}}}if(this.extractRoutes){var a=y.getElementsByTagName("rte");for(var r=0,q=a.length;r<q;r++){var o={};if(this.extractAttributes){o=this.parseAttributes(a[r])}var x=this.extractSegment(a[r],"rtept");c.push(new OpenLayers.Feature.Vector(x,o))}}if(this.extractWaypoints){var b=y.getElementsByTagName("wpt");for(var p=0,v=b.length;p<v;p++){var o={};if(this.extractAttributes){o=this.parseAttributes(b[p])}var e=new OpenLayers.Geometry.Point(b[p].getAttribute("lon"),b[p].getAttribute("lat"));c.push(new OpenLayers.Feature.Vector(e,o))}}if(this.internalProjection&&this.externalProjection){for(var w=0,d=c.length;w<d;w++){c[w].geometry.transform(this.externalProjection,this.internalProjection)}}return c},extractSegment:function(e,f){var d=this.getElementsByTagNameNS(e,e.namespaceURI,f);var b=[];for(var c=0,a=d.length;c<a;c++){b.push(new OpenLayers.Geometry.Point(d[c].getAttribute("lon"),d[c].getAttribute("lat")))}return new OpenLayers.Geometry.LineString(b)},parseAttributes:function(b){var a={};var d=b.firstChild;while(d){if(d.nodeType==1){var c=d.firstChild;if(c.nodeType==3||c.nodeType==4){name=(d.prefix)?d.nodeName.split(":")[1]:d.nodeName;if(name!="trkseg"&&name!="rtept"){a[name]=c.nodeValue}}}d=d.nextSibling}return a},CLASS_NAME:"OpenLayers.Format.GPX"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(a){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(a,b){var c=false;var d=this.components.pop();if(b!=null||!a.equals(d)){c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var e=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]);return c},removeComponent:function(a){if(this.components.length>4){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var b=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[b])}},move:function(b,d){for(var c=0,a=this.components.length;c<a-1;c++){this.components[c].move(b,d)}},rotate:function(d,b){for(var c=0,a=this.components.length;c<a-1;++c){this.components[c].rotate(d,b)}},resize:function(e,b,d){for(var c=0,a=this.components.length;c<a-1;++c){this.components[c].resize(e,b,d)}return this},transform:function(e,c){if(e&&c){for(var d=0,a=this.components.length;d<a-1;d++){var b=this.components[d];b.transform(e,c)}this.bounds=null}return this},getCentroid:function(){if(this.components&&(this.components.length>2)){var h=0;var g=0;for(var e=0;e<this.components.length-1;e++){var d=this.components[e];var k=this.components[e+1];h+=(d.x+k.x)*(d.x*k.y-k.x*d.y);g+=(d.y+k.y)*(d.x*k.y-k.x*d.y)}var f=-1*this.getArea();var a=h/(6*f);var j=g/(6*f);return new OpenLayers.Geometry.Point(a,j)}else{return null}},getArea:function(){var g=0;if(this.components&&(this.components.length>2)){var f=0;for(var e=0,d=this.components.length;e<d-1;e++){var a=this.components[e];var h=this.components[e+1];f+=(a.x+h.x)*(h.y-a.y)}g=-f/2}return g},getGeodesicArea:function(b){var d=this;if(b){var c=new OpenLayers.Projection("EPSG:4326");if(!c.equals(b)){d=this.clone().transform(b,c)}}var f=0;var a=d.components&&d.components.length;if(a>2){var h,g;for(var e=0;e<a-1;e++){h=d.components[e];g=d.components[e+1];f+=OpenLayers.Util.rad(g.x-h.x)*(2+Math.sin(OpenLayers.Util.rad(h.y))+Math.sin(OpenLayers.Util.rad(g.y)))}f=f*6378137*6378137/2}return f},containsPoint:function(m){var t=OpenLayers.Number.limitSigDigs;var l=14;var k=t(m.x,l);var j=t(m.y,l);function s(z,v,x,u,w){return(((v-u)*z)+((u*x)-(v*w)))/(x-w)}var a=this.components.length-1;var g,f,r,d,p,b,e,c;var h=0;for(var o=0;o<a;++o){g=this.components[o];r=t(g.x,l);d=t(g.y,l);f=this.components[o+1];p=t(f.x,l);b=t(f.y,l);if(d==b){if(j==d){if(r<=p&&(k>=r&&k<=p)||r>=p&&(k<=r&&k>=p)){h=-1;break}}continue}e=t(s(j,r,d,p,b),l);if(e==k){if(d<b&&(j>=d&&j<=b)||d>b&&(j<=d&&j>=b)){h=-1;break}}if(e<=k){continue}if(r!=p&&(e<Math.min(r,p)||e>Math.max(r,p))){continue}if(d<b&&(j>=d&&j<b)||d>b&&(j<d&&j>=b)){++h}}var q=(h==-1)?1:!!(h&1);return q},intersects:function(d){var b=false;if(d.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(d)}else{if(d.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=d.intersects(this)}else{if(d.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[d])}else{for(var c=0,a=d.components.length;c<a;++c){b=d.components[c].intersects(this);if(b){break}}}}}return b},getVertices:function(a){return(a===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},split:function(o,t){var g=null;var s=t&&t.mutual;var p,a,r,m,b;var e=[];var q=[o];for(var f=0,h=this.components.length;f<h;++f){a=this.components[f];m=false;for(var d=0;d<q.length;++d){p=a.split(q[d],t);if(p){if(s){r=p[0];for(var c=0,l=r.length;c<l;++c){if(c===0&&e.length){e[e.length-1].addComponent(r[c])}else{e.push(new OpenLayers.Geometry.MultiLineString([r[c]]))}}m=true;p=p[1]}if(p.length){p.unshift(d,1);Array.prototype.splice.apply(q,p);break}}}if(!m){if(e.length){e[e.length-1].addComponent(a.clone())}else{e=[new OpenLayers.Geometry.MultiLineString(a.clone())]}}}if(e&&e.length>1){m=true}else{e=[]}if(q&&q.length>1){b=true}else{q=[]}if(m||b){if(s){g=[e,q]}else{g=q}}return g},splitWith:function(o,t){var g=null;var s=t&&t.mutual;var p,c,r,m,a,e,q;if(o instanceof OpenLayers.Geometry.LineString){q=[];e=[o];for(var f=0,h=this.components.length;f<h;++f){a=false;c=this.components[f];for(var d=0;d<e.length;++d){p=e[d].split(c,t);if(p){if(s){r=p[0];if(r.length){r.unshift(d,1);Array.prototype.splice.apply(e,r);d+=r.length-2}p=p[1];if(p.length===0){p=[c.clone()]}}for(var b=0,l=p.length;b<l;++b){if(b===0&&q.length){q[q.length-1].addComponent(p[b])}else{q.push(new OpenLayers.Geometry.MultiLineString([p[b]]))}}a=true}}if(!a){if(q.length){q[q.length-1].addComponent(c.clone())}else{q=[new OpenLayers.Geometry.MultiLineString([c.clone()])]}}}}else{g=o.split(this)}if(e&&e.length>1){m=true}else{e=[]}if(q&&q.length>1){a=true}else{q=[]}if(m||a){if(s){g=[e,q]}else{g=q}}return g},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,freehand:false,freehandToggle:"shiftKey",initialize:function(c,b,a){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Point.prototype.destroyFeature.apply(this);this.line=null},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature()},freehandMode:function(a){return(this.freehandToggle&&a[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;this.callback("modify",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiLineString([a])}return a},mousedown:function(a){if(this.lastDown&&this.lastDown.equals(a.xy)){return false}if(this.lastDown==null){if(this.persist){this.destroyFeature()}this.createFeature(a.xy)}else{if((this.lastUp==null)||!this.lastUp.equals(a.xy)){this.addPoint(a.xy)}}this.mouseDown=true;this.lastDown=a.xy;this.drawing=true;return false},mousemove:function(a){if(this.drawing){if(this.mouseDown&&this.freehandMode(a)){this.addPoint(a.xy)}else{this.modifyFeature(a.xy)}}return true},mouseup:function(a){this.mouseDown=false;if(this.drawing){if(this.freehandMode(a)){this.removePoint();this.finalize()}else{if(this.lastUp==null){this.addPoint(a.xy)}this.lastUp=a.xy}return false}return true},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforesplit","split","aftersplit"],layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){Array.prototype.push.apply(this.EVENT_TYPES,OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.options=a||{};if(this.options.source){this.setSource(this.options.source)}},setSource:function(a){if(this.active){this.deactivate();if(this.handler){this.handler.destroy();delete this.handler}this.source=a;this.activate()}else{this.source=a}},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a){if(!this.source){if(!this.handler){this.handler=new OpenLayers.Handler.Path(this,{done:function(b){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(b)})}},{layerOptions:this.sourceOptions})}this.handler.activate()}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a){if(this.source&&this.source.events){this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})}}return a},onSketchComplete:function(a){this.feature=null;return !this.considerSplit(a.feature)},afterFeatureModified:function(b){if(b.modified){var a=b.feature;if(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString){this.feature=b.feature;this.considerSplit(b.feature)}}},removeByGeometry:function(c,d){for(var b=0,a=c.length;b<a;++b){if(c[b].geometry===d){c.splice(b,1);break}}},isEligible:function(a){return(a.state!==OpenLayers.State.DELETE)&&(a.geometry instanceof OpenLayers.Geometry.LineString||a.geometry instanceof OpenLayers.Geometry.MultiLineString)&&(this.feature!==a)&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes))},considerSplit:function(c){var h=false;var f=false;if(!this.sourceFilter||this.sourceFilter.evaluate(c.attributes)){var g=this.layer&&this.layer.features||[];var z,q,a;var m=[],y=[];var d=(this.layer===this.source)&&this.mutual;var b={edge:this.edge,tolerance:this.tolerance,mutual:d};var l=[c.geometry];var p,e;var s,r;for(var w=0,x=g.length;w<x;++w){p=g[w];if(this.isEligible(p)){e=[p.geometry];for(var v=0;v<l.length;++v){s=l[v];for(var t=0;t<e.length;++t){z=e[t];if(s.getBounds().intersectsBounds(z.getBounds())){q=s.split(z,b);if(q){a=this.events.triggerEvent("beforesplit",{source:c,target:p});if(a!==false){if(d){r=q[0];if(r.length>1){r.unshift(v,1);Array.prototype.splice.apply(l,r);v+=r.length-3}q=q[1]}if(q.length>1){q.unshift(t,1);Array.prototype.splice.apply(e,q);t+=q.length-3}}}}}}if(e&&e.length>1){this.geomsToFeatures(p,e);this.events.triggerEvent("split",{original:p,features:e});Array.prototype.push.apply(m,e);y.push(p);f=true}}}if(l&&l.length>1){this.geomsToFeatures(c,l);this.events.triggerEvent("split",{original:c,features:l});Array.prototype.push.apply(m,l);y.push(c);h=true}if(h||f){if(this.deferDelete){var o,u=[];for(var w=0,x=y.length;w<x;++w){o=y[w];if(o.state===OpenLayers.State.INSERT){u.push(o)}else{o.state=OpenLayers.State.DELETE;this.layer.drawFeature(o)}}this.layer.destroyFeatures(u,{silent:true});for(var w=0,x=m.length;w<x;++w){m[w].state=OpenLayers.State.INSERT}}else{this.layer.destroyFeatures(y,{silent:true})}this.layer.addFeatures(m,{silent:true});this.events.triggerEvent("aftersplit",{source:c,features:m})}}return h},geomsToFeatures:function(c,d){var f=c.clone();delete f.geometry;var e;for(var b=0,a=d.length;b<a;++b){e=f.clone();e.geometry=d[b];e.state=OpenLayers.State.INSERT;d[b]=e}},destroy:function(){if(this.active){this.deactivate()}OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var c=0;if(this.components&&(this.components.length>0)){c+=Math.abs(this.components[0].getArea());for(var b=1,a=this.components.length;b<a;b++){c-=Math.abs(this.components[b].getArea())}}return c},getGeodesicArea:function(b){var d=0;if(this.components&&(this.components.length>0)){d+=Math.abs(this.components[0].getGeodesicArea(b));for(var c=1,a=this.components.length;c<a;c++){d-=Math.abs(this.components[c].getGeodesicArea(b))}}return d},containsPoint:function(a){var e=this.components.length;var c=false;if(e>0){c=this.components[0].containsPoint(a);if(c!==1){if(c&&e>1){var d;for(var b=1;b<e;++b){d=this.components[b].containsPoint(a);if(d){if(d===1){c=1}else{c=false}break}}}}}return c},intersects:function(e){var b=false;var d,a;if(e.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.containsPoint(e)}else{if(e.CLASS_NAME=="OpenLayers.Geometry.LineString"||e.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(d=0,a=this.components.length;d<a;++d){b=e.intersects(this.components[d]);if(b){break}}if(!b){for(d=0,a=e.components.length;d<a;++d){b=this.containsPoint(e.components[d]);if(b){break}}}}else{for(d=0,a=e.components.length;d<a;++d){b=this.intersects(e.components[d]);if(b){break}}}}if(!b&&e.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var c=this.components[0];for(d=0,a=c.components.length;d<a;++d){b=e.containsPoint(c.components[d]);if(b){break}}}return b},distanceTo:function(d,b){var c=!(b&&b.edge===false);var a;if(!c&&this.intersects(d)){a=0}else{a=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[d,b])}return a},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(j,f,b,l){var c=Math.PI*((1/b)-(1/2));if(l){c+=(l/180)*Math.PI}var a,h,g;var k=[];for(var e=0;e<b;++e){a=c+(e*2*Math.PI/b);h=j.x+(f*Math.cos(a));g=j.y+(f*Math.sin(a));k.push(new OpenLayers.Geometry.Point(h,g))}var d=new OpenLayers.Geometry.LinearRing(k);return new OpenLayers.Geometry.Polygon([d])};OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},createGeometryFromItem:function(o){var m=this.getElementsByTagNameNS(o,this.georssns,"point");var g=this.getElementsByTagNameNS(o,this.geons,"lat");var a=this.getElementsByTagNameNS(o,this.geons,"long");var q=this.getElementsByTagNameNS(o,this.georssns,"line");var k=this.getElementsByTagNameNS(o,this.georssns,"polygon");var c=this.getElementsByTagNameNS(o,this.georssns,"where");var d=this.getElementsByTagNameNS(o,this.georssns,"box");if(m.length>0||(g.length>0&&a.length>0)){var l;if(m.length>0){l=OpenLayers.String.trim(m[0].firstChild.nodeValue).split(/\s+/);if(l.length!=2){l=OpenLayers.String.trim(m[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{l=[parseFloat(g[0].firstChild.nodeValue),parseFloat(a[0].firstChild.nodeValue)]}var h=new OpenLayers.Geometry.Point(parseFloat(l[1]),parseFloat(l[0]))}else{if(q.length>0){var j=OpenLayers.String.trim(this.concatChildValues(q[0])).split(/\s+/);var e=[];var m;for(var b=0,f=j.length;b<f;b+=2){m=new OpenLayers.Geometry.Point(parseFloat(j[b+1]),parseFloat(j[b]));e.push(m)}h=new OpenLayers.Geometry.LineString(e)}else{if(k.length>0){var j=OpenLayers.String.trim(this.concatChildValues(k[0])).split(/\s+/);var e=[];var m;for(var b=0,f=j.length;b<f;b+=2){m=new OpenLayers.Geometry.Point(parseFloat(j[b+1]),parseFloat(j[b]));e.push(m)}h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e)])}else{if(c.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var p=this.gmlParser.parseFeature(c[0]);h=p.geometry}else{if(d.length>0){var j=OpenLayers.String.trim(d[0].firstChild.nodeValue).split(/\s+/);var e=[];var m;if(j.length>3){m=new OpenLayers.Geometry.Point(parseFloat(j[1]),parseFloat(j[0]));e.push(m);m=new OpenLayers.Geometry.Point(parseFloat(j[1]),parseFloat(j[2]));e.push(m);m=new OpenLayers.Geometry.Point(parseFloat(j[3]),parseFloat(j[2]));e.push(m);m=new OpenLayers.Geometry.Point(parseFloat(j[3]),parseFloat(j[0]));e.push(m);m=new OpenLayers.Geometry.Point(parseFloat(j[1]),parseFloat(j[0]));e.push(m)}h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e)])}}}}}if(h&&this.internalProjection&&this.externalProjection){h.transform(this.externalProjection,this.internalProjection)}return h},createFeatureFromItem:function(j){var d=this.createGeometryFromItem(j);var g=this.getChildValue(j,"*","title",this.featureTitle);var h=this.getChildValue(j,"*","description",this.getChildValue(j,"*","content",this.getChildValue(j,"*","summary",this.featureDescription)));var f=this.getChildValue(j,"*","link");if(!f){try{f=this.getElementsByTagNameNS(j,"*","link")[0].getAttribute("href")}catch(c){f=null}}var a=this.getChildValue(j,"*","id",null);var b={title:g,description:h,link:f};var k=new OpenLayers.Feature.Vector(d,b);k.fid=a;return k},getChildValue:function(d,b,c,f){var e;var a=this.getElementsByTagNameNS(d,b,c);if(a&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue){e=a[0].firstChild.nodeValue}else{e=(f==undefined)?"":f}return e},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}var a=null;a=this.getElementsByTagNameNS(e,"*","item");if(a.length==0){a=this.getElementsByTagNameNS(e,"*","entry")}var c=a.length;var d=new Array(c);for(var b=0;b<c;b++){d[b]=this.createFeatureFromItem(a[b])}return d},write:function(c){var d;if(c instanceof Array){d=this.createElementNS(this.rssns,"rss");for(var b=0,a=c.length;b<a;b++){d.appendChild(this.createFeatureXML(c[b]))}}else{d=this.createFeatureXML(c)}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},createFeatureXML:function(k){var f=this.buildGeometryNode(k.geometry);var a=this.createElementNS(this.rssns,"item");var d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(k.attributes.title?k.attributes.title:""));var b=this.createElementNS(this.rssns,"description");b.appendChild(this.createTextNode(k.attributes.description?k.attributes.description:""));a.appendChild(d);a.appendChild(b);if(k.attributes.link){var h=this.createElementNS(this.rssns,"link");h.appendChild(this.createTextNode(k.attributes.link));a.appendChild(h)}for(var j in k.attributes){if(j=="link"||j=="title"||j=="description"){continue}var g=this.createTextNode(k.attributes[j]);var e=j;if(j.search(":")!=-1){e=j.split(":")[1]}var c=this.createElementNS(this.featureNS,"feature:"+e);c.appendChild(g);a.appendChild(c)}a.appendChild(f);return a},buildGeometryNode:function(b){if(this.internalProjection&&this.externalProjection){b=b.clone();b.transform(this.internalProjection,this.externalProjection)}var a;if(b.CLASS_NAME=="OpenLayers.Geometry.Polygon"){a=this.createElementNS(this.georssns,"georss:polygon");a.appendChild(this.buildCoordinatesNode(b.components[0]))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.LineString"){a=this.createElementNS(this.georssns,"georss:line");a.appendChild(this.buildCoordinatesNode(b))}else{if(b.CLASS_NAME=="OpenLayers.Geometry.Point"){a=this.createElementNS(this.georssns,"georss:point");a.appendChild(this.buildCoordinatesNode(b))}else{throw"Couldn't parse "+b.CLASS_NAME}}}return a},buildCoordinatesNode:function(f){var c=null;if(f.components){c=f.components}var e;if(c){var b=c.length;var d=new Array(b);for(var a=0;a<b;a++){d[a]=c[a].y+" "+c[a].x}e=d.join(" ")}else{e=f.y+" "+f.x}return this.createTextNode(e)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,extractStyles:false,extractTracks:false,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(b){this.features=[];this.styles={};this.fetched={};var a={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(b,a)},parseData:function(g,c){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var e=["Link","NetworkLink","Style","StyleMap","Placemark"];for(var d=0,a=e.length;d<a;++d){var f=e[d];var b=this.getElementsByTagNameNS(g,"*",f);if(b.length==0){continue}switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(b,c);break;case"style":if(this.extractStyles){this.parseStyles(b,c)}break;case"stylemap":if(this.extractStyles){this.parseStyleMaps(b,c)}break;case"placemark":this.parseFeatures(b,c);break}}return this.features},parseLinks:function(c,d){if(d.depth>=this.maxDepth){return false}var g=OpenLayers.Util.extend({},d);g.depth++;for(var e=0,a=c.length;e<a;e++){var b=this.parseProperty(c[e],"*","href");if(b&&!this.fetched[b]){this.fetched[b]=true;var f=this.fetchLink(b);if(f){this.parseData(f,g)}}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:false});if(b){return b.responseText}},parseStyles:function(b,c){for(var e=0,a=b.length;e<a;e++){var f=this.parseStyle(b[e]);if(f){var d=(c.styleBaseUrl||"")+"#"+f.id;this.styles[d]=f}}},parseKmlColor:function(b){var a=null;if(b){var c=b.match(this.regExes.kmlColor);if(c){a={color:"#"+c[4]+c[3]+c[2],opacity:parseInt(c[1],16)/255}}}return a},parseStyle:function(A){var I={};var r=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"];var e,L,g,d;for(var F=0,H=r.length;F<H;++F){e=r[F];styleTypeNode=this.getElementsByTagNameNS(A,"*",e)[0];if(!styleTypeNode){continue}switch(e.toLowerCase()){case"linestyle":var c=this.parseProperty(styleTypeNode,"*","color");var C=this.parseKmlColor(c);if(C){I.strokeColor=C.color;I.strokeOpacity=C.opacity}var z=this.parseProperty(styleTypeNode,"*","width");if(z){I.strokeWidth=z}break;case"polystyle":var c=this.parseProperty(styleTypeNode,"*","color");var C=this.parseKmlColor(c);if(C){I.fillOpacity=C.opacity;I.fillColor=C.color}var D=this.parseProperty(styleTypeNode,"*","fill");if(D=="0"){I.fillColor="none"}var j=this.parseProperty(styleTypeNode,"*","outline");if(j=="0"){I.strokeWidth="0"}break;case"iconstyle":var N=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1);var z=32*N;var u=32*N;var M=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(M){var E=this.parseProperty(M,"*","href");if(E){var q=this.parseProperty(M,"*","w");var G=this.parseProperty(M,"*","h");var f="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(E,f)&&!q&&!G){q=64;G=64;N=N/2}q=q||G;G=G||q;if(q){z=parseInt(q)*N}if(G){u=parseInt(G)*N}var b=E.match(this.regExes.kmlIconPalette);if(b){var J=b[1];var t=b[2];var p=this.parseProperty(M,"*","x");var o=this.parseProperty(M,"*","y");var m=p?p/32:0;var l=o?(7-o/32):7;var k=l*8+m;E="http://maps.google.com/mapfiles/kml/pal"+J+"/icon"+k+t}I.graphicOpacity=1;I.externalGraphic=E}}var s=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];if(s){var p=parseFloat(s.getAttribute("x"));var o=parseFloat(s.getAttribute("y"));var B=s.getAttribute("xunits");if(B=="pixels"){I.graphicXOffset=-p*N}else{if(B=="insetPixels"){I.graphicXOffset=-z+(p*N)}else{if(B=="fraction"){I.graphicXOffset=-z*p}}}var K=s.getAttribute("yunits");if(K=="pixels"){I.graphicYOffset=-u+(o*N)+1}else{if(K=="insetPixels"){I.graphicYOffset=-(o*N)+1}else{if(K=="fraction"){I.graphicYOffset=-u*(1-o)+1}}}}I.graphicWidth=z;I.graphicHeight=u;break;case"balloonstyle":var a=OpenLayers.Util.getXmlNodeValue(styleTypeNode);if(a){I.balloonStyle=a.replace(this.regExes.straightBracket,"${$1}")}break;case"labelstyle":var c=this.parseProperty(styleTypeNode,"*","color");var C=this.parseKmlColor(c);if(C){I.fontColor=C.color;I.fontOpacity=C.opacity}break;default:}}if(!I.strokeColor&&I.fillColor){I.strokeColor=I.fillColor}var v=A.getAttribute("id");if(v&&I){I.id=v}return I},parseStyleMaps:function(a,o){for(var g=0,h=a.length;g<h;g++){var d=a[g];var c=this.getElementsByTagNameNS(d,"*","Pair");var b=d.getAttribute("id");for(var f=0,m=c.length;f<m;f++){var e=c[f];var l=this.parseProperty(e,"*","key");var k=this.parseProperty(e,"*","styleUrl");if(k&&l=="normal"){this.styles[(o.styleBaseUrl||"")+"#"+b]=this.styles[(o.styleBaseUrl||"")+k]}if(k&&l=="highlight"){}}}},parseFeatures:function(b,m){var f=[];for(var g=0,h=b.length;g<h;g++){var c=b[g];var l=this.parseFeature.apply(this,[c]);if(l){if(this.extractStyles&&l.attributes&&l.attributes.styleUrl){l.style=this.getStyle(l.attributes.styleUrl,m)}if(this.extractStyles){var k=this.getElementsByTagNameNS(c,"*","Style")[0];if(k){var e=this.parseStyle(k);if(e){l.style=OpenLayers.Util.extend(l.style,e)}}}if(this.extractTracks){var j=this.getElementsByTagNameNS(c,this.namespaces.gx,"Track");if(j&&j.length>0){var d=j[0];var a={features:[],feature:l};this.readNode(d,a);if(a.features.length>0){f.push.apply(f,a.features)}}}else{f.push(l)}}else{throw"Bad Placemark: "+g}}this.features=this.features.concat(f)},readers:{kml:{when:function(b,a){a.whens.push(OpenLayers.Date.parse(this.getChildValue(b)))},_trackPointAttribute:function(c,a){var b=c.nodeName.split(":").pop();a.attributes[b].push(this.getChildValue(c))}},gx:{Track:function(c,b){var e={whens:[],points:[],angles:[]};if(this.trackAttributes){var a;e.attributes={};for(var f=0,m=this.trackAttributes.length;f<m;++f){a=this.trackAttributes[f];e.attributes[a]=[];if(!(a in this.readers.kml)){this.readers.kml[a]=this.readers.kml._trackPointAttribute}}}this.readChildNodes(c,e);if(e.whens.length!==e.points.length){throw new Error("gx:Track with unequal number of when ("+e.whens.length+") and gx:coord ("+e.points.length+") elements.")}var k=e.angles.length>0;if(k&&e.whens.length!==e.angles.length){throw new Error("gx:Track with unequal number of when ("+e.whens.length+") and gx:angles ("+e.angles.length+") elements.")}var o,l,h;for(var f=0,m=e.whens.length;f<m;++f){o=b.feature.clone();o.fid=b.feature.fid||b.feature.id;l=e.points[f];o.geometry=l;if("z" in l){o.attributes.altitude=l.z}if(this.internalProjection&&this.externalProjection){o.geometry.transform(this.externalProjection,this.internalProjection)}if(this.trackAttributes){for(var d=0,g=this.trackAttributes.length;d<g;++d){o.attributes[a]=e.attributes[this.trackAttributes[d]][f]}}o.attributes.when=e.whens[f];o.attributes.trackId=b.feature.id;if(k){h=e.angles[f];o.attributes.heading=parseFloat(h[0]);o.attributes.tilt=parseFloat(h[1]);o.attributes.roll=parseFloat(h[2])}b.features.push(o)}},coord:function(c,b){var e=this.getChildValue(c);var d=e.replace(this.regExes.trimSpace,"").split(/\s+/);var a=new OpenLayers.Geometry.Point(d[0],d[1]);if(d.length>2){a.z=parseFloat(d[2])}b.points.push(a)},angles:function(b,a){var d=this.getChildValue(b);var c=d.replace(this.regExes.trimSpace,"").split(/\s+/);a.angles.push(c)}}},parseFeature:function(b){var c=["MultiGeometry","Polygon","LineString","Point"];var j,e,k,a;for(var g=0,h=c.length;g<h;++g){j=c[g];this.internalns=b.namespaceURI?b.namespaceURI:this.kmlns;e=this.getElementsByTagNameNS(b,this.internalns,j);if(e.length>0){var a=this.parseGeometry[j.toLowerCase()];if(a){k=a.apply(this,[e[0]]);if(this.internalProjection&&this.externalProjection){k.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:j}))}break}}var f;if(this.extractAttributes){f=this.parseAttributes(b)}var l=new OpenLayers.Feature.Vector(k,f);var d=b.getAttribute("id")||b.getAttribute("name");if(d!=null){l.fid=d}return l},getStyle:function(b,a){var c=OpenLayers.Util.removeTail(b);var f=OpenLayers.Util.extend({},a);f.depth++;f.styleBaseUrl=c;if(!this.styles[b]&&!OpenLayers.String.startsWith(b,"#")&&f.depth<=this.maxDepth&&!this.fetched[c]){var e=this.fetchLink(c);if(e){this.parseData(e,f)}}var d=OpenLayers.Util.extend({},this.styles[b]);return d},parseGeometry:{point:function(d){var c=this.getElementsByTagNameNS(d,this.internalns,"coordinates");var e=[];if(c.length>0){var b=c[0].firstChild.nodeValue;b=b.replace(this.regExes.removeSpace,"");e=b.split(",")}var a=null;if(e.length>1){if(e.length==2){e[2]=null}a=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{throw"Bad coordinate string: "+b}return a},linestring:function(c,e){var d=this.getElementsByTagNameNS(c,this.internalns,"coordinates");var l=null;if(d.length>0){var b=this.getChildValue(d[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);var h=a.length;var k=new Array(h);var j,g;for(var f=0;f<h;++f){j=a[f].split(",");g=j.length;if(g>1){if(j.length==2){j[2]=null}k[f]=new OpenLayers.Geometry.Point(j[0],j[1],j[2])}else{throw"Bad LineString point coordinates: "+a[f]}}if(h){if(e){l=new OpenLayers.Geometry.LinearRing(k)}else{l=new OpenLayers.Geometry.LineString(k)}}else{throw"Bad LineString coordinates: "+b}}return l},polygon:function(f){var c=this.getElementsByTagNameNS(f,this.internalns,"LinearRing");var g=c.length;var e=new Array(g);if(g>0){var b;for(var d=0,a=c.length;d<a;++d){b=this.parseGeometry.linestring.apply(this,[c[d],true]);if(b){e[d]=b}else{throw"Bad LinearRing geometry: "+d}}}return new OpenLayers.Geometry.Polygon(e)},multigeometry:function(e){var h,g;var f=[];var c=e.childNodes;for(var b=0,a=c.length;b<a;++b){h=c[b];if(h.nodeType==1){var d=(h.prefix)?h.nodeName.split(":")[1]:h.nodeName;var g=this.parseGeometry[d.toLowerCase()];if(g){f.push(g.apply(this,[h]))}}}return new OpenLayers.Geometry.Collection(f)}},parseAttributes:function(d){var f={};var h=d.getElementsByTagName("ExtendedData");if(h.length){f=this.parseExtendedData(h[0])}var b,o,m;var c=d.childNodes;for(var j=0,k=c.length;j<k;++j){b=c[j];if(b.nodeType==1){o=b.childNodes;if(o.length>=1&&o.length<=3){var m;switch(o.length){case 1:m=o[0];break;case 2:var g=o[0];var e=o[1];m=(g.nodeType==3||g.nodeType==4)?g:e;break;case 3:default:m=o[1];break}if(m.nodeType==3||m.nodeType==4){var a=(b.prefix)?b.nodeName.split(":")[1]:b.nodeName;var l=OpenLayers.Util.getXmlNodeValue(m);if(l){l=l.replace(this.regExes.trimSpace,"");f[a]=l}}}}}return f},parseExtendedData:function(b){var d={};var f,h,e,k;var c=b.getElementsByTagName("Data");for(f=0,h=c.length;f<h;f++){e=c[f];k=e.getAttribute("name");var g={};var l=e.getElementsByTagName("value");if(l.length){g.value=this.getChildValue(l[0])}var a=e.getElementsByTagName("displayName");if(a.length){g.displayName=this.getChildValue(a[0])}d[k]=g}var j=b.getElementsByTagName("SimpleData");for(f=0,h=j.length;f<h;f++){var g={};e=j[f];k=e.getAttribute("name");g.value=this.getChildValue(e);g.displayName=k;d[k]=g}return d},parseProperty:function(c,d,b){var f;var a=this.getElementsByTagNameNS(c,d,b);try{f=OpenLayers.Util.getXmlNodeValue(a[0])}catch(g){f=null}return f},write:function(d){if(!(d instanceof Array)){d=[d]}var b=this.createElementNS(this.kmlns,"kml");var e=this.createFolderXML();for(var c=0,a=d.length;c<a;++c){e.appendChild(this.createPlacemarkXML(d[c]))}b.appendChild(e);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var c=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var e=this.createElementNS(this.kmlns,"name");var d=this.createTextNode(this.foldersName);e.appendChild(d);c.appendChild(e)}if(this.foldersDesc){var a=this.createElementNS(this.kmlns,"description");var b=this.createTextNode(this.foldersDesc);a.appendChild(b);c.appendChild(a)}return c},createPlacemarkXML:function(e){var g=this.createElementNS(this.kmlns,"name");var c=e.style&&e.style.label?e.style.label:e.attributes.name||e.id;g.appendChild(this.createTextNode(c));var d=this.createElementNS(this.kmlns,"description");var f=e.attributes.description||this.placemarksDesc;d.appendChild(this.createTextNode(f));var b=this.createElementNS(this.kmlns,"Placemark");if(e.fid!=null){b.setAttribute("id",e.fid)}b.appendChild(g);b.appendChild(d);var a=this.buildGeometryNode(e.geometry);b.appendChild(a);return b},buildGeometryNode:function(e){if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var c=e.CLASS_NAME;var b=c.substring(c.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];var d=null;if(a){d=a.apply(this,[e])}return d},buildGeometry:{point:function(b){var a=this.createElementNS(this.kmlns,"Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(b){var a=this.createElementNS(this.kmlns,"LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(b){var a=this.createElementNS(this.kmlns,"LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(h){var b=this.createElementNS(this.kmlns,"Polygon");var g=h.components;var e,f,d;for(var c=0,a=g.length;c<a;++c){d=(c==0)?"outerBoundaryIs":"innerBoundaryIs";e=this.createElementNS(this.kmlns,d);f=this.buildGeometry.linearring.apply(this,[g[c]]);e.appendChild(f);b.appendChild(e)}return b},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(d){var b=this.createElementNS(this.kmlns,"MultiGeometry");var e;for(var c=0,a=d.components.length;c<a;++c){e=this.buildGeometryNode.apply(this,[d.components[c]]);if(e){b.appendChild(e)}}return b}},buildCoordinatesNode:function(e){var a=this.createElementNS(this.kmlns,"coordinates");var j;var h=e.components;if(h){var g;var f=h.length;var c=new Array(f);for(var d=0;d<f;++d){g=h[d];c[d]=g.x+","+g.y}j=c.join(" ")}else{j=e.x+","+e.y}var b=this.createTextNode(j);a.appendChild(b);return a},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(a){var d={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};d=OpenLayers.Util.extend(d,a);var e={};for(var b=0;b<d.interestingTagsExclude.length;b++){e[d.interestingTagsExclude[b]]=true}d.interestingTagsExclude=e;var c={};for(var b=0;b<d.areaTags.length;b++){c[d.areaTags[b]]=true}d.areaTags=c;this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[d])},read:function(o){if(typeof o=="string"){o=OpenLayers.Format.XML.prototype.read.apply(this,[o])}var b=this.getNodes(o);var p=this.getWays(o);var g=new Array(p.length);for(var f=0;f<p.length;f++){var l=new Array(p[f].nodes.length);var a=this.isWayArea(p[f])?1:0;for(var e=0;e<p[f].nodes.length;e++){var c=b[p[f].nodes[e]];var m=new OpenLayers.Geometry.Point(c.lon,c.lat);m.osm_id=parseInt(p[f].nodes[e]);l[e]=m;c.used=true}var k=null;if(a){k=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(l))}else{k=new OpenLayers.Geometry.LineString(l)}if(this.internalProjection&&this.externalProjection){k.transform(this.externalProjection,this.internalProjection)}var h=new OpenLayers.Feature.Vector(k,p[f].tags);h.osm_id=parseInt(p[f].id);h.fid="way."+h.osm_id;g[f]=h}for(var d in b){var c=b[d];if(!c.used||this.checkTags){var r=null;if(this.checkTags){var q=this.getTags(c.node,true);if(c.used&&!q[1]){continue}r=q[0]}else{r=this.getTags(c.node)}var h=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),r);if(this.internalProjection&&this.externalProjection){h.geometry.transform(this.externalProjection,this.internalProjection)}h.osm_id=parseInt(d);h.fid="node."+h.osm_id;g.push(h)}c.node=null}return g},getNodes:function(e){var d=e.getElementsByTagName("node");var a={};for(var b=0;b<d.length;b++){var c=d[b];var f=c.getAttribute("id");a[f]={lat:c.getAttribute("lat"),lon:c.getAttribute("lon"),node:c}}return a},getWays:function(g){var f=g.getElementsByTagName("way");var h=[];for(var d=0;d<f.length;d++){var b=f[d];var c={id:b.getAttribute("id")};c.tags=this.getTags(b);var e=b.getElementsByTagName("nd");c.nodes=new Array(e.length);for(var a=0;a<e.length;a++){c.nodes[a]=e[a].getAttribute("ref")}h.push(c)}return h},getTags:function(e,g){var a=e.getElementsByTagName("tag");var c={};var f=false;for(var b=0;b<a.length;b++){var d=a[b].getAttribute("k");c[d]=a[b].getAttribute("v");if(g){if(!this.interestingTagsExclude[d]){f=true}}}return g?[c,f]:c},isWayArea:function(b){var a=false;var d=false;if(b.nodes[0]==b.nodes[b.nodes.length-1]){a=true}if(this.checkTags){for(var c in b.tags){if(this.areaTags[c]){d=true;break}}}return a&&(this.checkTags?d:true)},write:function(d){if(!(d instanceof Array)){d=[d]}this.osm_id=1;this.created_nodes={};var e=this.createElementNS(null,"osm");e.setAttribute("version","0.5");e.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=d.length-1;c>=0;c--){var a=this.createFeatureNodes(d[c]);for(var b=0;b<a.length;b++){e.appendChild(a[b])}}return OpenLayers.Format.XML.prototype.write.apply(this,[e])},createFeatureNodes:function(c){var b=[];var e=c.geometry.CLASS_NAME;var d=e.substring(e.lastIndexOf(".")+1);d=d.toLowerCase();var a=this.createXML[d];if(a){b=a.apply(this,[c])}return b},createXML:{point:function(a){var e=null;var c=a.geometry?a.geometry:a;var d=false;if(a.osm_id){e=a.osm_id;if(this.created_nodes[e]){d=true}}else{e=-this.osm_id;this.osm_id++}if(d){b=this.created_nodes[e]}else{var b=this.createElementNS(null,"node")}this.created_nodes[e]=b;b.setAttribute("id",e);b.setAttribute("lon",c.x);b.setAttribute("lat",c.y);if(a.attributes){this.serializeTags(a,b)}this.setState(a,b);return d?[]:[b]},linestring:function(d){var a=[];var h=d.geometry;if(d.osm_id){id=d.osm_id}else{id=-this.osm_id;this.osm_id++}var b=this.createElementNS(null,"way");b.setAttribute("id",id);for(var c=0;c<h.components.length;c++){var f=this.createXML.point.apply(this,[h.components[c]]);if(f.length){f=f[0];var e=f.getAttribute("id");a.push(f)}else{e=h.components[c].osm_id;f=this.created_nodes[e]}this.setState(d,f);var g=this.createElementNS(null,"nd");g.setAttribute("ref",e);b.appendChild(g)}this.serializeTags(d,b);a.push(b);return a},polygon:function(b){var a=OpenLayers.Util.extend({area:"yes"},b.attributes);var c=new OpenLayers.Feature.Vector(b.geometry.components[0],a);c.osm_id=b.osm_id;return this.createXML.linestring.apply(this,[c])}},serializeTags:function(c,d){for(var b in c.attributes){var a=this.createElementNS(null,"tag");a.setAttribute("k",b);a.setAttribute("v",c.attributes[b]);d.appendChild(a)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}if(c){b.setAttribute("action",c)}}},CLASS_NAME:"OpenLayers.Format.OSM"});OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(a){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{polygon:null,initialize:function(c,b,a){OpenLayers.Handler.Path.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.control.map.getLonLatFromPixel(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat));this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:true})},destroyFeature:function(){OpenLayers.Handler.Path.prototype.destroyFeature.apply(this);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;if(a&&this.multi){a=new OpenLayers.Geometry.MultiPolygon([a])}return a},dblclick:function(a){if(!this.freehandMode(a)){var b=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()}return false},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(c,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]);this.addControls([new OpenLayers.Control.Navigation()]);var a=[new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint"}),new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath"}),new OpenLayers.Control.DrawFeature(c,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon"})];this.addControls(a)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.activateControl(this.controls[0]);return a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["selected"],clearOnDeactivate:false,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:false},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(b,a){this.EVENT_TYPES=OpenLayers.Control.SLDSelect.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:false});if(this.sketchStyle){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})}this.handler=new b(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache){delete this.layerCache[a]}for(var a in this.wfsCache){delete this.wfsCache[a]}OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(b){var a;if(!this.layerCache[b.id]){a=new OpenLayers.Layer.WMS.Post(b.name,b.url,b.params,OpenLayers.Util.applyDefaults(this.layerOptions,b.getOptions()));this.layerCache[b.id]=a;if(this.layerOptions.displayInLayerSwitcher===false){b.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:a})}this.map.addLayer(a)}else{a=this.layerCache[b.id]}return a},createSLD:function(f,d,g){var a={version:"1.0.0",namedLayers:{}};var j=[f.params.LAYERS].join(",").split(",");for(var e=0,h=j.length;e<h;e++){var b=j[e];a.namedLayers[b]={name:b,userStyles:[]};var l=this.selectionSymbolizer;var k=g[e];if(k.type.indexOf("Polygon")>=0){l={Polygon:this.selectionSymbolizer.Polygon}}else{if(k.type.indexOf("LineString")>=0){l={Line:this.selectionSymbolizer.Line}}else{if(k.type.indexOf("Point")>=0){l={Point:this.selectionSymbolizer.Point}}}}var c=d[e];a.namedLayers[b].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:l,filter:c,maxScaleDenominator:f.options.minScale})]})}return new OpenLayers.Format.SLD().write(a)},parseDescribeLayer:function(c){var g=new OpenLayers.Format.WMSDescribeLayer();var h=c.responseXML;if(!h||!h.documentElement){h=c.responseText}var b=g.read(h);var f=[];var a=null;for(var d=0,e=b.length;d<e;d++){if(b[d].owsType=="WFS"){f.push(b[d].typeName);a=b[d].owsURL}}var j={url:a,params:{SERVICE:"WFS",TYPENAME:f.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(l){var o=new OpenLayers.Format.WFSDescribeFeatureType();var m=l.responseXML;if(!m||!m.documentElement){m=l.responseText}var k=o.read(m);this.control.wfsCache[this.layer.id]=k;this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(j)},getGeometryAttributes:function(d){var m=[];var a=this.wfsCache[d.id];for(var c=0,e=a.featureTypes.length;c<e;c++){var h=a.featureTypes[c];var f=h.properties;for(var b=0,l=f.length;b<l;b++){var k=f[b];var g=k.type;if((g.indexOf("LineString")>=0)||(g.indexOf("GeometryAssociationType")>=0)||(g.indexOf("GeometryPropertyType")>=0)||(g.indexOf("Point")>=0)||(g.indexOf("Polygon")>=0)){m.push(k)}}}return m},activate:function(){var b=OpenLayers.Control.prototype.activate.call(this);if(b){for(var e=0,a=this.layers.length;e<a;e++){var d=this.layers[e];if(d&&!this.wfsCache[d.id]){var c={url:d.url,params:{SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}};OpenLayers.Request.GET(c)}}}return b},deactivate:function(){var f=OpenLayers.Control.prototype.deactivate.call(this);if(f){for(var e=0,a=this.layers.length;e<a;e++){var d=this.layers[e];if(d&&this.clearOnDeactivate===true){var c=this.layerCache;var b=c[d.id];if(b){d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:b});b.destroy();delete c[d.id]}}}}return f},setLayers:function(a){if(this.active){this.deactivate();this.layers=a;this.activate()}else{this.layers=a}},createFilter:function(a,c){var b=null;if(this.handler instanceof OpenLayers.Handler.RegularPolygon){if(this.handler.irregular===true){b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:c.getBounds()})}else{b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:c})}}else{if(this.handler instanceof OpenLayers.Handler.Polygon){b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:c})}else{if(this.handler instanceof OpenLayers.Handler.Path){if(a.type.indexOf("Point")>=0){b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:c})}else{b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:c})}}else{if(this.handler instanceof OpenLayers.Handler.Click){if(a.type.indexOf("Polygon")>=0){b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:c})}else{b=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:c})}}}}}return b},select:function(a){this._queue=function(){for(var g=0,l=this.layers.length;g<l;g++){var h=this.layers[g];var k=this.getGeometryAttributes(h);var d=[];for(var f=0,o=k.length;f<o;f++){var p=k[f];if(p!==null){if(!(a instanceof OpenLayers.Geometry)){var m=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(m.lon,m.lat)}var c=this.createFilter(p,a);if(c!==null){d.push(c)}}}var e=this.createSelectionLayer(h);var b=this.createSLD(h,d,k);this.events.triggerEvent("selected",{layer:h,filters:d});e.mergeNewParams({SLD_BODY:b});delete this._queue}};this.applySelection()},applySelection:function(){var c=true;for(var b=0,a=this.layers.length;b<a;b++){if(!this.wfsCache[this.layers[b].id]){c=false;break}}c&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"});OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(a){this.request=new OpenLayers.Format.ArcXML.Request();this.response=new OpenLayers.Format.ArcXML.Response();if(a){if(a.requesttype=="feature"){this.request.get_image=null;var c=this.request.get_feature.query;this.addCoordSys(c.featurecoordsys,a.featureCoordSys);this.addCoordSys(c.filtercoordsys,a.filterCoordSys);if(a.polygon){c.isspatial=true;c.spatialfilter.polygon=a.polygon}else{if(a.envelope){c.isspatial=true;c.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0};this.parseEnvelope(c.spatialfilter.envelope,a.envelope)}}}else{if(a.requesttype=="image"){this.request.get_feature=null;var b=this.request.get_image.properties;this.parseEnvelope(b.envelope,a.envelope);this.addLayers(b.layerlist,a.layers);this.addImageSize(b.imagesize,a.tileSize);this.addCoordSys(b.featurecoordsys,a.featureCoordSys);this.addCoordSys(b.filtercoordsys,a.filterCoordSys)}else{this.request=null}}}OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(b,a){if(a&&a.length==4){b.minx=a[0];b.miny=a[1];b.maxx=a[2];b.maxy=a[3]}},addLayers:function(d,c){for(var b=0,a=c.length;b<a;b++){d.push(c[b])}},addImageSize:function(b,a){if(a!==null){b.width=a.w;b.height=a.h;b.printwidth=a.w;b.printheight=a.h}},addCoordSys:function(a,b){if(typeof b=="string"){a.id=parseInt(b);a.string=b}else{if(typeof b=="object"&&b.proj!==null){a.id=b.proj.srsProjNumber;a.string=b.proj.srsCode}else{a=b}}},iserror:function(c){var a=null;if(!c){a=(this.response.error!=="")}else{c=OpenLayers.Format.XML.prototype.read.apply(this,[c]);var b=c.documentElement.getElementsByTagName("ERROR");a=(b!==null&&b.length>0)}return a},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}var a=null;if(f&&f.documentElement){if(f.documentElement.nodeName=="ARCXML"){a=f.documentElement}else{a=f.documentElement.getElementsByTagName("ARCXML")[0]}}if(!a||a.firstChild.nodeName==="parsererror"){var c,e;try{c=f.firstChild.nodeValue;e=f.firstChild.childNodes[1].firstChild.nodeValue}catch(d){}throw {message:"Error parsing the ArcXML request",error:c,source:e}}var b=this.parseResponse(a);return b},write:function(c){if(!c){c=this.request}var s=this.createElementNS("","ARCXML");s.setAttribute("version","1.1");var h=this.createElementNS("","REQUEST");if(c.get_image!=null){var l=this.createElementNS("","GET_IMAGE");h.appendChild(l);var k=this.createElementNS("","PROPERTIES");l.appendChild(k);var b=c.get_image.properties;if(b.featurecoordsys!=null){var q=this.createElementNS("","FEATURECOORDSYS");k.appendChild(q);if(b.featurecoordsys.id===0){q.setAttribute("string",b.featurecoordsys.string)}else{q.setAttribute("id",b.featurecoordsys.id)}}if(b.filtercoordsys!=null){var o=this.createElementNS("","FILTERCOORDSYS");k.appendChild(o);if(b.filtercoordsys.id===0){o.setAttribute("string",b.filtercoordsys.string)}else{o.setAttribute("id",b.filtercoordsys.id)}}if(b.envelope!=null){var w=this.createElementNS("","ENVELOPE");k.appendChild(w);w.setAttribute("minx",b.envelope.minx);w.setAttribute("miny",b.envelope.miny);w.setAttribute("maxx",b.envelope.maxx);w.setAttribute("maxy",b.envelope.maxy)}var u=this.createElementNS("","IMAGESIZE");k.appendChild(u);u.setAttribute("height",b.imagesize.height);u.setAttribute("width",b.imagesize.width);if(b.imagesize.height!=b.imagesize.printheight||b.imagesize.width!=b.imagesize.printwidth){u.setAttribute("printheight",b.imagesize.printheight);u.setArrtibute("printwidth",b.imagesize.printwidth)}if(b.background!=null){var a=this.createElementNS("","BACKGROUND");k.appendChild(a);a.setAttribute("color",b.background.color.r+","+b.background.color.g+","+b.background.color.b);if(b.background.transcolor!==null){a.setAttribute("transcolor",b.background.transcolor.r+","+b.background.transcolor.g+","+b.background.transcolor.b)}}if(b.layerlist!=null&&b.layerlist.length>0){var g=this.createElementNS("","LAYERLIST");k.appendChild(g);for(var r=0;r<b.layerlist.length;r++){var p=this.createElementNS("","LAYERDEF");g.appendChild(p);p.setAttribute("id",b.layerlist[r].id);p.setAttribute("visible",b.layerlist[r].visible);if(typeof b.layerlist[r].query=="object"){var f=b.layerlist[r].query;if(f.where.length<0){continue}var z=null;if(typeof f.spatialfilter=="boolean"&&f.spatialfilter){z=this.createElementNS("","SPATIALQUERY")}else{z=this.createElementNS("","QUERY")}z.setAttribute("where",f.where);if(typeof f.accuracy=="number"&&f.accuracy>0){z.setAttribute("accuracy",f.accuracy)}if(typeof f.featurelimit=="number"&&f.featurelimit<2000){z.setAttribute("featurelimit",f.featurelimit)}if(typeof f.subfields=="string"&&f.subfields!="#ALL#"){z.setAttribute("subfields",f.subfields)}if(typeof f.joinexpression=="string"&&f.joinexpression.length>0){z.setAttribute("joinexpression",f.joinexpression)}if(typeof f.jointables=="string"&&f.jointables.length>0){z.setAttribute("jointables",f.jointables)}p.appendChild(z)}if(typeof b.layerlist[r].renderer=="object"){this.addRenderer(p,b.layerlist[r].renderer)}}}}else{if(c.get_feature!=null){var l=this.createElementNS("","GET_FEATURES");l.setAttribute("outputmode","newxml");l.setAttribute("checkesc","true");if(c.get_feature.geometry){l.setAttribute("geometry",c.get_feature.geometry)}else{l.setAttribute("geometry","false")}if(c.get_feature.compact){l.setAttribute("compact",c.get_feature.compact)}if(c.get_feature.featurelimit=="number"){l.setAttribute("featurelimit",c.get_feature.featurelimit)}l.setAttribute("globalenvelope","true");h.appendChild(l);if(c.get_feature.layer!=null&&c.get_feature.layer.length>0){var x=this.createElementNS("","LAYER");x.setAttribute("id",c.get_feature.layer);l.appendChild(x)}var t=c.get_feature.query;if(t!=null){var v=null;if(t.isspatial){v=this.createElementNS("","SPATIALQUERY")}else{v=this.createElementNS("","QUERY")}l.appendChild(v);if(typeof t.accuracy=="number"){v.setAttribute("accuracy",t.accuracy)}if(t.featurecoordsys!=null){var e=this.createElementNS("","FEATURECOORDSYS");if(t.featurecoordsys.id==0){e.setAttribute("string",t.featurecoordsys.string)}else{e.setAttribute("id",t.featurecoordsys.id)}v.appendChild(e)}if(t.filtercoordsys!=null){var d=this.createElementNS("","FILTERCOORDSYS");if(t.filtercoordsys.id===0){d.setAttribute("string",t.filtercoordsys.string)}else{d.setAttribute("id",t.filtercoordsys.id)}v.appendChild(d)}if(t.buffer>0){var m=this.createElementNS("","BUFFER");m.setAttribute("distance",t.buffer);v.appendChild(m)}if(t.isspatial){var j=this.createElementNS("","SPATIALFILTER");j.setAttribute("relation",t.spatialfilter.relation);v.appendChild(j);if(t.spatialfilter.envelope){var y=this.createElementNS("","ENVELOPE");y.setAttribute("minx",t.spatialfilter.envelope.minx);y.setAttribute("miny",t.spatialfilter.envelope.miny);y.setAttribute("maxx",t.spatialfilter.envelope.maxx);y.setAttribute("maxy",t.spatialfilter.envelope.maxy);j.appendChild(y)}else{if(typeof t.spatialfilter.polygon=="object"){j.appendChild(this.writePolygonGeometry(t.spatialfilter.polygon))}}}if(t.where!=null&&t.where.length>0){v.setAttribute("where",t.where)}}}}s.appendChild(h);return OpenLayers.Format.XML.prototype.write.apply(this,[s])},addGroupRenderer:function(b,a){var e=this.createElementNS("","GROUPRENDERER");b.appendChild(e);for(var c=0;c<a.length;c++){var d=a[c];this.addRenderer(e,d)}},addRenderer:function(c,b){if(b instanceof Array){this.addGroupRenderer(c,b)}else{var a=this.createElementNS("",b.type.toUpperCase()+"RENDERER");c.appendChild(a);if(a.tagName=="VALUEMAPRENDERER"){this.addValueMapRenderer(a,b)}else{if(a.tagName=="VALUEMAPLABELRENDERER"){this.addValueMapLabelRenderer(a,b)}else{if(a.tagName=="SIMPLELABELRENDERER"){this.addSimpleLabelRenderer(a,b)}else{if(a.tagName=="SCALEDEPENDENTRENDERER"){this.addScaleDependentRenderer(a,b)}}}}}},addScaleDependentRenderer:function(a,b){if(typeof b.lower=="string"||typeof b.lower=="number"){a.setAttribute("lower",b.lower)}if(typeof b.upper=="string"||typeof b.upper=="number"){a.setAttribute("upper",b.upper)}this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(h,g){h.setAttribute("lookupfield",g.lookupfield);h.setAttribute("labelfield",g.labelfield);if(typeof g.exacts=="object"){for(var a=0,k=g.exacts.length;a<k;a++){var e=g.exacts[a];var d=this.createElementNS("","EXACT");if(typeof e.value=="string"){d.setAttribute("value",e.value)}if(typeof e.label=="string"){d.setAttribute("label",e.label)}if(typeof e.method=="string"){d.setAttribute("method",e.method)}h.appendChild(d);if(typeof e.symbol=="object"){var b=null;if(e.symbol.type=="text"){b=this.createElementNS("","TEXTSYMBOL")}if(b!=null){var l=this.fontStyleKeys;for(var c=0,f=l.length;c<f;c++){var j=l[c];if(e.symbol[j]){b.setAttribute(j,e.symbol[j])}}d.appendChild(b)}}}}},addValueMapRenderer:function(k,j){k.setAttribute("lookupfield",j.lookupfield);if(typeof j.ranges=="object"){for(var a=0,b=j.ranges.length;a<b;a++){var g=j.ranges[a];var e=this.createElementNS("","RANGE");e.setAttribute("lower",g.lower);e.setAttribute("upper",g.upper);k.appendChild(e);if(typeof g.symbol=="object"){var d=null;if(g.symbol.type=="simplepolygon"){d=this.createElementNS("","SIMPLEPOLYGONSYMBOL")}if(d!=null){if(typeof g.symbol.boundarycolor=="string"){d.setAttribute("boundarycolor",g.symbol.boundarycolor)}if(typeof g.symbol.fillcolor=="string"){d.setAttribute("fillcolor",g.symbol.fillcolor)}if(typeof g.symbol.filltransparency=="number"){d.setAttribute("filltransparency",g.symbol.filltransparency)}e.appendChild(d)}}}}else{if(typeof j.exacts=="object"){for(var c=0,l=j.exacts.length;c<l;c++){var h=j.exacts[c];var f=this.createElementNS("","EXACT");if(typeof h.value=="string"){f.setAttribute("value",h.value)}if(typeof h.label=="string"){f.setAttribute("label",h.label)}if(typeof h.method=="string"){f.setAttribute("method",h.method)}k.appendChild(f);if(typeof h.symbol=="object"){var d=null;if(h.symbol.type=="simplemarker"){d=this.createElementNS("","SIMPLEMARKERSYMBOL")}if(d!=null){if(typeof h.symbol.antialiasing=="string"){d.setAttribute("antialiasing",h.symbol.antialiasing)}if(typeof h.symbol.color=="string"){d.setAttribute("color",h.symbol.color)}if(typeof h.symbol.outline=="string"){d.setAttribute("outline",h.symbol.outline)}if(typeof h.symbol.overlap=="string"){d.setAttribute("overlap",h.symbol.overlap)}if(typeof h.symbol.shadow=="string"){d.setAttribute("shadow",h.symbol.shadow)}if(typeof h.symbol.transparency=="number"){d.setAttribute("transparency",h.symbol.transparency)}if(typeof h.symbol.usecentroid=="string"){d.setAttribute("usecentroid",h.symbol.usecentroid)}if(typeof h.symbol.width=="number"){d.setAttribute("width",h.symbol.width)}f.appendChild(d)}}}}}},addSimpleLabelRenderer:function(f,h){f.setAttribute("field",h.field);var e=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"];for(var d=0,a=e.length;d<a;d++){var c=e[d];if(h[c]){f.setAttribute(c,h[c])}}if(h.symbol.type=="text"){var g=h.symbol;var b=this.createElementNS("","TEXTSYMBOL");f.appendChild(b);var e=this.fontStyleKeys;for(var d=0,a=e.length;d<a;d++){var c=e[d];if(g[c]){b.setAttribute(c,h[c])}}}},writePolygonGeometry:function(g){if(!(g instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+g.CLASS_NAME+" object.",geometry:g}}var b=this.createElementNS("","POLYGON");for(var e=0,c=g.components.length;e<c;e++){var a=g.components[e];var j=this.createElementNS("","RING");for(var d=0,k=a.components.length;d<k;d++){var h=a.components[d];var f=this.createElementNS("","POINT");f.setAttribute("x",h.x);f.setAttribute("y",h.y);j.appendChild(f)}b.appendChild(j)}return b},parseResponse:function(B){if(typeof B=="string"){var p=new OpenLayers.Format.XML();B=p.read(B)}var a=new OpenLayers.Format.ArcXML.Response();var C=B.getElementsByTagName("ERROR");if(C!=null&&C.length>0){a.error=this.getChildValue(C,"Unknown error.")}else{var t=B.getElementsByTagName("RESPONSE");if(t==null||t.length==0){a.error="No RESPONSE tag found in ArcXML response.";return a}var s=t[0].firstChild.nodeName;if(s=="#text"){s=t[0].firstChild.nextSibling.nodeName}if(s=="IMAGE"){var c=B.getElementsByTagName("ENVELOPE");var y=B.getElementsByTagName("OUTPUT");if(c==null||c.length==0){a.error="No ENVELOPE tag found in ArcXML response."}else{if(y==null||y.length==0){a.error="No OUTPUT tag found in ArcXML response."}else{var w=this.parseAttributes(c[0]);var x=this.parseAttributes(y[0]);if(typeof x.type=="string"){a.image={envelope:w,output:{type:x.type,data:this.getChildValue(y[0])}}}else{a.image={envelope:w,output:x}}}}}else{if(s=="FEATURES"){var j=t[0].getElementsByTagName("FEATURES");var r=j[0].getElementsByTagName("FEATURECOUNT");a.features.featurecount=r[0].getAttribute("count");if(a.features.featurecount>0){var d=j[0].getElementsByTagName("ENVELOPE");a.features.envelope=this.parseAttributes(d[0],typeof(0));var z=j[0].getElementsByTagName("FEATURE");for(var o=0;o<z.length;o++){var h=new OpenLayers.Feature.Vector();var u=z[o].getElementsByTagName("FIELD");for(var f=0;f<u.length;f++){var g=u[f].getAttribute("name");var l=u[f].getAttribute("value");h.attributes[g]=l}var v=z[o].getElementsByTagName("POLYGON");if(v.length>0){var k=v[0].getElementsByTagName("RING");var e=[];for(var q=0;q<k.length;q++){var A=[];A.push(this.parsePointGeometry(k[q]));var m=k[q].getElementsByTagName("HOLE");for(var b=0;b<m.length;b++){A.push(this.parsePointGeometry(m[b]))}m=null;e.push(new OpenLayers.Geometry.Polygon(A));A=null}k=null;if(e.length==1){h.geometry=e[0]}else{h.geometry=new OpenLayers.Geometry.MultiPolygon(e)}}a.features.feature.push(h)}}}else{a.error="Unidentified response type."}}}return a},parseAttributes:function(d,c){var b={};for(var a=0;a<d.attributes.length;a++){if(c=="number"){b[d.attributes[a].nodeName]=parseFloat(d.attributes[a].nodeValue)}else{b[d.attributes[a].nodeName]=d.attributes[a].nodeValue}}return b},parsePointGeometry:function(d){var b=[];var e=d.getElementsByTagName("COORDS");if(e.length>0){var f=this.getChildValue(e[0]);f=f.split(/;/);for(var h=0;h<f.length;h++){var g=f[h].split(/ /);b.push(new OpenLayers.Geometry.Point(parseFloat(g[0]),parseFloat(g[1])))}e=null}else{var a=d.getElementsByTagName("POINT");if(a.length>0){for(var c=0;c<a.length;c++){b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute("x")),parseFloat(a[c].getAttribute("y"))))}}a=null}return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"});OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(b){var a={get_image:{properties:{background:null,draw:true,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:false},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:false,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(b){var a={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(a){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(d){if(typeof d=="string"){d=OpenLayers.Format.XML.prototype.read.apply(this,[d])}var e=this.getElementsByTagNameNS(d.documentElement,this.gmlns,this.featureName);var c=[];for(var b=0;b<e.length;b++){var a=this.parseFeature(e[b]);if(a){c.push(a)}}return c},parseFeature:function(d){var e=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];var q,h,r,c;for(var l=0;l<e.length;++l){q=e[l];h=this.getElementsByTagNameNS(d,this.gmlns,q);if(h.length>0){c=this.parseGeometry[q.toLowerCase()];if(c){r=c.apply(this,[h[0]]);if(this.internalProjection&&this.externalProjection){r.transform(this.externalProjection,this.internalProjection)}}else{OpenLayers.Console.error(OpenLayers.i18n("unsupportedGeometryType",{geomType:q}))}break}}var b;var k=this.getElementsByTagNameNS(d,this.gmlns,"Box");for(l=0;l<k.length;++l){var p=k[l];var o=this.parseGeometry.box.apply(this,[p]);var m=p.parentNode;var g=m.localName||m.nodeName.split(":").pop();if(g==="boundedBy"){b=o}else{r=o.toGeometry()}}var j;if(this.extractAttributes){j=this.parseAttributes(d)}var s=new OpenLayers.Feature.Vector(r,j);s.bounds=b;s.gml={featureType:d.firstChild.nodeName.split(":")[1],featureNS:d.firstChild.namespaceURI,featureNSPrefix:d.firstChild.prefix};var a=d.firstChild;var f;while(a){if(a.nodeType==1){f=a.getAttribute("fid")||a.getAttribute("id");if(f){break}}a=a.nextSibling}s.fid=f;return s},parseGeometry:{point:function(d){var b,a;var e=[];var b=this.getElementsByTagNameNS(d,this.gmlns,"pos");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");e=a.split(this.regExes.splitSpace)}if(e.length==0){b=this.getElementsByTagNameNS(d,this.gmlns,"coordinates");if(b.length>0){a=b[0].firstChild.nodeValue;a=a.replace(this.regExes.removeSpace,"");e=a.split(",")}}if(e.length==0){b=this.getElementsByTagNameNS(d,this.gmlns,"coord");if(b.length>0){var f=this.getElementsByTagNameNS(b[0],this.gmlns,"X");var c=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");if(f.length>0&&c.length>0){e=[f[0].firstChild.nodeValue,c[0].firstChild.nodeValue]}}}if(e.length==2){e[2]=null}if(this.xy){return new OpenLayers.Geometry.Point(e[0],e[1],e[2])}else{return new OpenLayers.Geometry.Point(e[1],e[0],e[2])}},multipoint:function(e){var b=this.getElementsByTagNameNS(e,this.gmlns,"Point");var d=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.point.apply(this,[b[c]]);if(a){d.push(a)}}}return new OpenLayers.Geometry.MultiPoint(d)},linestring:function(c,e){var d,b;var o=[];var p=[];d=this.getElementsByTagNameNS(c,this.gmlns,"posList");if(d.length>0){b=this.getChildValue(d[0]);b=b.replace(this.regExes.trimSpace,"");o=b.split(this.regExes.splitSpace);var h=parseInt(d[0].getAttribute("dimension"));var f,m,l,k;for(var g=0;g<o.length/h;++g){f=g*h;m=o[f];l=o[f+1];k=(h==2)?null:o[f+2];if(this.xy){p.push(new OpenLayers.Geometry.Point(m,l,k))}else{p.push(new OpenLayers.Geometry.Point(l,m,k))}}}if(o.length==0){d=this.getElementsByTagNameNS(c,this.gmlns,"coordinates");if(d.length>0){b=this.getChildValue(d[0]);b=b.replace(this.regExes.trimSpace,"");b=b.replace(this.regExes.trimComma,",");var a=b.split(this.regExes.splitSpace);for(var g=0;g<a.length;++g){o=a[g].split(",");if(o.length==2){o[2]=null}if(this.xy){p.push(new OpenLayers.Geometry.Point(o[0],o[1],o[2]))}else{p.push(new OpenLayers.Geometry.Point(o[1],o[0],o[2]))}}}}var q=null;if(p.length!=0){if(e){q=new OpenLayers.Geometry.LinearRing(p)}else{q=new OpenLayers.Geometry.LineString(p)}}return q},multilinestring:function(e){var b=this.getElementsByTagNameNS(e,this.gmlns,"LineString");var d=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.linestring.apply(this,[b[c]]);if(a){d.push(a)}}}return new OpenLayers.Geometry.MultiLineString(d)},polygon:function(e){var b=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing");var d=[];if(b.length>0){var a;for(var c=0;c<b.length;++c){a=this.parseGeometry.linestring.apply(this,[b[c],true]);if(a){d.push(a)}}}return new OpenLayers.Geometry.Polygon(d)},multipolygon:function(e){var a=this.getElementsByTagNameNS(e,this.gmlns,"Polygon");var d=[];if(a.length>0){var c;for(var b=0;b<a.length;++b){c=this.parseGeometry.polygon.apply(this,[a[b]]);if(c){d.push(c)}}}return new OpenLayers.Geometry.MultiPolygon(d)},envelope:function(b){var e=[];var a;var f;var k=this.getElementsByTagNameNS(b,this.gmlns,"lowerCorner");if(k.length>0){var h=[];if(k.length>0){a=k[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");h=a.split(this.regExes.splitSpace)}if(h.length==2){h[2]=null}if(this.xy){var d=new OpenLayers.Geometry.Point(h[0],h[1],h[2])}else{var d=new OpenLayers.Geometry.Point(h[1],h[0],h[2])}}var g=this.getElementsByTagNameNS(b,this.gmlns,"upperCorner");if(g.length>0){var h=[];if(g.length>0){a=g[0].firstChild.nodeValue;a=a.replace(this.regExes.trimSpace,"");h=a.split(this.regExes.splitSpace)}if(h.length==2){h[2]=null}if(this.xy){var j=new OpenLayers.Geometry.Point(h[0],h[1],h[2])}else{var j=new OpenLayers.Geometry.Point(h[1],h[0],h[2])}}if(d&&j){e.push(new OpenLayers.Geometry.Point(d.x,d.y));e.push(new OpenLayers.Geometry.Point(j.x,d.y));e.push(new OpenLayers.Geometry.Point(j.x,j.y));e.push(new OpenLayers.Geometry.Point(d.x,j.y));e.push(new OpenLayers.Geometry.Point(d.x,d.y));var c=new OpenLayers.Geometry.LinearRing(e);f=new OpenLayers.Geometry.Polygon([c])}return f},box:function(e){var c=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");var b;var f,a=null,d=null;if(c.length>0){b=c[0].firstChild.nodeValue;f=b.split(" ");if(f.length==2){a=f[0].split(",");d=f[1].split(",")}}if(a!==null&&d!==null){return new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(d[0]),parseFloat(d[1]))}}},parseAttributes:function(e){var f={};var a=e.firstChild;var d,g,c,k,j,b,h;while(a){if(a.nodeType==1){d=a.childNodes;for(g=0;g<d.length;++g){c=d[g];if(c.nodeType==1){k=c.childNodes;if(k.length==1){j=k[0];if(j.nodeType==3||j.nodeType==4){b=(c.prefix)?c.nodeName.split(":")[1]:c.nodeName;h=j.nodeValue.replace(this.regExes.trimSpace,"");f[b]=h}}else{f[c.nodeName.split(":").pop()]=null}}}break}a=a.nextSibling}return f},write:function(c){if(!(c instanceof Array)){c=[c]}var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);for(var a=0;a<c.length;a++){b.appendChild(this.createFeatureXML(c[a]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(k){var h=k.geometry;var e=this.buildGeometryNode(h);var j=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);j.appendChild(e);var a=this.createElementNS(this.gmlns,"gml:"+this.featureName);var l=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);var c=k.fid||k.id;l.setAttribute("fid",c);l.appendChild(j);for(var g in k.attributes){var f=this.createTextNode(k.attributes[g]);var d=g.substring(g.lastIndexOf(":")+1);var b=this.createElementNS(this.featureNS,this.featurePrefix+":"+d);b.appendChild(f);l.appendChild(b)}a.appendChild(l);return a},buildGeometryNode:function(d){if(this.externalProjection&&this.internalProjection){d=d.clone();d.transform(this.internalProjection,this.externalProjection)}var c=d.CLASS_NAME;var b=c.substring(c.lastIndexOf(".")+1);var a=this.buildGeometry[b.toLowerCase()];return a.apply(this,[d])},buildGeometry:{point:function(b){var a=this.createElementNS(this.gmlns,"gml:Point");a.appendChild(this.buildCoordinatesNode(b));return a},multipoint:function(f){var d=this.createElementNS(this.gmlns,"gml:MultiPoint");var c=f.components;var b,e;for(var a=0;a<c.length;a++){b=this.createElementNS(this.gmlns,"gml:pointMember");e=this.buildGeometry.point.apply(this,[c[a]]);b.appendChild(e);d.appendChild(b)}return d},linestring:function(b){var a=this.createElementNS(this.gmlns,"gml:LineString");a.appendChild(this.buildCoordinatesNode(b));return a},multilinestring:function(f){var d=this.createElementNS(this.gmlns,"gml:MultiLineString");var a=f.components;var c,e;for(var b=0;b<a.length;++b){c=this.createElementNS(this.gmlns,"gml:lineStringMember");e=this.buildGeometry.linestring.apply(this,[a[b]]);c.appendChild(e);d.appendChild(c)}return d},linearring:function(b){var a=this.createElementNS(this.gmlns,"gml:LinearRing");a.appendChild(this.buildCoordinatesNode(b));return a},polygon:function(g){var d=this.createElementNS(this.gmlns,"gml:Polygon");var f=g.components;var c,e,b;for(var a=0;a<f.length;++a){b=(a==0)?"outerBoundaryIs":"innerBoundaryIs";c=this.createElementNS(this.gmlns,"gml:"+b);e=this.buildGeometry.linearring.apply(this,[f[a]]);c.appendChild(e);d.appendChild(c)}return d},multipolygon:function(f){var d=this.createElementNS(this.gmlns,"gml:MultiPolygon");var a=f.components;var e,b;for(var c=0;c<a.length;++c){e=this.createElementNS(this.gmlns,"gml:polygonMember");b=this.buildGeometry.polygon.apply(this,[a[c]]);e.appendChild(b);d.appendChild(e)}return d},bounds:function(b){var a=this.createElementNS(this.gmlns,"gml:Box");a.appendChild(this.buildCoordinatesNode(b));return a}},buildCoordinatesNode:function(f){var a=this.createElementNS(this.gmlns,"gml:coordinates");a.setAttribute("decimal",".");a.setAttribute("cs",",");a.setAttribute("ts"," ");var e=[];if(f instanceof OpenLayers.Bounds){e.push(f.left+","+f.bottom);e.push(f.right+","+f.top)}else{var c=(f.components)?f.components:[f];for(var b=0;b<c.length;b++){e.push(c[b].x+","+c[b].y)}}var d=this.createTextNode(e.join(" "));a.appendChild(d);return a},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,initialize:function(a){OpenLayers.Format.JSON.prototype.initialize.apply(this,[a])},read:function(j,g,a){g=(g)?g:"FeatureCollection";var d=null;var c=null;if(typeof j=="string"){c=OpenLayers.Format.JSON.prototype.read.apply(this,[j,a])}else{c=j}if(!c){OpenLayers.Console.error("Bad JSON: "+j)}else{if(typeof(c.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+j)}else{if(this.isValidType(c,g)){switch(g){case"Geometry":try{d=this.parseGeometry(c)}catch(b){OpenLayers.Console.error(b)}break;case"Feature":try{d=this.parseFeature(c);d.type="Feature"}catch(b){OpenLayers.Console.error(b)}break;case"FeatureCollection":d=[];switch(c.type){case"Feature":try{d.push(this.parseFeature(c))}catch(b){d=null;OpenLayers.Console.error(b)}break;case"FeatureCollection":for(var e=0,f=c.features.length;e<f;++e){try{d.push(this.parseFeature(c.features[e]))}catch(b){d=null;OpenLayers.Console.error(b)}}break;default:try{var h=this.parseGeometry(c);d.push(new OpenLayers.Feature.Vector(h))}catch(b){d=null;OpenLayers.Console.error(b)}}break}}}}return d},isValidType:function(c,a){var b=false;switch(a){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],c.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+c.type)}else{b=true}break;case"FeatureCollection":b=true;break;default:if(c.type==a){b=true}else{OpenLayers.Console.error("Cannot convert types from "+c.type+" to "+a)}}return b},parseFeature:function(d){var b,f,a,e;a=(d.properties)?d.properties:{};e=(d.geometry&&d.geometry.bbox)||d.bbox;try{f=this.parseGeometry(d.geometry)}catch(c){throw c}b=new OpenLayers.Feature.Vector(f,a);if(e){b.bounds=OpenLayers.Bounds.fromArray(e)}if(d.id){b.fid=d.id}return b},parseGeometry:function(e){if(e==null){return null}var g,f=false;if(e.type=="GeometryCollection"){if(!(e.geometries instanceof Array)){throw"GeometryCollection must have geometries array: "+e}var b=e.geometries.length;var d=new Array(b);for(var a=0;a<b;++a){d[a]=this.parseGeometry.apply(this,[e.geometries[a]])}g=new OpenLayers.Geometry.Collection(d);f=true}else{if(!(e.coordinates instanceof Array)){throw"Geometry must have coordinates array: "+e}if(!this.parseCoords[e.type.toLowerCase()]){throw"Unsupported geometry type: "+e.type}try{g=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(c){throw c}}if(this.internalProjection&&this.externalProjection&&!f){g.transform(this.externalProjection,this.internalProjection)}return g},parseCoords:{point:function(a){if(this.ignoreExtraDims==false&&a.length!=2){throw"Only 2D points are supported: "+a}return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(f){var c=[];var e=null;for(var b=0,a=f.length;b<a;++b){try{e=this.parseCoords.point.apply(this,[f[b]])}catch(d){throw d}c.push(e)}return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(f){var c=[];var e=null;for(var b=0,a=f.length;b<a;++b){try{e=this.parseCoords.point.apply(this,[f[b]])}catch(d){throw d}c.push(e)}return new OpenLayers.Geometry.LineString(c)},multilinestring:function(f){var c=[];var b=null;for(var d=0,a=f.length;d<a;++d){try{b=this.parseCoords.linestring.apply(this,[f[d]])}catch(e){throw e}c.push(b)}return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(g){var f=[];var e,b;for(var c=0,a=g.length;c<a;++c){try{b=this.parseCoords.linestring.apply(this,[g[c]])}catch(d){throw d}e=new OpenLayers.Geometry.LinearRing(b.components);f.push(e)}return new OpenLayers.Geometry.Polygon(f)},multipolygon:function(f){var b=[];var e=null;for(var c=0,a=f.length;c<a;++c){try{e=this.parseCoords.polygon.apply(this,[f[c]])}catch(d){throw d}b.push(e)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(a.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(e,d){var a={type:null};if(e instanceof Array){a.type="FeatureCollection";var g=e.length;a.features=new Array(g);for(var c=0;c<g;++c){var b=e[c];if(!b instanceof OpenLayers.Feature.Vector){var f="FeatureCollection only supports collections of features: "+b;throw f}a.features[c]=this.extract.feature.apply(this,[b])}}else{if(e.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){a=this.extract.geometry.apply(this,[e])}else{if(e instanceof OpenLayers.Feature.Vector){a=this.extract.feature.apply(this,[e]);if(e.layer&&e.layer.projection){a.crs=this.createCRSObject(e)}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[a,d])},createCRSObject:function(b){var c=b.layer.projection.toString();var a={};if(c.match(/epsg:/i)){var d=parseInt(c.substring(c.indexOf(":")+1));if(d==4326){a={type:"OGC",properties:{urn:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{a={type:"EPSG",properties:{code:d}}}}return a},extract:{feature:function(b){var a=this.extract.geometry.apply(this,[b.geometry]);return{type:"Feature",id:b.fid==null?b.id:b.fid,properties:b.attributes,geometry:a}},geometry:function(d){if(d==null){return null}if(this.internalProjection&&this.externalProjection){d=d.clone();d.transform(this.internalProjection,this.externalProjection)}var a=d.CLASS_NAME.split(".")[2];var c=this.extract[a.toLowerCase()].apply(this,[d]);var b;if(a=="Collection"){b={type:"GeometryCollection",geometries:c}}else{b={type:a,coordinates:c}}return b},point:function(a){return[a.x,a.y]},multipoint:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push(this.extract.point.apply(this,[c.components[b]]))}return d},linestring:function(b){var d=[];for(var c=0,a=b.components.length;c<a;++c){d.push(this.extract.point.apply(this,[b.components[c]]))}return d},multilinestring:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push(this.extract.linestring.apply(this,[c.components[b]]))}return d},polygon:function(c){var d=[];for(var b=0,a=c.components.length;b<a;++b){d.push(this.extract.linestring.apply(this,[c.components[b]]))}return d},multipolygon:function(d){var c=[];for(var b=0,a=d.components.length;b<a;++b){c.push(this.extract.polygon.apply(this,[d.components[b]]))}return c},collection:function(c){var a=c.components.length;var d=new Array(a);for(var b=0;b<a;++b){d[b]=this.extract.geometry.apply(this,[c.components[b]])}return d}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(c){var b=new OpenLayers.Format.ArcXML();var a=b.read(c);return a.features.feature}});if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.setGeometryTypes();if(a&&a.featureNS){this.setNamespace("feature",a.featureNS)}this.singleFeatureType=!a||(typeof a.featureType==="string")},read:function(e){if(typeof e=="string"){e=OpenLayers.Format.XML.prototype.read.apply(this,[e])}if(e&&e.nodeType==9){e=e.documentElement}var c=[];this.readNode(e,{features:c});if(c.length==0){var d=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(d.length){for(var b=0,a=d.length;b<a;++b){this.readNode(d[b],{features:c})}}else{var d=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");if(d.length){this.readNode(d[0],{features:c})}}}return c},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(b,c){var a={};this.readChildNodes(b,a);if(a.components&&a.components.length>0){c.bounds=a.components[0]}},Point:function(b,a){var c={points:[]};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(c.points[0])},coordinates:function(e,g){var h=this.getChildValue(e).replace(this.regExes.trimSpace,"");h=h.replace(this.regExes.trimComma,",");var a=h.split(this.regExes.splitSpace);var f;var d=a.length;var c=new Array(d);for(var b=0;b<d;++b){f=a[b].split(",");if(this.xy){c[b]=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}else{c[b]=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}}g.points=c},coord:function(a,b){var c={};this.readChildNodes(a,c);if(!b.points){b.points=[]}b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(b,a){var c={};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(b,a){var c={outer:null,inner:[]};this.readChildNodes(b,c);c.inner.unshift(c.outer);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(b,c){var a={};this.readChildNodes(b,a);c.components=[new OpenLayers.Geometry.LinearRing(a.points)]},MultiPolygon:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(b,a){var c={components:[]};this.readChildNodes(b,c);a.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(c,d){var a;var b=c.localName||c.nodeName.split(":").pop();if(d.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,b)!==-1)){a="_typeName"}else{if(b===this.featureType){a="_typeName"}}}else{if(c.childNodes.length==0||(c.childNodes.length==1&&c.firstChild.nodeType==3)){if(this.extractAttributes){a="_attribute"}}else{a="_geometry"}}if(a){this.readers.feature[a].apply(this,[c,d])}},_typeName:function(c,d){var a={components:[],attributes:{}};this.readChildNodes(c,a);if(a.name){a.attributes.name=a.name}var b=new OpenLayers.Feature.Vector(a.components[0],a.attributes);if(!this.singleFeatureType){b.type=c.nodeName.split(":").pop();b.namespace=c.namespaceURI}var e=c.getAttribute("fid")||this.getAttributeNS(c,this.namespaces.gml,"id");if(e){b.fid=e}if(this.internalProjection&&this.externalProjection&&b.geometry){b.geometry.transform(this.externalProjection,this.internalProjection)}if(a.bounds){b.bounds=a.bounds}d.features.push(b)},_geometry:function(a,b){this.readChildNodes(a,b)},_attribute:function(b,d){var a=b.localName||b.nodeName.split(":").pop();var c=this.getChildValue(b);d.attributes[a]=c}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(c){var b;if(c instanceof Array){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",a,b);return b},MultiPoint:function(c){var b=this.createElementNSPlus("gml:MultiPoint");for(var a=0;a<c.components.length;++a){this.writeNode("pointMember",c.components[a],b)}return b},pointMember:function(b){var a=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",b,a);return a},MultiLineString:function(c){var b=this.createElementNSPlus("gml:MultiLineString");for(var a=0;a<c.components.length;++a){this.writeNode("lineStringMember",c.components[a],b)}return b},lineStringMember:function(b){var a=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",b,a);return a},MultiPolygon:function(c){var b=this.createElementNSPlus("gml:MultiPolygon");for(var a=0;a<c.components.length;++a){this.writeNode("polygonMember",c.components[a],b)}return b},polygonMember:function(b){var a=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",b,a);return a},GeometryCollection:function(d){var c=this.createElementNSPlus("gml:GeometryCollection");for(var b=0,a=d.components.length;b<a;++b){this.writeNode("geometryMember",d.components[b],c)}return c},geometryMember:function(b){var a=this.createElementNSPlus("gml:geometryMember");var c=this.writeNode("feature:_geometry",b);a.appendChild(c.firstChild);return a}},feature:{_typeName:function(b){var c=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:b.fid}});if(b.geometry){this.writeNode("feature:_geometry",b.geometry,c)}for(var a in b.attributes){var d=b.attributes[a];if(d!=null){this.writeNode("feature:_attribute",{name:a,value:d},c)}}return c},_geometry:function(c){if(this.externalProjection&&this.internalProjection){c=c.clone().transform(this.internalProjection,this.externalProjection)}var b=this.createElementNSPlus("feature:"+this.geometryName);var a=this.geometryTypes[c.CLASS_NAME];var d=this.writeNode("gml:"+a,c,b);if(this.srsName){d.setAttribute("srsName",this.srsName)}return b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(c){var d=this.createElementNSPlus("wfs:FeatureCollection");for(var b=0,a=c.length;b<a;++b){this.writeNode("gml:featureMember",c[b],d)}return d}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]);this.layer=b;if(this.layer.featureNS){this.featureNS=this.layer.featureNS}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column}if(this.layer.options.typename){this.featureName=this.layer.options.typename}},write:function(b){var c=this.createElementNS(this.wfsns,"wfs:Transaction");c.setAttribute("version","1.0.0");c.setAttribute("service","WFS");for(var a=0;a<b.length;a++){switch(b[a].state){case OpenLayers.State.INSERT:c.appendChild(this.insert(b[a]));break;case OpenLayers.State.UPDATE:c.appendChild(this.update(b[a]));break;case OpenLayers.State.DELETE:c.appendChild(this.remove(b[a]));break}}return OpenLayers.Format.XML.prototype.write.apply(this,[c])},createFeatureXML:function(f){var c=this.buildGeometryNode(f.geometry);var g=this.createElementNS(this.featureNS,"feature:"+this.geometryName);g.appendChild(c);var b=this.createElementNS(this.featureNS,"feature:"+this.featureName);b.appendChild(g);for(var a in f.attributes){var h=this.createTextNode(f.attributes[a]);var d=a;if(a.search(":")!=-1){d=a.split(":")[1]}var e=this.createElementNS(this.featureNS,"feature:"+d);e.appendChild(h);b.appendChild(e)}return b},insert:function(b){var a=this.createElementNS(this.wfsns,"wfs:Insert");a.appendChild(this.createFeatureXML(b));return a},update:function(k){if(!k.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"))}var f=this.createElementNS(this.wfsns,"wfs:Update");f.setAttribute("typeName",this.featurePrefix+":"+this.featureName);f.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var h=this.createElementNS(this.wfsns,"wfs:Property");var a=this.createElementNS(this.wfsns,"wfs:Name");var c=this.createTextNode(this.geometryName);a.appendChild(c);h.appendChild(a);var j=this.createElementNS(this.wfsns,"wfs:Value");var d=this.buildGeometryNode(k.geometry);if(k.layer){d.setAttribute("srsName",k.layer.projection.getCode())}j.appendChild(d);h.appendChild(j);f.appendChild(h);for(var e in k.attributes){h=this.createElementNS(this.wfsns,"wfs:Property");a=this.createElementNS(this.wfsns,"wfs:Name");a.appendChild(this.createTextNode(e));h.appendChild(a);j=this.createElementNS(this.wfsns,"wfs:Value");j.appendChild(this.createTextNode(k.attributes[e]));h.appendChild(j);f.appendChild(h)}var g=this.createElementNS(this.ogcns,"ogc:Filter");var b=this.createElementNS(this.ogcns,"ogc:FeatureId");b.setAttribute("fid",k.fid);g.appendChild(b);f.appendChild(g);return f},remove:function(b){if(!b.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"));return false}var a=this.createElementNS(this.wfsns,"wfs:Delete");a.setAttribute("typeName",this.featurePrefix+":"+this.featureName);a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter");var d=this.createElementNS(this.ogcns,"ogc:FeatureId");d.setAttribute("fid",b.fid);c.appendChild(d);a.appendChild(c);return a},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"});OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},tileSize:null,featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:true,name:"ArcIMS",isBaseLayer:true,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:true,async:true,name:"ArcIMS"},initialize:function(c,b,a){this.tileSize=new OpenLayers.Size(512,512);this.params=OpenLayers.Util.applyDefaults({ServiceName:a.serviceName},this.DEFAULT_PARAMS);this.options=OpenLayers.Util.applyDefaults(a,this.DEFAULT_OPTIONS);OpenLayers.Layer.Grid.prototype.initialize.apply(this,[c,b,this.params,a]);if(this.transparent){if(!this.isBaseLayer){this.isBaseLayer=false}if(this.format=="image/jpeg"){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}if(this.options.layers===null){this.options.layers=[]}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},getURL:function(d){var a="";d=this.adjustBounds(d);var c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:d.toArray(),tileSize:this.tileSize}));var b=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:false});if(b!=null){var f=b.responseXML;if(!f||!f.documentElement){f=b.responseText}var e=new OpenLayers.Format.ArcXML();var g=e.read(f);a=this.getUrlOrImage(g.image.output)}return a},getURLasync:function(c,a,e,d){c=this.adjustBounds(c);var b=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:c.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:true,data:b.write(),callback:function(f){var h=f.responseXML;if(!h||!h.documentElement){h=f.responseText}var g=new OpenLayers.Format.ArcXML();var j=g.read(h);a[e]=this.getUrlOrImage(j.image.output);d.apply(a)},scope:this})},getUrlOrImage:function(a){var b="";if(a.url){b=a.url}else{if(a.data){b="data:image/"+a.type+";base64,"+a.data}}return b},setLayerQuery:function(c,a){for(var b=0;b<this.options.layers.length;b++){if(c==this.options.layers[b].id){this.options.layers[b].query=a;return}}this.options.layers.push({id:c,visible:true,query:a})},getFeatureInfo:function(h,f,l){var b=l.buffer||1;var j=l.callback||function(){};var k=l.scope||window;var a={};OpenLayers.Util.extend(a,this.options);a.requesttype="feature";if(h instanceof OpenLayers.LonLat){a.polygon=null;a.envelope=[h.lon-b,h.lat-b,h.lon+b,h.lat+b]}else{if(h instanceof OpenLayers.Geometry.Polygon){a.envelope=null;a.polygon=h}}var e=new OpenLayers.Format.ArcXML(a);OpenLayers.Util.extend(e.request.get_feature,l);e.request.get_feature.layer=f.id;if(typeof f.query.accuracy=="number"){e.request.get_feature.query.accuracy=f.query.accuracy}else{var g=this.map.getCenter();var d=this.map.getViewPortPxFromLonLat(g);d.x++;var c=this.map.getLonLatFromPixel(d);e.request.get_feature.query.accuracy=c.lon-g.lon}e.request.get_feature.query.where=f.query.where;e.request.get_feature.query.spatialfilter.relation="area_intersection";OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:e.write(),callback:function(o){var m=e.parseResponse(o.responseText);if(!e.iserror()){j.call(k,m.features)}else{j.call(k,null)}}})},clone:function(a){if(a==null){a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())}a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]);return a},addTile:function(b,a){return new OpenLayers.Tile.Image(this,a,b,null,this.tileSize)},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},innerBoundaryIs:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},Box:function(d,b){var e={};this.readChildNodes(d,e);if(!b.components){b.components=[]}var c=e.points[0];var a=e.points[1];b.components.push(new OpenLayers.Bounds(c.x,c.y,a.x,a.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var b;if(c instanceof Array){b="wfs:FeatureCollection"}else{b="gml:featureMember"}var a=this.writeNode(b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[b],a);return a},coordinates:function(d){var c=d.length;var e=new Array(c);var a;for(var b=0;b<c;++b){a=d[b];if(this.xy){e[b]=a.x+","+a.y}else{e[b]=a.y+","+a.x}if(a.z!=undefined){e[b]+=","+a.z}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(c==1)?e[0]:e.join(" ")})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",b.components,a);return a},Polygon:function(c){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",c.components[0],b);for(var a=1;a<c.components.length;++a){this.writeNode("innerBoundaryIs",c.components[a],b)}return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",a,b);return b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",a.components,b);return b},Box:function(b){var a=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:b.left,y:b.bottom},{x:b.right,y:b.top}],a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(b,a){var c={points:[]};this.readChildNodes(b,c);if(!a.components){a.components=[]}a.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(b,a){var c={};this.readChildNodes(b,c);if(c.points){Array.prototype.push.apply(a.points,c.points)}},pos:function(b,d){var e=this.getChildValue(b).replace(this.regExes.trimSpace,"");var c=e.split(this.regExes.splitSpace);var a;if(this.xy){a=new OpenLayers.Geometry.Point(c[0],c[1],c[2])}else{a=new OpenLayers.Geometry.Point(c[1],c[0],c[2])}d.points=[a]},posList:function(a,d){var h=this.getChildValue(a).replace(this.regExes.trimSpace,"");var m=h.split(this.regExes.splitSpace);var e=parseInt(a.getAttribute("dimension"))||2;var b,o,l,g;var k=m.length/e;var p=new Array(k);for(var c=0,f=m.length;c<f;c+=e){o=m[c];l=m[c+1];g=(e==2)?undefined:m[c+2];if(this.xy){p[c/e]=new OpenLayers.Geometry.Point(o,l,g)}else{p[c/e]=new OpenLayers.Geometry.Point(l,o,g)}}d.points=p},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(b,a){var c={};this.readChildNodes(b,c);a.outer=c.components[0]},interior:function(b,a){var c={};this.readChildNodes(b,c);a.inner.push(c.components[0])},MultiCurve:function(b,a){var c={components:[]};this.readChildNodes(b,c);if(c.components.length>0){a.components=[new OpenLayers.Geometry.MultiLineString(c.components)]}},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(b,a){var c={components:[]};this.readChildNodes(b,c);if(c.components.length>0){a.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]}},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(d,b){var e={points:new Array(2)};this.readChildNodes(d,e);if(!b.components){b.components=[]}var c=e.points[0];var a=e.points[1];b.components.push(new OpenLayers.Bounds(c.x,c.y,a.x,a.y))},lowerCorner:function(b,a){var c={};this.readers.gml.pos.apply(this,[b,c]);a.points[0]=c.points[0]},upperCorner:function(b,a){var c={};this.readers.gml.pos.apply(this,[b,c]);a.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(c){var b;if(c instanceof Array){b="featureMembers"}else{b="featureMember"}var a=this.writeNode("gml:"+b,c);this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(c){var d=this.createElementNSPlus("gml:featureMembers");for(var b=0,a=c.length;b<a;++b){this.writeNode("feature:_typeName",c[b],d)}return d},Point:function(b){var a=this.createElementNSPlus("gml:Point");this.writeNode("pos",b,a);return a},pos:function(a){var b=(this.xy)?(a.x+" "+a.y):(a.y+" "+a.x);return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(b){var a=this.createElementNSPlus("gml:LineString");this.writeNode("posList",b.components,a);return a},Curve:function(b){var a=this.createElementNSPlus("gml:Curve");this.writeNode("segments",b,a);return a},segments:function(b){var a=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",b,a);return a},LineStringSegment:function(b){var a=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",b.components,a);return a},posList:function(d){var b=d.length;var e=new Array(b);var a;for(var c=0;c<b;++c){a=d[c];if(this.xy){e[c]=a.x+" "+a.y}else{e[c]=a.y+" "+a.x}}return this.createElementNSPlus("gml:posList",{value:e.join(" ")})},Surface:function(b){var a=this.createElementNSPlus("gml:Surface");this.writeNode("patches",b,a);return a},patches:function(b){var a=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",b,a);return a},PolygonPatch:function(d){var c=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",d.components[0],c);for(var b=1,a=d.components.length;b<a;++b){this.writeNode("interior",d.components[b],c)}return c},Polygon:function(d){var c=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",d.components[0],c);for(var b=1,a=d.components.length;b<a;++b){this.writeNode("interior",d.components[b],c)}return c},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",a,b);return b},interior:function(a){var b=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",a,b);return b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",a.components,b);return b},MultiCurve:function(d){var c=this.createElementNSPlus("gml:MultiCurve");for(var b=0,a=d.components.length;b<a;++b){this.writeNode("curveMember",d.components[b],c)}return c},curveMember:function(b){var a=this.createElementNSPlus("gml:curveMember");if(this.curve){this.writeNode("Curve",b,a)}else{this.writeNode("LineString",b,a)}return a},MultiSurface:function(d){var c=this.createElementNSPlus("gml:MultiSurface");for(var b=0,a=d.components.length;b<a;++b){this.writeNode("surfaceMember",d.components[b],c)}return c},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");if(this.surface){this.writeNode("Surface",a,b)}else{this.writeNode("Polygon",a,b)}return b},Envelope:function(b){var a=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",b,a);this.writeNode("upperCorner",b,a);if(this.srsName){a.setAttribute("srsName",this.srsName)}return a},lowerCorner:function(a){var b=(this.xy)?(a.left+" "+a.bottom):(a.bottom+" "+a.left);return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=(this.xy)?(a.right+" "+a.top):(a.top+" "+a.right);return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:false,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}return this.parseFeatures(a)},write:function(c){var d;if(c instanceof Array){d=this.createElementNSPlus("atom:feed");d.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var a=0,b=c.length;a<b;a++){d.appendChild(this.buildEntryNode(c[a]))}}else{d=this.buildEntryNode(c)}return OpenLayers.Format.XML.prototype.write.apply(this,[d])},buildContentNode:function(b){var a=this.createElementNSPlus("atom:content",{attributes:{type:b.type||null}});if(b.src){a.setAttribute("src",b.src)}else{if(b.type=="text"||b.type==null){a.appendChild(this.createTextNode(b.value))}else{if(b.type=="html"){if(typeof b.value!="string"){throw"HTML content must be in form of an escaped string"}a.appendChild(this.createTextNode(b.value))}else{if(b.type=="xhtml"){a.appendChild(b.value)}else{if(b.type=="xhtml"||b.type.match(/(\+|\/)xml$/)){a.appendChild(b.value)}else{a.appendChild(this.createTextNode(b.value))}}}}}return a},buildEntryNode:function(o){var c=o.attributes;var j=c.atom||{};var k=this.createElementNSPlus("atom:entry");if(j.authors){var h=j.authors instanceof Array?j.authors:[j.authors];for(var d=0,m=h.length;d<m;d++){k.appendChild(this.buildPersonConstructNode("author",h[d]))}}if(j.categories){var e=j.categories instanceof Array?j.categories:[j.categories];var a;for(var d=0,m=e.length;d<m;d++){a=e[d];k.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:a.term,scheme:a.scheme||null,label:a.label||null}}))}}if(j.content){k.appendChild(this.buildContentNode(j.content))}if(j.contributors){var f=j.contributors instanceof Array?j.contributors:[j.contributors];for(var d=0,m=f.length;d<m;d++){k.appendChild(this.buildPersonConstructNode("contributor",f[d]))}}if(o.fid){k.appendChild(this.createElementNSPlus("atom:id",{value:o.fid}))}if(j.links){var l=j.links instanceof Array?j.links:[j.links];var g;for(var d=0,m=l.length;d<m;d++){g=l[d];k.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:g.href,rel:g.rel||null,type:g.type||null,hreflang:g.hreflang||null,title:g.title||null,length:g.length||null}}))}}if(j.published){k.appendChild(this.createElementNSPlus("atom:published",{value:j.published}))}if(j.rights){k.appendChild(this.createElementNSPlus("atom:rights",{value:j.rights}))}if(j.summary||c.description){k.appendChild(this.createElementNSPlus("atom:summary",{value:j.summary||c.description}))}k.appendChild(this.createElementNSPlus("atom:title",{value:j.title||c.title||this.defaultEntryTitle}));if(j.updated){k.appendChild(this.createElementNSPlus("atom:updated",{value:j.updated}))}if(o.geometry){var b=this.createElementNSPlus("georss:where");b.appendChild(this.buildGeometryNode(o.geometry));k.appendChild(b)}return k},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(b){if(!this.gmlParser){this.initGmlParser()}var a=this.gmlParser.writeNode("feature:_geometry",b);return a.firstChild},buildPersonConstructNode:function(b,f){var d=["uri","email"];var a=this.createElementNSPlus("atom:"+b);a.appendChild(this.createElementNSPlus("atom:name",{value:f.name}));for(var c=0,e=d.length;c<e;c++){if(f[d[c]]){a.appendChild(this.createElementNSPlus("atom:"+d[c],{value:f[d[c]]}))}}return a},getFirstChildValue:function(d,b,c,f){var e;var a=this.getElementsByTagNameNS(d,b,c);if(a&&a.length>0){e=this.getChildValue(a[0],f)}else{e=f}return e},parseFeature:function(d){var m={};var o=null;var a=null;var k=null;var b=this.namespaces.atom;this.parsePersonConstructs(d,"author",m);a=this.getElementsByTagNameNS(d,b,"category");if(a.length>0){m.categories=[]}for(var g=0,p=a.length;g<p;g++){o={};o.term=a[g].getAttribute("term");k=a[g].getAttribute("scheme");if(k){o.scheme=k}k=a[g].getAttribute("label");if(k){o.label=k}m.categories.push(o)}a=this.getElementsByTagNameNS(d,b,"content");if(a.length>0){o={};k=a[0].getAttribute("type");if(k){o.type=k}k=a[0].getAttribute("src");if(k){o.src=k}else{if(o.type=="text"||o.type=="html"||o.type==null){o.value=this.getFirstChildValue(d,b,"content",null)}else{if(o.type=="xhtml"||o.type.match(/(\+|\/)xml$/)){o.value=this.getChildEl(a[0])}else{o.value=this.getFirstChildValue(d,b,"content",null)}}m.content=o}}this.parsePersonConstructs(d,"contributor",m);m.id=this.getFirstChildValue(d,b,"id",null);a=this.getElementsByTagNameNS(d,b,"link");if(a.length>0){m.links=new Array(a.length)}var c=["rel","type","hreflang","title","length"];for(var g=0,p=a.length;g<p;g++){o={};o.href=a[g].getAttribute("href");for(var e=0,h=c.length;e<h;e++){k=a[g].getAttribute(c[e]);if(k){o[c[e]]=k}}m.links[g]=o}o=this.getFirstChildValue(d,b,"published",null);if(o){m.published=o}o=this.getFirstChildValue(d,b,"rights",null);if(o){m.rights=o}o=this.getFirstChildValue(d,b,"summary",null);if(o){m.summary=o}m.title=this.getFirstChildValue(d,b,"title",null);m.updated=this.getFirstChildValue(d,b,"updated",null);var f={title:m.title,description:m.summary,atom:m};var l=this.parseLocations(d)[0];var q=new OpenLayers.Feature.Vector(l,f);q.fid=m.id;return q},parseFeatures:function(e){var d=[];var a=this.getElementsByTagNameNS(e,this.namespaces.atom,"entry");if(a.length==0){a=[e]}for(var b=0,c=a.length;b<c;b++){d.push(this.parseFeature(a[b]))}return d},parseLocations:function(c){var a=this.namespaces.georss;var k={components:[]};var f=this.getElementsByTagNameNS(c,a,"where");if(f&&f.length>0){if(!this.gmlParser){this.initGmlParser()}for(var e=0,r=f.length;e<r;e++){this.gmlParser.readChildNodes(f[e],k)}}var h=k.components;var o=this.getElementsByTagNameNS(c,a,"point");if(o&&o.length>0){for(var e=0,r=o.length;e<r;e++){var t=OpenLayers.String.trim(o[e].firstChild.nodeValue).split(/\s+/);if(t.length!=2){t=OpenLayers.String.trim(o[e].firstChild.nodeValue).split(/\s*,\s*/)}h.push(new OpenLayers.Geometry.Point(parseFloat(t[1]),parseFloat(t[0])))}}var s=this.getElementsByTagNameNS(c,a,"line");if(s&&s.length>0){var m;var b;var q;for(var e=0,r=s.length;e<r;e++){m=OpenLayers.String.trim(s[e].firstChild.nodeValue).split(/\s+/);q=[];for(var d=0,g=m.length;d<g;d+=2){b=new OpenLayers.Geometry.Point(parseFloat(m[d+1]),parseFloat(m[d]));q.push(b)}h.push(new OpenLayers.Geometry.LineString(q))}}var l=this.getElementsByTagNameNS(c,a,"polygon");if(l&&l.length>0){var m;var b;var q;for(var e=0,r=l.length;e<r;e++){m=OpenLayers.String.trim(l[e].firstChild.nodeValue).split(/\s+/);q=[];for(var d=0,g=m.length;d<g;d+=2){b=new OpenLayers.Geometry.Point(parseFloat(m[d+1]),parseFloat(m[d]));q.push(b)}h.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(h)]))}}if(this.internalProjection&&this.externalProjection){for(var e=0,r=h.length;e<r;e++){if(h[e]){h[e].transform(this.externalProjection,this.internalProjection)}}}return h},parsePersonConstructs:function(d,a,g){var m=[];var c=this.namespaces.atom;var b=this.getElementsByTagNameNS(d,c,a);var e=["uri","email"];for(var h=0,p=b.length;h<p;h++){var o={};o.name=this.getFirstChildValue(b[h],c,"name",null);for(var f=0,k=e.length;f<k;f++){var l=this.getFirstChildValue(b[h],c,e[f],null);if(l){o[e[f]]=l}}m.push(o)}if(m.length>0){g[a+"s"]=m}},CLASS_NAME:"OpenLayers.Format.Atom"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsNotEqualTo:function(b,c){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(b,a);c.filters.push(a)},PropertyIsLike:function(d,e){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(d,c);var f=d.getAttribute("wildCard");var b=d.getAttribute("singleChar");var a=d.getAttribute("escape");c.value2regex(f,b,a);e.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var c=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,c);var b=this.writeNode("gml:Box",a.value,c);if(a.projection){b.setAttribute("srsName",a.projection)}return c}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(b,a){var c=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,c);var d;if(b.value instanceof OpenLayers.Geometry){d=this.writeNode("feature:_geometry",b.value).firstChild}else{d=this.writeNode("gml:Box",b.value)}if(b.projection){d.setAttribute("srsName",b.projection)}c.appendChild(d);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(b,d){var c=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsNotEqualTo:function(b,d){var c=b.getAttribute("matchCase");var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(c==="false"||c==="0")});this.readChildNodes(b,a);d.filters.push(a)},PropertyIsLike:function(d,e){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(d,c);var f=d.getAttribute("wildCard");var b=d.getAttribute("singleChar");var a=d.getAttribute("escapeChar");c.value2regex(f,b,a);e.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.value,b);return b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",a,b);this.writeNode("Literal",a.regex2value(),b);return b},BBOX:function(a){var c=this.createElementNSPlus("ogc:BBOX");this.writeNode("PropertyName",a,c);var b=this.writeNode("gml:Envelope",a.value);if(a.projection){b.setAttribute("srsName",a.projection)}c.appendChild(b);return c}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(b,a){var c=this.createElementNSPlus("ogc:"+a);this.writeNode("PropertyName",b,c);var d;if(b.value instanceof OpenLayers.Geometry){d=this.writeNode("feature:_geometry",b.value).firstChild}else{d=this.writeNode("gml:Envelope",b.value)}if(b.projection){d.setAttribute("srsName",b.projection)}c.appendChild(d);return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);this.options=a},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);return a},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={};this.readChildNodes(a,b.timePeriod)},beginPosition:function(b,a){a.beginPosition=this.getChildValue(b)},endPosition:function(b,a){a.endPosition=this.getChildValue(b)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={};this.readChildNodes(a,b.contents)},ObservationOfferingList:function(b,a){a.offeringList={};this.readChildNodes(b,a.offeringList)},ObservationOffering:function(b,a){var c=this.getAttributeNS(b,this.namespaces.gml,"id");a[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};this.readChildNodes(b,a[c])},time:function(a,b){b.time={};this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(f){if(typeof f=="string"){f=OpenLayers.Format.XML.prototype.read.apply(this,[f])}if(f&&f.nodeType==9){f=f.documentElement}var g={features:[]};this.readNode(f,g);var e=[];for(var d=0,a=g.features.length;d<a;d++){var b=g.features[d];if(this.internalProjection&&this.externalProjection&&b.components[0]){b.components[0].transform(this.externalProjection,this.internalProjection)}var c=new OpenLayers.Feature.Vector(b.components[0],b.attributes);e.push(c)}return e},readers:{sa:{SamplingPoint:function(b,c){if(!c.attributes){var a={attributes:{}};c.features.push(a);c=a}c.attributes.id=this.getAttributeNS(b,this.namespaces.gml,"id");this.readChildNodes(b,c)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(b,c){var a={attributes:{}};c.features.push(a);this.readChildNodes(b,a)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){if(!this.externalProjection){this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName"))}OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(b){var d=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}});for(var c=0,a=b.fois.length;c<a;c++){this.writeNode("FeatureOfInterestId",{foi:b.fois[c]},d)}return d},FeatureOfInterestId:function(a){var b=this.createElementNSPlus("FeatureOfInterestId",{value:a.foi});return b}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={measurements:[]};this.readNode(a,b);return b},write:function(a){var b=this.writeNode("sos:GetObservation",a);b.setAttribute("xmlns:om",this.namespaces.om);this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,"id");this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(b,c){var a={};c.measurements.push(a);this.readChildNodes(b,a)},samplingTime:function(b,a){var c={};a.samplingTime=c;this.readChildNodes(b,c)},observedProperty:function(b,a){a.observedProperty=this.getAttributeNS(b,this.namespaces.xlink,"href");this.readChildNodes(b,a)},procedure:function(b,a){a.procedure=this.getAttributeNS(b,this.namespaces.xlink,"href");this.readChildNodes(b,a)},result:function(c,b){var a={};b.result=a;if(this.getChildValue(c)!==""){a.value=this.getChildValue(c);a.uom=c.getAttribute("uom")}else{this.readChildNodes(c,a)}}},gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c;this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",a,b);this.writeNode("eventTime",a,b);this.writeNode("procedure",a,b);this.writeNode("observedProperty",a,b);this.writeNode("responseFormat",a,b);this.writeNode("resultModel",a,b);this.writeNode("responseMode",a,b);return b},responseFormat:function(a){return this.createElementNSPlus("responseFormat",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus("procedure",{value:a.procedure})},offering:function(a){return this.createElementNSPlus("offering",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus("observedProperty",{value:a.observedProperty})},eventTime:function(a){var b=this.createElementNSPlus("eventTime");if(a.eventTime==="latest"){this.writeNode("ogc:TM_Equals",a,b)}return b},resultModel:function(a){return this.createElementNSPlus("resultModel",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus("responseMode",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus("ogc:TM_Equals");this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},b);if(a.eventTime==="latest"){this.writeNode("gml:TimeInstant",{value:"latest"},b)}return b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus("gml:TimeInstant");this.writeNode("gml:timePosition",a,b);return b},timePosition:function(a){var b=this.createElementNSPlus("gml:timePosition",{value:a.value});return b}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"});OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){if(typeof a=="string"){a=OpenLayers.Format.XML.prototype.read.apply(this,[a])}if(a&&a.nodeType==9){a=a.documentElement}var b={};this.readNode(a,b);return b},readers:{csw:{GetRecordsResponse:function(b,c){c.records=[];this.readChildNodes(b,c);var a=this.getAttributeNS(b,"","version");if(a!=""){c.version=a}},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,c){c.SearchStatus={};var b=this.getAttributeNS(a,"","timestamp");if(b!=""){c.SearchStatus.timestamp=b}},SearchResults:function(d,e){this.readChildNodes(d,e);var b=d.attributes;var f={};for(var c=0,a=b.length;c<a;++c){if((b[c].name=="numberOfRecordsMatched")||(b[c].name=="numberOfRecordsReturned")||(b[c].name=="nextRecord")){f[b[c].name]=parseInt(b[c].nodeValue)}else{f[b[c].name]=b[c].nodeValue}}e.SearchResults=f},SummaryRecord:function(b,c){var a={type:"SummaryRecord"};this.readChildNodes(b,a);c.records.push(a)},BriefRecord:function(b,c){var a={type:"BriefRecord"};this.readChildNodes(b,a);c.records.push(a)},DCMIRecord:function(b,c){var a={type:"DCMIRecord"};this.readChildNodes(b,a);c.records.push(a)},Record:function(b,c){var a={type:"Record"};this.readChildNodes(b,a);c.records.push(a)}},dc:{"*":function(f,g){var d=f.localName||f.nodeName.split(":").pop();if(!(g[d] instanceof Array)){g[d]=new Array()}var c={};var b=f.attributes;for(var e=0,a=b.length;e<a;++e){c[b[e].name]=b[e].nodeValue}c.value=this.getChildValue(f);g[d].push(c)}},dct:{"*":function(b,c){var a=b.localName||b.nodeName.split(":").pop();if(!(c[a] instanceof Array)){c[a]=new Array()}c[a].push(this.getChildValue(b))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){if(b.bounds){b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}];delete b.projection;delete b.bounds}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows["BoundingBox"].apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(b){if(!b){b={}}var e=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:b.requestId||this.requestId,resultType:b.resultType||this.resultType,outputFormat:b.outputFormat||this.outputFormat,outputSchema:b.outputSchema||this.outputSchema,startPosition:b.startPosition||this.startPosition,maxRecords:b.maxRecords||this.maxRecords}});if(b.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",b.DistributedSearch||this.DistributedSearch,e)}var d=b.ResponseHandler||this.ResponseHandler;if(d instanceof Array&&d.length>0){for(var c=0,a=d.length;c<a;c++){this.writeNode("csw:ResponseHandler",d[c],e)}}this.writeNode("Query",b.Query||this.Query,e);return e},DistributedSearch:function(a){var b=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}});return b},ResponseHandler:function(a){var b=this.createElementNSPlus("csw:ResponseHandler",{value:a.value});return b},Query:function(b){if(!b){b={}}var e=this.createElementNSPlus("csw:Query",{attributes:{typeNames:b.typeNames||"csw:Record"}});var d=b.ElementName;if(d instanceof Array&&d.length>0){for(var c=0,a=d.length;c<a;c++){this.writeNode("csw:ElementName",d[c],e)}}else{this.writeNode("csw:ElementSetName",b.ElementSetName||{value:"summary"},e)}if(b.Constraint){this.writeNode("csw:Constraint",b.Constraint,e)}return e},ElementName:function(a){var b=this.createElementNSPlus("csw:ElementName",{value:a.value});return b},ElementSetName:function(a){var b=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value});return b},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else{if(a.CqlText){var d=this.createElementNSPlus("CqlText",{value:a.CqlText.value});b.appendChild(d)}}return b}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a])},read:function(c,a){a=OpenLayers.Util.applyDefaults(a,this.options);var b={namedLayers:a.namedLayersAsArray===true?[]:{}};this.readChildNodes(c,b);return b},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version");this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(d,e){var c={userStyles:[],namedStyles:[]};this.readChildNodes(d,c);for(var b=0,a=c.userStyles.length;b<a;++b){c.userStyles[b].layerName=c.name}if(e.namedLayers instanceof Array){e.namedLayers.push(c)}else{e.namedLayers[c.name]=c}},NamedStyle:function(b,a){a.namedStyles.push(this.getChildName(b.firstChild))},UserStyle:function(c,a){var d={defaultsPerSymbolizer:true,rules:[]};this.featureTypeCounter=-1;this.readChildNodes(c,d);var b;if(this.multipleSymbolizers){delete d.defaultsPerSymbolizer;b=new OpenLayers.Style2(d)}else{b=new OpenLayers.Style(this.defaultSymbolizer,d)}a.userStyles.push(b)},IsDefault:function(b,a){if(this.getChildValue(b)=="1"){a.isDefault=true}},FeatureTypeStyle:function(b,a){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?a.rules:[]};this.readChildNodes(b,c);if(!this.multipleSymbolizers){a.rules=c.rules}},Rule:function(b,d){var a;if(this.multipleSymbolizers){a={symbolizers:[]}}var c=new OpenLayers.Rule(a);this.readChildNodes(b,c);d.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=true},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Text(a))}else{c.symbolizer.Text=OpenLayers.Util.applyDefaults(a,c.symbolizer.Text)}},Label:function(b,a){var d={};this.readChildNodes(b,d);if(d.property){a.label="${"+d.property+"}"}else{var c=this.readOgcExpression(b);if(c){a.label=c}}},Font:function(b,a){this.readChildNodes(b,a)},Halo:function(b,a){var c={};this.readChildNodes(b,c);a.haloRadius=c.haloRadius;a.haloColor=c.fillColor;a.haloOpacity=c.fillOpacity},Radius:function(c,b){var a=this.readOgcExpression(c);if(a!=null){b.haloRadius=a}},RasterSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Raster(a))}else{c.symbolizer.Raster=OpenLayers.Util.applyDefaults(a,c.symbolizer.Raster)}},Geometry:function(a,b){b.geometry={};this.readChildNodes(a,b.geometry)},ColorMap:function(b,a){a.colorMap=[];this.readChildNodes(b,a.colorMap)},ColorMapEntry:function(b,a){var c=b.getAttribute("quantity");var d=b.getAttribute("opacity");a.push({color:b.getAttribute("color"),quantity:c!==null?parseFloat(c):undefined,label:b.getAttribute("label")||undefined,opacity:d!==null?parseFloat(d):undefined})},LineSymbolizer:function(b,c){var a={};this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Line(a))}else{c.symbolizer.Line=OpenLayers.Util.applyDefaults(a,c.symbolizer.Line)}},PolygonSymbolizer:function(b,c){var a={fill:false,stroke:false};if(!this.multipleSymbolizers){a=c.symbolizer.Polygon||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Polygon(a))}else{c.symbolizer.Polygon=a}},PointSymbolizer:function(b,c){var a={fill:false,stroke:false,graphic:false};if(!this.multipleSymbolizers){a=c.symbolizer.Point||a}this.readChildNodes(b,a);if(this.multipleSymbolizers){a.zIndex=this.featureTypeCounter;c.symbolizers.push(new OpenLayers.Symbolizer.Point(a))}else{c.symbolizer.Point=a}},Stroke:function(b,a){a.stroke=true;this.readChildNodes(b,a)},Fill:function(b,a){a.fill=true;this.readChildNodes(b,a)},CssParameter:function(c,b){var a=c.getAttribute("name");var e=this.cssMap[a];if(e){var d=this.readOgcExpression(c);if(d){b[e]=d}}},Graphic:function(e,d){d.graphic=true;var h={};this.readChildNodes(e,h);var c=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];var g,f;for(var b=0,a=c.length;b<a;++b){g=c[b];f=h[g];if(f!=undefined){d[g]=f}}if(h.opacity!=undefined){d.graphicOpacity=h.opacity}if(h.size!=undefined){d.pointRadius=h.size/2}if(h.href!=undefined){d.externalGraphic=h.href}if(h.rotation!=undefined){d.rotation=h.rotation}},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(b,c){var a=this.readOgcExpression(b);if(a){c.opacity=a}},Size:function(b,c){var a=this.readOgcExpression(b);if(a){c.size=a}},Rotation:function(b,c){var a=this.readOgcExpression(b);if(a){c.rotation=a}},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap){if(this.cssMap[c]==a){b=c;break}}return b},getGraphicFormat:function(a){var d,c;for(var b in this.graphicFormats){if(this.graphicFormats[b].test(a)){d=b;break}}return d||this.defautlGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(e){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});b.setAttribute("xmlns:ogc",this.namespaces.ogc);b.setAttribute("xmlns:gml",this.namespaces.gml);if(e.name){this.writeNode("Name",e.name,b)}if(e.title){this.writeNode("Title",e.title,b)}if(e.description){this.writeNode("Abstract",e.description,b)}if(e.namedLayers instanceof Array){for(var d=0,a=e.namedLayers.length;d<a;++d){this.writeNode("NamedLayer",e.namedLayers[d],b)}}else{for(var c in e.namedLayers){this.writeNode("NamedLayer",e.namedLayers[c],b)}}return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(c){var d=this.createElementNSPlus("sld:NamedLayer");this.writeNode("Name",c.name,d);if(c.namedStyles){for(var b=0,a=c.namedStyles.length;b<a;++b){this.writeNode("NamedStyle",c.namedStyles[b],d)}}if(c.userStyles){for(var b=0,a=c.userStyles.length;b<a;++b){this.writeNode("UserStyle",c.userStyles[b],d)}}return d},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");this.writeNode("Name",a,b);return b},UserStyle:function(b){var d=this.createElementNSPlus("sld:UserStyle");if(b.name){this.writeNode("Name",b.name,d)}if(b.title){this.writeNode("Title",b.title,d)}if(b.description){this.writeNode("Abstract",b.description,d)}if(b.isDefault){this.writeNode("IsDefault",b.isDefault,d)}if(this.multipleSymbolizers&&b.rules){var m={0:[]};var c=[0];var l,a,q,k,h;for(var f=0,p=b.rules.length;f<p;++f){l=b.rules[f];if(l.symbolizers){a={};for(var e=0,g=l.symbolizers.length;e<g;++e){q=l.symbolizers[e];k=q.zIndex;if(!(k in a)){h=l.clone();h.symbolizers=[];a[k]=h}a[k].symbolizers.push(q.clone())}for(k in a){if(!(k in m)){c.push(k);m[k]=[]}m[k].push(a[k])}}else{m[0].push(l.clone())}}c.sort();var o;for(var f=0,p=c.length;f<p;++f){o=m[c[f]];if(o.length>0){h=b.clone();h.rules=m[c[f]];this.writeNode("FeatureTypeStyle",h,d)}}}else{this.writeNode("FeatureTypeStyle",b,d)}return d},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:(a)?"1":"0"})},FeatureTypeStyle:function(c){var d=this.createElementNSPlus("sld:FeatureTypeStyle");for(var b=0,a=c.rules.length;b<a;++b){this.writeNode("Rule",c.rules[b],d)}return d},Rule:function(h){var g=this.createElementNSPlus("sld:Rule");if(h.name){this.writeNode("Name",h.name,g)}if(h.title){this.writeNode("Title",h.title,g)}if(h.description){this.writeNode("Abstract",h.description,g)}if(h.elseFilter){this.writeNode("ElseFilter",null,g)}else{if(h.filter){this.writeNode("ogc:Filter",h.filter,g)}}if(h.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",h.minScaleDenominator,g)}if(h.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",h.maxScaleDenominator,g)}var f,e;if(this.multipleSymbolizers&&h.symbolizers){var e;for(var c=0,d=h.symbolizers.length;c<d;++c){e=h.symbolizers[c];f=e.CLASS_NAME.split(".").pop();this.writeNode(f+"Symbolizer",e,g)}}else{var b=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var c=0,a=b.length;c<a;++c){f=b[c];e=h.symbolizer[f];if(e){this.writeNode(f+"Symbolizer",e,g)}}}return g},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");this.writeNode("Stroke",a,b);return b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");if(a.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b)}if(a.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b)}if(a.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b)}if(a.strokeDashstyle!=undefined&&a.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b)}if(a.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b)}return b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");if(a.label!=null){this.writeNode("Label",a.label,b)}if(a.fontFamily!=null||a.fontSize!=null||a.fontWeight!=null||a.fontStyle!=null){this.writeNode("Font",a,b)}if(a.haloRadius!=null||a.haloColor!=null||a.haloOpacity!=null){this.writeNode("Halo",a,b)}if(a.fillColor!=null||a.fillOpacity!=null){this.writeNode("Fill",a,b)}return b},Font:function(a){var b=this.createElementNSPlus("sld:Font");if(a.fontFamily){this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b)}if(a.fontSize){this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b)}if(a.fontWeight){this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b)}if(a.fontStyle){this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b)}return b},Label:function(b){var f=this.createElementNSPlus("sld:Label");var g=b.split("${");f.appendChild(this.createTextNode(g[0]));var e,d;for(var c=1,a=g.length;c<a;c++){e=g[c];d=e.indexOf("}");if(d>0){this.writeNode("ogc:PropertyName",{property:e.substring(0,d)},f);f.appendChild(this.createTextNode(e.substring(++d)))}else{f.appendChild(this.createTextNode("${"+e))}}return f},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");if(a.haloRadius){this.writeNode("Radius",a.haloRadius,b)}if(a.haloColor||a.haloOpacity){this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b)}return b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");if(a.geometry){this.writeNode("Geometry",a.geometry,b)}if(a.opacity){this.writeNode("Opacity",a.opacity,b)}if(a.colorMap){this.writeNode("ColorMap",a.colorMap,b)}return b},Geometry:function(b){var a=this.createElementNSPlus("sld:Geometry");if(b.property){this.writeNode("ogc:PropertyName",b,a)}return a},ColorMap:function(b){var d=this.createElementNSPlus("sld:ColorMap");for(var c=0,a=b.length;c<a;++c){this.writeNode("ColorMapEntry",b[c],d)}return d},ColorMapEntry:function(c){var d=this.createElementNSPlus("sld:ColorMapEntry");var b=c;d.setAttribute("color",b.color);b.opacity!==undefined&&d.setAttribute("opacity",parseFloat(b.opacity));b.quantity!==undefined&&d.setAttribute("quantity",parseFloat(b.quantity));b.label!==undefined&&d.setAttribute("label",b.label);return d},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");if(a.fillColor){this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b)}if(a.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b)}return b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");this.writeNode("Graphic",a,b);return b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");if(a.externalGraphic!=undefined){this.writeNode("ExternalGraphic",a,b)}else{this.writeNode("Mark",a,b)}if(a.graphicOpacity!=undefined){this.writeNode("Opacity",a.graphicOpacity,b)}if(a.pointRadius!=undefined){this.writeNode("Size",a.pointRadius*2,b)}if(a.rotation!=undefined){this.writeNode("Rotation",a.rotation,b)}return b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);this.writeNode("Format",c,b);return b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");if(a.graphicName){this.writeNode("WellKnownName",a.graphicName,b)}if(a.fill!==false){this.writeNode("Fill",a,b)}if(a.stroke!==false){this.writeNode("Stroke",a,b)}return b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.createElementNSPlus("sld:Size",{value:a})},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:false,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},InsertResult:function(b,a){var c={fids:[]};this.readChildNodes(b,c);a.insertIds.push(c.fids[0])},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=true}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(b){b=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},b);var d=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b.featureNS?b.featurePrefix+":":"")+b.featureType}});if(b.srsNameInQuery&&b.srsName){d.setAttribute("srsName",b.srsName)}if(b.featureNS){d.setAttribute("xmlns:"+b.featurePrefix,b.featureNS)}if(b.propertyNames){for(var c=0,a=b.propertyNames.length;c<a;c++){this.writeNode("ogc:PropertyName",{property:b.propertyNames[c]},d)}}if(b.filter){this.setFilterProperty(b.filter);this.writeNode("ogc:Filter",b.filter,d)}return d}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs["FeatureCollection"].apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[];b.success=false;this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=true},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(b,a){var c={fids:[]};this.readChildNodes(b,c);a.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs["GetFeature"].apply(this,arguments);a&&a.resultType&&this.setAttributes(b,{resultType:a.resultType});return b},Query:function(b){b=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},b);var d=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b.featureNS?b.featurePrefix+":":"")+b.featureType,srsName:b.srsName}});if(b.featureNS){d.setAttribute("xmlns:"+b.featurePrefix,b.featureNS)}if(b.propertyNames){for(var c=0,a=b.propertyNames.length;c<a;c++){this.writeNode("wfs:PropertyName",{property:b.propertyNames[c]},d)}}if(b.filter){this.setFilterProperty(b.filter);this.writeNode("ogc:Filter",b.filter,d)}return d},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]);if(!a.format){this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions)}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()}this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(b){b=OpenLayers.Util.extend({},b);OpenLayers.Util.applyDefaults(b,this.options||{});var a=new OpenLayers.Protocol.Response({requestType:"read"});var d=this.format;var c=OpenLayers.Format.XML.prototype.write.apply(d,[d.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);a.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleRead,a,b),data:c});return a},handleRead:function(a,b){if(b.callback){var c=a.priv;if(c.status>=200&&c.status<300){a.features=this.parseFeatures(c);a.code=OpenLayers.Protocol.Response.SUCCESS}else{a.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;if(!b||!b.documentElement){b=a.responseText}if(!b||b.length<=0){return null}return this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",initialize:function(a){OpenLayers.Format.SLD.v1.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:true,xy:true,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(b){if(b.layersContext){for(var c=0,a=b.layersContext.length;c<a;c++){var f=b.layersContext[c];var d=[];var e=b.title||"";if(b.metadata&&b.metadata.nestingPath){d=b.metadata.nestingPath.slice()}if(e!=""){d.push(e)}f.metadata.nestingPath=d;if(f.layersContext){this.setNestingPath(f)}}}},decomposeNestingPath:function(c){var b=[];if(c instanceof Array){while(c.length>0){b.push(c.slice());c.pop()}b.reverse()}return b},read:function(b){if(typeof b=="string"){b=OpenLayers.Format.XML.prototype.read.apply(this,[b])}if(b&&b.nodeType==9){b=b.documentElement}var a={};this.readNode(b,a);this.setNestingPath({layersContext:a.layersContext});var c=[];this.processLayer(c,a);delete a.layersContext;a.layersContext=c;return a},processLayer:function(b,e){if(e.layersContext){for(var d=0,a=e.layersContext.length;d<a;d++){var c=e.layersContext[d];b.push(c);if(c.layersContext){this.processLayer(b,c)}}}},write:function(d,c){var b="OWSContext";this.nestingLayerLookup={};c=c||{};OpenLayers.Util.applyDefaults(c,d);var a=this.writeNode(b,c);this.nestingLayerLookup=null;this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[a])},readers:{kml:{Document:function(a,b){b.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:true}).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,c){var b={metadata:{},visibility:(a.getAttribute("hidden")!="1"),queryable:(a.getAttribute("queryable")=="1"),opacity:((a.getAttribute("opacity")!=null)?parseFloat(a.getAttribute("opacity")):null),name:a.getAttribute("name"),categoryLayer:(a.getAttribute("name")==null),formats:[],styles:[]};if(!c.layersContext){c.layersContext=[]}c.layersContext.push(b);this.readChildNodes(a,b)},InlineGeometry:function(b,d){d.features=[];var c=this.getElementsByTagNameNS(b,this.namespaces.gml,"featureMember");var a;if(c.length>=1){a=c[0]}if(a&&a.firstChild){var e=(a.firstChild.nextSibling)?a.firstChild.nextSibling:a.firstChild;this.setNamespace("feature",e.namespaceURI);this.featureType=e.localName||e.nodeName.split(":").pop();this.readChildNodes(b,d)}},Server:function(a,b){if((!b.service&&!b.version)||(b.service!=OpenLayers.Format.Context.serviceTypes.WMS)){b.service=a.getAttribute("service");b.version=a.getAttribute("version");this.readChildNodes(a,b)}},Name:function(a,b){b.name=this.getChildValue(a);this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a);this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},Style:function(b,c){var a={};c.push(a);this.readChildNodes(b,a)},LegendURL:function(b,c){var a={};c.legend=a;this.readChildNodes(b,a)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href");this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});this.writeNode("General",a,b);this.writeNode("ResourceList",a,b);return b},General:function(a){var b=this.createElementNSPlus("General");this.writeNode("ows:BoundingBox",a,b);this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b);return b},ResourceList:function(c){var f=this.createElementNSPlus("ResourceList");for(var e=0,b=c.layers.length;e<b;e++){var d=c.layers[e];var a=this.decomposeNestingPath(d.metadata.nestingPath);this.writeNode("_Layer",{layer:d,subPaths:a},f)}return f},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});this.writeNode("OnlineResource",a,b);return b},OnlineResource:function(a){var b=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}});return b},InlineGeometry:function(c){var d=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",c.getDataExtent(),d);for(var b=0,a=c.features.length;b<a;b++){this.writeNode("gml:featureMember",c.features[b],d)}return d},StyleList:function(d){var c=this.createElementNSPlus("StyleList");for(var b=0,a=d.length;b<a;b++){this.writeNode("Style",d[b],c)}return c},Style:function(a){var b=this.createElementNSPlus("Style");this.writeNode("Name",a,b);this.writeNode("Title",a,b);this.writeNode("LegendURL",a,b);return b},Name:function(b){var a=this.createElementNSPlus("Name",{value:b.name});return a},Title:function(b){var a=this.createElementNSPlus("Title",{value:b.title});return a},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");this.writeNode("OnlineResource",a.legend,b);return b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.opacity?a.opacity:null}});this.writeNode("ows:Title",a.name,b);this.writeNode("ows:OutputFormat",a.params.FORMAT,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url},b);if(a.metadata.styles&&a.metadata.styles.length>0){this.writeNode("StyleList",a.metadata.styles,b)}return b},_Layer:function(b){var c,g,d,f;c=b.layer;g=b.subPaths;d=null;f=null;if(g.length>0){var e=g[0].join("/");var a=e.lastIndexOf("/");d=this.nestingLayerLookup[e];f=(a>0)?e.substring(a+1,e.length):e;if(!d){d=this.createElementNSPlus("Layer");this.writeNode("ows:Title",f,d);this.nestingLayerLookup[e]=d}b.subPaths.shift();this.writeNode("_Layer",b,d);return d}else{if(c instanceof OpenLayers.Layer.WMS){d=this.writeNode("_WMS",c)}else{if(c instanceof OpenLayers.Layer.Vector){if(c.protocol instanceof OpenLayers.Protocol.WFS.v1){d=this.writeNode("_WFS",c)}else{if(c.protocol instanceof OpenLayers.Protocol.HTTP){if(c.protocol.format instanceof OpenLayers.Format.GML){c.protocol.format.version="2.1.2";d=this.writeNode("_GML",c)}else{if(c.protocol.format instanceof OpenLayers.Format.KML){c.protocol.format.version="2.2";d=this.writeNode("_KML",c)}}}else{this.setNamespace("feature",this.featureNS);d=this.writeNode("_InlineGeometry",c)}}}}if(c.options.maxScale){this.writeNode("sld:MinScaleDenominator",c.options.maxScale,d)}if(c.options.minScale){this.writeNode("sld:MaxScaleDenominator",c.options.minScale,d)}this.nestingLayerLookup[c.name]=d;return d}},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url},b);return b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});this.writeNode("ows:Title",a.name,b);this.writeNode("InlineGeometry",a,b);return b},_GML:function(a){var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b);return b},_KML:function(a){var b=this.createElementNSPlus("Layer");this.writeNode("ows:Title",a.name,b);this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b);return b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(b){var a=this.createElementNSPlus("gml:boundedBy");this.writeNode("gml:Box",b,a);return a}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});OpenLayers.Control.ModifiedZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);this.zoomIn=new OpenLayers.Control.ZoomIn();this.zoomToMaxExtent=new OpenLayers.Control.ZoomToMaxExtent(),this.zoomOut=new OpenLayers.Control.ZoomOut();this.addControls([this.zoomIn,this.zoomToMaxExtent,this.zoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});var STIStatic={map:true,mapWidth:"1024px",mapHeight:"580px",mapHeadline:false,timeplot:true,timeplotWidth:"1024px",timeplotHeight:"100px",timeHeadline:false,table:true,tableWidth:"1024px",tableHeight:false,incompleteData:false,inverseFilter:false,maxDatasets:4,mouseWheelZoom:true,popups:true,alternativeMap:{name:"Contemporary Map",url:"/geoserver/wms",layer:"historic:world"},googleMaps:false,bingMaps:false,bingApiKey:"none",osmMaps:true,baseLayer:"Contemporary Map",fractionalZoom:false,resetMap:true,countrySelect:true,polygonSelect:true,circleSelect:true,squareSelect:true,editPolygon:true,multiSelection:true,individualSelection:true,olNavigation:false,olLayerSwitcher:false,olMapOverview:true,olKeyboardDefaults:false,geoLocation:true,connections:false,boundaries:{minLon:-29,minLat:35,maxLon:44,maxLat:67},mapCanvasFrom:"#9db9d8",mapCanvasTo:"#5783b5",labelGrid:true,maxPlaceLabels:6,selectDefault:true,maxLabelIncrease:2,labelHover:false,cloudOpacity:0.85,circleGap:0,minimumRadius:4,classBase:1.5,circleOutline:true,circleTransparency:true,minTransparency:0.4,maxTransparency:0.8,binning:"generic",noBinningRadii:"static",circlePackings:true,binCount:10,showDescriptions:true,mapSelection:true,binningSelection:true,mapSelectionTools:true,dataInformation:true,proxyHost:"",timeZoom:false,timeUnit:-1,featherSlider:false,defaultMinDate:new Date(2012,0,1),defaultMaxDate:new Date(),timeDragAndDrop:true,linearScale:true,validResultsPerPage:[10,20,50,100],initialResultsPerPage:10,tableSorting:true,tableContentOffset:250,tableSelectPage:true,tableSelectAll:false,tableShowSelected:true,designURL:"images/",lightScheme:false,toolbarLeft:false,toolbarWidth:41,toolbarColor:"#DDDDDD",toolbarColor2:"#878380",toolbarBorder:"1px solid #878380",rangeBoxColor:"white",frameColor:"#eebccd",frameColor2:"#cb063a",frameBorder:"1px solid #cb063a",placeLabelStyles:"shadows",shadowSelected:"0 0 0.1em white, 0 0 0.1em white, 0 0 0.1em white, 0 0 0.1em COLOR1",shadowUnselected:"0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em COLOR0",shadowHovered:"0 -1px COLOR1, 1px 0 COLOR1, 0 1px COLOR1, -1px 0 COLOR1",customSelected:"color: COLOR1; font-weight: normal;",customUnselected:"color: COLOR1; font-weight: normal;",customHovered:"color: COLOR1; font-weight: bold;",selectedPlaceStyle:"bold",customSelectedPlace:"",customUnselectedPlace:"",language:"en",defaultZoomPanel:true,colors:[{r1:255,g1:101,b1:0,r0:253,g0:229,b0:205,},{r1:144,g1:26,b1:255,r0:230,g0:225,b0:255,},{r1:0,g1:217,b1:0,r0:213,g0:255,b0:213,},{r1:240,g1:220,b1:0,r0:247,g0:244,b0:197}]};STIStatic.ie8=false;if(SimileAjax.Platform.browser.isIE){if(STIStatic.placeLabelStyles=="shadows"){STIStatic.placeLabelStyles="frames";STIStatic.placeTagStyle="bold"}if(SimileAjax.Platform.browser.majorVersion<9){STIStatic.ie8=true}}STIStatic.configure=function(urlPrefix){STIStatic.urlPrefix=urlPrefix;STIStatic.path=STIStatic.urlPrefix+""+STIStatic.designURL;var textsJson=STIStatic.getJsonFile(urlPrefix+"config/texts.json");STIStatic.texts=eval("("+textsJson+")")};STIStatic.applySettings=function(a){$.extend(this,a)};STIStatic.getString=function(a){if(typeof this.texts[STIStatic.language]=="undefined"){STIStatic.language="en"}return this.texts[STIStatic.language][a]};STIStatic.createToolbar=function(c){var a=document.createElement("dl");a.style.margin="0px";for(i in c){c[i].style.cursor="pointer";c[i].style.marginLeft="auto";c[i].style.marginRight="auto";var b=document.createElement("dt");b.style.textAlign="center";b.appendChild(c[i]);a.appendChild(b)}return a};STIStatic.getMousePosition=function(b){if(!b){b=window.event}var a=(window.document.compatMode&&window.document.compatMode=="CSS1Compat")?window.document.documentElement:window.document.body;return{top:b.pageY?b.pageY:b.clientY,left:b.pageX?b.pageX:b.clientX}};STIStatic.getRadius=function(b,a){if(b==0){return 0}if(b==1){return STIStatic.minimumRadius}return Math.sqrt((STIStatic.minArea+(STIStatic.maxArea-STIStatic.minArea)/(STIStatic.maximumPoints-1)*(b-1))/Math.PI)};STIStatic.getArea=function(a){return Math.PI*a*a};STIStatic.getJsonFile=function(a){var b=$.ajax({url:a,async:false,dataType:"json"});return b.responseText};STIStatic.getFile=function(a){var b=false;if(!b){try{b=new XMLHttpRequest()}catch(c){b=false}}if(typeof ActiveXObject!="undefined"){if(!b){try{b=new ActiveXObject("MSXML2.XMLHTTP")}catch(c){b=false}}if(!b){try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){b=false}}}b.open("GET",a,false);b.send("");return b};STIStatic.getXmlDoc=function(a){var b=STIStatic.getFile(a);var c;if(window.DOMParser){parser=new DOMParser();c=parser.parseFromString(b.responseText,"text/xml")}else{c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(b.responseText)}return c};STIStatic.getTimeData=function(k){if(!k){return}var b;try{var g=false;if(k.startsWith("-")){g=true;k=k.substring(1)}var a=k.split("T");var j=a[0].split("-");for(var f=0;f<j.length;f++){parseInt(j[f])}if(g){j[0]="-"+j[0]}if(a.length==1){b=j}else{var c;if(a[1].indexOf("Z")!=-1){c=a[1].substring(0,a[1].indexOf("Z")-1).split(":")}else{c=a[1].substring(0,a[1].indexOf("+")-1).split(":")}for(var f=0;f<j.length;f++){parseInt(c[f])}b=j.concat(c)}}catch(d){return null}var e,h;if(b.length==6){h=SimileAjax.DateTime.SECOND;e=new Date(Date.UTC(b[0],b[1]-1,b[2],b[3],b[4],b[5]))}else{if(b.length==3){h=SimileAjax.DateTime.DAY;e=new Date(Date.UTC(b[0],b[1]-1,b[2]))}else{if(b.length==2){h=SimileAjax.DateTime.MONTH;e=new Date(Date.UTC(b[0],b[1]-1,1))}else{if(b.length==1){h=SimileAjax.DateTime.YEAR;e=new Date(Date.UTC(b[0],0,1))}}}}if(j[0]&&j[0]<100){e.setFullYear(j[0])}return{date:e,granularity:h}};STIStatic.loadSpatialJSONData=function(o){var d=[];var p=0;for(var g in o){try{var r=o[g];var k=r.index||r.id||p++;var c=r.name||"";var q=r.description||"";var f=r.place||"unknown";var b=r.lon||"";var m=r.lat||"";if(b==""||m==""||isNaN(b)||isNaN(m)){throw"e"}var j=r.tableContent||[];var h=r.weight||1;var a=new MapObject(c,q,f,b,m,h,j);a.setIndex(k);d.push(a)}catch(l){continue}}return d};STIStatic.loadTemporalJSONData=function(o){var b=[];for(var c in o){try{var s=o[c];var h=s.index||s.id||runningIndex++;var a=s.name||"";var p=s.description||"";var g=s.tableContent||[];var f,l,k;var r=STIStatic.getTimeData(s.time);if(r==null){continue}f=r.d;k=r.g;var q=STIStatic.getTimeData(s.time2);if(q==null){q=r}l=q.d;if(q.g>k){k=q.g}var d=s.weight||"1";var m=new TimeObject(a,p,f,l,k,d,g);m.setIndex(h);b.push(m)}catch(j){continue}}return b};STIStatic.loadSpatioTemporalJSONData=function(a){var l=[];var k=0;for(var r in a){try{var u=a[r];var g=u.index||u.id||k++;var w=u.name||"";var p=u.description||"";var t=u.tableContent||[];var v=[];if(u.location instanceof Array){for(var q=0;q<u.location.length;q++){var m=u.location[q].place||"unknown";var b=u.location[q].lon||"";var f=u.location[q].lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!STIStatic.incompleteData){throw"e"}v.push({longitude:b,latitude:f,place:m})}}else{var m=u.place||"unknown";var b=u.lon||"";var f=u.lat||"";if((b==""||f==""||isNaN(b)||isNaN(f))&&!STIStatic.incompleteData){throw"e"}v.push({longitude:b,latitude:f,place:m})}var d=[];if(u.time instanceof Array){for(var q=0;q<u.time.length;q++){var h=STIStatic.getTimeData(u.time[q]);if(h==null&&!STIStatic.incompleteData){throw"e"}d.push(h)}}else{var h=STIStatic.getTimeData(u.time);if(h==null&&!STIStatic.incompleteData){throw"e"}d.push(h)}var o=u.weight||1;var c=new MapTimeObject(w,p,v,d,o,t);c.setIndex(g);l.push(c)}catch(s){continue}}return l};STIStatic.loadSpatioTemporalKMLData=function(j,C){var w=[];if(typeof C=="undefined"){C=STIStatic.getXmlDoc(j)}var r=C.getElementsByTagName("Placemark");if(r.length==0){return null}var l=0;for(var v=0;v<r.length;v++){var z=r[v];var D,u,p,c,g,k,y=[],m=[],b=[];var q=1;var a=false,t=false;try{D=z.getElementsByTagName("name")[0].childNodes[0].nodeValue;y.name=D}catch(x){D=""}try{u=z.getElementsByTagName("description")[0].childNodes[0].nodeValue}catch(x){u=""}try{p=z.getElementsByTagName("address")[0].childNodes[0].nodeValue;y.place=p}catch(x){p=""}try{var d=z.getElementsByTagName("Point")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;var o=d.split(",");g=o[0];k=o[1];if(g==""||k==""||isNaN(g)||isNaN(k)){throw"e"}t=true}catch(x){if(!STIStatic.incompleteData){continue}}try{var s=STIStatic.getTimeData(z.getElementsByTagName("TimeStamp")[0].getElementsByTagName("when")[0].childNodes[0].nodeValue);if(s!=null){m.push(s);a=true}else{if(!STIStatic.incompleteData){continue}}}catch(x){try{throw"e";var A=z.getElementsByTagName("TimeSpan")[0];var h=STIStatic.getTimeData(A.getElementsByTagName("begin")[0].childNodes[0].nodeValue);timeStart=h.d;c=h.g;var f=STIStatic.getTimeData(A.getElementsByTagName("end")[0].childNodes[0].nodeValue);timeEnd=f.d;if(f.g>c){c=f.g}a=true}catch(x){if(!STIStatic.incompleteData){continue}}}if(!a&&!t){continue}b.push({longitude:g,latitude:k,place:p});var B;if(a&&t){B=new MapTimeObject(D,u,b,m,1,y)}else{if(t){B=new MapObject(D,u,b,1,y)}else{if(a){B=new TimeObject(D,u,timeStart,timeEnd,c,1,y)}}}B.setIndex(l);l++;w.push(B)}return w};STIStatic.getAbsoluteLeft=function(c,a){var b=0;while(c){b+=c.offsetLeft;c=c.offsetParent;if(a&&a==c){break}}return b};STIStatic.getAbsoluteTop=function(c,a){var b=0;while(c){b+=c.offsetTop;c=c.offsetParent;if(a&&a==c){break}}return b};Binning=function(b,a){this.map=b;this.placeIndex=a;this.reset()};Binning.prototype={getSet:function(){var a=STIStatic.binning;if(!a){return this.getExactBinning()}else{if(a=="generic"){return this.getGenericBinning()}else{if(a=="square"){return this.getSquareBinning()}else{if(a=="hexagonal"){return this.getHexagonalBinning()}else{if(a=="triangular"){return this.getTriangularBinning()}}}}}},getExactBinning:function(){if(typeof this.binnings.exact=="undefined"){this.exactBinning()}return this.binnings.exact},getGenericBinning:function(){if(typeof this.binnings.generic=="undefined"){this.genericBinning()}return this.binnings.generic},getSquareBinning:function(){if(typeof this.binnings.square=="undefined"){this.squareBinning()}return this.binnings.square},getHexagonalBinning:function(){if(typeof this.binnings.hexagonal=="undefined"){this.hexagonalBinning()}return this.binnings.hexagonal},getTriangularBinning:function(){if(typeof this.binnings.triangular=="undefined"){this.triangularBinning()}return this.binnings.triangular},reset:function(){this.zoomLevels=this.map.getNumZoomLevels();this.binnings=[];STIStatic.maximumRadius=STIStatic.minimumRadius},getMaxRadius:function(a){return 4*Math.log(a+1)/Math.log(2)},setObjects:function(e){this.objects=e;for(var b=0;b<this.objects.length;b++){var d=0;for(var a=0;a<this.objects[b].length;a++){d+=this.objects[b][a].weight}var c=this.getMaxRadius(d);if(c>STIStatic.maximumRadius){STIStatic.maximumRadius=c;STIStatic.maximumPoints=d;STIStatic.maxArea=Math.PI*STIStatic.maximumRadius*STIStatic.maximumRadius;STIStatic.minArea=Math.PI*STIStatic.minimumRadius*STIStatic.minimumRadius}}},dist:function(b,d,a,c){return Math.sqrt((b-a)*(b-a)+(d-c)*(d-c))},exactBinning:function(){var x=[];var d=[];var a=[];var v=[];var q=[];for(var u=0;u<this.objects.length;u++){q.push([]);v.push([]);for(var t=0;t<this.objects[u].length;t++){var m=this.objects[u][t];if(typeof v[u][""+m.getLongitude(this.placeIndex)]=="undefined"){v[u][""+m.getLongitude(this.placeIndex)]=[]}if(typeof v[u][""+m.getLongitude(this.placeIndex)][""+m.getLatitude(this.placeIndex)]=="undefined"){v[u][""+m.getLongitude(this.placeIndex)][""+m.getLatitude(this.placeIndex)]=[];q[u].push(v[u][""+m.getLongitude(this.placeIndex)][""+m.getLatitude(this.placeIndex)])}v[u][""+m.getLongitude(this.placeIndex)][""+m.getLatitude(this.placeIndex)].push(m)}}var s=[];var e=[];var w=[];for(var u=0;u<q.length;u++){s.push([]);e.push([]);w.push([]);for(var t=0;t<q[u].length;t++){var h=q[u][t];var l=new OpenLayers.Geometry.Point(h[0].getLongitude(this.placeIndex),h[0].getLatitude(this.placeIndex),null);l.transform(this.map.displayProjection,this.map.projection);var g=0;for(var f=0;f<h.length;f++){g+=h[f].weight}var b=STIStatic.minimumRadius;if(STIStatic.noBinningRadii=="dynamic"){STIStatic.getRadius(g)}var c=new CircleObject(l.x,l.y,0,0,h,b,u,g);s[u].push(c);for(var f=0;f<h.length;f++){e[u][h[f].index]=c;w[u][h[f].index]=false}}}for(var r=0;r<this.zoomLevels;r++){x.push(s);d.push(e);a.push(w)}this.binnings.exact={circleSets:x,hashMaps:d,selectionHashs:a}},genericClustering:function(a,h){var t=[];var G=[];var c=[];var b=[];var f=new Clustering(-20037508.34,-20037508.34,20037508.34,20037508.34);for(var D=0;D<a.length;D++){for(var A=0;A<a[D].length;A++){var m=a[D][A];var l=new OpenLayers.Geometry.Point(m.getLongitude(this.placeIndex),m.getLatitude(this.placeIndex),null);l.transform(this.map.displayProjection,this.map.projection);var s=new Vertex(Math.floor(l.x),Math.floor(l.y),a.length);s.addElement(m,m.weight,D);f.add(s)}}for(var D=0;D<this.zoomLevels;D++){var q=[];var x=[];var e=[];var E=[];for(var A=0;A<a.length;A++){x.push([]);e.push([]);E.push([])}var u=this.map.getResolutionForZoom(this.zoomLevels-D-1);f.mergeForResolution(u,this.zoomLevels-D-1);for(var A=0;A<f.vertices.length;A++){var s=f.vertices[A];if(!s.legal){continue}var J=[];for(var w=0;w<s.elements.length;w++){if(s.elements[w].length>0){J.push({search:w,elements:s.elements[w],radius:s.radii[w],weight:s.weights[w]})}}var g=function(j,d){if(j.radius>d.radius){return -1}if(d.radius>j.radius){return 1}return 0};var I={circles:[],length:0,radius:s.radius/u,x:s.x,y:s.y};for(var w=0;w<a.length;w++){I.circles.push(false)}var H=function(L,K,p){var j=h||p.search;var o=new CircleObject(s.x,s.y,L,K,p.elements,p.radius,j,p.weight);x[p.search].push(o);I.circles[j]=o;I.length++;for(var d=0;d<p.elements.length;d++){e[p.search][p.elements[d].index]=o;E[p.search][p.elements[d].index]=false}};if(J.length==1){H(0,0,J[0])}else{if(J.length==2){var C=J[0].radius;var z=J[1].radius;H(-1*z,0,J[0]);H(C,0,J[1])}else{if(J.length==3){J.sort(g);var C=J[0].radius;var z=J[1].radius;var v=J[2].radius;var F=((2/3*Math.sqrt(3)-1)/2)*z;var B=s.radius/u-C-F;var y=C-B;H(-B,0,J[0]);H(y+z-3*F,z,J[1]);H(y+v-(3*F*v/z),-1*v,J[2])}else{if(J.length==4){J.sort(g);var C=J[0].radius;var z=J[1].radius;var v=J[2].radius;var r=J[3].radius;var F=(Math.sqrt(2)-1)*z;H(-1*F-z,0,J[0]);H(C-z,-1*F-r,J[3]);H(C-z,F+v,J[2]);H(F+C,0,J[1])}}}}if(I.length>1){q.push(I)}}G.push(x);t.push(q);c.push(e);b.push(E)}G.reverse();t.reverse();c.reverse();b.reverse();return{circleSets:G,binSets:t,hashMaps:c,selectionHashs:b}},genericBinning:function(){if(STIStatic.circlePackings||this.objects.length==1){this.binnings.generic=this.genericClustering(this.objects)}else{var a=[];var f=[];var d=[];for(var c=0;c<this.objects.length;c++){var e=this.genericClustering([this.objects[c]],c);if(c==0){a=e.circleSets;f=e.hashMaps;d=e.selectionHashs}else{for(var b=0;b<a.length;b++){a[b]=a[b].concat(e.circleSets[b]);f[b]=f[b].concat(e.hashMaps[b]);d[b]=d[b].concat(e.selectionHashs[b])}}}this.binnings.generic={circleSets:a,hashMaps:f,selectionHashs:d}}},getRadius:function(f,c,e){if(f==0){return 0}function b(g){return(Math.log(g))/(Math.log(2))}var a=STIStatic.minimumRadius;var d;if(typeof c=="undefined"){return a+f/Math.sqrt(STIStatic.maximumPoints)}return a+(c-a)*b(f)/b(e)},shift:function(h,r,g,a){var c=r.x,b=0;var o=r.y,k=0;for(var f=0;f<a.length;f++){b+=a[f].x/a.length;k+=a[f].y/a.length}var l=0,j=0;if(h=="square"){var q=Math.abs(b-c);var p=Math.abs(k-o);var e=p/q;var d=o-e*c;if(q>p){l=r.x-(c+r.r-g);j=r.y-(e*r.x+d)}else{j=r.y-(o+r.r-g);l=r.x-(r.y-d)/e}}return{x:l,y:j}},binSize:function(c){var b=0;for(var a in c){b+=c[a].weight}return b},setCircleSet:function(m,o){var A=[];var d=[];var a=[];for(var w=0;w<o.length;w++){var q=[];var e=[];var y=[];for(var t=0;t<this.objects.length;t++){q.push([]);e.push([]);y.push([])}var u=[];var v=0;var b=0;var p=this.map.getResolutionForZoom(w);for(var t=0;t<o[w].length;t++){for(var s=0;s<o[w][t].bin.length;s++){var B=this.binSize(o[w][t].bin[s]);if(B>v){v=B;b=o[w][t].r/p}}}for(var t=0;t<o[w].length;t++){var l=o[w][t];for(var s=0;s<l.bin.length;s++){if(l.bin[s].length==0){continue}var g=this.binSize(l.bin[s]);var h=this.getRadius(g,b,v);var x=this.shift(m,l,h*p,l.bin[s],w);var c=new CircleObject(l.x-x.x,l.y-x.y,0,0,l.bin[s],h,s,g);q[s].push(c);for(var f=0;f<l.bin[s].length;f++){e[s][l.bin[s][f].index]=c;y[s][l.bin[s][f].index]=false}}}A.push(q);d.push(e);a.push(y)}this.binnings[m]={circleSets:A,hashMaps:d,selectionHashs:a}},squareBinning:function(){var f=20037508.34;var A=f*f*4;var q=STIStatic.binCount;var B=[];var r=[];for(var g=0;g<this.zoomLevels;g++){B.push([]);r.push([])}for(var m=0;m<this.objects.length;m++){for(var h=0;h<this.objects[m].length;h++){var e=this.objects[m][h];var c=new OpenLayers.Geometry.Point(e.getLongitude(this.placeIndex),e.getLatitude(this.placeIndex),null);c.transform(this.map.displayProjection,this.map.projection);e.x=c.x;e.y=c.y;for(var g=0;g<this.zoomLevels;g++){var s=q*Math.pow(2,g);var w=2*f/s;var d=Math.floor((c.x+f)/(2*f)*s);var b=Math.floor((c.y+f)/(2*f)*s);if(typeof B[g][""+d]=="undefined"){B[g][""+d]=[]}if(typeof B[g][""+d][""+b]=="undefined"){B[g][""+d][""+b]=[];for(var t=0;t<this.objects.length;t++){B[g][""+d][""+b].push([])}var v=d*w+w/2-f;var u=b*w+w/2-f;r[g].push({bin:B[g][""+d][""+b],x:v,y:u,a:w,r:w/2})}B[g][""+d][""+b][m].push(e)}}}this.setCircleSet("square",r)},triangularBinning:function(){var A=20037508.34;var L=STIStatic.binCount;var K=Math.sqrt(4*L*L/Math.sqrt(3));var B=L/K*L;var v=[];var t=[];for(var C=0;C<this.zoomLevels;C++){v.push([]);t.push([])}for(var E=0;E<this.objects.length;E++){for(var D=0;D<this.objects[E].length;D++){var u=this.objects[E][D];var s=new OpenLayers.Geometry.Point(u.getLongitude(this.placeIndex),u.getLatitude(this.placeIndex),null);s.transform(this.map.displayProjection,this.map.projection);u.x=s.x;u.y=s.y;for(var C=0;C<this.zoomLevels;C++){var w=B*Math.pow(2,C);var H=w*w/Math.sqrt(w*w-w*w/4);var J=2*A/w;var G=2*A/H;var c=Math.floor((s.y+A)/(2*A)*H);if(typeof v[C][""+c]=="undefined"){v[C][""+c]=[]}var F;var e=w*2;var d=Math.floor((s.x+A)/(2*A)*e);var I=J/2;var b=G;var m=s.x+A-d*J/2;var g=s.y+A-c*G;if(c%2==0&&d%2==1||c%2==1&&d%2==0){if(g+b/I*m<b){F=d}else{F=d+1}}else{if(g>b/I*m){F=d}else{F=d+1}}if(typeof v[C][""+c][""+F]=="undefined"){v[C][""+c][""+F]=[];for(var f=0;f<this.objects.length;f++){v[C][""+c][""+F].push([])}var q=Math.sqrt(3)/6*J;var m=(F-1)*J/2+J/2-A;var g;if(c%2==0&&F%2==0||c%2==1&&F%2==1){g=c*G+G-q-A}else{g=c*G+q-A}t[C].push({bin:v[C][""+c][""+F],x:m,y:g,a:J,r:q})}v[C][""+c][""+F][E].push(u)}}}this.setCircleSet("triangular",t)},hexagonalBinning:function(){var F=20037508.34;var R=STIStatic.binCount;var Q=Math.sqrt(4*R*R/Math.sqrt(3))/Math.sqrt(6);var G=R/Q*R;var D=[];var A=[];for(var H=0;H<this.zoomLevels;H++){D.push([]);A.push([])}for(var J=0;J<this.objects.length;J++){for(var I=0;I<this.objects[J].length;I++){var B=this.objects[J][I];var w=new OpenLayers.Geometry.Point(B.getLongitude(this.placeIndex),B.getLatitude(this.placeIndex),null);w.transform(this.map.displayProjection,this.map.projection);B.x=w.x;B.y=w.y;for(var H=0;H<this.zoomLevels;H++){var E=G*Math.pow(2,H);var M=E*E/Math.sqrt(E*E-E*E/4);var O=2*F/E;var L=2*F/M;var d=Math.floor((w.y+F)/(2*F)*M);if(typeof D[H][""+d]=="undefined"){D[H][""+d]=[]}var K;var g=E*2;var f=Math.floor((w.x+F)/(2*F)*g);var N=O/2;var b=L;var t=w.x+F-f*O/2;var s=w.y+F-d*L;if(d%2==0&&f%2==1||d%2==1&&f%2==0){if(s+b/N*t<b){K=f}else{K=f+1}}else{if(s>b/N*t){K=f}else{K=f+1}}if(typeof D[H][""+d][""+K]=="undefined"){D[H][""+d][""+K]=[];for(var q=0;q<this.objects.length;q++){D[H][""+d][""+K].push([])}var u=Math.sqrt(3)/6*O;var t=(K-1)*O/2+O/2-F;var s;if(d%2==0&&K%2==0||d%2==1&&K%2==1){s=d*L+L-u-F}else{s=d*L+u-F}A[H].push({bin:D[H][""+d][""+K],x:t,y:s,a:O,r:u,h:L,binX:K,binY:d})}D[H][""+d][""+K][J].push(B)}}}var P=[];var c=[];for(var H=0;H<this.zoomLevels;H++){P.push([]);c.push([])}for(var J=0;J<A.length;J++){for(var I=0;I<A[J].length;I++){var v=A[J][I];var d=Math.floor(v.binY/2);var e=Math.floor(v.binX/3);var t,s;var O=v.a;var L=v.h;if(v.binX%6<3){if(typeof P[J][""+d]=="undefined"){P[J][""+d]=[]}s=d*2*v.h+v.h-F;t=e*1.5*v.a+O/2-F}else{if(v.binY%2==1){d++}if(typeof P[J][""+d]=="undefined"){P[J][""+d]=[]}s=d*2*v.h-F;t=e*1.5*v.a+O/2-F}if(typeof P[J][""+d][""+e]=="undefined"){P[J][""+d][""+e]=[];for(var q=0;q<this.objects.length;q++){P[J][""+d][""+e].push([])}c[J].push({bin:P[J][""+d][""+e],x:t,y:s,a:v.a,r:v.h})}for(var H=0;H<v.bin.length;H++){for(var C=0;C<v.bin[H].length;C++){P[J][""+d][""+e][H].push(v.bin[H][C])}}}}this.setCircleSet("hexagonal",c)}};function MapControl(e,c,b,f,a){var d=this;this.button=c;this.enabled=true;this.activated=false;this.label=b;if(this.button!=null){$(this.button).addClass(b+"Deactivated");$(this.button).attr("title",STIStatic.getString(STIStatic.language,b));$(this.button).click(function(){d.checkStatus()})}this.checkStatus=function(){if(d.enabled){if(typeof e.activeControl!="undefined"){if(d.activated){d.deactivate()}else{e.activeControl.deactivate();d.activate()}}else{d.activate()}}};this.setButtonClass=function(h,g){if(this.button!=null){$(this.button).removeClass(b+h);$(this.button).addClass(b+g);$(this.button).attr("title",STIStatic.getString(STIStatic.language,b))}};this.disable=function(){this.enabled=false;this.setButtonClass("Deactivated","Disabled")};this.enable=function(){this.enabled=true;this.setButtonClass("Disabled","Deactivated")};this.activate=function(){f();this.activated=true;this.setButtonClass("Deactivated","Activated");e.activeControl=this};this.deactivate=function(){a();this.activated=false;this.setButtonClass("Activated","Deactivated");e.activeControl=undefined}}function FilterBar(a,c){var b=this;this.toolbar=document.createElement("div");this.toolbar.setAttribute("class","filterBar");c.appendChild(this.toolbar);this.filter=document.createElement("div");this.filter.setAttribute("class","smallButton filter");this.toolbar.appendChild(this.filter);this.filter.onclick=function(){a.filtering()};this.filterInverse=document.createElement("div");this.filterInverse.setAttribute("class","smallButton filterInverse");this.toolbar.appendChild(this.filterInverse);this.filterInverse.onclick=function(){a.inverseFiltering()};if(!STIStatic.inverseFilter){this.filterInverse.style.display="none"}this.cancelSelection=document.createElement("div");this.cancelSelection.setAttribute("class","smallButton cancelSelection");this.toolbar.appendChild(this.cancelSelection);this.cancelSelection.onclick=function(){a.deselection()};this.toolbar.style.display="none";this.reset=function(d){return;if(d){this.toolbar.style.display="block"}else{this.toolbar.style.display="none"}this.toolbar.style.left=c.offsetWidth+"px";this.toolbar.style.top=Math.floor(c.offsetHeight/2-this.toolbar.offsetHeight/2)+"px"}}function PlacenameTags(b,a){this.circle=b;this.map=a;this.placeLabels;this.selectedLabel;this.allLabel;this.othersLabel;this.unknownLabel;this.calculate=function(){this.calculateLabels();this.calculatePlacenameTags()};this.calculateLabels=function(){var d=this.circle.elements;var f=this.circle.search;var m=0;var o=[];var e=this.map.getLevelOfDetail();for(var l=0;l<d.length;l++){m+=d[l].weight;var t=false;var r=d[l].getPlace(this.map.placeIndex,e);if(r==""){r="unknown"}for(var h=0;h<o.length;h++){if(o[h].place==r){o[h].elements.push(d[l]);o[h].weight+=d[l].weight;t=true;break}}if(!t){o.push({id:d[l].name,place:r,elements:new Array(d[l]),weight:d[l].weight,index:f})}}var q=function(j,c){if(j.weight>c.weight){return -1}return 1};o.sort(q);if(STIStatic.maxPlaceLabels){var g=STIStatic.maxPlaceLabels;if(g==1){o=[];o.push({place:"all",elements:d,weight:m,index:f})}if(g==2){g++}if(g>2&&o.length+1>g){var p=[];var s=0;for(var l=g-2;l<o.length;l++){p=p.concat(o[l].elements);s+=o[l].weight}o=o.slice(0,g-2);o.push({place:"others",elements:p,weight:s,index:f})}}if(o.length>1){o.push({place:"all",elements:d,weight:m,index:f})}this.placeLabels=o};this.calculatePlacenameTags=function(){var k=this;var p=STIStatic.colors[this.circle.search];var t="rgb("+p.r0+","+p.g0+","+p.b0+")";var s="rgb("+p.r1+","+p.g1+","+p.b1+")";var g="",j="",q="",r="",o="";if(STIStatic.placeLabelStyles=="shadows"){j+="color: "+t+"; text-shadow: "+STIStatic.shadowHovered.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";q+="color: "+s+"; text-shadow: "+STIStatic.shadowSelected.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";r+="color: "+t+"; text-shadow: "+STIStatic.shadowUnselected.replace(/COLOR1/g,s).replace(/COLOR0/g,t)+";";o+="color: "+s+";"}else{if(STIStatic.placeLabelStyles=="frames"){g+="padding: 0px 5px; opacity: 0.8; color: "+s+"; background-color: "+t+";";if(STIStatic.ie8){g+="filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';"}j+="border: 1px solid "+s+";";q+="border: 1px solid "+s+";";r+="border: 1px solid "+t+";"}else{if(STIStatic.placeLabelStyles=="custom"){j+=STIStatic.customHovered.replace(/COLOR1/g,s).replace(/COLOR0/g,t);q+=STIStatic.customSelected.replace(/COLOR1/g,s).replace(/COLOR0/g,t);r+=STIStatic.customUnselected.replace(/COLOR1/g,s).replace(/COLOR0/g,t)}}}if(STIStatic.selectedPlaceStyle=="underline"){q+="text-decoration: underline;";r+="text-decoration: none;"}else{if(STIStatic.selectedPlaceStyle=="bold"){q+="font-weight: bold;";r+="font-weight: normal;"}else{q+=STIStatic.customSelectedPlace.replace(/COLOR1/g,s).replace(/COLOR0/g,t);r+=STIStatic.customUnselectedPlace.replace(/COLOR1/g,s).replace(/COLOR0/g,t)}}var f=function(c){c.div.onclick=function(){k.changeLabelSelection(c)};c.div.onmouseover=function(){if(STIStatic.labelHover){if(c!=k.selectedLabel){c.div.setAttribute("style",c.allStyle+""+c.hoverStyle);k.map.mapLabelHighlight(c,false)}}};c.div.onmouseout=function(){if(STIStatic.labelHover){if(c!=k.selectedLabel){c.div.setAttribute("style",c.allStyle+""+c.unselectedStyle);k.map.mapLabelHighlight(c,true)}}}};var e=this.count;for(var m=0;m<this.placeLabels.length;m++){var h=this.placeLabels[m];h.selected=false;var d=document.createElement("div");d.setAttribute("class","tagCloudItem");var u=1+(h.weight-1)/this.map.count*STIStatic.maxLabelIncrease;if(h.place=="all"){u=1}d.style.fontSize=u+"em";h.allStyle=g+"font-size: "+u+"em;";h.selectedStyle=q;h.unselectedStyle=r;h.hoverStyle=j;h.altStyle=o;d.innerHTML=h.place+"<span style='font-size:"+(1/u)+"em'>&nbsp;("+h.weight+")</span>";h.div=d;f(h)}if(STIStatic.labelGrid){this.showPlacelabels()}else{for(var m=0;m<this.placeLabels.length;m++){this.placeLabels[m].div.setAttribute("style",this.placeLabels[m].allStyle+""+this.placeLabels[m].unselectedStyle)}}};this.selectLabel=function(c){if(typeof c=="undefined"){c=this.placeLabels[this.placeLabels.length-1]}if(this.map.popup){this.map.popup.showLabelContent(c)}this.selectedLabel=c;this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.selectedStyle);this.map.mapLabelSelection(c)};this.changeLabelSelection=function(c){if(this.selectedLabel==c){return}if(typeof this.selectedLabel!="undefined"){this.selectedLabel.div.setAttribute("style",this.selectedLabel.allStyle+""+this.selectedLabel.altStyle)}this.selectLabel(c)};this.showPlacelabels=function(){this.leftDiv=document.createElement("div");this.leftDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.leftDiv);this.rightDiv=document.createElement("div");this.rightDiv.setAttribute("class","tagCloudDiv");this.map.gui.mapWindow.appendChild(this.rightDiv);for(var c=0;c<this.placeLabels.length;c++){if(c%2==0){this.leftDiv.appendChild(this.placeLabels[c].div)}else{this.rightDiv.appendChild(this.placeLabels[c].div)}this.placeLabels[c].div.setAttribute("style",this.placeLabels[c].allStyle+""+this.placeLabels[c].unselectedStyle)}this.placeTagCloud()};this.placeTagCloud=function(){var h=new OpenLayers.LonLat(this.circle.feature.geometry.x,this.circle.feature.geometry.y);var c=a.openlayersMap.getPixelFromLonLat(h);var j=this.circle.feature.style.pointRadius;var e=this.leftDiv.offsetWidth;var d=this.rightDiv.offsetWidth;this.leftDiv.style.left=(c.x-j-e-5)+"px";this.rightDiv.style.left=(c.x+j+5)+"px";var l=this.leftDiv.offsetHeight;var k=this.rightDiv.offsetHeight;var g=c.y-l/2;var f=c.y-k/2;this.leftDiv.style.top=g+"px";this.rightDiv.style.top=f+"px"};this.remove=function(){$(this.leftDiv).remove();$(this.rightDiv).remove()}}function PlacenamePopup(a){this.parentDiv=a.gui.mapWindow;this.createPopup=function(b,h,g){var c=this;this.x=b;this.y=h;this.labels=g;this.popupDiv=document.createElement("div");this.popupDiv.setAttribute("class","ddbPopupDiv");this.parentDiv.appendChild(this.popupDiv);this.cancel=document.createElement("div");this.cancel.setAttribute("class","ddbPopupCancel");this.cancel.onclick=function(){a.deselection();c.reset()};this.resultsLabel=document.createElement("div");this.resultsLabel.setAttribute("class","popupDDBResults");this.input=document.createElement("div");this.input.style.maxWidth=Math.floor(this.parentDiv.offsetWidth*0.75)+"px";this.input.style.maxHeight=Math.floor(this.parentDiv.offsetHeight*0.75)+"px";this.input.setAttribute("class","ddbPopupInput");this.popupDiv.appendChild(this.resultsLabel);this.backward=document.createElement("div");this.backward.setAttribute("class","prevItem");this.popupDiv.appendChild(this.backward);this.backward.onclick=function(){c.descriptionIndex--;c.showDescription()};this.number=document.createElement("div");this.popupDiv.appendChild(this.number);this.number.style.display="none";this.number.style.fontSize="13px";this.forward=document.createElement("div");this.forward.setAttribute("class","nextItem");this.popupDiv.appendChild(this.forward);this.forward.onclick=function(){c.descriptionIndex++;c.showDescription()};this.popupDiv.appendChild(this.input);this.popupDiv.appendChild(this.cancel);if(STIStatic.showDescriptions){this.descriptions=document.createElement("div");this.descriptions.setAttribute("class","descriptions");this.descriptions.onclick=function(){c.switchToDescriptionMode()}}this.back=document.createElement("div");this.back.setAttribute("class","back");this.popupDiv.appendChild(this.back);this.back.onclick=function(){$(c.input).empty();c.back.style.display="none";c.backward.style.display="none";c.forward.style.display="none";c.number.style.display="none";c.showLabels()};var f=document.createElement("div");f.setAttribute("class","popupPeak");this.popupDiv.appendChild(f);var e=document.createElement("div");e.setAttribute("class","popupTopRight");this.popupDiv.appendChild(e);var d=document.createElement("div");d.setAttribute("class","popupBottomRight");this.popupDiv.appendChild(d);this.popupRight=document.createElement("div");this.popupRight.setAttribute("class","popupRight");this.popupDiv.appendChild(this.popupRight);this.popupBottom=document.createElement("div");this.popupBottom.setAttribute("class","popupBottom");this.popupDiv.appendChild(this.popupBottom);this.listLabels();this.showLabels();this.updateTexts();this.visible=true};this.reset=function(){$(this.popupDiv).remove();this.visible=false};this.switchToDescriptionMode=function(){this.descriptionIndex=0;this.descriptionContents=this.activeLabel.descriptions;this.number.style.display="inline-block";this.input.style.minWidth="300px";this.showDescription();this.count=this.activeLabel.weight;this.setCount();this.back.style.display="inline-block"};this.showDescription=function(){$(this.input).empty();this.input.appendChild(this.descriptionContents[this.descriptionIndex]);if(this.descriptionContents.length==1){this.backward.style.display="none";this.forward.style.display="none"}else{if(this.descriptionIndex==0){this.backward.style.display="none"}else{this.backward.style.display="inline-block"}if(this.descriptionIndex==this.descriptionContents.length-1){this.forward.style.display="none"}else{this.forward.style.display="inline-block"}}if(this.descriptionContents.length>1){this.number.innerHTML="#"+(this.descriptionIndex+1)}else{this.number.style.display="none"}this.decorate()};this.setCount=function(){var b=this.count;if(b>1){this.resultsLabel.innerHTML=b+" "+STIStatic.getString("results")}else{this.resultsLabel.innerHTML=b+" "+STIStatic.getString("result")}};this.listLabels=function(){var b=this;this.labelDivs=[];this.labelCount=0;this.labelsWidth=0;for(var e=0;e<this.labels.length;e++){var g=document.createElement("div");var f=document.createElement("div");this.labels[e].allStyle+="position: relative; white-space: nowrap;";f.appendChild(this.labels[e].div);f.setAttribute("class","ddbPopupLabel");g.appendChild(f);this.labels[e].div.setAttribute("style",this.labels[e].allStyle+""+this.labels[e].selectedStyle);this.input.appendChild(g);if(this.input.offsetWidth>this.labelsWidth){this.labelsWidth=this.input.offsetWidth}this.labels[e].div.setAttribute("style",this.labels[e].allStyle+""+this.labels[e].altStyle);this.labelDivs.push(g);var d=[];for(var c=0;c<this.labels[e].elements.length;c++){var g=document.createElement("div");g.innerHTML=this.labels[e].elements[c].description;d.push(g)}this.labels[e].descriptions=d;if(this.labels[e].place!="all"||e==0){this.labelCount+=this.labels[e].weight}}if(typeof this.descriptions!="undefined"){this.labelsWidth+=20}$(this.input).empty()};this.showLabels=function(){this.count=this.labelCount;this.setCount();for(var b=0;b<this.labelDivs.length;b++){this.input.appendChild(this.labelDivs[b])}this.input.style.width=this.labelsWidth+"px";this.input.style.minWidth=this.labelsWidth+"px";this.decorate()};this.showLabelContent=function(b){for(var c=0;c<this.labels.length;c++){if(this.labels[c]==b){this.activeLabel=this.labels[c];if(typeof this.descriptions!="undefined"){this.labelDivs[c].appendChild(this.descriptions)}this.decorate();break}}};this.decorate=function(){this.popupRight.style.height=(this.popupDiv.offsetHeight-14)+"px";this.popupBottom.style.width=(this.popupDiv.offsetWidth-22)+"px";this.left=this.x+9;this.top=this.y-10-this.popupDiv.offsetHeight;this.popupDiv.style.left=this.left+"px";this.popupDiv.style.top=this.top+"px";var c=0,b=0;if(this.popupDiv.offsetTop<a.gui.headerHeight+10){b=-1*(a.gui.headerHeight+10-this.popupDiv.offsetTop)}if(this.popupDiv.offsetLeft+this.popupDiv.offsetWidth>a.gui.headerWidth-10){c=-1*(a.gui.headerWidth-10-this.popupDiv.offsetLeft-this.popupDiv.offsetWidth)}a.shift(c,b)};this.shift=function(b,c){this.left=this.left-this.x+b;this.top=this.top-this.y+c;this.x=b;this.y=c;if(this.left+this.popupDiv.offsetWidth>this.parentDiv.offsetWidth){this.popupDiv.style.left="auto";this.popupDiv.style.right=(this.parentDiv.offsetWidth-this.left-this.popupDiv.offsetWidth)+"px"}else{this.popupDiv.style.right="auto";this.popupDiv.style.left=this.left+"px"}this.popupDiv.style.top=this.top+"px"};this.setLanguage=function(b){this.language=b;if(this.visible){this.updateTexts()}};this.updateTexts=function(){this.cancel.title=STIStatic.getString("close");this.setCount()}}DataObject=function(b,c,d,a){this.name=b;this.description=c;this.weight=d;this.tableContent=a;this.status=false;this.percentage=0;this.hoverSelect=false};DataObject.prototype={setPercentage:function(a){if(this.percentage==a){this.status=false}else{this.percentage=a;this.status=true}},setHover:function(a){this.hoverSelect=a;if(this.percentage!=1){this.status=true}},setIndex:function(a){this.index=a}};MapObject=function(c,e,a,f,b){this.base=DataObject;this.base(c,e,f,b);this.locations=a;this.placeDetails=[];for(var d=0;d<this.locations.length;d++){this.placeDetails.push(this.locations[d].place.split("/"))}this.getLatitude=function(g){return this.locations[g].latitude};this.getLongitude=function(g){return this.locations[g].longitude};this.getPlace=function(g,h){if(h>=this.placeDetails[g].length){return this.placeDetails[g][this.placeDetails[g].length-1]}return this.placeDetails[g][h]}};MapObject.prototype=new DataObject;TimeObject=function(b,c,e,a,f,d){this.base=DataObject;this.base(b,c,d);this.timeStart=e;this.timeEnd=a;this.granularity=f};TimeObject.prototype=new DataObject;TimeObject.prototype.getTimeString=function(){if(this.timeStart!=this.timeEnd){return(SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+" - "+SimileAjax.DateTime.getTimeString(this.granularity,this.timeEnd))}else{return SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+""}};MapTimeObject=function(c,e,a,g,f,b){this.base=DataObject;this.base(c,e,f,b);this.locations=a;this.placeDetails=[];for(var d=0;d<this.locations.length;d++){this.placeDetails.push(this.locations[d].place.split("/"))}this.getLatitude=function(h){return this.locations[h].latitude};this.getLongitude=function(h){return this.locations[h].longitude};this.getPlace=function(h,j){if(j>=this.placeDetails[h].length){return this.placeDetails[h][this.placeDetails[h].length-1]}return this.placeDetails[h][j]};this.dates=g;this.getDate=function(h){return this.dates[h].date};this.getTimeGranularity=function(h){return this.dates[h].granularity}};MapTimeObject.prototype=new DataObject;MapTimeObject.prototype.getTimeString=function(){if(this.timeStart!=this.timeEnd){return(SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+" - "+SimileAjax.DateTime.getTimeString(this.granularity,this.timeEnd))}else{return SimileAjax.DateTime.getTimeString(this.granularity,this.timeStart)+""}};function Dataset(){this.mapTimeObjects=[];this.mapObjects=[];this.timeObjects=[]}Dataset.prototype={getMapObjects:function(){return this.mapObjects.concat(this.mapTimeObjects)},getTimeObjects:function(){return this.timeObjects.concat(this.mapTimeObjects)},getObjects:function(){return this.timeObjects.concat(this.mapTimeObjects).concat(this.mapObjects)},addObject:function(a){if(a instanceof MapObject){this.mapObjects.push(a)}else{if(a instanceof TimeObject){this.timeObjects.push(a)}else{if(a instanceof MapTimeObject){this.mapTimeObjects.push(a)}}}},setID:function(a){this.id=a},getID:function(){if(this.id==undefined){return"Unknown ID"}return this.id}};function TimeDataSource(a){this.timeIndex=a;this.timeSlices=[];this.unit;this.minDate;this.maxDate;this.eventSources;this.events;this.leftSlice;this.rightSlice;this.hashMapping}TimeDataSource.prototype={findTimeUnits:function(f,a,c){var b=SimileAjax.DateTime;this.availableUnits=[];var e=SimileAjax.DateTime.gregorianUnitLengths;for(var d=0;d<e.length;d++){if(f>d){continue}var h=0;var k=new Date(this.minDate.getTime());do{b.roundDownToInterval(k,d,undefined,1,0);h++;b.incrementByInterval(k,d,undefined)}while(k.getTime()<=this.maxDate.getTime()&&h<c+2);if(h>2&&h<=c){this.availableUnits.push({unit:d,slices:h,label:SimileAjax.DateTime.Strings[STIStatic.language][d]})}}var j=c+1;for(var d=0;d<this.availableUnits.length;d++){var g=Math.abs(this.availableUnits[d].slices-200);if(g<j){j=g;this.unit=this.availableUnits[d].unit}}},setTimeUnit:function(a){this.unit=a;this.initializeSlices()},initialize:function(a,h,f,p,b,e){this.dataSources=a;this.eventSources=h;this.timeObjects=f;this.minDate=undefined;this.maxDate=undefined;this.hashMapping=[];for(var l=0;l<f.length;l++){this.hashMapping.push([]);for(var k=0;k<f[l].length;k++){var c=f[l][k];var m=c.dates[this.timeIndex].granularity;if(m==null){continue}var d=c.dates[this.timeIndex].date;if(this.minDate==undefined||d.getTime()<this.minDate.getTime()){this.minDate=d}if(this.maxDate==undefined||d.getTime()>this.maxDate.getTime()){this.maxDate=d}}}if(this.minDate==undefined){this.minDate=STIStatic.defaultMinDate;this.maxDate=STIStatic.defaultMaxDate}this.findTimeUnits(p,b,e);this.initializeSlices()},initializeSlices:function(){for(var f=0;f<this.dataSources.length;f++){this.dataSources[f]._range={earliestDate:null,latestDate:null,min:0,max:0}}this.timeSlices=[];var b=SimileAjax.DateTime;var q=new Date(this.minDate.getTime()-0.9*b.gregorianUnitLengths[this.unit]);do{b.roundDownToInterval(q,this.unit,undefined,1,0);var p=new TimeSlice(SimileAjax.NativeDateUnit.cloneValue(q),this.timeObjects.length);this.timeSlices.push(p);b.incrementByInterval(q,this.unit,undefined)}while(q.getTime()<=this.maxDate.getTime()+1.1*b.gregorianUnitLengths[this.unit]);for(var f=0;f<this.timeObjects.length;f++){for(var e=0;e<this.timeObjects[f].length;e++){var a=this.timeObjects[f][e];var c=a.dates[this.timeIndex].date;for(var d=0;d<this.timeSlices.length-1;d++){var h=this.timeSlices[d].date.getTime();var g=this.timeSlices[d+1].date.getTime();var l=null;if(c>=h&&c<g){l=this.timeSlices[d].getStack(f)}if(d==this.timeSlices.length-2&&c>=g){l=this.timeSlices[d+1].getStack(f)}if(l!=null){l.addObject(a);this.hashMapping[f][a.index]=l;break}}}}this.events=[];for(var f=0;f<this.eventSources.length;f++){var r=[];for(var e=0;e<this.timeSlices.length;e++){var m=new Array(""+this.timeSlices[e].stacks[f].value);r.push({date:this.timeSlices[e].date,value:m})}this.eventSources[f].loadData(r);this.events.push(r)}this.leftSlice=0;this.rightSlice=this.timeSlices.length-1},getSliceNumber:function(){return this.timeSlices.length},getSliceIndex:function(b){for(var a=0;a<this.timeSlices.length;a++){if(b==this.timeSlices[a].date){return a}}},getSliceTime:function(a){return this.timeSlices[a].date},setShift:function(a){if(a==1&&this.leftSlice!=0){this.leftSlice--;this.rightSlice--;return true}else{if(a==-1&&this.rightSlice!=this.timeSlices.length-1){this.leftSlice++;this.rightSlice++;return true}else{return false}}},setZoom:function(h,b,a,g){var f=0;var e=0;var c=-1;if(h>0){c=1;if(a!=null){f=this.getSliceIndex(a)-this.leftSlice;e=this.rightSlice-this.getSliceIndex(g)}else{slice=this.getSliceIndex(b);if(slice==this.leftSlice||slice==this.rightSlice){return}f=slice-1-this.leftSlice;e=this.rightSlice-slice-1}}else{if(h<0){f=this.leftSlice;e=this.timeSlices.length-1-this.rightSlice}}var d=2*h;if(Math.abs(f+e)<Math.abs(d)){d=f+e}if(f+e==0){return false}var k=Math.round(f/(f+e)*d);var j=d-k;this.leftSlice+=k;this.rightSlice-=j;return true},reset:function(a){for(var b=0;b<this.eventSources.length;b++){this.eventSources[b].loadData(this.events[b].slice(this.leftSlice,this.rightSlice+1));if(b+1<this.eventSources.length){a._earliestDate=null;a._latestDate=null}}},getZoom:function(){if(this.timeSlices==undefined){return 0}return Math.round((this.timeSlices.length-3)/2)-Math.round((this.rightSlice-this.leftSlice-2)/2)},earliest:function(){return this.timeSlices[0].date},latest:function(){return this.timeSlices[this.timeSlices.length-1].date},setOverlay:function(b){for(var e=0;e<this.timeSlices.length;e++){this.timeSlices[e].reset()}for(var e in b){var f=b[e].value;for(var d in b[e].objects){for(var c in b[e].objects[d]){var g=b[e].objects[d][c];if(g.getTimeGranularity(this.timeIndex)==null){continue}var a=this.hashMapping[d][g.index];if(f==1){a.overlay+=g.weight}}}}}};function TimeSlice(a,c){this.date=a;this.selected=false;this.stacks=[];for(var b=0;b<c;b++){this.stacks.push(new TimeStack())}}TimeSlice.prototype.getStack=function(a){return this.stacks[a]};TimeSlice.prototype.reset=function(){for(var a in this.stacks){this.stacks[a].overlay=0}};TimeSlice.prototype.overlay=function(){var b=0;for(var a in this.stacks){if(this.stacks[a].overlay>b){b=this.stacks[a].overlay}}return b};function TimeStack(){this.overlay=0;this.value=0;this.elements=[]}TimeStack.prototype.addObject=function(a){this.elements.push(a);this.value+=a.weight};function MapDataSource(b,a){this.olMap=b;this.circleSets=[];this.binning=new Binning(b,a)}MapDataSource.prototype={initialize:function(a){if(a!=this.mapObjects){this.binning.reset();this.binning.setObjects(a)}this.mapObjects=a;var b=this.binning.getSet();this.circleSets=b.circleSets;this.binSets=b.binSets;this.hashMapping=b.hashMaps;this.selectionHash=b.selectionHashs},getObjectsByZoom:function(){var a=Math.floor(this.olMap.getZoom());if(this.circleSets.length<a){return null}return this.circleSets[a]},getAllObjects:function(){if(this.circleSets.length==0){return null}return this.circleSets},getAllBins:function(){if(this.binSets.length==0){return null}return this.binSets},clearOverlay:function(){var c=Math.floor(this.olMap.getZoom());var d=this.circleSets[c];for(var b in d){for(var a in d[b]){d[b][a].reset()}}},setSelection:function(e,d){this.clearOverlay();var c=Math.floor(this.olMap.getZoom());for(var b in e){for(var a in e[b]){var g=e[b][a];this.selectionHash[c][b][g.index]=d;if(d){var f=this.hashMapping[c][b][g.index];f.overlay+=g.weight}}}},setOverlay:function(e){var d=Math.floor(this.olMap.getZoom());for(var c in e){var g=e[c].value;for(var b in e[c].objects){for(var a in e[c].objects[b]){var h=e[c].objects[b][a];if(this.selectionHash[d][b][h.index]){continue}var f=this.hashMapping[d][b][h.index];if(g==1){f.overlay+=h.weight}else{f.smoothness+=h.weight*g}}}}},size:function(){if(this.circleSets.length==0){return 0}return this.circleSets[0].length},getCircle:function(a,c){var b=Math.floor(this.olMap.getZoom());return this.hashMapping[b][a][c]}};CircleObject=function(c,b,h,g,f,a,d,e){this.originX=c;this.originY=b;this.shiftX=h;this.shiftY=g;this.elements=f;this.radius=a;this.search=d;this.weight=e;this.overlay=0;this.smoothness=0;this.feature;this.olFeature;this.percentage=0;this.selected=false};CircleObject.prototype={setFeature:function(a){this.feature=a},setOlFeature:function(a){this.olFeature=a},reset:function(){this.overlay=0;this.smoothness=0},setSelection:function(a){this.selected=a},toggleSelection:function(){this.selected=!this.selected},setPercentage:function(){if(this.weight==this.overlay){return false}var a=this.smoothness/(this.weight-this.overlay);if(a!=this.percentage){this.percentage=a;return true}return false}};function Vertex(a,d,b){this.x=a;this.y=d;this.radius;this.size=0;this.elements=[];this.radii=[];this.weights=[];this.legal=true;if(b!=undefined){for(var c=0;c<b;c++){this.elements.push([]);this.weights.push(0)}}}Vertex.prototype.merge=function(a,c){for(var b=0;b<a.elements.length;b++){this.elements[b]=a.elements[b].concat(c.elements[b]);this.weights[b]=a.weights[b]+c.weights[b];this.size+=this.weights[b]}};Vertex.prototype.CalculateRadius=function(e,c){this.radii=[];for(i in this.elements){this.radii.push(STIStatic.getRadius(this.weights[i],c))}if(this.radii.length==1){this.radius=this.radii[0]*e}else{var f=0;var b=0;var a=0;for(i in this.radii){if(this.radii[i]!=0){f++}if(this.radii[i]>b){if(b>a){a=b}b=this.radii[i]}else{if(this.radii[i]>a){a=this.radii[i]}}}if(f==1){this.radius=b*e}else{if(f==2){this.radius=(b+a)*e}else{if(f==3){var g=(2/3*Math.sqrt(3)-1)*b;this.radius=(g+b+a)*e}else{if(f==4){var g=(Math.sqrt(2)-1)*a;this.radius=(g+b+a)*e}}}}}};Vertex.prototype.addElement=function(c,b,a){this.elements[a].push(c);this.size+=b;this.weights[a]+=b};function Edge(a,b){this.v0=a;this.v1=b;this.leftFace;this.rightFace;this.legal=true;this.setLength()}Edge.prototype.setLength=function(){var b=this.v0.x-this.v1.x;var a=this.v0.y-this.v1.y;this.length=Math.sqrt(b*b+a*a)};Edge.prototype.contains=function(a){if(this.v0==a||this.v1==a){return true}return false};Edge.prototype.replaceFace=function(b,a){if(this.leftFace==b){this.leftFace=a}else{if(this.rightFace==b){this.rightFace=a}}};Edge.prototype.setFace=function(a){if(a.leftOf(this)){this.leftFace=a}else{this.rightFace=a}};Edge.prototype.setFaces=function(a,b){if(a.leftOf(this)){this.leftFace=a;this.rightFace=b}else{this.leftFace=b;this.rightFace=a}};Edge.prototype.removeFace=function(a){if(this.leftFace==a){this.leftFace=null}else{this.rightFace=null}};Edge.prototype.equals=function(a){if(this.v0==a.v0&&this.v1==a.v1||this.v0==a.v1&&this.v1==a.v0){return true}return false};function Triangle(a){this.edges=a;this.setVertices();this.descendants=[]}Triangle.prototype.getTriple=function(b){var a=arrayIndex(this.edges,b);return{e_s:this.edges[(a+1)%3],e_p:this.edges[(a+2)%3],u:this.vertices[(a+2)%3]}};Triangle.prototype.leftOf=function(b){var a=arrayIndex(this.edges,b);if(this.vertices[a].y!=this.vertices[(a+1)%3].y){return this.vertices[a].y>this.vertices[(a+1)%3].y}return this.vertices[a].y>this.vertices[(a+2)%3].y};Triangle.prototype.getNext=function(a){var b=arrayIndex(this.vertices,a);return this.vertices[(b+1)%3]};Triangle.prototype.oppositeEdge=function(a){var b=arrayIndex(this.vertices,a);return this.edges[(b+1)%3]};Triangle.prototype.contains=function(a){return arrayIndex(this.vertices,a)!=-1};Triangle.prototype.replace=function(a,b){this.edges[arrayIndex(this.edges,a)]=b};Triangle.prototype.setVertices=function(){if(this.edges[1].v0==this.edges[0].v0||this.edges[1].v1==this.edges[0].v0){this.vertices=[this.edges[0].v1,this.edges[0].v0]}else{this.vertices=[this.edges[0].v0,this.edges[0].v1]}if(this.edges[2].v0==this.vertices[0]){this.vertices.push(this.edges[2].v1)}else{this.vertices.push(this.edges[2].v0)}};Triangle.prototype.replaceBy=function(a){this.descendants=a;this.edges[0].replaceFace(this,a[0]);this.edges[1].replaceFace(this,a[1]);this.edges[2].replaceFace(this,a[2])};Triangle.prototype.CalcCircumcircle=function(){var j=this.vertices[0];var h=this.vertices[1];var g=this.vertices[2];var d=h.x-j.x;var c=h.y-j.y;var b=g.x-j.x;var a=g.y-j.y;var p=d*(j.x+h.x)+c*(j.y+h.y);var m=b*(j.x+g.x)+a*(j.y+g.y);var k=2*(d*(g.y-h.y)-c*(g.x-h.x));var f=(a*p-c*m)/k;var e=(d*m-b*p)/k;this.center=new Vertex(f,e);var o=this.center.x-j.x;var l=this.center.y-j.y;this.radius_squared=o*o+l*l};Triangle.prototype.inCircumcircle=function(c){if(this.radius_squared==undefined){this.CalcCircumcircle()}var b=this.center.x-c.x;var a=this.center.y-c.y;var d=b*b+a*a;return(d<=this.radius_squared)};Triangle.prototype.interior=function(b){var a=this.vertices[0];var g=this.vertices[1];var e=this.vertices[2];var d=(b.x-a.x)*(a.y-g.y)+(b.y-a.y)*(g.x-a.x);var f=(b.x-g.x)*(g.y-e.y)+(b.y-g.y)*(e.x-g.x);var c=(b.x-e.x)*(e.y-a.y)+(b.y-e.y)*(a.x-e.x);if(d>0||f>0||c>0){return null}else{if(d<0&&f<0&&c<0){return this}else{if(d==0){if(f==0){return this.vertices[1]}else{if(c==0){return this.vertices[0]}}return this.edges[0]}else{if(f==0){if(c==0){return this.vertices[2]}return this.edges[1]}else{if(c==0){return this.edges[2]}}}}}};function Clustering(b,a,d,c){this.triangles=[];this.newTriangles=[];this.bbox={x1:b,y1:a,x2:d,y2:c};this.CreateBoundingTriangle();this.edges=[];this.vertices=[];this.legalizes=0;this.collapses=0}Clustering.prototype.locate=function(b){if(this.boundingTriangle.descendants.length==0){return this.boundingTriangle}var d=this.boundingTriangle.descendants;while(true){for(var c=0;c<d.length;c++){var a=d[c].interior(b);if(a==null){continue}if(a instanceof Vertex||this.isLeaf(d[c])){return a}d=d[c].descendants;break}}};Clustering.prototype.legalize=function(m,j,l){if(!j.v0.legal&&!j.v1.legal){return}this.legalizes++;var g=false;var k,f;if(j.leftFace==l&&j.rightFace.inCircumcircle(m)){g=true;k=j.rightFace}else{if(j.rightFace==l&&j.leftFace.inCircumcircle(m)){g=true;k=j.leftFace}}if(g){var h=l.getTriple(j);var f=k.getTriple(j);var d=new Edge(h.u,f.u);var a=[];a.push(j.v0);a.push(d.v0);a.push(j.v1);a.push(d.v1);if(!this.JordanTest(a,d)){return}j.legal=false;this.edges.push(d);var c=new Triangle([d,h.e_p,f.e_s]);var b=new Triangle([d,f.e_p,h.e_s]);d.setFaces(c,b);h.e_p.replaceFace(l,c);f.e_s.replaceFace(k,c);f.e_p.replaceFace(k,b);h.e_s.replaceFace(l,b);l.descendants=[c,b];k.descendants=[c,b];this.legalize(m,c.edges[2],c);this.legalize(m,b.edges[1],b)}};Clustering.prototype.add=function(a){this.addVertex(a,this.locate(a))};Clustering.prototype.addVertex=function(p,q){if(q instanceof Vertex){q.merge(q,p)}else{if(q instanceof Edge){this.vertices.push(p);q.legal=false;var g=q.leftFace.getTriple(q);var e=q.rightFace.getTriple(q);var o=new Edge(p,g.u);var m=new Edge(p,q.leftFace.getNext(g.u));var l=new Edge(p,e.u);var k=new Edge(p,q.rightFace.getNext(e.u));var j=new Triangle([o,g.e_p,m]);var h=new Triangle([m,e.e_s,l]);var f=new Triangle([l,e.e_p,k]);var d=new Triangle([k,g.e_s,o]);q.leftFace.descendants=[j,d];q.rightFace.descendants=[h,f];this.edges.push(o);this.edges.push(m);this.edges.push(l);this.edges.push(k);o.setFaces(j,d);m.setFaces(j,h);l.setFaces(h,f);k.setFaces(f,d);g.e_p.replaceFace(q.leftFace,j);e.e_s.replaceFace(q.rightFace,h);e.e_p.replaceFace(q.rightFace,f);g.e_s.replaceFace(q.leftFace,d);this.legalize(p,g.e_p,j);this.legalize(p,e.e_s,h);this.legalize(p,e.e_p,f);this.legalize(p,g.e_s,d)}else{this.vertices.push(p);var c=new Edge(q.vertices[0],p);var b=new Edge(q.vertices[1],p);var a=new Edge(q.vertices[2],p);this.edges.push(c);this.edges.push(b);this.edges.push(a);var j=new Triangle([c,q.edges[0],b]);var h=new Triangle([b,q.edges[1],a]);var f=new Triangle([a,q.edges[2],c]);c.setFaces(j,f);b.setFaces(j,h);a.setFaces(h,f);q.replaceBy([j,h,f]);this.legalize(p,q.edges[0],j);this.legalize(p,q.edges[1],h);this.legalize(p,q.edges[2],f)}}};Clustering.prototype.isLeaf=function(a){return a.descendants.length==0};Clustering.prototype.CreateBoundingTriangle=function(){var j=(this.bbox.x2-this.bbox.x1)*10;var h=(this.bbox.y2-this.bbox.y1)*10;var g=new Vertex(this.bbox.x1-j,this.bbox.y1-h*3);var f=new Vertex(this.bbox.x2+j*3,this.bbox.y2+h);var e=new Vertex(this.bbox.x1-j,this.bbox.y2+h);var d=new Edge(f,g);var c=new Edge(g,e);var b=new Edge(e,f);g.legal=false;f.legal=false;e.legal=false;this.boundingTriangle=new Triangle([d,c,b]);var a=new Triangle([d,c,b]);d.setFaces(this.boundingTriangle,a);c.setFaces(this.boundingTriangle,a);b.setFaces(this.boundingTriangle,a)};Clustering.prototype.mergeVertices=function(F){this.collapses++;var g=F.v0.size;var f=F.v1.size;var s=(F.v0.x*g+F.v1.x*f)/(g+f);var q=(F.v0.y*g+F.v1.y*f)/(g+f);var w=new Vertex(s,q,F.v0.elements.length);w.merge(F.v0,F.v1);F.v0.legal=false;F.v1.legal=false;var z=[];var D=[];F.legal=false;var o=[];var E=function(b,v,e){b.legal=false;do{var j;if(b.leftFace==e){j=b.rightFace.getTriple(b);D.push(b.rightFace);j.e_s.removeFace(b.rightFace);e=b.rightFace}else{j=b.leftFace.getTriple(b);D.push(b.leftFace);j.e_s.removeFace(b.leftFace);e=b.leftFace}if(arrayIndex(z,j.e_s)==-1){z.push(j.e_s)}o.push(j.u);b=j.e_p;b.legal=false}while(b!=v)};var I=F.leftFace.getTriple(F);var H=F.rightFace.getTriple(F);D.push(F.leftFace);D.push(F.rightFace);E(I.e_p,H.e_s,F.leftFace);E(H.e_p,I.e_s,F.rightFace);var m=new Clustering(this.bbox.x1-10,this.bbox.y1-10,this.bbox.x2+10,this.bbox.y2+10);var A=[];for(var C in z){if(!(z[C].leftFace==null&&z[C].rightFace==null)){A.push(z[C].v0);A.push(z[C].v1)}}var k=[];var a=[];for(var C in o){if(arrayIndex(a,o[C])==-1){m.add(o[C]);a.push(o[C])}if(arrayIndex(A,o[C])!=-1){k.push(o[C])}}var c=[];var d=function(j){for(var b=0;b<z.length;b++){if(z[b].equals(j)){return b}}return -1};var h=new Array(z.length);var u=[];for(var C=0;C<m.edges.length;C++){var F=m.edges[C];var G=d(F);if(G!=-1){if(!F.legal){var r=F.leftFace.getTriple(F);var p=F.rightFace.getTriple(F);var l=new Edge(r.u,p.u);for(var B=0;B<m.edges.length;B++){if(m.edges[B].equals(l)&&m.edges[B].legal){m.edges[B].legal=false;break}}r.e_p.setFace(F.leftFace);r.e_s.setFace(F.leftFace);p.e_p.setFace(F.rightFace);p.e_s.setFace(F.rightFace);F.legal=true}h[G]=F}else{u.push(F)}}for(var C=0;C<h.length;C++){var F=h[C];if(z[C].leftFace==null){z[C].leftFace=F.leftFace;z[C].leftFace.replace(F,z[C]);if(arrayIndex(c,z[C].leftFace)==-1){c.push(z[C].leftFace)}}if(z[C].rightFace==null){z[C].rightFace=F.rightFace;z[C].rightFace.replace(F,z[C]);if(arrayIndex(c,z[C].rightFace)==-1){c.push(z[C].rightFace)}}}for(var C=0;C<u.length;C++){var F=u[C];if(!F.legal){continue}if(this.JordanTest(k,F)){this.edges.push(F);if(arrayIndex(c,F.rightFace)==-1){c.push(F.rightFace)}if(arrayIndex(c,F.leftFace)==-1){c.push(F.leftFace)}}}for(var C in D){D[C].descendants=c}for(var C=0;C<c.length;C++){var t=c[C].interior(w);if(t==null){continue}else{this.addVertex(w,t);break}}return w};Clustering.prototype.JordanTest=function(d,h){var g=new Vertex((h.v0.x+h.v1.x)*0.5,(h.v0.y+h.v1.y)*0.5);var a=false;var c,b=d.length-1;for(c=0;c<d.length;b=c++){var k=d[c];var f=d[b];if((((k.y<=g.y)&&(g.y<f.y))||((f.y<=g.y)&&(g.y<k.y)))&&(g.x<(f.x-k.x)*(g.y-k.y)/(f.y-k.y)+k.x)){a=!a}}return a};Clustering.prototype.mergeForResolution=function(f,d){this.deleteEdges=new BinaryHeap(function(k){return k.weight});this.weightEdges(f,d);var c=0;while(this.deleteEdges.size()>0){var j=this.deleteEdges.pop();if(j.legal){var a=this.edges.length;var h=this.mergeVertices(j);h.CalculateRadius(f,d);for(var b=a;b<this.edges.length;b++){var g=this.edges[b];if(g.legal){g.weight=g.length/(g.v0.radius+g.v1.radius+STIStatic.circleGap*f);if(g.weight<1){this.deleteEdges.push(g)}}}}}};Clustering.prototype.weightEdges=function(c,b){for(var d=0;d<this.vertices.length;d++){if(this.vertices[d].legal){this.vertices[d].CalculateRadius(c,b)}}var a=[];for(var d=0;d<this.edges.length;d++){var f=this.edges[d];if(f.legal){if(!f.v0.legal||!f.v1.legal){f.weight=1}else{f.weight=f.length/(f.v0.radius+f.v1.radius+STIStatic.circleGap*c);if(f.weight<1){this.deleteEdges.push(f)}}a.push(f)}}this.edges=a};Clustering.prototype.ValidityTest=function(){console.info("Test 1: Valid Delaunay ...");for(i in this.edges){var h=this.edges[i];if(h.leftFace==null||h.rightFace==null){console.info(h);alert()}}var a=function(r,q,m){var e=r.x-q.x;var c=r.x-m.x;var p=r.y-q.y;var o=r.y-m.y;if(e*o-p*c<0){return true}return false};var j=0;for(i in this.edges){var h=this.edges[i];var g=h.leftFace.getTriple(h);var d=h.rightFace.getTriple(h);if(h.v0.y==h.v1.y){if(g.u.y>d.u.y){console.info("equal y conflict ...");console.info(h);alert();j++}}else{var l,k;if(h.v0.y>h.v1.y){l=h.v0;k=h.v1}else{l=h.v1;k=h.v0}if(!a(l,k,g.u)){console.info("left right conflict ... left is right");console.info(h);alert();j++}if(a(l,k,d.u)){console.info("left right conflict ... right is left");console.info(h);alert();j++}}}for(i in this.edges){if(this.edges[i].legal){var h=this.edges[i];var f=h.leftFace.getTriple(h);var b=h.rightFace.getTriple(h);if(!f.e_p.legal||!f.e_s.legal||!b.e_p.legal||!b.e_s.legal){console.info(h);console.info("conflict in edge continuity");return}}}};function BinaryHeap(a){this.content=[];this.scoreFunction=a}BinaryHeap.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0];var b=this.content.pop();if(this.content.length>0){this.content[0]=b;this.sinkDown(0)}return a},remove:function(d){var a=this.content.length;for(var c=0;c<a;c++){if(this.content[c]==d){var b=this.content.pop();if(c!=a-1){this.content[c]=b;if(this.scoreFunction(b)<this.scoreFunction(d)){this.bubbleUp(c)}else{this.sinkDown(c)}}return}}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(d){var a=this.content[d];while(d>0){var c=Math.floor((d+1)/2)-1,b=this.content[c];if(this.scoreFunction(a)<this.scoreFunction(b)){this.content[c]=a;this.content[d]=b;d=c}else{break}}},sinkDown:function(b){var a=this.content.length,f=this.content[b],h=this.scoreFunction(f);while(true){var e=(b+1)*2,k=e-1;var c=null;if(k<a){var j=this.content[k],l=this.scoreFunction(j);if(l<h){c=k}}if(e<a){var g=this.content[e],d=this.scoreFunction(g);if(d<(c==null?h:l)){c=e}}if(c!=null){this.content[b]=this.content[c];this.content[c]=f;b=c}else{break}}}};var infinity=100000000000;function Edge2(e,c,d){this.v1=e;this.v2=c;this.wt=d}function setEdgeAdjMatrix(d,b,a){if(b>d){var c=d;d=b;b=c}this.matrix[d][b]=a}function randomAdjMatrix(c){var b,a;for(b=0;b<this.Vertices;b++){for(a=0;a<b;a++){if(Math.random()<=c){this.setEdge(b,a,1+Math.round(Math.random()*8))}}}}function edgeWeightAdjMatrix(b,a){return b>=a?this.matrix[b][a]:this.matrix[a][b]}function adjacentAdjMatrix(b,a){return this.edgeWeight(b,a)<infinity}function AdjMatrix(a){this.Vertices=a;this.edgeWeight=edgeWeightAdjMatrix;this.adjacent=adjacentAdjMatrix;this.random=randomAdjMatrix;this.setEdge=setEdgeAdjMatrix;this.matrix=new Array(a);var c,b;for(c=0;c<a;c++){this.matrix[c]=new Array(c+1);for(b=0;b<=c;b++){this.setEdge(c,b,infinity)}}}function AdjListCell(b,a,c){this.v=b;this.wt=a;this.tl=c}function AdjListFromAdjMatrix(b){var d,c;this.Vertices=b.Vertices;for(d=0;d<this.Vertices;d++){this.vertex[d]=null;for(c=this.Vertices-1;c>=d;c--){if(b.adjacent(d,c)){var a=b.edgeWeight(d,c);this.vertex[d]=new AdjListCell(c,a,this.vertex[d])}}}}function AdjList(a){this.Vertices=a;this.fromAdjMatrix=AdjListFromAdjMatrix;this.vertex=new Array(a);var b;for(b=0;b<a;b++){this.vertex[b]=null}}function Prim(f){var c=new Array(f.Vertices-1);var d;var a=new Array(f.Vertices);a[0]=true;for(d=1;d<f.Vertices;d++){c[d-1]=new Edge2(0,d,f.edgeWeight(0,d));a[d]=false}var e;for(e=1;e<f.Vertices;e++){var b=infinity,h=-1;for(d=1;d<f.Vertices;d++){if(!a[d]&&c[d-1].wt<=b){b=c[d-1].wt;h=d}}a[h]=true;for(d=1;d<f.Vertices;d++){if(!a[d]){var g=f.edgeWeight(h,d);if(g<c[d-1].wt){c[d-1].wt=g;c[d-1].v1=h}}}}return c}function PartitionMerge(f,d){var c,b;if(this.subset[f].nElts<this.subset[d].nElts){c=f;b=d}else{c=d;b=f}var e=this.subset[c].firstElt;var a=false;while(!a){this.elt[e].setNumber=b;if(this.elt[e].nextElt<0){a=true}else{e=this.elt[e].nextElt}}this.elt[e].nextElt=this.subset[b].firstElt;this.subset[b].firstElt=this.subset[c].firstElt;this.subset[b].nElts+=this.subset[c].nElts;this.subset[c].firstElt=-1;this.subset[c].nElts=0;this.size--}function PartitionEltCell(b,a){this.setNumber=b;this.nextElt=a}function PartitionSetCell(b,a){this.nElts=b;this.firstElt=a}function PartitionSingletons(){var a;this.size=(this.elt).length;for(a=0;a<this.size;a++){this.elt[a]=new PartitionEltCell(a,-1);this.subset[a]=new PartitionSetCell(1,a)}}function Partition(a){this.elt=new Array(a);this.subset=new Array(a);this.singletons=PartitionSingletons;this.merge=PartitionMerge}function upHeap(b){this.size++;var c=this.size,a;while(c>1){a=Math.floor(c/2);if(this.arr[a].wt>b.wt){this.arr[c]=this.arr[a]}else{break}c=a}this.arr[c]=b}function downHeap(b){var a=1,c;while(2*a<=this.size){c=2*a;if(c<this.size&&this.arr[c+1].wt<this.arr[c].wt){c++}if(this.arr[c].wt<b.wt){this.arr[a]=this.arr[c]}else{break}a=c}this.arr[a]=b}function topHeap(){var a=this.arr[1];this.size--;if(this.size<=0){return a}this.downHeap(this.arr[this.size+1]);return a}function PriorityQ(){this.arr=new Array();this.size=0;this.pushq=upHeap;this.popq=topHeap;this.downHeap=downHeap}function Kruskal(d){var c;var b=new Array();var f=new PriorityQ();for(c=0;c<d.Vertices;c++){var a=d.vertex[c];while(a!=null){f.pushq(new Edge2(c,a.v,a.wt));a=a.tl}}var j=0;var g=new Partition(d.Vertices);g.singletons();while(g.size>1){if(f.size<=0){break}var h=f.popq();if(g.elt[h.v1].setNumber!=g.elt[h.v2].setNumber){b[j]=h;j++;g.merge(g.elt[h.v1].setNumber,g.elt[h.v2].setNumber)}}return b}function Dropdown(h,a,k){var j=this;this.visibility=false;this.div=document.createElement("div");this.div.setAttribute("class","dropdown");this.selection=document.createElement("div");this.selection.setAttribute("class","dropdownSelection");h.appendChild(this.div);var b=document.createElement("div");b.setAttribute("class","dropdownLeft");this.div.appendChild(b);this.div.appendChild(this.selection);var f=document.createElement("div");this.div.appendChild(f);if(a.length>1){f.setAttribute("class","dropdownButtonEnabled")}else{f.setAttribute("class","dropdownButtonDisabled")}f.onclick=function(){if(a.length>1){j.changeVisibility()}};f.title=k;this.getValue=function(){return this.selectedEntry.innerHTML};var g=document.createElement("div");g.setAttribute("class","dropdownMenu");this.div.appendChild(g);var e=document.createElement("dl");var c=function(m){var l=document.createElement("dt");l.innerHTML=m.name;l.onclick=function(){m.onclick();j.changeVisibility();j.changeEntries(m)};e.appendChild(l);m.entry=l};for(var d=0;d<a.length;d++){c(a[d])}g.appendChild(e);this.selection.style.width=g.offsetWidth+"px";g.style.width=(g.offsetWidth+b.offsetWidth+f.offsetWidth-2)+"px";this.div.style.maxHeight=this.div.offsetHeight+"px";g.style.display="none";this.setEntry=function(l){if(typeof(l)=="undefined"){if((a)&&a.length>0){this.changeEntries(a[0])}}else{this.changeEntries(a[l])}};this.changeEntries=function(l){if(this.selectedEntry){this.selectedEntry.setAttribute("class","dropdownUnselectedEntry")}this.selectedEntry=l.entry;this.selectedEntry.setAttribute("class","dropdownSelectedEntry");this.selection.innerHTML="<div style='display:inline-block;vertical-align:middle;'>"+l.name+"</div>"};this.changeVisibility=function(){this.visibility=!this.visibility;if(this.visibility){g.style.display="block"}else{g.style.display="none"}}}function MapZoomSlider(c,b){this.parent=c;var f=this;this.div=document.createElement("div");this.div.setAttribute("class","sliderStyle-"+b);var e=document.createElement("div");e.setAttribute("class","zoomSliderContainer-"+b);var g=document.createElement("div");g.tabIndex=1;var d=document.createElement("div");g.appendChild(d);e.appendChild(g);this.slider=new Slider(g,d,b);this.div.appendChild(e);var h=document.createElement("img");h.src=STIStatic.path+"zoom_in.png";h.setAttribute("class","zoomSliderIn-"+b);h.onclick=function(){f.parent.zoom(1)};this.div.appendChild(h);var a=document.createElement("img");a.src=STIStatic.path+"zoom_out.png";a.setAttribute("class","zoomSliderOut-"+b);a.onclick=function(){f.parent.zoom(-1)};this.div.appendChild(a);this.slider.onclick=function(){console.info(f.slider.getValue())};this.slider.handle.onmousedown=function(){var j=f.slider.getValue();document.onmouseup=function(){if(!f.parent.zoom((f.slider.getValue()-j)/f.max*f.levels)){f.setValue(j)}document.onmouseup=null}};this.setValue=function(j){this.slider.setValue(j/this.levels*this.max)};this.setMaxAndLevels=function(j,k){this.max=j;this.levels=k;this.slider.setMaximum(j)};this.setLanguage=function(){h.title=STIStatic.getString("zoomIn");a.title=STIStatic.getString("zoomOut");this.slider.handle.title=STIStatic.getString("zoomSlider")}}function Popup(a){this.parentDiv=a.mapWindow;this.initialize=function(b,j,h,g){var c=this;this.x=b;this.y=j;this.popupDiv=document.createElement("div");this.popupDiv.setAttribute("class","ddbPopupDiv");this.parentDiv.appendChild(this.popupDiv);this.cancel=document.createElement("div");this.cancel.setAttribute("class","ddbPopupCancel");this.cancel.onclick=function(){if(typeof g!="undefined"){g()}c.reset()};this.input=document.createElement("div");this.input.style.maxWidth=Math.floor(this.parentDiv.offsetWidth*0.75)+"px";this.input.style.maxHeight=Math.floor(this.parentDiv.offsetHeight*0.75)+"px";this.input.setAttribute("class","ddbPopupInput");this.popupDiv.appendChild(this.input);this.popupDiv.appendChild(this.cancel);var f=document.createElement("div");f.setAttribute("class","popupPeak");this.popupDiv.appendChild(f);var e=document.createElement("div");e.setAttribute("class","popupTopRight");this.popupDiv.appendChild(e);var d=document.createElement("div");d.setAttribute("class","popupBottomRight");this.popupDiv.appendChild(d);this.popupRight=document.createElement("div");this.popupRight.setAttribute("class","popupRight");this.popupDiv.appendChild(this.popupRight);this.popupBottom=document.createElement("div");this.popupBottom.setAttribute("class","popupBottom");this.popupDiv.appendChild(this.popupBottom);this.visible=true;$(this.input).append(h);this.decorate()};this.reset=function(){$(this.popupDiv).remove();this.visible=false};this.updateContent=function(b){$(this.input).empty();$(this.input).append(b)};this.decorate=function(){this.popupRight.style.height=(this.popupDiv.offsetHeight-14)+"px";this.popupBottom.style.width=(this.popupDiv.offsetWidth-22)+"px";this.left=this.x+9;this.top=this.y-10-this.popupDiv.offsetHeight;this.popupDiv.style.left=this.left+"px";this.popupDiv.style.top=this.top+"px";var c=0,b=0;if(this.popupDiv.offsetTop<gui.mapToolbar.offsetHeight+10){b=-1*(gui.mapToolbar.offsetHeight+10-this.popupDiv.offsetTop)}if(this.popupDiv.offsetLeft+this.popupDiv.offsetWidth>gui.mapToolbar.offsetWidth-10){c=-1*(gui.mapToolbar.offsetWidth-10-this.popupDiv.offsetLeft-this.popupDiv.offsetWidth)}gui.map.shift(c,b)};this.shift=function(b,c){this.left=this.left-this.x+b;this.top=this.top-this.y+c;this.x=b;this.y=c;if(this.left+this.popupDiv.offsetWidth>this.parentDiv.offsetWidth){this.popupDiv.style.left="auto";this.popupDiv.style.right=(this.parentDiv.offsetWidth-this.left-this.popupDiv.offsetWidth)+"px"}else{this.popupDiv.style.right="auto";this.popupDiv.style.left=this.left+"px"}this.popupDiv.style.top=this.top+"px"}}if(typeof Publisher=="undefined"){Publisher=function(){var a=new Array();this.Get=function(b){var c=this[b];if(!c){c=this[b]=[]}return c};this.Publish=function(b,e,d){var f=this.Get(b);for(var c=0;c<f.length;c++){if(d==null||f[c].client!=d){f[c].callback(e)}}};this.Subscribe=function(b,c,e){var d=this.Get(b);d.push({client:c,callback:e})};this.Unsubscribe=function(b,d){var e=this.Get(b);for(var c=0;c<e.length;c++){if(e[c].client==d){e.splice(c,1);return}}};return this}()}OpenLayers.Util.getImagesLocation=function(){return STIMinifier_urlPrefix+"images/"};OpenLayers.Map.prototype.initialize=function(h,d){if(arguments.length===1&&typeof h==="object"){d=h;h=d&&d.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=STIMinifier_urlPrefix+"minify/stif-styles.css";OpenLayers.Util.extend(this,d);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(h);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var g=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);g=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(g);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.viewPortDiv.appendChild(this.layerContainerDiv);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:true});this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var f=true;var c=document.getElementsByTagName("link");for(var e=0,a=c.length;e<a;++e){if(OpenLayers.Util.isEquivalentUrl(c.item(e).href,this.theme)){f=false;break}}if(f){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(b)}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var e=0,a=this.controls.length;e<a;e++){this.addControlToMap(this.controls[e])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(d&&d.layers){this.addLayers(d.layers);if(d.center){this.setCenter(d.center,d.zoom)}}};STIStatic.configure(STIMinifier_urlPrefix);var fullscreen=new function(){this.fullscreens=[];this.zIndex=5;this.margin=20;this.frameContainer=function(a){var c=$("<div/>");c.addClass("blockContent");var b=$("<div/>");b.addClass("closeFullscreeen");c.append(b);b.click(function(){if(a){a()}fullscreen.removeFullscreen()});return c};this.dialogContent=function(f){var j=function(){f.appendToParent()};var e=this.frameContainer(j);var b=$("<div/>").appendTo(e);var k=Archaeo18_properties.fullscreenFormatX;var g=Archaeo18_properties.fullscreenFormatY;var m,d,o,c;if(k&&g){if(k>g){m=$(document).width()-100;d=Math.floor(m*g/k);c=50;o=Math.floor(($(document).height()-d)/2)}else{d=$(document).height()-100;m=Math.floor(d*k/g);c=Math.floor(($(document).width()-m)/2);o=50}}else{d=$(document).height()-100;m=$(document).width()-100;c=50;o=50}m-=2*this.margin;d-=2*this.margin;b.css("margin",this.margin+"px");b.css("width",(m+2*this.margin)+"px");b.css("height",(d+2*this.margin)+"px");var a=$("<div/>");a.addClass("fullscreenHeader");a.attr("innerHTML",f.document.title);a.css("padding-bottom","10px");b.append(a);b.append(f.container);return e};this.loaderContent=function(){var a=new Image();a.src=STIStatic.path+"ajax-loader.gif";var b=$("<div/>");b.css("position","absolute");b.append('<div id="FullscreenWindowHeader" align="center"><h1>Starting STIF.... </h1></div>');b.append("<img src='"+a.src+"'/>");b.append('<div id="FullscreenWindowLog" align="center">Loading scripts</div>');return b};this.downloadContent=function(a){var g=this.frameContainer();var b=$("<div/>").appendTo(g);b.css("margin",this.margin+"px");b.css("width","400px");b.css("font-family","Arial");var c=a.substring(a.lastIndexOf("/")+1);b.append("<h2 style='text-align:center;'>"+Archaeo18Gui.getString("downloadHeader")+"</h2>");b.append("<p style='text-align:center;'>"+c+"</p>");var j;var e=BrowserDetect.browser;if(e=="Chrome"||e=="Firefox"||e=="Safari"||e=="Opera"||e=="Explorer"){j=Archaeo18Gui.getString("downloadSave")+" <strong>"+Archaeo18Gui.getString(e+"Download")+"</strong>"}else{j=Archaeo18Gui.getString("DefaultDownload")}b.append("<p>1. <strong>"+Archaeo18Gui.getString("save")+"</strong>: <br>"+j+"</p>");var d="<a href='"+a+"'><img src='images/tei.png'/></a>";b.append("<p style='text-align:center;'>"+d+"</p>");var f=Archaeo18Gui.getString("open");var h=Archaeo18Gui.getString("downloadOpen");var k="<a href='"+a+"' target='_blank'>"+Archaeo18Gui.getString("here")+"</a>";b.append("<p>2. <strong>"+f+"</strong>: <br>"+h+" <strong>"+k+"</strong> ...</p>");return g};this.addFullscreen=function(b){var c=$("<div/>").appendTo("body");c.addClass("blockDiv");c.css("width",$(document).width()+"px");c.css("height",$(document).height()+"px");var a=$("<div/>").appendTo(c);a.addClass("blockDivOverlay");a.css("width",$(document).width()+"px");a.css("height",$(document).height()+"px");$(b).appendTo(c);this.fullscreens.push({content:b,overlay:a,blockDiv:c});this.centerDiv(b)};this.centerDiv=function(c){var b=Math.floor($(document).width()/2-c.width()/2);var a=Math.floor($(window).height()/2-c.height()/2);c.css("top",a+"px");c.css("left",b+"px")};this.removeFullscreen=function(){$(this.fullscreens[this.fullscreens.length-1].blockDiv).remove();this.fullscreens.pop()};this.resize=function(){for(var a in this.fullscreens){this.fullscreens[a].blockDiv.css("width",$(document).width()+"px");this.fullscreens[a].blockDiv.css("height",$(document).height()+"px");this.fullscreens[a].overlay.css("width",$(document).width()+"px");this.fullscreens[a].overlay.css("height",$(document).height()+"px");this.centerDiv(this.fullscreens[a].content)}}};function MapWidget(a,d,b,c){this.core=a;this.openlayersMap;this.baseLayers;this.objectLayer;this.placeIndex=b;this.drawPolygon;this.drawCircle;this.selectCountry;this.dragArea;this.selectFeature;this.navigation;this.div=d;this.gui=new MapGui(this,this.div,c);this.initialize()}MapWidget.prototype={initialize:function(){if(STIStatic.proxyHost){OpenLayers.ProxyHost=STIStatic.proxyHost}var d=this;this.polygons=[];this.connections=[];this.selectedObjects=[];this.foreignSelection=[];this.wmsOverlays=[];this.layerZIndex=1;this.zIndices=[];var e=function(){d.dragArea.activate()};var b=function(){d.dragArea.deactivate()};this.dragControl=new MapControl(this,null,"drag",e,b);var l="http://www.openstreetmap.org/";var o="http://creativecommons.org/licenses/by-sa/2.0/";this.osmLink=document.createElement("div");this.osmLink.setAttribute("class","osmLink");this.osmLink.innerHTML="?? <a href="+l+">OpenStreetMap contributors</a>, <a href="+o+">CC-BY-SA</a>";this.gui.mapWindow.appendChild(this.osmLink);this.filterBar=new FilterBar(this,this.gui.mapWindow);this.objectLayer=new OpenLayers.Layer.Vector("Data Objects",{projection:"EPSG:4326",displayInLayerSwitcher:false,rendererOptions:{zIndexing:true}});this.markerLayer=new OpenLayers.Layer.Markers("Markers");this.navigation=new OpenLayers.Control.Navigation({zoomWheelEnabled:STIStatic.mouseWheelZoom});this.navigation.defaultDblClick=function(r){var q=this.map.getLonLatFromViewPortPx(r.xy);this.map.setCenter(q,this.map.zoom+1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}};this.navigation.wheelUp=function(q){this.wheelChange(q,1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}};this.navigation.wheelDown=function(q){this.wheelChange(q,-1);d.drawObjectLayer(false);if(d.zoomSlider){d.zoomSlider.setValue(d.openlayersMap.getZoom())}};this.resolutions=[78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677];var p={controls:[this.navigation,new OpenLayers.Control.ScaleLine()],projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),resolutions:this.resolutions,units:"meters",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34)};this.openlayersMap=new OpenLayers.Map("mapContainer",p);this.setBaseLayers();this.gui.setMapsDropdown();this.gui.setMap();this.openlayersMap.fractionalZoom=false;if(STIStatic.navigate){this.activeControl="navigate"}this.mds=new MapDataSource(this.openlayersMap,this.placeIndex);var f=STIStatic.boundaries;var c=new OpenLayers.Bounds(f.minLon,f.minLat,f.maxLon,f.maxLat);var m=c.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.zoomToExtent(m);this.openlayersMap.addLayers([this.objectLayer,this.markerLayer]);if(STIStatic.olNavigation){this.zoomPanel=new OpenLayers.Control.ModifiedZoomPanel();this.zoomPanel.zoomIn.trigger=function(){d.zoom(1)};this.zoomPanel.zoomOut.trigger=function(){d.zoom(-1)};this.zoomPanel.zoomToMaxExtent.trigger=function(){if(this.map){d.zoom(this.map.zoom*-1)}};this.openlayersMap.addControl(this.zoomPanel);this.openlayersMap.addControl(new OpenLayers.Control.PanPanel())}if(STIStatic.popups){var g=function(){if(d.selectedGlyph){var r=new OpenLayers.LonLat(d.selectedGlyph.lon,d.selectedGlyph.lat);var q=d.openlayersMap.getPixelFromLonLat(r);if(d.popup){d.popup.shift(q.x,q.y)}}};this.openlayersMap.events.register("move",this.openlayersMap,g)}if(STIStatic.mapOverview){this.openlayersMap.addControl(new OpenLayers.Control.OverviewMap())}if(STIStatic.keyboardDefaults){this.openlayersMap.addControl(new OpenLayers.Control.KeyboardDefaults())}if(STIStatic.layerSwitcher){this.openlayersMap.addControl(new OpenLayers.Control.LayerSwitcher())}this.drawnPolygonHandler=function(t){if(d.mds.getAllObjects()==null){return}var r;if(t instanceof OpenLayers.Geometry.Polygon){r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon([t]))}else{if(t instanceof OpenLayers.Geometry.MultiPolygon){r=new OpenLayers.Feature.Vector(t)}}d.polygons.push(r);var u=$.extend(true,{},OpenLayers.Feature.Vector.style["default"]);u.graphicZIndex=0;r.style=u;d.objectLayer.addFeatures([r]);try{d.activeControl.deactivate()}catch(v){}var w=d.mds.getObjectsByZoom();for(var s=0;s<w.length;s++){for(var q=0;q<w[s].length;q++){var x=w[s][q];if(d.inPolygon(x)){x.setSelection(true)}}}d.mapSelection()};this.polygonDeselection=function(){var s=d.mds.getObjectsByZoom();for(var r=0;r<s.length;r++){for(var q=0;q<s[r].length;q++){var t=s[r][q];if(d.inPolygon(t)){t.setSelection(false)}}}};this.snapper=function(){if(d.polygons.length==0||!STIStatic.multiSelection){d.deselection()}};if(STIStatic.polygonSelect){this.drawPolygon=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawPolygon)}if(STIStatic.circleSelect){this.drawCircle=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:40},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawCircle)}if(STIStatic.squareSelect){this.drawSquare=new OpenLayers.Control.DrawFeature(d.objectLayer,OpenLayers.Handler.RegularPolygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{sides:4},callbacks:{done:d.drawnPolygonHandler,create:d.snapper}});this.openlayersMap.addControl(this.drawSquare)}if(STIStatic.polygonSelect||STIStatic.circleSelect||STIStatic.squareSelect){this.dragArea=new OpenLayers.Control.DragFeature(d.objectLayer,{onStart:function(q){q.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(q){q.style.graphicZIndex=0;d.drawnPolygonHandler(q.geometry)}});this.openlayersMap.addControl(this.dragArea);this.modifyArea=new OpenLayers.Control.ModifyFeature(d.objectLayer,{onStart:function(q){q.style.graphicZIndex=10000;d.polygonDeselection()},onComplete:function(q){q.style.graphicZIndex=0;d.drawnPolygonHandler(q.geometry)}});this.openlayersMap.addControl(this.modifyArea);this.modifyArea.mode=OpenLayers.Control.ModifyFeature.RESHAPE}var a=function(r){var q=r.feature;if(q.geometry instanceof OpenLayers.Geometry.Point){var s=r.feature.parent;s.placenameTags=new PlacenameTags(s,d);s.placenameTags.calculate();d.mapCircleHighlight(q.parent,false);d.hoverCircle=s;if(typeof d.featureInfo!="undefined"){d.featureInfo.deactivate()}}else{d.dragControl.checkStatus()}};var h=function(r){var q=r.feature;if(q.geometry instanceof OpenLayers.Geometry.Point){var s=r.feature.parent;s.placenameTags.remove();d.hoverCircle=undefined;d.mapCircleHighlight(q.parent,true);if(typeof d.featureInfo!="undefined"){d.featureInfo.activate()}}else{d.dragControl.deactivate()}};var k=new OpenLayers.Control.SelectFeature(this.objectLayer,{hover:true,highlightOnly:true,renderIntent:"temporary",eventListeners:{featurehighlighted:a,featureunhighlighted:h}});this.openlayersMap.addControl(k);k.activate();this.selectFeature=new OpenLayers.Control.SelectFeature(this.objectLayer);document.onkeydown=function(q){if(q.ctrlKey){d.ctrlKey=true}};document.onkeyup=function(q){d.ctrlKey=false};var j=function(s,q){if(!(s.feature.geometry instanceof OpenLayers.Geometry.Point)){return}var u=s.feature.parent;if(STIStatic.individualSelection&&d.ctrlKey){if(d.popup){d.popup.reset();d.selectedGlyph=false}u.toggleSelection();d.mapSelection();return}d.reset();u.setSelection(true);d.objectLayer.drawFeature(u.feature);if(STIStatic.popups){if(d.popup){d.popup.reset()}var t=s.feature.geometry.getBounds().getCenterLonLat();var r=d.openlayersMap.getPixelFromLonLat(t);d.selectedGlyph={lon:t.lon,lat:t.lat};d.popup=new PlacenamePopup(d);d.popup.createPopup(r.x,r.y,u.placenameTags.placeLabels);if(STIStatic.selectDefault){u.placenameTags.selectLabel()}}else{d.openlayersMap.setCenter(s.feature.geometry.getBounds().getCenterLonLat());d.placeTagCloud(point);if(STIStatic.selectDefault){u.placenameTags.selectLabel()}}};this.objectLayer.events.on({featureselected:j});this.openlayersMap.addControl(this.selectFeature);this.selectFeature.activate();if(this.zoomSlider){this.zoomSlider.setMaxAndLevels(1000,this.openlayersMap.getNumZoomLevels());this.zoomSlider.setValue(this.openlayersMap.getZoom())}},shift:function(b,a){this.openlayersMap.pan(b,a)},addBaseLayers:function(c){if(c instanceof Array){for(var b in c){var a=new OpenLayers.Layer.WMS(c[b].name,c[b].url,{projection:"EPSG:4326",layers:c[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:true});this.baseLayers.push(a);this.openlayersMap.addLayers([a])}}this.gui.setMapsDropdown()},setBaseLayers:function(){this.baseLayers=[];if(STIStatic.googleMaps){this.baseLayers.push(new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN}));this.baseLayers.push(new OpenLayers.Layer.Google("Google Streets"));this.baseLayers.push(new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.HYBRID}));this.baseLayers.push(new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.SATELLITE}))}if(STIStatic.bingMaps){var b=STIStatic.bingApiKey;this.baseLayers.push(new OpenLayers.Layer.Bing({key:b,type:"Road"}));this.baseLayers.push(new OpenLayers.Layer.Bing({key:b,type:"Aerial"}));this.baseLayers.push(new OpenLayers.Layer.Bing({key:b,type:"AerialWithLabels",name:"Bing Aerial With Labels"}))}if(STIStatic.osmMaps){this.baseLayers.push(new OpenLayers.Layer.OSM("Open Street Map","",{sphericalMercator:true,zoomOffset:1,resolutions:this.resolutions}))}for(var a=0;a<this.baseLayers.length;a++){this.openlayersMap.addLayers([this.baseLayers[a]])}if(STIStatic.alternativeMap){this.addBaseLayers([STIStatic.alternativeMap])}for(var a=0;a<this.baseLayers.length;a++){if(this.baseLayers[a].name==STIStatic.baseLayer){this.setMap(a)}}},getBaseLayerName:function(){return this.openlayersMap.baseLayer.name},setOverlays:function(e){for(var b in this.wmsOverlays){this.openlayersMap.removeLayer(this.wmsOverlays[b])}this.wmsOverlays=[];var c=[];if(e instanceof Array){for(var b in e){var a=new OpenLayers.Layer.WMS(e[b].name,e[b].url,{projection:"EPSG:4326",layers:e[b].layer,transparent:"true",format:"image/png"},{isBaseLayer:false,visibility:STIStatic.overlayVisibility});this.wmsOverlays.push(a);if(e[b].featureInfo){c.push(a)}}this.openlayersMap.addLayers(this.wmsOverlays)}if(this.wmsOverlays.length>0&&STIStatic.overlayVisibility){var d=this;if(typeof this.featureInfo!="undefined"){this.featureInfo.deactivate();this.openlayersMap.removeControl(this.featureInfo)}this.featureInfo=new OpenLayers.Control.WMSGetFeatureInfo({url:"/geoserver/wms",layers:c,eventListeners:{getfeatureinfo:function(f){if(f.text==""){return}var g=d.openlayersMap.getLonLatFromPixel(new OpenLayers.Pixel(f.xy.x,f.xy.y));d.selectedGlyph={lon:g.lon,lat:g.lat};if(typeof d.popup!="undefined"){d.popup.reset()}d.popup=new Popup(d);d.popup.initialize(f.xy.x,f.xy.y,f.text)}}});this.openlayersMap.addControl(this.featureInfo);this.featureInfo.activate();this.activateCountrySelector(this.wmsOverlays[this.wmsOverlays.length-1])}else{this.deactivateCountrySelector();if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.activateCountrySelector(this.openlayersMap.baseLayer)}}},addBaseLayer:function(b){this.baseLayers.push(b);this.openlayersMap.addLayers([b]);for(var a in this.baseLayers){if(this.baseLayers[a].name==STIStatic.baseLayer){this.setMap(a)}}},drawObjectLayer:function(b){var w=this.mds.getAllObjects();if(w==null){return}this.objectLayer.removeAllFeatures();try{this.deselection()}catch(A){}if(b){var c,s,a,o;var g=w[w.length-1];for(var z=0;z<g.length;z++){for(var v=0;v<g[z].length;v++){var t=g[z][v];if(a==null||t.originX<a){a=t.originX}if(o==null||t.originX>o){o=t.originX}if(c==null||t.originY<c){c=t.originY}if(s==null||t.originY>s){s=t.originY}}}if(a==o&&c==s){this.openlayersMap.setCenter(new OpenLayers.LonLat(a,c))}else{var h=0.1*(o-a);var f=0.1*(s-c);var d=(this.gui.headerHeight/this.gui.mapWindow.offsetHeight+0.1)*(s-c);this.openlayersMap.zoomToExtent(new OpenLayers.Bounds(a-h,c-f,o+h,s+d));this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()))}if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}var k=this.mds.getObjectsByZoom();var u=this.openlayersMap.getResolution();for(var z=0;z<k.length;z++){for(var v=0;v<k[z].length;v++){var q=k[z][v];var m=q.originX+u*q.shiftX;var l=q.originY+u*q.shiftY;q.feature.geometry.x=m;q.feature.geometry.y=l;q.olFeature.geometry.x=m;q.olFeature.geometry.y=l;q.feature.style.graphicZIndex=this.zIndices[z];q.olFeature.style.graphicZIndex=this.zIndices[z]+1;this.objectLayer.addFeatures([q.feature]);this.objectLayer.addFeatures([q.olFeature])}}var r=function(j,e){return Math.sqrt((j.x-e.x)*(j.x-e.x)+(j.y-e.y)*(j.y-e.y))};if(this.foreignSelection.length>0){this.highlightChanged(this.foreignSelection)}if(typeof this.hoverCircle!="undefined"){this.hoverCircle.placenameTags.remove()}},riseLayer:function(a){this.lastId=a;if(typeof a=="undefined"){a=this.lastId||0}this.zIndices[a]=this.layerZIndex;this.layerZIndex+=2;this.reset();this.drawObjectLayer(false)},initMap:function(w,a){this.clearMap();if(typeof w=="undefined"){return}this.mapObjects=w;this.count=0;this.objectCount=0;for(var v=0;v<w.length;v++){var z=0;for(var s=0;s<w[v].length;s++){z+=w[v][s].weight;this.objectCount++}this.count+=z;this.zIndices.push(this.layerZIndex);this.layerZIndex+=2}this.mds.initialize(w);var t=this.mds.getAllObjects();if(t==null){return}for(var v=0;v<t.length;v++){var y=0;var h=0;for(var s=0;s<t[v].length;s++){for(var r=0;r<t[v][s].length;r++){if(t[v][s][r].radius>h){h=t[v][s][r].radius;y=STIStatic.getArea(h)}}}var f=STIStatic.getArea(STIStatic.minimumRadius);var l=y-f;for(var s=0;s<t[v].length;s++){for(var r=0;r<t[v][s].length;r++){var p=t[v][s][r];var z=STIStatic.colors[p.search];var o=1;if(STIStatic.circleTransparency){var q=STIStatic.minTransparency;var u=STIStatic.maxTransparency;o=q+Math.abs(q-u)*(1-(STIStatic.getArea(p.radius)-f)/l)}o=0.6;var x={fillColor:"rgb("+z.r0+","+z.g0+","+z.b0+")",fillOpacity:o,strokeWidth:2,strokeColor:"rgb("+z.r1+","+z.g1+","+z.b1+")",stroke:STIStatic.circleOutline,pointRadius:p.radius,cursor:"pointer"};var e=new OpenLayers.Geometry.Point(p.originX,p.originY,null);var g=new OpenLayers.Feature.Vector(e);g.style=x;g.parent=p;p.setFeature(g);var b={fillColor:"rgb("+z.r1+","+z.g1+","+z.b1+")",fillOpacity:o,stroke:false,pointRadius:0,cursor:"pointer"};var d=new OpenLayers.Geometry.Point(p.originX,p.originY,null);var m=new OpenLayers.Feature.Vector(d);m.style=b;m.parent=p;p.setOlFeature(m)}}}if(typeof a=="undefined"){this.drawObjectLayer(true)}else{this.drawObjectLayer(a)}this.gui.updateSpaceQuantity(this.count)},setFilterBar:function(a){this.filterBar=a},reset:function(){this.objectLayer.removeFeatures(this.polygons);this.polygons=[];this.objectLayer.removeFeatures(this.connections);this.connections=[];this.selectFeature.unselectAll();this.selectedGlyph=false;if(this.dragControl.activated){this.dragControl.deactivate()}if(this.popup){this.popup.reset()}this.selectedObjects=[];this.foreignSelection=[];this.filterBar.reset(false);var c=this.mds.getObjectsByZoom();if(c==null){return}for(var b=0;b<c.length;b++){for(var a=0;a<c[b].length;a++){c[b][a].setSelection(false)}}},clearMap:function(){this.reset();this.zIndices=[];this.layerZIndex=1;this.objectLayer.destroyFeatures()},updatePoint:function(o,m){var s=o.feature;var f=o.olFeature;var q=false,d=false;var h=STIStatic.getRadius(o.overlay,this.openlayersMap.zoom+1);if(h!=f.style.pointRadius){f.style.pointRadius=h;d=true}if(o.setPercentage()){var k=STIStatic.colors[o.search];var e=o.percentage;var a=k.r0+Math.round(e*(k.r1-k.r0));var j=k.g0+Math.round(e*(k.g1-k.g0));var l=k.b0+Math.round(e*(k.b1-k.b0));s.style.fillColor="rgb("+a+","+j+","+l+")";q=true}if(m.containsPoint(s.geometry)){if(q){this.objectLayer.drawFeature(s)}if(q||d){this.objectLayer.drawFeature(f)}}},highlightChanged:function(e){if(this.selectedObjects.length==0){this.mds.setSelection(this.selectedObjects,false)}else{this.mds.setSelection(this.selectedObjects,true)}this.mds.setOverlay(e);var d=this.mds.getObjectsByZoom();var c=this.openlayersMap.getExtent().toGeometry();for(var b in d){for(var a in d[b]){this.updatePoint(d[b][a],c)}}this.displayConnections()},selectionChanged:function(a){this.reset();this.foreignSelection=a;this.highlightChanged(a)},inPolygon:function(a){for(var d=0;d<this.polygons.length;d++){var c=this.polygons[d].geometry;for(var b=0;b<c.components.length;b++){if(c.components[b].containsPoint(a.feature.geometry)){return true}}}return false},mapSelection:function(){this.selectedObjects=[];for(var b=0;b<this.mds.size();b++){this.selectedObjects.push([])}var d=this.mds.getObjectsByZoom();for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){var e=d[b][a];if(e.selected){this.selectedObjects[b]=this.selectedObjects[b].concat(e.elements)}}}this.highlightChanged([]);this.core.triggerSelection([{value:1,objects:this.selectedObjects}],"map");this.filterBar.reset(true)},deselection:function(){this.mds.setSelection(this.selectedObjects,false);this.reset();this.highlightChanged([]);this.core.triggerSelection([],"map")},filtering:function(){this.core.triggerRefining(this.selectedObjects)},inverseFiltering:function(){this.selectedObjects=[];for(var b=0;b<this.mds.size();b++){this.selectedObjects.push([])}var d=this.mds.getObjectsByZoom();for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){var e=d[b][a];if(!e.selected){this.selectedObjects[b]=this.selectedObjects[b].concat(e.elements)}}}this.filtering()},mapCircleHighlight:function(e,a){if(this.polygons.length>0&&this.inPolygon(e)){return}var d=[];if(!a&&!e.selected){for(var b=0;b<this.mds.size();b++){d.push([])}d[e.search]=e.elements}this.objectLayer.drawFeature(e.feature);var c=[];if(this.selectedObjects.length>0){c.push({value:1,objects:this.selectedObjects})}if(d.length>0){c.push({value:1,objects:d})}this.core.triggerHighlight(c,"map")},mapLabelSelection:function(a){this.mds.setSelection(this.selectedObjects,false);this.selectedObjects=[];for(var b=0;b<this.mds.size();b++){this.selectedObjects.push([])}this.selectedObjects[a.index]=a.elements;this.highlightChanged([]);this.core.triggerSelection([{value:1,objects:this.selectedObjects}],"label");this.filterBar.reset(true)},mapLabelHighlight:function(b,a){if(this.placenameTags.selectedLabel==this.placenameTags.allLabel){return}if(a){this.core.triggerHighlight([{value:1,objects:this.selectedObjects}],"label")}else{var d=[];for(var c=0;c<this.mds.size();c++){d.push([])}d[b.index]=b.elements;this.core.triggerHighlight([{value:1,objects:d}].concat([{value:1,objects:this.selectedObjects}]),"label")}},displayConnections:function(){return;if(typeof this.connection!="undefined"){this.objectLayer.removeFeatures(this.connections);this.connections=[]}if(STIStatic.connections){var v=this.mds.getObjectsByZoom();for(var w in v){for(var u in v[w]){}}var b=this.core.timeplot.getSlices();for(var w=0;w<b.length;w++){for(var u=0;u<b[w].stacks.length;u++){var y=b[w].stacks[u].elements;if(y.length==0){continue}var v=[];for(var s=0;s<y.length;s++){var q=this.mds.getCircle(u,y[s].index).feature.geometry;if(arrayIndex(v,q)==-1){v.push(q)}}var t=new AdjMatrix(v.length);for(var s=0;s<v.length-1;s++){for(var r=s+1;r<v.length;r++){t.setEdge(s,r,dist(v[s],v[r]))}}var p=Prim(t);var a=[];for(var g=0;g<p.length;g++){a.push(new OpenLayers.Geometry.LineString(new Array(v[p[g].v1],v[p[g].v2])))}this.connections[u].push({first:this.mds.getCircle(u,y[0].index).feature.geometry,last:this.mds.getCircle(u,y[y.length-1].index).feature.geometry,lines:a,time:b[w].date})}}var B=this.core.timeplot.leftFlagTime;var f=this.core.timeplot.rightFlagTime;if(B==undefined||B==null){return}else{B=B.getTime();f=f.getTime()}if(thisConnections){for(var w=0;w<this.connections.length;w++){var A=STIStatic.colors[w];var x={strokeColor:"rgb("+A.r1+","+A.g1+","+A.b1+")",strokeOpacity:0.5,strokeWidth:3};var o=[];var h=undefined;for(var u=0;u<this.connections[w].length;u++){var A=this.connections[w][u];var d=A.time.getTime();if(d>=B&&d<=f){if(h!=undefined){var m=new OpenLayers.Geometry.LineString(new Array(h,A.first));this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(m,null,x)])}for(var s=0;s<A.lines.length;s++){this.connectionLayer.addFeatures([new OpenLayers.Feature.Vector(A.lines[s],null,x)])}h=A.last}}}}}},zoom:function(b){var a=this.openlayersMap.getZoom()+b;if(this.openlayersMap.baseLayer instanceof OpenLayers.Layer.WMS){this.openlayersMap.zoomTo(a)}else{this.openlayersMap.zoomTo(Math.round(a));if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}}this.drawObjectLayer(false);return true},deactivateCountrySelector:function(){this.openlayersMap.removeControl(this.selectCountry);this.selectCountry=undefined},activateCountrySelector:function(a){var b=this;if(STIStatic.countrySelect&&STIStatic.mapSelectionTools){this.selectCountry=new OpenLayers.Control.GetFeature({protocol:OpenLayers.Protocol.WFS.fromWMSLayer(a),click:true});this.selectCountry.events.register("featureselected",this,function(c){b.snapper();b.drawnPolygonHandler(c.feature.geometry)});this.openlayersMap.addControl(this.selectCountry);this.countrySelectionControl.enable()}},setMap:function(a){this.baselayerIndex=a;if(this.selectCountry){this.deactivateCountrySelector()}if(this.baseLayers[a] instanceof OpenLayers.Layer.WMS){if(STIStatic.fractionalZoom){this.openlayersMap.fractionalZoom=true}this.activateCountrySelector(this.baseLayers[a])}else{this.openlayersMap.fractionalZoom=false;if(this.countrySelectionControl){this.countrySelectionControl.disable()}}this.openlayersMap.zoomTo(Math.floor(this.openlayersMap.getZoom()));this.openlayersMap.setBaseLayer(this.baseLayers[a]);if(this.baseLayers[a].name=="Open Street Map"){this.osmLink.style.visibility="visible"}else{this.osmLink.style.visibility="hidden"}},initSelectorTools:function(){var d=this;this.mapControls=[];if(STIStatic.squareSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawSquare.activate()};var c=function(){d.drawSquare.deactivate()};this.mapControls.push(new MapControl(this,a,"square",b,c))}if(STIStatic.circleSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawCircle.activate()};var c=function(){d.drawCircle.deactivate()};this.mapControls.push(new MapControl(this,a,"circle",b,c))}if(STIStatic.polygonSelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.drawPolygon.activate()};var c=function(){d.drawPolygon.deactivate()};this.mapControls.push(new MapControl(this,a,"polygon",b,c))}if(STIStatic.countrySelect){var a=document.createElement("div");$(a).addClass("mapControl");var b=function(){d.selectCountry.activate();d.dragControl.disable()};var c=function(){d.selectCountry.deactivate();d.dragControl.enable()};this.countrySelectionControl=new MapControl(this,a,"country",b,c);this.mapControls.push(this.countrySelectionControl)}return this.mapControls},getZoom:function(){return this.openlayersMap.getZoom()},setMarker:function(b,g){var q=new OpenLayers.Geometry.Point(b,g,null);q.transform(this.openlayersMap.displayProjection,this.openlayersMap.projection);this.openlayersMap.setCenter(new OpenLayers.LonLat(q.x,q.y));var l=new OpenLayers.Size(22,33);var f=new OpenLayers.Pixel(-(l.w/2),-l.h);var y=new OpenLayers.Icon(STIStatic.path+"marker.png",l,f);var h=new OpenLayers.Marker(new OpenLayers.LonLat(q.x,q.y),y);h.setOpacity(0.9);this.markerLayer.setZIndex(parseInt(this.objectLayer.getZIndex())+1);this.markerLayer.addMarker(h);var m;var v=this.mds.getAllObjects();if(v==null){return}var r=function(j,d){return Math.sqrt((j.x-d.x)*(j.x-d.x)+(j.y-d.y)*(j.y-d.y))};var C=this.openlayersMap.getNumZoomLevels();var a=v[C-1];var A=undefined;var c;for(var w=0;w<a.length;w++){for(var u=0;u<a[w].length;u++){var t=a[w][u].feature.geometry;var z=r(t,q);if(!A||z<A){A=z;c=t}}}var o=0;var e=this.gui.mapWindow.offsetWidth/2-o;var x=this.gui.mapWindow.offsetHeight/2-o;var B=Math.abs(q.x-c.x);var k=Math.abs(q.y-c.y);for(var w=0;w<C;w++){var s=this.openlayersMap.getResolutionForZoom(C-w-1);if(B/s<e&&k/s<x){this.openlayersMap.zoomTo(C-w-1);if(this.zoomSlider){this.zoomSlider.setValue(this.openlayersMap.getZoom())}this.drawObjectLayer(false);break}}},removeMarker:function(){this.markerLayer.removeMarker(this.markerLayer.markers[0])},getLevelOfDetail:function(){var a=Math.floor(this.openlayersMap.getZoom());if(a<=1){return 0}else{if(a<=3){return 1}else{if(a<=8){return 2}else{return 3}}}}};function TimeWidget(b,d,a,c){this.core=b;this.timeplot;this.dataSources;this.eventSources;this.tds;this.timeGeometry;this.valueGeometry;this.canvas;this.timeIndex=a;this.leftFlagPole;this.rightFlagPole;this.rangeBox;this.leftFeather;this.rightFeather;this.leftHandle;this.rightHandle;this.leftFlagPos=null;this.leftFlagTime=null;this.rightFlagPos=null;this.rightFlagTime=null;this.leftFeatherTime=null;this.rightFeatherTime=null;this.mouseDownTime;this.mouseUpTime;this.mouseTempTime;this.mouseDownPos;this.mouseUpPos;this.mouseTempPos;this.status;this.featherWidth;this.slider;this.gui=new TimeGui(this,d,c);this.initialize()}TimeWidget.prototype={clearTimeplot:function(){this.timeplot._clearCanvas();this.timeGeometry._earliestDate=null;this.timeGeometry._latestDate=null;this.valueGeometry._minValue=0;this.valueGeometry._maxValue=0;this.highlightedSlice=undefined;this.timeGeometry._clearLabels()},initTimeplot:function(f){this.clearTimeplot();this.reset();for(var k=0;k<this.timeplot._plots.length;k++){this.timeplot._plots[k].dispose()}this.dataSources=new Array();this.plotInfos=new Array();this.eventSources=new Array();var m=0;this.count=0;for(var k=0;k<f.length;k++){var e=new Timeplot.DefaultEventSource();var a=new Timeplot.ColumnSource(e,1);this.dataSources.push(a);this.eventSources.push(e);var p=STIStatic.colors[k];var b=Timeplot.createPlotInfo({id:"plot"+k,dataSource:a,timeGeometry:this.timeGeometry,valueGeometry:this.valueGeometry,fillGradient:false,lineColor:"rgba("+p.r1+","+p.g1+","+p.b1+", 1)",fillColor:"rgba("+p.r0+","+p.g0+","+p.b0+", 0.3)",showValues:true});this.plotInfos.push(b);for(var h=0;h<f[k].length;h++){var d=f[k][h];var l=d.dates[this.timeIndex].granularity;if(l==null){continue}else{if(l>m){m=l}}this.count+=d.weight}}this.timeGeometry._granularity=m;this.timeGeometry._clearLabels();this.timeplot.resetPlots(this.plotInfos);if(this.plotInfos.length==0){this.initLabels(this.timeplot.regularGrid());return}this.timeGeometry.extendedDataSource=this.tds;this.tds.initialize(this.dataSources,this.eventSources,f,m,STIStatic.timeUnit,this.gui.timeplotDiv.offsetWidth);this.gui.setTimeUnitDropdown(this.tds.availableUnits);var s=this.timeplot._plots;for(var k=0;k<s.length;k++){s[k].pins=[];s[k].style=this.style;for(var h=0;h<this.tds.getSliceNumber();h++){s[k].pins.push({height:0,count:0})}}var t=Math.round((this.tds.timeSlices.length-3)/2);if(STIStatic.timeZoom){this.zoomSlider.setMaxAndLevels(t,t)}this.timeplot.repaint();this.timeplot._resizeCanvas();var r=this.tds.timeSlices.length;var q=Math.floor(r/this.canvas.width*this.canvas.height+0.5);if(STIStatic.featherSlider){this.slider.setMaximum(q)}this.initLabels([]);this.initOverview();this.gui.updateTimeQuantity(this.count)},setTimeUnit:function(a){this.clearTimeplot();this.reset();this.tds.setTimeUnit(a)},initialize:function(){this.status=0;this.selectedObjects=[];this.paused=true;this.dataSources=new Array();this.plotInfos=new Array();this.eventSources=new Array();this.timeGeometry=new Timeplot.DefaultTimeGeometry({gridColor:"#000000",axisLabelsPlacement:"top"});this.style="graph";this.timeGeometry._hideLabels=true;this.timeGeometry._granularity=0;this.valueGeometry=new Timeplot.LogarithmicValueGeometry({min:0});this.valueGeometry.actLinear();var z=this;this.timeplot=Timeplot.create(this.gui.timeplotDiv,this.plotInfos);this.tds=new TimeDataSource(this.timeIndex);this.canvas=this.timeplot.getCanvas();this.leftFlagPole=this.timeplot.putDiv("leftflagpole","timeplot-dayflag-pole");this.leftFlagPole.style.borderLeft=STIStatic.frameBorder;this.rightFlagPole=this.timeplot.putDiv("rightflagpole","timeplot-dayflag-pole");this.rightFlagPole.style.borderLeft=STIStatic.frameBorder;SimileAjax.Graphics.setOpacity(this.leftFlagPole,50);SimileAjax.Graphics.setOpacity(this.rightFlagPole,50);this.rangeBox=this.timeplot.putDiv("rangebox","range-box");this.rangeBox.style.backgroundColor=STIStatic.rangeBoxColor;this.leftFeather=this.timeplot.putDiv("leftfeather","left-feather");this.rightFeather=this.timeplot.putDiv("rightfeather","right-feather");this.leftHandle=document.createElement("div");this.rightHandle=document.createElement("div");this.gui.plotWindow.appendChild(this.leftHandle);this.gui.plotWindow.appendChild(this.rightHandle);this.leftHandle.title=STIStatic.getString("leftHandle");this.rightHandle.title=STIStatic.getString("rightHandle");this.leftHandle.style.backgroundImage="url("+STIStatic.path+"leftHandle.png)";this.leftHandle.setAttribute("class","plotHandle plotHandleIcon");this.rightHandle.style.backgroundImage="url("+STIStatic.path+"rightHandle.png)";this.rightHandle.setAttribute("class","plotHandle plotHandleIcon");this.poles=this.timeplot.putDiv("poles","pole");this.timeplot.placeDiv(this.poles,{left:0,bottom:0,width:this.canvas.width,height:this.canvas.height,display:"block"});this.poles.appendChild(document.createElement("canvas"));this.filterBar=new FilterBar(this,this.gui.plotWindow);var z=this;this.dragButton=document.createElement("div");this.dragButton.title=STIStatic.getString("dragTimeRange");this.cancelButton=document.createElement("div");this.cancelButton.title=STIStatic.getString("clearSelection");this.cancelButton.onclick=function(){z.deselection()};this.toolbar=document.createElement("div");this.toolbar.setAttribute("class","plotToolbar");this.toolbar.style.backgroundColor=STIStatic.frameColor;this.toolbar.style.borderLeft=STIStatic.frameBorder;this.toolbar.style.borderRight=STIStatic.frameBorder;this.toolbar.style.borderBottom=STIStatic.frameBorder;this.toolbar.style.textAlign="center";this.gui.plotWindow.appendChild(this.toolbar);this.toolbarAbsoluteDiv=document.createElement("div");this.toolbarAbsoluteDiv.setAttribute("class","absoluteToolbar");this.toolbar.appendChild(this.toolbarAbsoluteDiv);this.dragButton.setAttribute("class","dragTimeRangeAlt");this.dragButton.style.backgroundImage="url("+STIStatic.path+"drag.png)";this.cancelButton.setAttribute("class","cancelRangeAlt");this.toolbarAbsoluteDiv.appendChild(this.dragButton);this.toolbarAbsoluteDiv.style.width=this.dragButton.offsetWidth+"px";this.gui.plotWindow.appendChild(this.cancelButton);if(STIStatic.animation=="embedded"){this.animation=document.createElement("div");this.animation.setAttribute("class","animation");this.animation.style.backgroundImage="url("+STIStatic.path+"play-enabled.png)";this.gui.plotWindow.appendChild(this.animation)}var w=function(){if(!STIStatic.featherSlider){return}z.leftFeather.style.visibility="visible";z.rightFeather.style.visibility="visible";z.timeplot.placeDiv(z.leftFeather,{left:z.leftFlagPos-z.featherWidth,width:z.featherWidth,bottom:0,height:z.canvas.height,display:"block"});z.timeplot.placeDiv(z.rightFeather,{left:z.rightFlagPos,width:z.featherWidth,bottom:0,height:z.canvas.height,display:"block"});var K=document.getElementById("leftFeatherCanvas");if(K==null){K=document.createElement("canvas");K.id="leftFeatherCanvas";z.leftFeather.appendChild(K)}K.width=z.featherWidth;K.height=z.canvas.height;if(!K.getContext&&G_vmlCanvasManager){K=G_vmlCanvasManager.initElement(K)}var I=K.getContext("2d");var G=I.createLinearGradient(z.featherWidth,0,0,0);G.addColorStop(0,"rgba(95,136,178,0.6)");G.addColorStop(1,"rgba(171,171,171,0)");I.fillStyle=G;I.fillRect(0,0,z.featherWidth,z.canvas.height);var L=document.getElementById("rightFeatherCanvas");if(L==null){L=document.createElement("canvas");L.id="rightFeatherCanvas";z.rightFeather.appendChild(L)}L.width=z.featherWidth;L.height=z.canvas.height;if(!L.getContext&&G_vmlCanvasManager){L=G_vmlCanvasManager.initElement(L)}var J=L.getContext("2d");var H=J.createLinearGradient(0,0,z.featherWidth,0);H.addColorStop(0,"rgba(95,136,178,0.6)");H.addColorStop(1,"rgba(171,171,171,0)");J.fillStyle=H;J.fillRect(0,0,z.featherWidth,z.canvas.height)};if(STIStatic.featherSlider){var k=document.createElement("div");k.setAttribute("class","featherSlider");k.title=STIStatic.getString("timeFeather");var D=document.createElement("input");k.appendChild(D);this.slider=new Slider(k,D,"horizontal");this.slider.onchange=function(){if(z.leftFlagPos!=null){z.setFeather();var G=z.timeplot._plots;for(i=0;i<G.length;i++){G[i].fullOpacityPlot(z.leftFlagTime,z.rightFlagTime,z.leftFlagPos,z.rightFlagPos,z.leftFeatherTime,z.rightFeatherTime,z.featherWidth,STIStatic.colors[i]);G[i].opacityPlot.style.visibility="visible"}w();z.timeSelection()}};this.toolbarAbsoluteDiv.appendChild(k)}this.overview=document.createElement("div");this.overview.setAttribute("class","timeOverview");this.gui.plotWindow.appendChild(this.overview);var x=false;this.shift=function(G){if(!x){return}if(z.tds.setShift(G)){z.redrawPlot()}setTimeout(function(){z.shift(G)},200)};var l=function(G){x=true;document.onmouseup=function(){x=false;document.onmouseup=null};z.shift(G)};this.shiftLeft=document.createElement("div");this.shiftLeft.setAttribute("class","shiftLeft");this.gui.plotWindow.appendChild(this.shiftLeft);this.shiftLeft.onmousedown=function(){l(1)};this.shiftRight=document.createElement("div");this.shiftRight.setAttribute("class","shiftRight");this.gui.plotWindow.appendChild(this.shiftRight);this.shiftRight.onmousedown=function(){l(-1)};this.plotLabels=document.createElement("div");this.plotLabels.setAttribute("class","plotLabels");this.gui.plotWindow.appendChild(this.plotLabels);this.initLabels(this.timeplot.regularGrid());var s=function(G){if(G>=z.canvas.width){G=z.canvas.width}if(isNaN(G)||G<0){G=0}var H=z.timeGeometry.fromScreen(G);if(H==0){return}return z.dataSources[0].getClosestValidTime(H)};var F=function(H){var G=z.timeGeometry.toScreen(H);if(G>=z.canvas.width){G=z.canvas.width}if(isNaN(G)||G<0){G=0}return G};var g=function(H,G){if(H>G){z.leftFlagPos=G;z.rightFlagPos=H}else{z.leftFlagPos=H;z.rightFlagPos=G}z.leftFlagTime=z.dataSources[0].getClosestValidTime(z.timeGeometry.fromScreen(z.leftFlagPos));z.rightFlagTime=z.dataSources[0].getClosestValidTime(z.timeGeometry.fromScreen(z.rightFlagPos))};var h=function(){z.leftFlagPole.style.visibility="visible";z.rightFlagPole.style.visibility="visible";z.rangeBox.style.visibility="visible";z.timeplot.placeDiv(z.leftFlagPole,{left:z.leftFlagPos,bottom:0,height:z.canvas.height,display:"block"});z.timeplot.placeDiv(z.rightFlagPole,{left:z.rightFlagPos,bottom:0,height:z.canvas.height,display:"block"});var L=z.rightFlagPos-z.leftFlagPos;if(z.popup){z.popupClickDiv.style.visibility="visible";z.timeplot.placeDiv(z.popupClickDiv,{left:z.leftFlagPos,width:L+1,height:z.canvas.height,display:"block"})}z.timeplot.placeDiv(z.rangeBox,{left:z.leftFlagPos,width:L+1,height:z.canvas.height,display:"block"});z.setFeather();w();var S=z.timeplot._plots;for(i=0;i<S.length;i++){S[i].fullOpacityPlot(z.leftFlagTime,z.rightFlagTime,z.leftFlagPos,z.rightFlagPos,z.leftFeatherTime,z.rightFeatherTime,z.featherWidth,STIStatic.colors[i]);S[i].opacityPlot.style.visibility="visible"}var Q=z.tds.unit;var P=z.gui.plotContainer.offsetTop;var I=z.gui.plotContainer.offsetLeft;var J=z.leftFlagPole.offsetLeft+z.timeplot.getElement().offsetLeft;var N=z.rightFlagPole.offsetLeft+z.timeplot.getElement().offsetLeft;var M=N-J;var H=z.canvas.width;var O=z.timeplot.getElement().offsetLeft;var G=P+Math.floor(z.gui.timeplotDiv.offsetHeight/2-z.leftHandle.offsetHeight/2);z.leftHandle.style.visibility="visible";z.rightHandle.style.visibility="visible";z.leftHandle.style.left=(J-z.leftHandle.offsetWidth/2)+"px";z.rightHandle.style.left=(N-z.rightHandle.offsetWidth+1+z.rightHandle.offsetWidth/2)+"px";z.leftHandle.style.top=G+"px";z.rightHandle.style.top=G+"px";if(N==J){z.rightHandle.style.visibility="hidden";z.leftHandle.style.backgroundImage="url("+STIStatic.path+"mergedHandle.png)"}else{z.leftHandle.style.backgroundImage="url("+STIStatic.path+"leftHandle.png)"}z.cancelButton.style.visibility="visible";z.cancelButton.style.top=P+"px";if(M>z.cancelButton.offsetWidth){z.cancelButton.style.left=(I+N-z.cancelButton.offsetWidth)+"px"}else{z.cancelButton.style.left=(I+N)+"px"}var R=z.toolbarAbsoluteDiv.offsetWidth;if(M>=R){z.toolbar.style.left=J+"px";z.toolbar.style.width=(M-1)+"px";z.toolbarAbsoluteDiv.style.left=((M-R)/2)+"px"}else{z.toolbar.style.left=(O+z.leftFlagPos*(H-R)/(H-M))+"px";z.toolbar.style.width=R+"px";z.toolbarAbsoluteDiv.style.left="0px"}var K=P+z.timeplot.getElement().offsetHeight+1;z.toolbar.style.top=K+"px";z.toolbar.style.visibility="visible";z.toolbarAbsoluteDiv.style.visibility="visible"};var p=function(H){var G=0;while(H){G+=H.offsetLeft;H=H.offsetParent}return G};var o=p(z.timeplot.getElement());var j=function(G){if(z.style=="bars"&&z.leftFlagTime==z.rightFlagTime){var H=z.tds.getSliceIndex(z.leftFlagTime);var L=z.leftFlagTime;var J=z.leftFlagPos;var K,I;if(H==0){K=z.tds.getSliceTime(H+1)}else{if(H==z.tds.getSliceNumber()-1){K=z.tds.getSliceTime(H-1)}else{if(G<z.leftFlagPos){K=z.tds.getSliceTime(H-1)}else{K=z.tds.getSliceTime(H+1)}}}I=z.timeGeometry.toScreen(K);g(J,I,L,K)}};var C,B,q;var c=function(L,K){var I=K-L;if(z.status==2){var H=s(C+I);if(H==z.mouseTempTime){return}z.mouseTempTime=H;z.mouseTempPos=z.timeGeometry.toScreen(z.mouseTempTime);g(z.mouseDownPos,z.mouseTempPos)}else{if(z.status==3){I*=q;var G=K-o;if(G<=z.canvas.width/2){var H=s(C+I);if(H==z.leftFlagTime){return}z.leftFlagTime=H;var J=z.leftFlagPos;z.leftFlagPos=z.timeGeometry.toScreen(z.leftFlagTime);J-=z.leftFlagPos;z.rightFlagTime=s(z.rightFlagPos-J);z.rightFlagPos=z.timeGeometry.toScreen(z.rightFlagTime)}else{var H=s(B+I);if(H==z.rightFlagTime){return}z.rightFlagTime=H;var J=z.rightFlagPos;z.rightFlagPos=z.timeGeometry.toScreen(z.rightFlagTime);J-=z.rightFlagPos;z.leftFlagTime=s(z.leftFlagPos-J);z.leftFlagPos=z.timeGeometry.toScreen(z.leftFlagTime)}}}j(K-o);h();z.timeSelection()};var d=function(K,J,H){if(!z.paused){var G=z.canvas.width/(z.tds.timeSlices.length-1)/5;var I=20*G;if(H){J=0}c(K,J);if(z.rightFlagPos>=z.canvas.width){H=true;I=1000}else{H=false}setTimeout(function(){d(K,J+G,H)},I)}};var A=function(){var H=z.rightFlagPos-z.leftFlagPos;var G=z.toolbarAbsoluteDiv.offsetWidth;var I=z.canvas.width;if(H<G){q=(I-H)/(I-G)}else{q=1}};this.play=function(){if(this.leftFlagPos==null){return}z.paused=false;z.gui.updateAnimationButtons(2);z.status=3;A();C=z.leftFlagPos;B=z.rightFlagPos;var G=Math.round(z.leftFlagPos);d(G,G+1,false)};this.stop=function(){z.paused=true;z.status=0;z.gui.updateAnimationButtons(1)};var u=function(G){var H=STIStatic.getMousePosition(G).left;document.onmousemove=function(I){c(H,STIStatic.getMousePosition(I).left);if(z.popup){z.popup.reset()}}};var r=function(){z.mouseDownTime=z.rightFlagTime;z.mouseTempTime=z.leftFlagTime;z.mouseDownPos=z.timeGeometry.toScreen(z.mouseDownTime);C=z.leftFlagPos};var y=function(){z.mouseDownTime=z.leftFlagTime;z.mouseTempTime=z.rightFlagTime;z.mouseDownPos=z.timeGeometry.toScreen(z.mouseDownTime);C=z.rightFlagPos};var b=function(){C=z.leftFlagPos;B=z.rightFlagPos;A()};if(STIStatic.timeDragAndDrop){var f=function(){if(z.style=="bars"&&z.mouseUpTime==z.mouseDownTime){var G=z.tds.getSliceIndex(z.mouseUpTime);if(G==0){z.mouseUpTime=z.tds.getSliceTime(G+1)}else{if(G==z.tds.getSliceNumber()-1){z.mouseUpTime=z.tds.getSliceTime(G-1)}else{if(z.x<z.leftFlagPos){z.mouseUpTime=z.tds.getSliceTime(G-1)}else{z.mouseUpTime=z.tds.getSliceTime(G+1)}}}}};this.leftHandle.onmousedown=function(G){if(z.status!=2){r();z.status=2;u(G);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;z.stop()}}};this.rightHandle.onmousedown=function(G){if(z.status!=2){y();z.status=2;u(G);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;z.stop()}}};this.dragButton.onmousedown=function(G){if(z.status!=3){z.status=3;b();u(G);document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;z.stop()}}}}else{this.leftHandle.onclick=function(G){if(z.status!=2){r();z.status=2;u(G)}};this.rightHandle.onclick=function(G){if(z.status!=2){y();z.status=2;u(G)}};this.dragButton.onclick=function(G){if(z.status!=3){z.status=3;b();u(G)}}}var a=function(I,U,Q){if(z.dataSources.length>0){z.x=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(U,z.canvas).x);if(z.status==0){var J=s(z.x);if(z.leftFlagPos!=null&&z.popup&&J>=z.leftFlagTime&&J<=z.rightFlagTime){var T=z.leftFlagPos+(z.rightFlagPos-z.leftFlagPos)/2;var G=[];for(var M=0;M<z.dataSources.length;M++){G.push([])}for(var M=0;M<z.selectedObjects.length;M++){if(z.selectedObjects[M].value==1){for(var L=0;L<z.selectedObjects[M].objects.length;L++){G[L]=G[L].concat(z.selectedObjects[M].objects[L])}}}var P=[];for(var M=0;M<G.length;M++){if(G[M].length==0){continue}var R=STIStatic.colors[M];var K="rgb("+R.r0+","+R.g0+","+R.b0+")";var H=document.createElement("div");H.setAttribute("class","tagCloudItem");H.style.color=K;var S={div:H,elements:G[M]};var N=0;for(L in G[M]){N+=G[M][L].weight}var O=2*N/1000;if(O>2){O=2}H.style.fontSize=(1+O)+"em";H.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+R.hex;if(N==1){H.innerHTML=N+" object"}else{H.innerHTML=N+" objects"}var V=function(X,Y,W){Y.onclick=function(){z.popup.showLabelContent(X);Y.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+W};Y.onmouseover=function(){Y.style.textShadow="0 -1px "+W+", 1px 0 "+W+", 0 1px "+W+", -1px 0 "+W};Y.onmouseout=function(){Y.style.textShadow="0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em black, 0 0 0.4em "+W}};V(S,H,R.hex);P.push(S)}if(P.length>0){z.popup.createPopup(T+20,0,P)}}else{z.deselection();z.status=1;z.mouseDownTime=J;z.mouseTempTime=z.mouseDownTime;z.mouseDownPos=z.timeGeometry.toScreen(z.mouseDownTime);g(z.mouseDownPos,z.mouseDownPos,z.mouseDownTime,z.mouseDownTime);document.onmouseup=function(){if(z.status==1){z.mouseUpTime=z.mouseTempTime;z.mouseUpPos=z.timeGeometry.toScreen(z.mouseUpTime);g(z.mouseDownPos,z.mouseUpPos,z.mouseDownTime,z.mouseUpTime);j(z.x);h();z.timeSelection();z.gui.updateAnimationButtons(1);w();document.onmouseup=null;z.status=0}}}}}};var e=function(H,G,I){if(z.dataSources.length>0){z.x=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(G,z.canvas).x);if(z.status==1){z.mouseTempTime=s(z.x);z.mouseTempPos=z.timeGeometry.toScreen(z.mouseTempTime);g(z.mouseDownPos,z.mouseTempPos,z.mouseDownTime,z.mouseTempTime);j(z.x);h()}}};var t=function(I,H,J){if(z.dataSources.length>0){var G=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(H,z.canvas).x);var K=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(H,z.canvas).y);if(G>z.canvas.width-2||isNaN(G)||G<2){z.timeHighlight(true);z.highlightedSlice=undefined}else{if(K>z.canvas.height-2||isNaN(K)||K<2){z.timeHighlight(true);z.highlightedSlice=undefined}}}};var E=function(G,O,K){if(z.dataSources.length>0){var M=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(O,z.canvas).x);var H=s(M);if(H==undefined){return}var I;var N=z.tds.timeSlices;var J=z.tds.getSliceIndex(H);if(z.style=="graph"){I=N[J]}if(z.style=="bars"){var L=z.timeGeometry.toScreen(H);if(M<L&&J>0){I=N[J-1]}else{I=N[J]}}if(z.highlightedSlice==undefined||z.highlightedSlice!=I){z.highlightedSlice=I;z.timeHighlight(false)}}};this.redrawPlot=function(){z.clearTimeplot();z.tds.reset(this.timeGeometry);z.timeplot.repaint();if(z.leftFlagPos!=null){z.leftFlagPos=F(z.leftFlagTime);z.rightFlagPos=F(z.rightFlagTime);h()}else{z.displayOverlay()}z.initLabels([]);z.updateOverview()};this.zoom=function(H,G){if(this.eventSources.length==0){if(STIStatic.timeZoom){this.zoomSlider.setValue(0)}return false}if(G==null){G=s(this.canvas.width/2)}if(this.tds.setZoom(H,G,this.leftFlagTime,this.rightFlagTime)){this.redrawPlot()}if(STIStatic.timeZoom){this.zoomSlider.setValue(this.tds.getZoom())}return true};var v=function(I,H,K){if(H.preventDefault){H.preventDefault()}if(z.dataSources.length==0){return}var L=0;if(!H){H=window.event}if(H.wheelDelta){L=H.wheelDelta/120;if(window.opera){L=-L}}else{if(H.detail){L=-H.detail/3}}if(L){var G=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(H,z.canvas).x);var J=s(G);z.zoom(L,J)}};var m=this.timeplot.getElement();SimileAjax.DOM.registerEvent(m,"mousedown",a);SimileAjax.DOM.registerEvent(m,"mousemove",e);SimileAjax.DOM.registerEvent(m,"mousemove",E);SimileAjax.DOM.registerEvent(m,"mouseout",t);if(STIStatic.mouseWheelZoom){SimileAjax.DOM.registerEvent(m,"mousewheel",v)}this.setCanvas();this.gui.setHeight()},setCanvas:function(){var b=document.createElement("canvas");b.setAttribute("class","plotCanvas");this.gui.plotWindow.appendChild(b);b.width=this.gui.plotWindow.clientWidth;b.height=this.gui.plotWindow.clientHeight;if(!b.getContext&&G_vmlCanvasManager){b=G_vmlCanvasManager.initElement(b)}var a=b.getContext("2d");var c=a.createLinearGradient(0,0,0,this.canvas.height);if(STIStatic.lightScheme){c.addColorStop(0,"#c9c9cb");c.addColorStop(1,"#ededed ")}else{c.addColorStop(0,STIStatic.toolbarColor);c.addColorStop(1,STIStatic.toolbarColor)}a.fillStyle=c;a.fillRect(0,0,this.gui.plotWindow.clientWidth,this.gui.plotWindow.clientHeight)},resetOverlay:function(){this.poles.style.visibility="hidden";var c=this.timeplot._plots;for(var b=0;b<c.length;b++){for(var a=0;a<c[b].pins.length;a++){c[b].pins[a]={height:0,count:0}}}},setFilterBar:function(a){this.filterBar=a},reset:function(){this.leftFlagPole.style.visibility="hidden";this.rightFlagPole.style.visibility="hidden";this.rangeBox.style.visibility="hidden";this.leftFeather.style.visibility="hidden";this.rightFeather.style.visibility="hidden";this.leftHandle.style.visibility="hidden";this.rightHandle.style.visibility="hidden";this.toolbar.style.visibility="hidden";this.toolbarAbsoluteDiv.style.visibility="hidden";this.cancelButton.style.visibility="hidden";var c=this.timeplot._plots;for(var a=0;a<c.length;a++){c[a].opacityPlot.style.visibility="hidden"}this.resetOverlay();this.filterBar.reset(false);var b=this.tds.timeSlices;if(b!=undefined){for(var a=0;a<b.length;a++){b[a].reset()}}this.status=0;this.stop();this.gui.updateAnimationButtons(0);this.leftFlagPos=null;this.leftFlagTime=null;this.rightFlagPos=null;this.rightFlagTime=null;this.mouseDownTime=null;this.mouseUpTime=null;this.mouseTempTime=null;this.mouseDownPos=null;this.mouseUpPos=null;this.mouseTempPos=null;if(this.popup){this.popup.reset();this.popupClickDiv.style.visibility="hidden"}this.selectedObjects=[]},displayOverlay:function(){this.poles.style.visibility="visible";var m=this.poles.getElementsByTagName("canvas")[0];m.width=this.canvas.width;m.height=this.canvas.height;if(!m.getContext&&G_vmlCanvasManager){m=G_vmlCanvasManager.initElement(m)}var u=m.getContext("2d");u.clearRect(0,0,this.canvas.width,this.canvas.height);var r=this.timeplot._plots;var s=this.tds.timeSlices;for(var l=0;l<s.length;l++){if(this.style=="bars"&&l+1==s.length){return}if(s[l].overlay()==0){continue}var c=s[l].stacks;var d=s[l].date;var q;if(this.style=="graph"){q=this.timeGeometry.toScreen(d)}else{if(this.style=="bars"){var b=this.timeGeometry.toScreen(d);var a=this.timeGeometry.toScreen(s[l+1].date);q=(b+a)/2}}var p=[];var o=0;for(var f=0;f<c.length;f++){var g=r[f]._dataSource.getData();for(var e=0;e<g.times.length;e++){if(g.times[e].getTime()==d.getTime()){var t=r[f]._valueGeometry.toScreen(r[f]._dataSource.getData().values[e])*c[f].overlay/c[f].value;p.push(t);r[f].pins[l]={height:t,count:c[f].overlay};if(t>o){o=t}break}}}u.fillStyle="rgb(102,102,102)";u.beginPath();u.rect(q-1,this.canvas.height-o,2,o);u.fill();for(var f=0;f<p.length;f++){if(p[f]>0){u.fillStyle="rgba("+STIStatic.colors[f].r1+","+STIStatic.colors[f].g1+","+STIStatic.colors[f].b1+",0.6)";u.beginPath();u.arc(q,this.canvas.height-p[f],2.5,0,Math.PI*2,true);u.closePath();u.fill()}}}},highlightChanged:function(a){this.resetOverlay();this.tds.setOverlay(a);this.displayOverlay()},selectionChanged:function(a){this.reset();this.tds.setOverlay(a);this.displayOverlay()},setFeather:function(){this.leftFeatherTime=this.leftFlagTime;this.rightFeatherTime=this.rightFlagTime;if(STIStatic.featherSlider){this.featherWidth=Math.floor(this.canvas.width/this.tds.timeSlices.length*this.slider.getValue());var b=this.tds.timeSlices;for(var a=0;a<b.length;a++){if(b[a].date.getTime()==this.leftFlagTime.getTime()){if(a-this.slider.getValue()>=0){this.leftFeatherTime=b[a-this.slider.getValue()].date}else{this.leftFeatherTime=b[0].date}}if(b[a].date.getTime()==this.rightFlagTime.getTime()){if(a+this.slider.getValue()<b.length){this.rightFeatherTime=b[a+this.slider.getValue()].date}else{this.rightFeatherTime=b[b.length-1].date}}}}else{this.featherWidth=0}},getOverviewLeft:function(f){var a=this.overview.offsetWidth;var c=this.tds.earliest().getTime();var d=this.tds.latest().getTime();var b=f.getTime();return Math.round(a*(b-c)/(d-c))},initOverview:function(){var e=this.timeGeometry._grid;if(e.length==0){var d=this;setTimeout(function(){d.initOverview()},10);return}this.overview.style.width=this.canvas.width+"px";var c=this.gui.timeplotDiv.offsetLeft;this.overview.innerHTML="";this.overview.style.left=c+"px";this.overviewRange=document.createElement("div");this.overviewRange.setAttribute("class","overviewRange");this.overview.appendChild(this.overviewRange);for(var b=0;b<e.length;b++){var a=document.createElement("div");a.setAttribute("class","overviewLabel");a.innerHTML=e[b].label;a.style.left=Math.floor(e[b].x)+"px";this.overview.appendChild(a)}this.updateOverview()},initLabels:function(e){if(e.length==0){e=this.timeGeometry._grid;if(e.length==0){var d=this;setTimeout(function(){d.initLabels([])},10);return}}this.plotLabels.style.width=this.canvas.width+"px";var c=this.gui.timeplotDiv.offsetLeft;this.plotLabels.style.left=c+"px";this.plotLabels.innerHTML="";for(var b=0;b<e.length;b++){var a=document.createElement("div");a.setAttribute("class","plotLabel");a.innerHTML=e[b].label;a.style.left=Math.floor(e[b].x)+"px";this.plotLabels.appendChild(a)}},updateOverview:function(){if(this.tds.getZoom()>0){this.plotLabels.style.visibility="hidden";this.timeGeometry._hideLabels=false;this.overview.style.visibility="visible";this.shiftLeft.style.visibility="visible";this.shiftRight.style.visibility="visible";var b=this.getOverviewLeft(this.tds.timeSlices[this.tds.leftSlice].date);var a=this.getOverviewLeft(this.tds.timeSlices[this.tds.rightSlice].date);this.overviewRange.style.left=b+"px";this.overviewRange.style.width=(a-b)+"px"}else{this.timeGeometry._hideLabels=true;this.plotLabels.style.visibility="visible";this.overview.style.visibility="hidden";this.shiftLeft.style.visibility="hidden";this.shiftRight.style.visibility="hidden"}},getSlices:function(){return this.tds.timeSlices},timeSelection:function(){this.setFeather();var k=this.tds.timeSlices;var m,h,e,d;for(var g=0;g<k.length;g++){if(k[g].date.getTime()==this.leftFeatherTime.getTime()){m=g}if(k[g].date.getTime()==this.leftFlagTime.getTime()){h=g}if(k[g].date.getTime()==this.rightFlagTime.getTime()){if(this.style=="graph"){e=g}if(this.style=="bars"){e=g-1}}if(k[g].date.getTime()==this.rightFeatherTime.getTime()){if(this.style=="graph"){e=g}if(this.style=="bars"){e=g-1}}}this.selectedObjects=[];var l=[];for(var g=0;g<k.length;g++){var b=0;if(g>m&&g<h){b=(g-m)/(h-m)}else{if(g>=h&&g<=e){b=1}else{if(g>e&&g<d){b=(d-g)/(d-e)}}}if(b==0){continue}var c=[];var a=false;for(var f in k[g].stacks){c.push(k[g].stacks[f].elements);if(k[g].stacks[f].elements.length>0){a=true}}if(b==1){if(this.selectedObjects.length==0){for(var f in c){this.selectedObjects.push([])}}for(var f in this.selectedObjects){this.selectedObjects[f]=this.selectedObjects[f].concat(c[f])}}if(a){l.push({value:b,objects:c})}}this.core.triggerSelection(l);this.filterBar.reset(true)},deselection:function(){this.reset();this.core.triggerSelection([])},filtering:function(){this.core.triggerRefining(this.selectedObjects)},inverseFiltering:function(){var g=this.tds.timeSlices;var b,c;for(var e=0;e<g.length;e++){if(g[e].date.getTime()==this.leftFlagTime.getTime()){b=e}if(g[e].date.getTime()==this.rightFlagTime.getTime()){if(this.style=="graph"){c=e}if(this.style=="bars"){c=e-1}}}this.selectedObjects=[];for(var e=0;e<g.length;e++){if(e>=b&&e<=c){continue}var a=[];var f=false;for(var d in g[e].stacks){a.push(g[e].stacks[d].elements);if(g[e].stacks[d].elements.length>0){f=true}}if(this.selectedObjects.length==0){for(var d in a){this.selectedObjects.push([])}}for(var d in this.selectedObjects){this.selectedObjects[d]=this.selectedObjects[d].concat(a[d])}}this.filtering()},timeHighlight:function(b){if(this.status==0){var d=this.highlightedSlice;if(this.leftFlagTime!=null){if(this.style=="graph"&&d.date>=this.leftFlagTime&&d.date<=this.rightFlagTime){return}if(this.style=="bars"&&d.date>=this.leftFlagTime&&d.date<this.rightFlagTime){return}}var a=[];var e=0;if(!b){for(var c in d.stacks){a.push(d.stacks[c].elements);e+=d.stacks[c].elements.length}}var f=[];if(this.selectedObjects.length>0){f.push({value:1,objects:this.selectedObjects})}if(e>0){f.push({value:1,objects:a})}this.core.triggerHighlight(f)}},timeRefining:function(){this.core.triggerRefining(this.selectedObjects)},setStyle:function(a){this.style=a},drawLinearPlot:function(){if(typeof this.valueGeometry!="undefined"){this.valueGeometry.actLinear();this.timeplot.repaint()}},drawLogarithmicPlot:function(){if(typeof this.valueGeometry!="undefined"){this.valueGeometry.actLogarithmic();this.timeplot.repaint()}}};function TableWidget(a,b){this.core=a;this.container=b;this.tables;this.hashMapping;this.gui=new TableGui(this,b);this.initialize()}TableWidget.prototype={initTable:function(g,h){$(this.tabs).empty();$(this.input).empty();this.activeTable=undefined;this.tables=[];this.tableTabs=[];this.tableElements=[];this.tableHash=[];this.selectedObjects=[];this.filterBar.reset(false);var b=this;var c=function(l,j){var m=document.createElement("div");m.setAttribute("class","tableTab unselectedTableTab");m.onclick=function(){b.selectTable(j)};m.innerHTML=l;return m};for(var f in g){this.selectedObjects.push([]);this.tableHash.push([]);var d=c(h[f],f);this.tabs.appendChild(d);this.tableTabs.push(d);var a=[];for(var e in g[f]){a.push(new TableElement(g[f][e]));this.tableHash[f][g[f][e].index]=a[a.length-1]}var k=new Table(a,this,f);this.tables.push(k);this.tableElements.push(a)}if(g.length>0){this.selectTable(0)}},selectTable:function(a){if(this.activeTable!=a){if(typeof this.activeTable!="undefined"){this.tables[this.activeTable].hide();this.tableTabs[this.activeTable].setAttribute("class","tableTab unselectedTableTab")}this.activeTable=a;this.tables[this.activeTable].show();this.tableTabs[this.activeTable].setAttribute("class","tableTab selectedTableTab");this.core.rise(a)}},initialize:function(){this.tabs=document.createElement("div");this.tabs.setAttribute("class","tableTabs");this.container.appendChild(this.tabs);this.input=document.createElement("div");this.input.setAttribute("class","tableInput");this.container.appendChild(this.input);this.filterBar=new FilterBar(this,this.container)},highlightChanged:function(e){for(var c=0;c<this.tableElements.length;c++){for(var b=0;b<this.tableElements[c].length;b++){this.tableElements[c][b].highlighted=false}}for(var c=0;c<e.length;c++){var d=e[c].objects;for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){this.tableHash[b][d[b][a].index].highlighted=true}}}this.tables[this.activeTable].update()},selectionChanged:function(e){this.reset();for(var c=0;c<this.tableElements.length;c++){for(var b=0;b<this.tableElements[c].length;b++){this.tableElements[c][b].selected=false;this.tableElements[c][b].highlighted=false}}for(var c=0;c<e.length;c++){var d=e[c].objects;for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){this.tableHash[b][d[b][a].index].selected=true}}}this.tables[this.activeTable].reset();this.tables[this.activeTable].update()},triggerHighlight:function(b){if(typeof b!="undefined"){var c=[];for(var a=0;a<this.tables.length;a++){c.push([])}c[this.activeTable].push(b);this.core.triggerHighlight([{value:1,objects:this.selectedObjects}].concat([{value:1,objects:c}]))}else{this.core.triggerHighlight([{value:1,objects:this.selectedObjects}])}},tableSelection:function(){var d=false;for(var b=0;b<this.tables.length;b++){this.selectedObjects[b]=[]}for(var b=0;b<this.tableElements.length;b++){for(var a=0;a<this.tableElements[b].length;a++){var c=this.tableElements[b][a];if(c.selected){this.selectedObjects[b].push(c.object);d=true}}}this.core.triggerSelection([{value:1,objects:this.selectedObjects}]);this.filterBar.reset(true)},deselection:function(){this.reset();this.core.triggerSelection([])},filtering:function(){this.core.triggerRefining(this.selectedObjects)},inverseFiltering:function(){var d=false;for(var b=0;b<this.tables.length;b++){this.selectedObjects[b]=[]}for(var b=0;b<this.tableElements.length;b++){for(var a=0;a<this.tableElements[b].length;a++){var c=this.tableElements[b][a];if(!c.selected){this.selectedObjects[b].push(c.object);d=true}}}this.filtering()},triggerRefining:function(){this.core.triggerRefining(this.selectedObjects)},setFilterBar:function(a){this.filterBar=a},reset:function(){this.selectedObjects=[];this.filterBar.reset(false);this.tables[this.activeTable].resetElements();this.tables[this.activeTable].reset();this.tables[this.activeTable].update()}};function Table(b,a,c){this.elements=b;this.showElementsLength=b.length;this.parent=a;this.id=c;this.validResultsPerPage=[10,20,50,100];this.keyHeaderList=[];this.initialize()}Table.prototype={initToolbar:function(){var o=this;this.toolbar=document.createElement("table");this.toolbar.setAttribute("class","ddbToolbar");this.tableDiv.appendChild(this.toolbar);var a=document.createElement("tr");this.toolbar.appendChild(a);var l=document.createElement("td");a.appendChild(l);if(STIStatic.tableSelectPage){var d=true;this.selectPage=document.createElement("div");this.selectPage.setAttribute("class","paginationButton selectPage");this.selectPage.title=STIStatic.getString("selectTablePageItemsHelp");l.appendChild(this.selectPage);this.selectPage.onclick=function(){d=!d;if(d){var q=0;for(var r=o.first;r<o.elements.length;r++){o.elements[r].selected=false;q++;if(q==o.resultsPerPage){break}}o.selectPage.setAttribute("class","paginationButton selectPage");o.selectPage.title=STIStatic.getString("selectTablePageItemsHelp")}else{var q=0;for(var r=o.first;r<o.elements.length;r++){o.elements[r].selected=true;q++;if(q==o.resultsPerPage){break}}o.selectPage.setAttribute("class","paginationButton deselectPage");o.selectPage.title=STIStatic.getString("deselectTablePageItemsHelp")}o.update();o.parent.tableSelection()}}if(STIStatic.tableSelectAll){var b=true;this.selectAll=document.createElement("div");this.selectAll.setAttribute("class","paginationButton selectAll");o.selectAll.title=STIStatic.getString("selectAllTableItemsHelp");l.appendChild(this.selectAll);this.selectAll.onclick=function(){b=!b;if(b){for(var q=0;q<o.elements.length;q++){o.elements[q].selected=false}o.selectAll.setAttribute("class","paginationButton selectAll");o.selectAll.title=STIStatic.getString("selectAllTableItemsHelp")}else{for(var q=0;q<o.elements.length;q++){o.elements[q].selected=true}o.selectAll.setAttribute("class","paginationButton deselectAll");o.selectAll.title=STIStatic.getString("deselectAllTableItemsHelp")}o.update();o.parent.tableSelection()}}this.showSelectedItems=false;if(STIStatic.tableShowSelected){this.showSelected=document.createElement("div");this.showSelected.setAttribute("class","paginationButton showSelected");o.showSelected.title=STIStatic.getString("showSelectedHelp");l.appendChild(this.showSelected);this.showSelected.onclick=function(){o.showSelectedItems=!o.showSelectedItems;if(o.showSelectedItems){o.showElementsLength=0;for(var q=0;q<o.elements.length;q++){if(o.elements[q].selected){o.showElementsLength++}}o.showSelected.setAttribute("class","paginationButton showAll")}else{o.showElementsLength=o.elements.length;o.showSelected.setAttribute("class","paginationButton showSelected")}o.updateIndices(o.resultsPerPage);o.update()}}var e=document.createElement("td");a.appendChild(e);var m=document.createElement("td");a.appendChild(m);this.resultsInfo=document.createElement("div");this.resultsInfo.setAttribute("class","resultsInfo");e.appendChild(this.resultsInfo);this.firstPage=document.createElement("div");this.firstPage.setAttribute("class","paginationButton");this.firstPage.title=STIStatic.getString("paginationFirsPageHelp");m.appendChild(this.firstPage);this.firstPage.onclick=function(){if(o.page!=0){o.page=0;o.update()}};this.previousPage=document.createElement("div");this.previousPage.setAttribute("class","paginationButton");this.previousPage.title=STIStatic.getString("paginationPreviousPageHelp");m.appendChild(this.previousPage);this.previousPage.onclick=function(){if(o.page>0){o.page--;o.update()}};this.pageInfo=document.createElement("div");this.pageInfo.setAttribute("class","pageInfo");m.appendChild(this.pageInfo);this.nextPage=document.createElement("div");this.nextPage.setAttribute("class","paginationButton");this.nextPage.title=STIStatic.getString("paginationNextPageHelp");m.appendChild(this.nextPage);this.nextPage.onclick=function(){if(o.page<o.pages-1){o.page++;o.update()}};this.lastPage=document.createElement("div");this.lastPage.setAttribute("class","paginationButton");this.lastPage.title=STIStatic.getString("paginationLastPageHelp");m.appendChild(this.lastPage);this.lastPage.onclick=function(){if(o.page!=o.pages-1){o.page=o.pages-1;o.update()}};this.resultsDropdown=document.createElement("div");this.resultsDropdown.setAttribute("class","resultsDropdown");m.appendChild(this.resultsDropdown);var g=[];var k=function(s,q){var r=function(){o.updateIndices(s);o.update()};g.push({name:s,onclick:r})};for(var c=0;c<STIStatic.validResultsPerPage.length;c++){k(STIStatic.validResultsPerPage[c],c)}var p=new Dropdown(this.resultsDropdown,g,"selectMapType");for(var c=0;c<STIStatic.validResultsPerPage.length;c++){if(STIStatic.initialResultsPerPage==STIStatic.validResultsPerPage[c]){p.setEntry(c);break}}p.div.title=STIStatic.getString("paginationDropdownHelp");this.elementList=document.createElement("table");this.elementList.setAttribute("class","resultList");this.tableDiv.appendChild(this.elementList);this.elementListHeader=document.createElement("tr");this.elementList.appendChild(this.elementListHeader);var j=document.createElement("th");this.elementListHeader.appendChild(j);if(typeof(this.elements[0])=="undefined"){return}var f=function(s){o.keyHeaderList.push(s);var q=document.createElement("th");o.elementListHeader.appendChild(q);var r=document.createElement("div");q.appendChild(r);var t=document.createElement("div");t.setAttribute("class","headerLabel");t.innerHTML=s;q.appendChild(t);r.setAttribute("class","paginationButton sortAZ");r.title=STIStatic.getString("sortAZHelp");var u=false;r.onclick=function(){u=!u;if(u){r.setAttribute("class","paginationButton sortZA");r.title=STIStatic.getString("sortZAHelp");o.sortAscending(s);o.update()}else{r.setAttribute("class","paginationButton sortAZ");r.title=STIStatic.getString("sortAZHelp");o.sortDescending(s);o.update()}}};for(var h in this.elements[0].object.tableContent){f(h)}},sortAscending:function(b){var a=function(d,c){if(d.object.tableContent[b]<c.object.tableContent[b]){return -1}return 1};this.elements.sort(a)},sortDescending:function(b){var a=function(d,c){if(d.object.tableContent[b]>c.object.tableContent[b]){return -1}return 1};this.elements.sort(a)},setPagesText:function(){var a=STIStatic.getString("pageInfo");a=a.replace("PAGES_ID",this.pages);a=a.replace("PAGE_ID",this.page+1);this.pageInfo.innerHTML=a},setResultsText:function(){if(this.elements.length==0){this.resultsInfo.innerHTML="0 Results"}else{var b=STIStatic.getString("resultsInfo");var c=this.page*this.resultsPerPage+1;var a=(this.page+1==this.pages)?this.showElementsLength:c+this.resultsPerPage-1;b=b.replace("RESULTS_FROM_ID",c);b=b.replace("RESULTS_TO_ID",a);b=b.replace("RESULTS_ID",this.showElementsLength);this.resultsInfo.innerHTML=b}},updateIndices:function(b){if(typeof this.resultsPerPage=="undefined"){this.page=0;this.resultsPerPage=0}var a=this.page*this.resultsPerPage;this.resultsPerPage=b;if(this.showSelectedItems){a=0}this.pages=Math.floor(this.showElementsLength/this.resultsPerPage);if(this.showElementsLength%this.resultsPerPage!=0){this.pages++}this.page=Math.floor(a/this.resultsPerPage)},update:function(){var s=this;$(this.elementList).find("tr:gt(0)").remove();if(this.page==0){this.previousPage.setAttribute("class","paginationButton previousPageDisabled");this.firstPage.setAttribute("class","paginationButton firstPageDisabled")}else{this.previousPage.setAttribute("class","paginationButton previousPageEnabled");this.firstPage.setAttribute("class","paginationButton firstPageEnabled")}if(this.page==this.pages-1){this.nextPage.setAttribute("class","paginationButton nextPageDisabled");this.lastPage.setAttribute("class","paginationButton lastPageDisabled")}else{this.nextPage.setAttribute("class","paginationButton nextPageEnabled");this.lastPage.setAttribute("class","paginationButton lastPageEnabled")}this.setPagesText();this.setResultsText();if(this.showSelectedItems){var f=this.page*this.resultsPerPage;var m=0;for(var q=0;q<this.elements.length;q++){if(m==f){this.first=q;break}if(this.elements[q].selected){m++}}}else{this.first=this.page*this.resultsPerPage}var u=STIStatic.colors[this.id];var h=[];var o=function(){for(var c=0;c<h.length;c++){if(!h[c].e.selected){h[c].e.highlighted=false;$(h[c].div).css("background-color",STIStatic.toolbarColor)}}};var v=function(e,x){var k=function(){o();if(!e.selected){e.highlighted=true;s.parent.triggerHighlight(e.object);$(x).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")")}};var c=function(){o();if(!e.selected){s.parent.triggerHighlight()}};$(x).hover(k,c);$(x).mousemove(function(){if(!e.selected&&!e.highlighted){e.highlighted=true;s.parent.triggerHighlight(e.object);$(x).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")")}})};var g=function(e,x,k){var c=function(z){var y=$(k).is(":checked");if(y){e.selected=true;e.highlighted=false}else{e.selected=false;e.highlighted=true}s.parent.tableSelection()};$(k).click(c)};this.checkboxes=[];var m=0;for(var q=this.first;q<this.elements.length;q++){var t=this.elements[q];if(typeof(t)=="undefined"){continue}if(this.showSelectedItems&&!t.selected){continue}var d=$("<tr/>").appendTo(this.elementList);var r=$("<td/>").appendTo(d);var l=$("<input type='checkbox'/>").appendTo(r);$(l).attr("checked",t.selected);var a=function(c,z){var x=z.substring(0,STIStatic.tableContentOffset);x=x.substring(0,x.lastIndexOf(" "));x+=" ... ";var k=$("<div style='display:inline-block;'/>").appendTo(c);$(k).html(x);var e=false;var y=$("<div style='display:inline-block;'><a href='javascript:void(0)'>>></a></div>").appendTo(c);$(y).click(function(){e=!e;if(e){$(k).html(z);$(y).html('<a href="javascript:void(0)"><<</a>')}else{$(k).html(x);$(y).html('<a href="javascript:void(0)">>></a>')}})};for(var p=0;p<s.keyHeaderList.length;p++){var w=s.keyHeaderList[p];var j=t.object.tableContent[w];var b=$("<td/>").appendTo(d);if(STIStatic.tableContentOffset&&j.length<STIStatic.tableContentOffset){$(b).html(j)}else{a(b,j)}}if(t.selected||t.highlighted){$(d).css("background-color","rgb("+u.r0+","+u.g0+","+u.b0+")")}else{$(d).css("background-color",STIStatic.toolbarColor)}h.push({e:t,div:d});v(t,d);g(t,d,l);this.checkboxes.push(l);$(r).css("text-align","center");m++;if(m==this.resultsPerPage){break}}},show:function(){this.tableDiv.style.display="block"},hide:function(){this.tableDiv.style.display="none"},resetElements:function(){for(var a=0;a<this.elements.length;a++){this.elements[a].selected=false;this.elements[a].highlighted=false}},reset:function(){this.showSelectedItems=false;this.showElementsLength=this.elements.length;this.showSelected.setAttribute("class","paginationButton showSelected");this.updateIndices(this.resultsPerPage)},initialize:function(){this.tableDiv=document.createElement("div");this.tableDiv.setAttribute("class","singleTable");this.parent.input.appendChild(this.tableDiv);this.initToolbar();this.input=document.createElement("div");this.input.setAttribute("class","tableInput");this.tableDiv.appendChild(this.input);this.tableDiv.style.display="none";this.updateIndices(STIStatic.initialResultsPerPage);this.update()}};function TableElement(a){this.object=a;this.selected=false;this.highlighted=false}function MapGui(b,a,h){this.map=b;this.container=a;if(STIStatic.mapWidth){this.container.style.width=STIStatic.mapWidth}if(STIStatic.mapHeight){this.container.style.height=STIStatic.mapHeight}this.mapWindow=document.createElement("div");this.mapWindow.id="mapWindow";this.container.appendChild(this.mapWindow);this.mapContainer=document.createElement("div");this.mapContainer.id="mapContainer";this.mapContainer.style.position="absolute";this.mapContainer.style.zIndex=0;this.mapWindow.appendChild(this.mapContainer);this.background=document.createElement("canvas");this.background.setAttribute("class","mapCanvas");this.mapWindow.appendChild(this.background);if(!this.background.getContext&&G_vmlCanvasManager){this.background=G_vmlCanvasManager.initElement(this.background)}var j=document.createElement("table");j.setAttribute("class","absoluteToolbar ddbToolbar");this.container.appendChild(j);this.mapToolbar=j;var f=document.createElement("tr");j.appendChild(f);var g=document.createElement("tr");j.appendChild(g);if(STIStatic.mapSelection){this.mapTypeTitle=document.createElement("td");f.appendChild(this.mapTypeTitle);this.mapTypeTitle.innerHTML=STIStatic.getString("mapType");this.mapTypeSelector=document.createElement("td");g.appendChild(this.mapTypeSelector)}if(STIStatic.mapSelectionTools){this.mapSelectorTitle=document.createElement("td");f.appendChild(this.mapSelectorTitle);this.mapSelectorTitle.innerHTML=STIStatic.getString("mapSelectorTools");var k=document.createElement("td");var l=this.map.initSelectorTools();for(var e in l){k.appendChild(l[e].button)}g.appendChild(k)}if(STIStatic.binningSelection){this.binningTitle=document.createElement("td");f.appendChild(this.binningTitle);this.binningTitle.innerHTML=STIStatic.getString("binningType");this.binningSelector=document.createElement("td");g.appendChild(this.binningSelector)}if(STIStatic.dataInformation){this.infoTitle=document.createElement("td");this.infoTitle.innerHTML=h;f.appendChild(this.infoTitle);var d=document.createElement("td");this.mapElements=document.createElement("div");this.mapElements.setAttribute("class","ddbElementsCount");d.appendChild(this.mapElements);g.appendChild(d)}var c=this;if(navigator.geolocation&&STIStatic.geoLocation){this.geoActive=false;this.geoLocation=document.createElement("div");this.geoLocation.setAttribute("class","geoLocationOff");this.geoLocation.title=STIStatic.getString("activateGeoLocation");this.container.appendChild(this.geoLocation);this.geoLocation.style.left="20px";this.geoLocation.onclick=function(){var m=function(){if(c.geoActive){c.geoLocation.setAttribute("class","geoLocationOn");c.geoLocation.title=STIStatic.getString(STIStatic.language,"deactivateGeoLocation")}else{c.geoLocation.setAttribute("class","geoLocationOff");c.geoLocation.title=STIStatic.getString(STIStatic.language,"activateGeoLocation")}};if(!c.geoActive){if(typeof c.longitude=="undefined"){navigator.geolocation.getCurrentPosition(function(o){c.longitude=o.coords.longitude;c.latitude=o.coords.latitude;c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;m()},function(o){console.log(typeof o=="string"?o:"error")})}else{c.map.setMarker(c.longitude,c.latitude);c.geoActive=true;m()}}else{c.map.removeMarker();c.geoActive=false;m()}}}if(!STIStatic.olNavigation){this.map.zoomSlider=new MapZoomSlider(this.map,"vertical");this.container.appendChild(this.map.zoomSlider.div);this.map.zoomSlider.div.style.left="20px"}if(STIStatic.resetMap){this.homeButton=document.createElement("div");this.homeButton.setAttribute("class","mapHome");this.homeButton.title=STIStatic.getString("home");this.container.appendChild(this.homeButton);this.homeButton.style.left="20px";this.homeButton.onclick=function(){c.map.drawObjectLayer(true)}}this.resize=function(){var t=this.container.offsetWidth;var m=this.container.offsetHeight;this.mapWindow.style.width=t+"px";this.mapWindow.style.height=m+"px";this.mapContainer.style.width=t+"px";this.mapContainer.style.height=m+"px";var r=j.offsetHeight+20;if(typeof this.geoLocation!="undefined"){this.geoLocation.style.top=r+"px";r+=this.geoLocation.offsetHeight+4}if(STIStatic.olNavigation){var u=$(".olControlPanPanel")[0];var q=$(".olControlZoomPanel")[0];$(u).css("top",r+"px");var p=$(".olControlPanSouthItemInactive")[0];r=$(p).height()+$(p).offset().top;$(q).css("top",r+"px");var o=$(".olControlZoomOutItemInactive")[0];r=$(o).height()+$(o).offset().top}else{this.map.zoomSlider.div.style.top=r+"px";r+=this.map.zoomSlider.div.offsetHeight+2}if(STIStatic.resetMap){this.homeButton.style.top=r+"px"}this.background.width=t;this.background.height=m;var v=this.background.getContext("2d");var s=v.createLinearGradient(0,0,0,m);s.addColorStop(0,STIStatic.mapCanvasFrom);s.addColorStop(1,STIStatic.mapCanvasTo);v.fillStyle=s;v.fillRect(0,0,t,m);this.headerHeight=j.offsetHeight;this.headerWidth=j.offsetWidth};this.resize();this.updateSpaceQuantity=function(m){if(!STIStatic.dataInformation){return}this.mapCount=m;if(m!=1){this.mapElements.innerHTML=this.beautifyCount(m)+" "+STIStatic.getString("results")}else{this.mapElements.innerHTML=this.beautifyCount(m)+" "+STIStatic.getString("result")}};this.setMapsDropdown=function(){if(!STIStatic.mapSelection){return}$(this.mapTypeSelector).empty();var q=[];var o=this;var m=function(s,r){var t=function(){o.map.setMap(r)};q.push({name:s,onclick:t})};for(var p=0;p<this.map.baseLayers.length;p++){m(this.map.baseLayers[p].name,p)}this.mapTypeDropdown=new Dropdown(this.mapTypeSelector,q,STIStatic.getString("selectMapType"))};this.setMap=function(){if(STIStatic.mapSelection){this.mapTypeDropdown.setEntry(this.map.baselayerIndex)}};this.setBinningDropdown=function(){if(!STIStatic.binningSelection){return}$(this.binningSelector).empty();var p=[];var m=this;var o=0;var s;var r=function(u,v){if(STIStatic.binning==v){s=o}else{o++}var t=function(){STIStatic.binning=v;m.map.initMap(m.map.mapObjects,false);m.map.riseLayer()};p.push({name:u,onclick:t})};r(STIStatic.getString("genericBinning"),"generic");r(STIStatic.getString("squareBinning"),"square");r(STIStatic.getString("hexagonalBinning"),"hexagonal");r(STIStatic.getString("triangularBinning"),"triangular");r(STIStatic.getString("noBinning"),false);var q=new Dropdown(this.binningSelector,p,STIStatic.getString("binningTooltip"));q.setEntry(s)};this.setBinningDropdown();this.beautifyCount=function(o){var r=o+"";var q=0;var m=r.length;while(m-q>3){q+=3;r=r.substring(0,m-q)+"."+r.substring(m-q);q++;m++}return r}}function TimeGui(l,a,o){var b=this;this.plot=l;this.container=a;if(STIStatic.timeplotWidth){this.container.style.width=STIStatic.timeplotWidth}if(STIStatic.timeplotHeight){this.container.style.height=STIStatic.timeplotHeight}var q=this.container.offsetWidth;var f=this.container.offsetHeight;var p=document.createElement("table");p.setAttribute("class","ddbToolbar");this.container.appendChild(p);this.plotWindow=document.createElement("div");this.plotWindow.id="plotWindow";this.plotWindow.style.width=q+"px";this.plotWindow.style.height=(f+12)+"px";this.container.style.height=(f+12)+"px";this.plotWindow.onmousedown=function(){return false};this.plotContainer=document.createElement("div");this.plotContainer.id="plotContainer";this.plotContainer.style.width=q+"px";this.plotContainer.style.height=f+"px";this.plotContainer.style.position="absolute";this.plotContainer.style.zIndex=0;this.plotContainer.style.top="12px";this.plotWindow.appendChild(this.plotContainer);this.container.appendChild(this.plotWindow);this.timeplotDiv=document.createElement("div");this.timeplotDiv.style.left="16px";this.timeplotDiv.style.width=(q-32)+"px";this.timeplotDiv.style.height=f+"px";this.plotContainer.appendChild(this.timeplotDiv);var j=document.createElement("tr");p.appendChild(j);var g=document.createElement("tr");p.appendChild(g);this.timeUnitTitle=document.createElement("td");this.timeUnitTitle.innerHTML=STIStatic.getString("timeUnit");j.appendChild(this.timeUnitTitle);this.timeUnitSelector=document.createElement("td");g.appendChild(this.timeUnitSelector);this.timeAnimation=document.createElement("td");this.timeAnimation.innerHTML=STIStatic.getString("timeAnimation");var k=document.createElement("td");var d;this.updateAnimationButtons=function(h){d=h;if(d==0){b.playButton.setAttribute("class","smallButton playDisabled");b.pauseButton.setAttribute("class","smallButton pauseDisabled")}else{if(d==1){b.playButton.setAttribute("class","smallButton playEnabled");b.pauseButton.setAttribute("class","smallButton pauseDisabled")}else{b.playButton.setAttribute("class","smallButton playDisabled");b.pauseButton.setAttribute("class","smallButton pauseEnabled")}}};this.playButton=document.createElement("div");this.playButton.title=STIStatic.getString("playButton");k.appendChild(this.playButton);this.playButton.onclick=function(){if(d==1){l.play()}};this.pauseButton=document.createElement("div");this.pauseButton.title=STIStatic.getString("pauseButton");k.appendChild(this.pauseButton);this.pauseButton.onclick=function(){if(d==2){l.stop()}};this.valueScale=document.createElement("td");this.valueScale.innerHTML=STIStatic.getString("valueScale");var c=document.createElement("td");var m;var e=function(h){if(m!=h){m=h;if(m){b.linButton.setAttribute("class","smallButton linearPlotActivated");b.logButton.setAttribute("class","smallButton logarithmicPlotDeactivated");l.drawLinearPlot()}else{b.linButton.setAttribute("class","smallButton linearPlotDeactivated");b.logButton.setAttribute("class","smallButton logarithmicPlotActivated");l.drawLogarithmicPlot()}}};this.linButton=document.createElement("div");this.linButton.title=STIStatic.getString("linearPlot");c.appendChild(this.linButton);this.linButton.onclick=function(){e(true)};this.logButton=document.createElement("div");this.logButton.title=STIStatic.getString("logarithmicPlot");c.appendChild(this.logButton);this.logButton.onclick=function(){e(false)};j.appendChild(this.timeAnimation);g.appendChild(k);j.appendChild(this.valueScale);g.appendChild(c);this.updateAnimationButtons(0);e(STIStatic.linearScale);if(STIStatic.dataInformation){this.infoTitle=document.createElement("td");this.infoTitle.innerHTML=o;j.appendChild(this.infoTitle);var r=document.createElement("td");this.timeElements=document.createElement("div");this.timeElements.setAttribute("class","ddbElementsCount");r.appendChild(this.timeElements);g.appendChild(r)}this.setHeight=function(){this.container.style.height=(this.plotWindow.offsetHeight+p.offsetHeight)+"px"};this.updateTimeQuantity=function(h){if(STIStatic.dataInformation){this.plotCount=h;if(h!=1){this.timeElements.innerHTML=this.beautifyCount(h)+" "+STIStatic.getString("results")}else{this.timeElements.innerHTML=this.beautifyCount(h)+" "+STIStatic.getString("result")}}};this.setTimeUnitDropdown=function(t){$(this.timeUnitSelector).empty();var s=this;var h=[];var v=function(y,x){var w=function(){s.plot.setTimeUnit(y.unit)};h.push({name:y.label,onclick:w})};for(var u=0;u<t.length;u++){v(t[u],u)}this.timeUnitDropdown=new Dropdown(this.timeUnitSelector,h,STIStatic.getString("selectTimeUnit"));this.timeUnitDropdown.setEntry(0)};this.setTimeUnitDropdown([{name:"none",id:-1}]);this.beautifyCount=function(s){var u=s+"";var t=0;var h=u.length;while(h-t>3){t+=3;u=u.substring(0,h-t)+"."+u.substring(h-t);t++;h++}return u};this.hideTimeUnitSelection=function(){this.timeUnitTitle.style.display="none";this.timeUnitSelector.style.display="none"}}function TableGui(a,b){this.tableContainer=b;if(STIStatic.tableWidth){this.tableContainer.style.width=STIStatic.tableWidth}if(STIStatic.tableHeight){this.tableContainer.style.height=STIStatic.tableHeight}}function MapWrapper(){this.initialize=function(d,b,c){this.map=new MapWidget(this,d,b,c)};var a=this;Publisher.Subscribe("highlight",this,function(b){if(typeof a.map!="undefined"){a.highlight(b)}});Publisher.Subscribe("selection",this,function(b){if(typeof a.map!="undefined"){a.select(b)}});Publisher.Subscribe("filter",this,function(b){if(typeof a.map!="undefined"){a.filter(b)}});Publisher.Subscribe("rise",this,function(b){if(typeof a.map!="undefined"){a.rise(b)}});this.display=function(c,b){if(c instanceof Array){this.map.initMap(c,b)}};this.triggerRefining=function(b){if(b&&b.length>0){Publisher.Publish("filter",b,null)}};this.triggerSelection=function(b){Publisher.Publish("selection",b,this)};this.triggerHighlight=function(b){Publisher.Publish("highlight",b,this)};this.highlight=function(b){if(b==undefined){return}if(b.length>0){this.map.highlightChanged(b)}else{this.map.highlightChanged([])}};this.select=function(b){if(b==undefined){return}if(b.length>0){this.map.selectionChanged(b)}else{this.map.selectionChanged([])}};this.filter=function(b){this.display(b)};this.rise=function(b){this.map.riseLayer(b)}}function TimeWrapper(){this.initialize=function(d,b,c){this.plot=new TimeWidget(this,d,b,c)};var a=this;Publisher.Subscribe("highlight",this,function(b){if(typeof a.plot!="undefined"){a.highlight(b)}});Publisher.Subscribe("selection",this,function(b){if(typeof a.plot!="undefined"){a.select(b)}});Publisher.Subscribe("filter",this,function(b){if(typeof a.plot!="undefined"){a.filter(b)}});this.display=function(b){if(b instanceof Array){this.plot.setStyle("graph");this.plot.initTimeplot(b)}};this.triggerRefining=function(b){if(b&&b.length>0){Publisher.Publish("filter",b,null)}};this.triggerSelection=function(b){Publisher.Publish("selection",b,this)};this.triggerHighlight=function(b){Publisher.Publish("highlight",b,this)};this.highlight=function(b){if(b==undefined){return}if(b.length>0){this.plot.highlightChanged(b)}else{if(typeof(this.plot)!="undefined"){this.plot.highlightChanged([])}}};this.select=function(b){if(b==undefined){return}if(b.length>0){if(typeof(this.plot)!="undefined"){this.plot.selectionChanged(b)}}else{if(typeof(this.plot)!="undefined"){this.plot.selectionChanged([])}}};this.filter=function(b){this.display(b)}}function TableWrapper(){this.initialize=function(b){this.table=new TableWidget(this,b)};var a=this;Publisher.Subscribe("highlight",this,function(b){if(typeof a.table!="undefined"){a.highlight(b)}});Publisher.Subscribe("selection",this,function(b){if(typeof a.table!="undefined"){a.select(b)}});Publisher.Subscribe("filter",this,function(b){if(typeof a.table!="undefined"){a.filter(b)}});this.display=function(b,c){if(typeof c!="undefined"){this.names=c}if(b instanceof Array){this.table.initTable(b,this.names)}};this.triggerRefining=function(b){if(b&&b.length>0){Publisher.Publish("filter",b,null)}};this.triggerSelection=function(b){Publisher.Publish("selection",b,this)};this.triggerHighlight=function(b){Publisher.Publish("highlight",b,this)};this.rise=function(b){Publisher.Publish("rise",b)};this.highlight=function(b){if(b==undefined){return}if(b.length>0){this.table.highlightChanged(b)}else{this.table.highlightChanged([])}};this.select=function(b){if(b==undefined){return}if(b.length>0){this.table.selectionChanged(b)}else{this.table.selectionChanged([])}};this.filter=function(b){this.display(b)}};